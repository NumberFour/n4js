<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<title>N4JS Language Specification</title>
<style>
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
@import url(https://fast.fonts.net/cssapi/20974f8a-0939-4574-aef9-681eda2faca8.css);
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ background-color: #D5DFEA; }

/** Remove default margin. */
body { margin: 0; background-color: #D5DFEA; font-family: ITC Officina Sans W01, sans-serif; font-weight: 400} /* add margin-right 0 here for mobile*/

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: 600; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: Fira Mono, monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/**
#tocbutton {
	top: 0;
	left: 13rem;
	position:fixed;
	z-index: 1000;
}
*/
/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body {  background-color:#527AA3; }

body {  background: white; color: #222222;   padding: ; margin: 0; font-family: ITC Officina Sans W01, sans-serif, Helvetica, Arial, sans-serif; font-weight: 400; font-style: normal; position: relative; cursor: auto; padding-left: 2rem; padding-right: 2rem;}


a:hover { cursor: pointer; }

img, object, embed {  height: auto; max-width: 90%; }


object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }	

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: baseline; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; text-align: center}

.spread { width: 100%; margin-right: 2rem; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1em; line-height: 1.6;  }


/* Typography padding etc */
.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 2.4; color: #132445; font-weight: 400; margin-top: 0em; margin-bottom: 0.5em;  }


/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }
div.openblock.partintro, div.sectionbody.paragraph {font-weight: 500;  line-height: 1.4; margin-bottom: 1em; }
div.sect1 {padding-top: 1rem;}

div.paragraph.faq-intro {max-width: 66%;}


/* Default Link Styles */
a { color: #6999d6; text-decoration: none; line-height: inherit;  }
a:hover, a:focus { color: #132445; }
a img { border: none; }


/* Grey links with black transition 

a { color: #2ba6cb; text-decoration: none; line-height: inherit; color: rgba(0,0,0,.3); transition: .2s; }
a:active, a:hover, a:focus { color: #212121; }
a img { border: none; }

*/



/* Default paragraph styles */
p { font-family: ITC Officina Sans W01, sans-serif; font-weight: 400; font-size: 1.2rem; line-height: 1.4; padding-bottom: 0.5em;    }
p aside { font-size: 0.575em; line-height: 1.35; font-style: italic; }
div.p, { width: 100% }


/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: ITC Officina Serif W01, Georgia, Verdana, "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; color: #244d82; text-rendering: optimizeLegibility; margin-bottom: 0em; line-height: 1.2125em; margin-top:; 2rem;  }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #6999d6; line-height: 0; }

h1 { font-size: 2.125em; max-width:66.66%;}

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: 600; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Fira Mono, Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; color: #7f0a0c; }

/* Lists */
ul, ol, dl {  list-style-position: outside; font-family: ITC Officina Sans W01, sans-serif; padding-left: 0rem; list-style-type: none}

ul, ol { margin-left: 0em;  }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em;  margin-bottom: 0;}

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */  }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: none; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0;   }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; font-size: 1.2em; font-style: italic}
dl dd { margin-bottom: 1.25em; }

/* Definition Block */
div.openblock.definition .paragraph:nth-of-type(2) {
	background-color: aliceblue;
	border-radius: 10px;
	padding: 0.5rem;
/*  
	border: burlywood;
    border-style: dotted;
    border-width: 1px; 
    						*/
}

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: inherit; color: color: #132445; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #417dcb; }

blockquote, blockquote p { line-height: 1.6; color: #132445; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4;  margin-top: 1rem; margin-bottom: 0.2rem;}
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }

/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: 600; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

/* FEATURE TABLE */

table.done, tr.done.alt, table.done tr:nth-of-type(even) {
	background: #efe;
	padding-top: 0;
	padding-bottom: 0;
	border: none;
	margin-bottom: -1px;
}

table.most, tr.most.alt, table.most tr:nth-of-type(even) {
	background: #ffd;
	padding-top: 0;
	padding-bottom: 0;
	border: none;
	margin-bottom: -1px;
}

table.tbc, tr.tbc.alt, table.tbc tr:nth-of-type(even) {
	background: #fff6de;
	padding-top: 0;
	padding-bottom: 0;
	border: none;
	margin-bottom: -1px;
}

table.tbd, tr.tbd.alt, table.tbd tr:nth-of-type(even) {
	background: #fee;
	padding-top: 0;
	padding-bottom: 0;
	border: none;
	margin-bottom: -1px;
}

table.done thead tr th, table.done tfoot tr th, table.done tfoot tr td, table.done.sect2, table.most thead tr th, table.most tfoot tr th, table.most tfoot tr td, table.most.sect2, table.tbc thead tr th, table.tbc tfoot tr th, table.tbc tfoot tr td, table.tbc.sect2, table.tbd thead tr th, table.tbd tfoot tr th, table.tbd tfoot tr td, table.tbd.sect2 {background: white; font-size: 1.9rem; color: #417dcb; }



/* 
green "done" = #efe
yellow "most" = #ffd
orange "tbc" = #fff6de
red "tbd" = #fee
 */



body { tab-size: 4; max-width: 1050px; margin-right: auto; margin-left: auto; position: relative; margin-top: 0rem; margin-bottom: 0rem; padding-top: 0rem; /*  Fixes tables, breaks headers */}

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4;  margin-top: 1rem;}

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 0; line-height: inherit; }

pre, pre > code { line-height: 1.4; color: black; font-family: monospace, serif; font-weight: normal; }

.keyseq { color: #555555; }

kbd { font-family: Consolas, "Liberation Mono", Courier, monospace; display: inline-block; color: #222222; font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #090909; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer {  max-width: 1050px; margin-right: auto; margin-left: auto; position: relative; margin-top: 0rem; margin-bottom: 0rem; padding-top: 0rem;  padding-right: 0rem;}
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }


#content:before { content: none; }

#header > h1:first-child { color: black; font-weight: bold; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #417dcb; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #6999d6; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #6999d6; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: black; font-weight: bold; border-bottom: 1px solid #dddddd; max-width: 1050px; margin-right: auto; margin-left: auto; position: relative; margin-top: 4rem; margin-bottom: 4rem; padding-top: 0rem;   }

/* ========================================================================== Table of Contents ======================================================================= */



#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; position: relative; left: 0;}
#toc > ul { margin-left: 0.125em; padding-left: 1em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; list-style-type: none; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toc ul li:before {
    content: "›";
    margin-left: -.75em;
    margin-right: .4em;
    color: #244d82
}



div.ulist li:before {
    content: "›";
    position: absolute;
    margin-top: .2rem;
    font-size: x-large;
    margin-left: -.75em;
    margin-bottom: -.75em;
    margin-right: 0;
    line-height: 1rem;
    color: #244d82

}


#toctitle { color: #244d82; font-size: 1.2em; padding-left: 1em; }

#faq {
	position: relative;
	right: 9.3rem;
    top: 9rem;
	margin-bottom: 20px;
	left: 45rem;
	z-index:1;padding-left:2rem;border-left:1px solid #d3d3d3

}
@media only screen and (max-width: 945px) {
	div#faq { display: none; }
}

#faq h2 {
	font-size: 25px;
	font-weight: 600;
	margin-top: -8rem;
}

div#faq li:before {
    content: "›";
    position: absolute;
    font-size: x-large;
    margin-left: -.75em;
    margin-bottom: -.75em;
    margin-right: 0;
    line-height: 1rem;
    color: #244d82
}

#features-nav {
	position: absolute;
	right: 1rem;
	top: 2rem;
	margin-bottom: 20px;
	position:absolute;z-index:1;padding-left:2rem;border-left:1px solid #d3d3d3
}

@media only screen and (max-width: 993px) {
	#features-nav { display: none; }
}

#features-nav h2 {
	font-size: 25px;
	font-weight: 600;
	margin-top: -1rem;
}
#features-nav li {
	margin-top: .3rem;
}

div#features-nav li:before {
    content: "›";
    position: absolute;
    font-size: x-large;
    margin-left: -.75em;
    margin-bottom: -.75em;
    margin-right: 0;
    line-height: 1rem;
    color: #244d82
}


@media only screen and (min-width: 1434px) { body.toc2.toc-right #toc.toc2 { border-right-width: 0; border: none; left: 0px; } }

@media only screen and (min-width: 1434px) { #toctitle { padding-top: 1.5rem; font-size: 1.375em; }
  body.toc2 { padding-left: 2em; padding-right: 1em; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f2f2f2; position: fixed; width: 12em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 0.25em 0em 0.25em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; padding-left: 1em;}
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 1em; padding-left: .3em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 2em; padding-right: 2em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: -13rem; } }
@media only screen and (min-width: 1535px) { 
  body.toc2 { padding-left: 2em; padding-right: 2em; }
  #toctitle { padding-top: 0rem; font-size: 1.375em; }
  #toc.toc2 { width: 13em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 0; }
  body.toc2.toc-right { padding-left: 2em; padding-right: 2em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }



#footer {  background-color: rgb(15,26,54); padding: 1.25em; padding-bottom: 0rem; margin-right: -2rem; margin-left: -2rem; margin-top: 2rem; color: white}
div.social  { background-color: rgb(15,26,54); padding: 1.25em; padding-top: 0rem; margin-right: -2rem; margin-left: -2rem; text-align: left;/* -webkit-flex-basis: 100%; -ms-flex-preferred-size: 100%; flex-basis: 100%; */  }
div.social > ul li {color: white; line-height: 1.44; font-size: 1.2em; font-weight: 800; font-style: bold position: relative; list-style: none; list-style-type: none; display: inline; text-decoration: none; }
div.social > ul a:visited { color: #244D82; }
div.social > ul a:hover { color: #F7D425; } 

#bottomright {float: right;}


@media only screen and (max-width: 1050px) {
	body {width: 100%;}
}



#footer-text { color: #dddddd; line-height: 1.44; }


.sect1 { padding-bottom: 0.625em; }
.sectionbody.paragraph {max-width: 66.666%}
.sectionbody ul {padding-left: 1rem;}

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 0em; } }
.sect1 + .sect1 { border-top: 0px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: 400; max-width: 1050px; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\2771"; font-size: 0.85em; display: block; padding-top: 0.1em; vertical-align: bas }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #244d82; text-decoration: none; font-family: ITC Officina Serif W01, sans-serif}
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #1e416e; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left;   }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0;  }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: black; max-width: 66%}

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; max-width: 80%;}
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: ITC Officina Serif W01, sans-serif, Georgia, Verdana, "Helvetica", Helvetica, Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #417dcb; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background-color: #fffef7; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { position: absolute; border-style: solid; border-width: 1px; border-color: #d9d9d9; margin: -2rem -7.5rem 0rem 63.65rem; padding: .2rem; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; text-align: left; width: 5.5rem;}
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #6999d6; margin-top: 0; }

@media only screen and (max-width: 1203px) { 
.sidebarblock { position: absolute; right: 12%; }
}
@media only screen and (max-width: 817px) { 
.sidebarblock { position: absolute; right: 18%; }
}

@media only screen and (max-width: 562px) { 
.sidebarblock { position: absolute; right: 25%; }
}

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eeeeee; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #cccccc; -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; padding: 0.8em 0.8em 0.65em 0.8em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eeeeee; background-color: black; }

.listingblock pre.highlightjs { padding: 0;  margin-right: 0em; }
.listingblock pre.highlightjs > code { padding: 0.8em 2rem 0.65em 0.8em; -webkit-border-radius: 0; border-radius: 0; padding-right: 2rem;}

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; padding-right: 2rem; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; line-height: 1.4; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #132445; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 1rem; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #6999d6; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 1em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #417dcb; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: ITC Officina Serif W01, sans-serif, "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #6999d6; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; text-align: right;}

.quoteblock .attribution, .verseblock .attribution { font-size: inherit; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: #417dcb; }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate;  }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; margin-right: 2rem;}

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; padding: 0.5rem;}

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0;}

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: 600; }

tbody tr th { display: table-cell; line-height: 1.4; background: whitesmoke; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: 600; }

p.tableblock > code:only-child { background: none; padding: 0; max-width: 100%}

p.tableblock { font-size: 1em; max-width: 100% }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }


dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: -0.2em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1em; font-size: 0.85em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { width: 1em; position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 1.25em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em;  }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0;   }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em;  }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.05em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.github-block { text-align: right; margin-right: -1rem; }
div.gist {padding-right: 2rem;}

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #207c98; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: ITC Officina Sans W01, sans-serif, "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }


.conum:not([data-value]):empty { display: none; }

.literalblock pre, .listingblock pre { background: #eeeeee; }

div#remarks.ulist {
	max-width: 70%;
}

div.title:first-of-type {
    display: none;
}

/* Mobile */

@media only screen and (max-width: 800px) {
	a#bottomright {visibility: hidden;}
	.sectionbody.paragraph {max-width: 100%}
	.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { max-width: 100% }
}

#div.paragraph.faq-intro {
	max-width: 66.66%
}
/* ========================================================================== Mobile Menu ======================================================================= */
#menu {
    display: none;
    }

div.slicknav_menu {
    padding-top: 5px;
    padding-right: 15px;
    background-color: #132445;
    margin-left: -2rem;
    margin-right: -2rem;
    text-align: right;
    display: none;
    right: 10px;
    font-size: 1rem;
    color: white;
    padding-bottom: 2rem;
    background: url("n4js-logo.png");
    background-position: 10px 10px;
    background-size: 344.48px 40px;
    background-repeat: no-repeat;
    background-color: #132445;
}

span.slicknav_menutxt {
    margin-right: -20px;
    color: white;
}

div.slicknav_menu a.scroll:first-of-type {
    color: #F7D425;
    font-size: 120%;
    font-weight: 600;
}
div.slicknav_menu ul li a {
    color: white;
}
div.slicknav_menu ul li a:hover {
    color: #F7D425;
}

div.slicknav_menu a:hover {color: #F7D425; }
div.slicknav_menu a:visited {color: white; }
div.slicknav_menu a {color: white;}
a.slicknav_btn  {
    padding: 1rem;
}


li.slicknav_parent.slicknav_open {
    color: white;
}

li.slicknav_parent.slicknav_open  {
    color: white;
}

@media screen and (max-width: 890px) {
    div.slicknav_menu {
        display: block;
        color: white
    }
    #mobile-banner {
        display: block;
    }
}

@media screen and (max-width: 470px) {
div.slicknav_menu ul:first-of-type {
    margin-top: 1.5rem;
}

div.slicknav_menu ul li {
    color: white;
}
div.slicknav_menu ul li:hover {
    color: #F7D425;
}
}
div.slicknav_menu li:last-of-type
    {
        padding-bottom: 0.7rem;
    }
/* ========================================================================== NavMenu ======================================================================= */

.banner {
  height: 1rem;
  padding-right: 2rem;
  max-height: 1rem;  
  max-width: 50%;
  vertical-align: middle;

  @media (max-width: 800px) {
    flex-basis: 66.666%%;
    max-width: 25%;
    margin: 1rem;

  }
}



#menubar ul { margin: 0; padding: 0; white-space:nowrap; padding-left: 10px; padding-right: 10px; line-height: 2rem;}
#menubar li { margin: 0; padding: 0;   }
#menubar a { margin: 0; padding: 0;}
#menubar ul {list-style: none; text-align: right;}
#menubar a {text-decoration: none;}
#menubar li {margin-left: 0;}
#menubar {height: 70px; background-color: #132445; /* box-shadow: 0px 2px 3px rgba(0,0,0,.4); */ position: relative; padding-right: 2rem; margin-left: -2rem;  margin-right: -2rem;  color: white; font-size: 1.9rem;}


#menubar > ul > li {

    display:inline-block;
    margin: 0.2rem;
    position: relative;
    z-index: 10000;
    flex-basis: 66.666%%;
    font-weight: 700;

}

@media only screen and (max-width: 890px) {

  #menubar > ul > li, #menubar {
    visibility: hidden;
    display: none;
  }
}

@media only screen and (max-width: 500px) {
#menubar {
  display: none;
}

#logo {
  margin-top: -55px;
}

}

#logo {
  height: 40px;
  width: 344.8px;
  margin-left: 40px;
  margin-top: 17px;
  position: relative;
  overflow: hidden;
}

#menubar > ul > li::after {
    content: " · ";
    position: relative;
    top: 3px;
    padding-left: 3px;
    font-weight: 400;
}

#menubar > ul > li:last-of-type::after {
  content: none;
}
#menubar > ul > li:last-of-type {
  padding-right: -1rem;
}

#menubar > ul > li > a {
    color: #FFFFFF;
    font-size:  1.2rem;
    line-height: 50px; 
    font-weight: 400;
    /* padding-top: 2rem; */
    webkit-transition: color .15s;
    -moz-transition: color .15s;
    -o-transition: color .15s;
    transition: color .15s;
    white-space:nowrap; 
    -webkit-font-smoothing: auto;
    letter-spacing: -.01em;
    padding-top: 0.2em;
    padding-left: 0.1rem;
    padding-right: 0.1rem;
}

#menubar > ul {
    margin-right: 12px;
    margin-top: 1px;
}

#menubar > ul > li > a:hover {color: #F7D425; }
body.home li.home, body.tech li.tech {font-weight:bold; }

#menubar > ul > li > ul {
    opacity: 0;
    visibility: hidden;
    padding: 18px 0 20px 0;
    background-color: #FFFFFF; /* rgb(15,26,54); top menu color */
    text-align: left;
    position: absolute;
    top: 55px;
    left: 50%;
    margin-left: -90px;
-webkit-transition: all .3s .1s;
   -moz-transition: all .3s .1s;
     -o-transition: all .3s .1s;
        transition: all .3s .1s;
-webkit-border-radius: 5px;
   -moz-border-radius: 5px;
        border-radius: 5px;
-webkit-box-shadow: 0px 1px 3px rgba(0,0,0,.4);
   -moz-box-shadow: 0px 1px 3px rgba(0,0,0,.4);
        box-shadow: 0px 1px 3px rgba(0,0,0,.4);
}

#menubar > li li {
    width:100%;
}

#menubar > ul > li:hover > ul {
    opacity: 1;
    top: 65px;
    visibility: visible;
}

#menubar > ul > li > ul:before{
    content: '';
    display: block;
    border-color: transparent transparent #FFFFFF transparent;
    border-style: solid;
    border-width: 10px;
    position: absolute;
    top: -20px;
    left: 10%;
    margin-left: -10px;
}

#menubar > ul ul > li { position: relative;}

#menubar ul ul a{
    color: rgb(50,50,50);
    font-family: ITC Officina Serif W01, sans-serif, Verdana, 'Lucida Grande';
    font-size: 17px;
    background-color: #FFFFFF; /* rgb(15,26,54); top menu color */
    padding: 5px 8px 7px 16px;
    display: block;
-webkit-transition: background-color .1s;
   -moz-transition: background-color .1s;
     -o-transition: background-color .1s;
        transition: background-color .1s;
}

#menubar ul ul a:hover {background-color: #244D82; color: #F7D425;}

#menubar ul ul ul {
    visibility: hidden;
    opacity: 0;
    position: absolute;
    top: -16px;
    left: 206px;
    padding: 16px 0 20px 0;
    background-color: #527AA3;
    text-align: left;
    width: 160px;
-webkit-transition: all .3s;
   -moz-transition: all .3s;
     -o-transition: all .3s;
        transition: all .3s;
-webkit-border-radius: 5px;
   -moz-border-radius: 5px;
        border-radius: 5px;
-webkit-box-shadow: 0px 1px 3px rgba(0,0,0,.4);
   -moz-box-shadow: 0px 1px 3px rgba(0,0,0,.4);
        box-shadow: 0px 1px 3px rgba(0,0,0,.4);
}


#menubar ul ul > li:hover > ul { opacity: 1; left: 196px; visibility: visible;}


#menubar ul ul a:hover{
    background-color: #244D82;
    color: #F7D425;
}

/* ========================================================================== Back-to-top button ======================================================================= */

a.back-to-top {
	display: none;
	width: 25px;
	height: 25px;
	text-indent: -9999px;
	position: fixed;
	z-index: 999;
	right: 15%;
	bottom: 5%;
	background: #032c52 url("up-arrow.png") no-repeat center 43%;
	-webkit-border-radius: 30px;
	-moz-border-radius: 30px;
	border-radius: 30px;
}

a:hover.back-to-top {
	background-color: #F7D425 ;
}
#tocbutton {
	visibility: hidden;
}

#tocbuttonbars.fa.fa-bars {
	z-index: 1000;
	right: 0;
}

#tocbutton:hover {
	background: url("yellowbars.png") no-repeat center 50%;
}


body.toc2.toc-right a.back-to-top {
	width: 25px;
	height: 25px;
	text-indent: -9999px;
	position: fixed;
	z-index: 1001;
	right: 90px;
	bottom: 20px;
	background: #032c52 url("up-arrow.png") no-repeat center 43%;
	-webkit-border-radius: 30px;
	-moz-border-radius: 30px;
	border-radius: 30px;
}

body.toc2.toc-right #tocbutton {
	visibility: visible;
	width: 25px;
	height: 25px;
	text-indent: -9999px;
	position: fixed;
	z-index: 998;
	border: none;
	right: 25px;
	top: 5px;
	background: url("bars.png") no-repeat center 50%;
}

body.toc2.toc-right #tocbutton:hover {
	background-color: #e3f2ff;
	background: url("yellowbars.png") no-repeat center 50%;
}

body.toc2.toc-right a:hover.back-to-top {
	background-color: #F7D425 ;
}

@media only screen and (max-width: 1535px) {
	body.toc2.toc-right #tocbutton {
	background: url("yellowbars.png") no-repeat center 50%;
	left: 98%;
	z-index: 100000;
}
@media only screen and (max-width: 1434px) {
	body.toc2.toc-right #tocbutton {
	visibility: hidden;
}

@media only screen and (min-width: ) 


@media only screen and (max-width: 1462px) {
	a.back-to-top {
	left: 90%;
}


/* ========================================================================== AsciiSpec ======================================================================= */
.requirement {
	border: 1px solid #aaaaaa;
	padding: 0.5em;
	margin-bottom: 1rem;
}

.bibliography .content .paragraph p :first-child::before { 
	color:#777777;
	content: "[" attr(id) "] "; }

.bibliography .content .paragraph {
	padding-left: 6em;
	text-indent: -6em;

</style>
<!-- ************* Meta ************* -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<!-- ************* OpenGraph ************-->
<meta name="description" content="SPEC">

<!-- ************* Favicon ************-->
<link rel="icon" href="resources/styles/favicon.ico" />

<!-- ************* Styles ************-->
<link rel="stylesheet" href="resources/styles/n4-adoc.css" />

<!-- ************* Back-to-top JQuery ************* -->
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
<script src="resources/scripts/nav-mobile.js"></script>

<!-- ****************** NavBar ****************** -->
<div id="menubar">
    <div class="banner">
      <a href="index.html"><img src="resources/styles/logo.png" alt="N4JS Specification"></a>
    </div>
<ul class="fa-ul">
	<li>
		<ul>
			<!-- insert menu items here-->
		</ul>
	</li>
</ul>
</div>
<button id="tocbutton">TOC</button>
<!-- ****************** Mobile NavBar ****************** -->
<div class="mobile-navbar">
<ul id="menu">
	<li><a class="scroll" href="index.html"><img src="resources/styles/logo.png" alt="N4JS Specification"></a>
		<ul>
<!-- insert menu items here-->
		</ul>
	</li>
</ul>
</div>

</head>
<body class="book toc2 toc-right">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_n4js_language_specification">N4JS Language Specification</a>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_notation">1.1. Notation</a></li>
<li><a href="#_auxiliary_functions">1.2. Auxiliary Functions</a></li>
</ul>
</li>
<li><a href="#_grammar">2. Grammar</a>
<ul class="sectlevel2">
<li><a href="#_lexical_conventions">2.1. Lexical Conventions</a></li>
</ul>
</li>
<li><a href="#_names">3. Names</a>
<ul class="sectlevel2">
<li><a href="#_access_control">3.1. Access Control</a></li>
<li><a href="#_accessibility_of_types_top_level_variables_and_function_declarations">3.2. Accessibility of Types, Top-Level Variables and Function Declarations</a></li>
</ul>
</li>
<li><a href="#_types">4. Types</a>
<ul class="sectlevel2">
<li><a href="#_overview">4.1. Overview</a></li>
<li><a href="#_type_expressions">4.2. Type Expressions</a></li>
<li><a href="#_type_inference">4.3. Type Inference</a></li>
<li><a href="#_generic_and_parameterized_types">4.4. Generic and Parameterized Types</a></li>
<li><a href="#_primitive_ecmascript_types">4.5. Primitive ECMAScript Types</a></li>
<li><a href="#_primitive_n4js_types">4.6. Primitive N4JS Types</a></li>
<li><a href="#_built_in_ecmascript_object_types">4.7. Built-in ECMAScript Object Types</a></li>
<li><a href="#_built_in_n4js_types">4.8. Built-In N4JS Types</a></li>
<li><a href="#_type_modifiers">4.9. Type Modifiers</a></li>
<li><a href="#_union_and_intersection_type_composed_types">4.10. Union and Intersection Type (Composed Types)</a></li>
<li><a href="#_constructor_and_classifier_type">4.11. Constructor and Classifier Type</a></li>
<li><a href="#_this_type">4.12. This Type</a></li>
<li><a href="#_enums">4.13. Enums</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_classifiers">Classifiers</a>
<ul class="sectlevel1">
<li><a href="#_n4js_specific_classifiers">5. N4JS Specific Classifiers</a>
<ul class="sectlevel2">
<li><a href="#_properties_2">5.1. Properties</a></li>
<li><a href="#_common_semantics_of_classifiers">5.2. Common Semantics of Classifiers</a></li>
<li><a href="#_classes">5.3. Classes</a></li>
<li><a href="#_interfaces">5.4. Interfaces</a></li>
<li><a href="#_generic_classifiers">5.5. Generic Classifiers</a></li>
<li><a href="#_definition_site_variance">5.6. Definition-Site Variance</a></li>
</ul>
</li>
<li><a href="#_members">6. Members</a>
<ul class="sectlevel2">
<li><a href="#_syntax_4">6.1. Syntax</a></li>
<li><a href="#_methods">6.2. Methods</a></li>
<li><a href="#_default_methods_in_interfaces">6.3. Default Methods in Interfaces</a></li>
<li><a href="#_constructors">6.4. Constructors</a></li>
<li><a href="#_data_fields">6.5. Data Fields</a></li>
<li><a href="#_static_members">6.6. Static Members</a></li>
<li><a href="#_redefinition_of_members">6.7. Redefinition of Members</a></li>
</ul>
</li>
<li><a href="#_structural_typing">7. Structural Typing</a>
<ul class="sectlevel2">
<li><a href="#_syntax_6">7.1. Syntax</a></li>
<li><a href="#_definition_site_structural_typing">7.2. Definition Site Structural Typing</a></li>
<li><a href="#_use_site_structural_typing">7.3. Use-Site Structural Typing</a></li>
<li><a href="#_structural_read_only_write_only_and_initializer_field_typing">7.4. Structural Read-only, Write-only and Initializer Field Typing</a></li>
<li><a href="#_public_setter_annotated_with_code_providesinitializer_code">7.5. Public Setter Annotated With <code>ProvidesInitializer</code></a></li>
<li><a href="#_structural_types_with_optional_fields">7.6. Structural Types With Optional Fields</a></li>
<li><a href="#_structural_types_with_access_modifier">7.7. Structural Types With Access Modifier</a></li>
<li><a href="#_structural_types_with_additional_members">7.8. Structural Types With Additional Members</a></li>
</ul>
</li>
<li><a href="#_functions">8. Functions</a>
<ul class="sectlevel2">
<li><a href="#_function_type">8.1. Function Type</a></li>
<li><a href="#_ecmascript_5_function_definition">8.2. ECMAScript 5 Function Definition</a></li>
<li><a href="#_ecmascript_2015_function_definition">8.3. ECMAScript 2015 Function Definition</a></li>
<li><a href="#_ecmascript_proposals_function_definition">8.4. ECMAScript Proposals Function Definition</a></li>
<li><a href="#_n4js_extended_function_definition">8.5. N4JS Extended Function Definition</a></li>
</ul>
</li>
<li><a href="#_conversions_and_reflection">9. Conversions and Reflection</a>
<ul class="sectlevel2">
<li><a href="#_auto_boxing_and_coercing">9.1. Auto-Boxing and Coercing</a></li>
<li><a href="#_auto_conversion_of_objects">9.2. Auto-Conversion of Objects</a></li>
<li><a href="#_type_cast_and_type_check">9.3. Type Cast and Type Check</a></li>
<li><a href="#_reflection_meta_information">9.4. Reflection meta-information</a></li>
<li><a href="#_conversion_of_primitive_types">9.5. Conversion of primitive types</a></li>
</ul>
</li>
<li><a href="#_expressions">10. Expressions</a>
<ul class="sectlevel2">
<li><a href="#_ecmascript_5_expressions">10.1. ECMAScript 5 Expressions</a></li>
<li><a href="#_ecmascript_6_expressions">10.2. ECMAScript 6 Expressions</a></li>
<li><a href="#_ecmascript_7_expressions">10.3. ECMAScript 7 Expressions</a></li>
<li><a href="#_n4js_specific_expressions">10.4. N4JS Specific Expressions</a></li>
</ul>
</li>
<li><a href="#_statements">11. Statements</a>
<ul class="sectlevel2">
<li><a href="#_ecmascript_5_statements">11.1. ECMAScript 5 Statements</a></li>
<li><a href="#_ecmascript_6_statements">11.2. ECMAScript 6 Statements</a></li>
</ul>
</li>
<li><a href="#_annotations">12. Annotations</a>
<ul class="sectlevel2">
<li><a href="#_introduction_2">12.1. Introduction</a></li>
<li><a href="#_declaration_of_annotations">12.2. Declaration of Annotations</a></li>
</ul>
</li>
<li><a href="#_extended_fetaures">13. Extended Fetaures</a>
<ul class="sectlevel2">
<li><a href="#_array_and_object_destructuring">13.1. Array and Object Destructuring</a></li>
<li><a href="#_dependency_injection">13.2. Dependency Injection</a></li>
<li><a href="#_test_support">13.3. Test Support</a></li>
<li><a href="#_polyfill_definitions">13.4. Polyfill Definitions</a></li>
</ul>
</li>
<li><a href="#_components">14. Components</a>
<ul class="sectlevel2">
<li><a href="#_n4js_platform_architecture">14.1. N4JS Platform Architecture</a></li>
<li><a href="#_component_types">14.2. Component Types</a></li>
<li><a href="#_component_content">14.3. Component Content</a></li>
<li><a href="#_component_manifest">14.4. Component Manifest</a></li>
<li><a href="#_component_dependencies">14.5. Component Dependencies</a></li>
<li><a href="#_modules">14.6. Modules</a></li>
<li><a href="#_numberfour_archives_nfar">14.7. NumberFour Archives (NFAR)</a></li>
<li><a href="#_properties_files">14.8. Properties Files</a></li>
<li><a href="#_api_and_implementation_components">14.9. API and Implementation Components</a></li>
<li><a href="#_api_and_implementation_with_di">14.10. API and Implementation With DI</a></li>
</ul>
</li>
<li><a href="#_plainjs">15. PlainJS</a>
<ul class="sectlevel2">
<li><a href="#_type_inference_and_validation_for_plain_js">15.1. Type Inference and Validation for Plain JS</a></li>
<li><a href="#_external_declarations">15.2. External Declarations</a></li>
<li><a href="#_global_definitions">15.3. Global Definitions</a></li>
<li><a href="#_runtime_definitions">15.4. Runtime Definitions</a></li>
<li><a href="#_applying_polyfills">15.5. Applying Polyfills</a></li>
</ul>
</li>
<li><a href="#_jsdoc_2">16. JSDoc</a>
<ul class="sectlevel2">
<li><a href="#_general_n4jsdoc_features">16.1. General N4JSDoc Features</a></li>
<li><a href="#_n4jsdoc_for_user_projects">16.2. N4JSdoc for User Projects</a></li>
<li><a href="#_n4jsdoc_for_api_and_implementation_projects">16.3. N4JSDoc for API and Implementation Projects</a></li>
</ul>
</li>
<li><a href="#_grammars">17. Grammars</a>
<ul class="sectlevel2">
<li><a href="#_type_expressions_grammar">17.1. Type Expressions Grammar</a></li>
<li><a href="#_n4js_language_grammar">17.2. N4JS Language Grammar</a></li>
</ul>
</li>
<li><a href="#_jsobjects">18. JSObjects</a>
<ul class="sectlevel2">
<li><a href="#_object">18.1. Object</a></li>
<li><a href="#_string">18.2. String</a></li>
<li><a href="#_boolean">18.3. Boolean</a></li>
<li><a href="#_number">18.4. Number</a></li>
<li><a href="#function">18.5. Function</a></li>
<li><a href="#_error">18.6. Error</a></li>
<li><a href="#_array">18.7. Array</a></li>
<li><a href="#_date">18.8. Date</a></li>
<li><a href="#_math">18.9. Math</a></li>
<li><a href="#_regexp">18.10. RegExp</a></li>
<li><a href="#_json">18.11. JSON</a></li>
</ul>
</li>
<li><a href="#_n4js_objects">19. N4JS Objects</a>
<ul class="sectlevel2">
<li><a href="#_reflection_model">19.1. Reflection Model</a></li>
<li><a href="#_error_types">19.2. Error Types</a></li>
</ul>
</li>
<li><a href="#_bibliography">20. Bibliography</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<h2 id="_document_attributes" class="discrete">Document Attributes</h2>
</div>
</div>
<h1 id="_n4js_language_specification" class="sect0"><a class="anchor" href="#_n4js_language_specification"></a>N4JS Language Specification</h1>
<div class="openblock partintro">
<div class="content">
<div style="page-break-after: always;"></div>
<div class="paragraph center">
<p>Version 0.4</p>
</div>
<div class="paragraph center">
<p>Revision Date: 28.10.2016</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="resources/images/n4jslogo.svg" alt="n4jslogo">
</div>
</div>
<div class="paragraph center">
<p>&#169; 2016 NumberFour AG</p>
</div>
<div class="paragraph center">
<p>Authors:<br>
Jens von Pilgrim, Jakub Siberski, Mark-Oliver Reiser,<br>
Torsten Krämer, Ákos Kitta, Sebastian Zarnekow, Lorenzo Bettini, Jörg Reichert</p>
</div>
<div style="page-break-after: always;"></div>
<h2 id="_abstract" class="discrete">Abstract</h2>
<div class="paragraph">
<p>This document contains the NumberFour JavaScript Specification.</p>
</div>
<h2 id="_revision_history" class="discrete">Revision History</h2>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Date</th>
<th class="tableblock halign-center valign-top">Tasks</th>
<th class="tableblock halign-center valign-top">Author</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>2013-03-21</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>–</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">v.Pilgrim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">initial commit</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>2016-03-13</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>–</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">v.Pilgrim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">public release, version 0.3 (alpha)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>2016-05-31</em></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">support for definition-site variance,
cf. [sec:DefinitionSiteVariance]</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>2016-07-18</em></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rename manifest property <code>artifactId</code> to <code>projectId</code>; remove <code>projectName</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>2016-09-09</em></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add <code>@CovariantConstructor</code>, cf. <a href="#Covariant_Constructors">[Covariant_Constructors]</a>, plus related
adjustments</p></td>
</tr>
</tbody>
</table>
<h2 id="_licence" class="discrete">Licence</h2>
<div class="paragraph">
<p>This specification and the accompanying materials is made available
under the terms of the Eclipse Public License v1.0 which accompanies
this distribution, and is available at <a href="http://www.eclipse.org/legal/epl-v10.html" class="bare">http://www.eclipse.org/legal/epl-v10.html</a></p>
</div>
<h3 id="_eclipse_public_license_v_1_0" class="discrete">Eclipse Public License - v 1.0</h3>
<div class="paragraph">
<p>THE ACCOMPANYING PROGRAM IS PROVIDED UNDER THE TERMS OF THIS ECLIPSE
PUBLIC LICENSE (<code>AGREEMENT</code>). ANY USE, REPRODUCTION OR DISTRIBUTION OF
THE PROGRAM CONSTITUTES RECIPIENT’S ACCEPTANCE OF THIS AGREEMENT.</p>
</div>
<h4 id="_1_definitions" class="discrete">1. DEFINITIONS</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Contribution</code> means: </dt>
<dd>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>in the case of the initial Contributor, the initial code and
documentation distributed under this Agreement, and</p>
</li>
<li>
<p>in the case of each subsequent Contributor:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>changes to the Program, and</p>
</li>
<li>
<p>additions to the Program;</p>
<div class="paragraph">
<p>where such changes and/or additions to the Program originate from and
are distributed by that particular Contributor. A Contribution
’originates’ from a Contributor if it was added to the Program by such
Contributor itself or anyone acting on such Contributor’s behalf.
Contributions do not include additions to the Program which:</p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>are separate modules of software distributed in conjunction with the Program
under their own license agreement, and</p>
</li>
<li>
<p>are not derivative works of the Program.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</dd>
<dt class="hdlist1"><code>Contributor</code></dt>
<dd>
<p>means any person or entity that distributes the Program.</p>
</dd>
<dt class="hdlist1"><code>Licensed Patents</code> </dt>
<dd>
<p>mean patent claims licensable by a Contributor
which are necessarily infringed by the use or sale of its Contribution
alone or when combined with the Program.</p>
</dd>
<dt class="hdlist1"><code>Program</code> </dt>
<dd>
<p>means the Contributions distributed in accordance with this
Agreement.</p>
</dd>
<dt class="hdlist1"><code>Recipient</code> </dt>
<dd>
<p>means anyone who receives the Program under this
Agreement, including all Contributors.</p>
</dd>
</dl>
</div>
<h4 id="_2_grant_of_rights" class="discrete">2. GRANT OF RIGHTS</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Subject to the terms of this Agreement, each Contributor hereby
grants Recipient a non-exclusive, worldwide, royalty-free copyright
license to reproduce, prepare derivative works of, publicly display,
publicly perform, distribute and sublicense the Contribution of such
Contributor, if any, and such derivative works, in source code and
object code form.</p>
</li>
<li>
<p>Subject to the terms of this Agreement, each Contributor hereby
grants Recipient a non-exclusive, worldwide, royalty-free patent license
under Licensed Patents to make, use, sell, offer to sell, import and
otherwise transfer the Contribution of such Contributor, if any, in
source code and object code form. This patent license shall apply to the
combination of the Contribution and the Program if, at the time the
Contribution is added by the Contributor, such addition of the
Contribution causes such combination to be covered by the Licensed
Patents. The patent license shall not apply to any other combinations
which include the Contribution. No hardware per se is licensed
hereunder.</p>
</li>
<li>
<p>Recipient understands that although each Contributor grants the
licenses to its Contributions set forth herein, no assurances are
provided by any Contributor that the Program does not infringe the
patent or other intellectual property rights of any other entity. Each
Contributor disclaims any liability to Recipient for claims brought by
any other entity based on infringement of intellectual property rights
or otherwise. As a condition to exercising the rights and licenses
granted hereunder, each Recipient hereby assumes sole responsibility to
secure any other intellectual property rights needed, if any. For
example, if a third party patent license is required to allow Recipient
to distribute the Program, it is Recipient’s responsibility to acquire
that license before distributing the Program.</p>
</li>
<li>
<p>Each Contributor represents that to its knowledge it has sufficient
copyright rights in its Contribution, if any, to grant the copyright
license set forth in this Agreement.</p>
</li>
</ol>
</div>
<h4 id="_3_requirements" class="discrete">3. REQUIREMENTS</h4>
<div class="paragraph">
<p>A Contributor may choose to distribute the Program in object code form
under its own license agreement, provided that:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>it complies with the terms and conditions of this Agreement; and</p>
</li>
<li>
<p>its license agreement:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>effectively disclaims on behalf of all Contributors all warranties
and conditions, express and implied, including warranties or conditions
of title and non-infringement, and implied warranties or conditions of
merchantability and fitness for a particular purpose;</p>
</li>
<li>
<p>effectively excludes on behalf of all Contributors all liability for
damages, including direct, indirect, special, incidental and
consequential damages, such as lost profits;</p>
</li>
<li>
<p>states that any provisions which differ from this Agreement are
offered by that Contributor alone and not by any other party; and</p>
</li>
<li>
<p>states that source code for the Program is available from such
Contributor, and informs licensees how to obtain it in a reasonable
manner on or through a medium customarily used for software exchange.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the Program is made available in source code form:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>it must be made available under this Agreement; and</p>
</li>
<li>
<p>a copy of this Agreement must be included with each copy of the
Program.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Contributors may not remove or alter any copyright notices contained
within the Program.</p>
</div>
<div class="paragraph">
<p>Each Contributor must identify itself as the originator of its
Contribution, if any, in a manner that reasonably allows subsequent
Recipients to identify the originator of the Contribution.</p>
</div>
<h4 id="_4_commercial_distribution" class="discrete">4. COMMERCIAL DISTRIBUTION</h4>
<div class="paragraph">
<p>Commercial distributors of software may accept certain responsibilities
with respect to end users, business partners and the like. While this
license is intended to facilitate the commercial use of the Program, the
Contributor who includes the Program in a commercial product offering
should do so in a manner which does not create potential liability for
other Contributors. Therefore, if a Contributor includes the Program in
a commercial product offering, such Contributor (<code>Commercial
Contributor</code>) hereby agrees to defend and indemnify every other
Contributor (<code>Indemnified Contributor</code>) against any losses, damages
and costs (collectively <code>Losses</code>) arising from claims, lawsuits and
other legal actions brought by a third party against the Indemnified
Contributor to the extent caused by the acts or omissions of such
Commercial Contributor in connection with its distribution of the
Program in a commercial product offering. The obligations in this
section do not apply to any claims or Losses relating to any actual or
alleged intellectual property infringement. In order to qualify, an
Indemnified Contributor must: a) promptly notify the Commercial
Contributor in writing of such claim, and b) allow the Commercial
Contributor to control, and cooperate with the Commercial Contributor
in, the defense and any related settlement negotiations. The Indemnified
Contributor may participate in any such claim at its own expense.</p>
</div>
<div class="paragraph">
<p>For example, a Contributor might include the Program in a commercial
product offering, Product X. That Contributor is then a Commercial
Contributor. If that Commercial Contributor then makes performance
claims, or offers warranties related to Product X, those performance
claims and warranties are such Commercial Contributor’s responsibility
alone. Under this section, the Commercial Contributor would have to
defend claims against the other Contributors related to those
performance claims and warranties, and if a court requires any other
Contributor to pay any damages as a result, the Commercial Contributor
must pay those damages.</p>
</div>
<h4 id="_5_no_warranty" class="discrete">5. NO WARRANTY</h4>
<div class="paragraph">
<p>EXCEPT AS EXPRESSLY SET FORTH IN THIS AGREEMENT, THE PROGRAM IS PROVIDED
ON AN <code>AS IS</code> BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
EITHER EXPRESS OR IMPLIED INCLUDING, WITHOUT LIMITATION, ANY WARRANTIES
OR CONDITIONS OF TITLE, NON-INFRINGEMENT, MERCHANTABILITY OR FITNESS FOR
A PARTICULAR PURPOSE. Each Recipient is solely responsible for
determining the appropriateness of using and distributing the Program
and assumes all risks associated with its exercise of rights under this
Agreement , including but not limited to the risks and costs of program
errors, compliance with applicable laws, damage to or loss of data,
programs or equipment, and unavailability or interruption of operations.</p>
</div>
<h4 id="_6_disclaimer_of_liability" class="discrete">6. DISCLAIMER OF LIABILITY</h4>
<div class="paragraph">
<p>EXCEPT AS EXPRESSLY SET FORTH IN THIS AGREEMENT, NEITHER RECIPIENT NOR
ANY CONTRIBUTORS SHALL HAVE ANY LIABILITY FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING
WITHOUT LIMITATION LOST PROFITS), HOWEVER CAUSED AND ON ANY THEORY OF
LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OR
DISTRIBUTION OF THE PROGRAM OR THE EXERCISE OF ANY RIGHTS GRANTED
HEREUNDER, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.</p>
</div>
<h4 id="_7_general" class="discrete">7. GENERAL</h4>
<div class="paragraph">
<p>If any provision of this Agreement is invalid or unenforceable under
applicable law, it shall not affect the validity or enforceability of
the remainder of the terms of this Agreement, and without further action
by the parties hereto, such provision shall be reformed to the minimum
extent necessary to make such provision valid and enforceable.</p>
</div>
<div class="paragraph">
<p>If Recipient institutes patent litigation against any entity (including
a cross-claim or counterclaim in a lawsuit) alleging that the Program
itself (excluding combinations of the Program with other software or
hardware) infringes such Recipient’s patent(s), then such Recipient’s
rights granted under Section 2(b) shall terminate as of the date such
litigation is filed.</p>
</div>
<div class="paragraph">
<p>All Recipient’s rights under this Agreement shall terminate if it fails
to comply with any of the material terms or conditions of this Agreement
and does not cure such failure in a reasonable period of time after
becoming aware of such noncompliance. If all Recipient’s rights under
this Agreement terminate, Recipient agrees to cease use and distribution
of the Program as soon as reasonably practicable. However, Recipient’s
obligations under this Agreement and any licenses granted by Recipient
relating to the Program shall continue and survive.</p>
</div>
<div class="paragraph">
<p>Everyone is permitted to copy and distribute copies of this Agreement,
but in order to avoid inconsistency the Agreement is copyrighted and may
only be modified in the following manner. The Agreement Steward reserves
the right to publish new versions (including revisions) of this
Agreement from time to time. No one other than the Agreement Steward has
the right to modify this Agreement. The Eclipse Foundation is the
initial Agreement Steward. The Eclipse Foundation may assign the
responsibility to serve as the Agreement Steward to a suitable separate
entity. Each new version of the Agreement will be given a distinguishing
version number. The Program (including Contributions) may always be
distributed subject to the version of the Agreement under which it was
received. In addition, after a new version of the Agreement is
published, Contributor may elect to distribute the Program (including
its Contributions) under the new version. Except as expressly stated in
Sections 2(a) and 2(b) above, Recipient receives no rights or licenses
to the intellectual property of any Contributor under this Agreement,
whether expressly, by implication, estoppel or otherwise. All rights in
the Program not expressly granted under this Agreement are reserved.</p>
</div>
<div class="paragraph">
<p>This Agreement is governed by the laws of the State of New York and the
intellectual property laws of the United States of America. No party to
this Agreement will bring a legal action under this Agreement more than
one year after the cause of action arose. Each party waives its rights
to a jury trial in any resulting litigation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This specification defines the N4JS language.</p>
</div>
<div class="paragraph">
<p>In general, the N4 JavaScript dialect used is identical to the standard
ECMAScript as defined in the 6th edition of ECMA-262, also known as
ECMAScript 2015, referred to as [<a href="#ECMA15a">ECMA15a</a>].</p>
</div>
<div class="sect2">
<h3 id="_notation"><a class="anchor" href="#_notation"></a>1.1. Notation</h3>
<div class="sect3">
<h4 id="_grammar_notation"><a class="anchor" href="#_grammar_notation"></a>1.1.1. Grammar Notation</h4>
<div class="paragraph">
<p>For the specification of the syntax and structure of elements, we use a
slightly augmented similar to the grammar language of Xtext <a href="http://www.eclipse.org/Xtext/documentation.html\#grammarLanguage">Grammar Language</a>.</p>
</div>
<div class="paragraph">
<p>Similar to [<a href="#ECMA11a">ECMA11a</a>], we define types with properties only for the purpose of
explanation and usage within this specification. We use the Xtext
notation style to assign values to meta-properties. Particularly, we use
the Xtext notation for collection (<code>+=</code>) and boolean (<code>?=</code>) values. These
properties are written in italics. Enumerations are defined similar to
Xtext. In order to allow the specification of default values, which are
often defined by omitting the value, we always define the literal
explicitly if it can be defined by the user.</p>
</div>
<div class="paragraph">
<p>The following lists informally defines the grammar:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Terminal</dt>
<dd>
<p>Terminals (or terminal strings) are enclosed in single quotes, e.g., <code>terminal</code>.</p>
</dd>
<dt class="hdlist1">Enumerations</dt>
<dd>
<p>Rules which contain only terminals used as values for properties are
marked with <code>enum</code> for enumeration.</p>
</dd>
<dt class="hdlist1">Properties</dt>
<dd>
<p>Values of non-terminals, e.g., other rules, can be assigned to
properties. The property name and the assignment are not part of the
original syntax and only used for the meta description. E.g., <code><em>name=</em>Identifier</code>.</p>
</dd>
<dt class="hdlist1">Collection Properties</dt>
<dd>
<p>If a property is a collection, values are added to that list via <code>+=</code>.
E.g.,<code><em>property+=</em>Value</code> .</p>
</dd>
<dt class="hdlist1">Boolean Properties</dt>
<dd>
<p>Boolean properties are set to false by default, if the value (usually
a terminal) is found, the boolean value is set to true. Often, the
name of the property is similar to the terminal. E.g., <code><em>final?</em>='final'?</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Properties of a non-terminal are sometimes listed again below the
grammar. In that case, often pseudo properties are introduced which are
derived from other properties and which are only used for
simplification.</p>
</div>
</div>
<div class="sect3">
<h4 id="_type_judgments_and_rules_and_constraints_notation"><a class="anchor" href="#_type_judgments_and_rules_and_constraints_notation"></a>1.1.2. Type Judgments and Rules and Constraints Notation</h4>
<div class="sect4">
<h5 id="_typing_rules_and_judgments"><a class="anchor" href="#_typing_rules_and_judgments"></a>Typing Rules and Judgments</h5>
<div class="openblock definition">
<div class="content">
<div class="paragraph">
<p><strong>Definition:</strong> <a href="#rule">Rule</a></p>
</div>
<div class="paragraph">
<p>We use the common notation for rules such as type
inference rules
<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</sup>]
, that is</p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mfrac><mrow><mi>p</mi><mi>r</mi><mi>e</mi><mi>m</mi><mi>i</mi><mi>s</mi><mi>e</mi><mi>s</mi></mrow><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>l</mi><mi>u</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></mfrac><mspace width="5.0mm"/><mstyle mathvariant="normal"><mtext>rule name</mtext></mstyle></math></p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mi>r</mi><mi>e</mi><mi>m</mi><mi>i</mi><mi>s</mi><mi>e</mi><mi>s</mi></math> is the rule’s premises (e.g., the expression to
be inferred), <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>l</mi><mi>u</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></math> the result of the rule.
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi><mi>u</mi><mi>l</mi><mi>e</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></math> is an optional condition which may be omitted.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Both parts of the rule may contain multiple expressions, which are
concatenated via and. For example, the following
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mfrac><mrow><msub><mi>P</mi><mn>1</mn></msub><mspace width="5.0mm"/><msub><mi>P</mi><mn>2</mn></msub><mspace width="5.0mm"/><msub><mi>P</mi><mn>3</mn></msub></mrow><mi>C</mi></mfrac></math> can be read as
' <code>if <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>P</mi><mn>1</mn></msub></math>, <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>P</mi><mn>2</mn></msub></math>, and <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>P</mi><mn>3</mn></msub></math> are all true, then <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> is true as well</code> '.</p>
</div>
<div class="paragraph">
<p>The following judgments (with relation symbols) are used:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">subtype <code>&lt;</code> </dt>
<dt class="hdlist1">type<code>:</code> </dt>
<dd>
<p>in which the left hand side is a declaration or
expression, and the right hand side a type. We also use
<math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mo>.</mo><mo>.</mo></mrow></math> as a function returning the (inferred) type
of an expression.</p>
</dd>
<dt class="hdlist1">expectedTypeIn <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>:</mi></math> </dt>
<dd>
<p> a relation with three arguments:
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>:</mi><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi></math> means, that
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></math> is expected to be a subtype of
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi></math> inside <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>r</mi></math></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following statement, for example, defines transitivity of subtypes
(in a simplified manner):</p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mfrac><mrow><mi>Γ</mi><mi>B</mi><mo>⊢</mo><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>A</mi><mspace width="7.0mm"/><mi>Γ</mi><mo>⊢</mo><mi>C</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>B</mi></mrow><mrow><mi>Γ</mi><mo>⊢</mo><mi>C</mi><mi>:</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>A</mi></mrow></mfrac></math></p>
</div>
<div class="paragraph">
<p>is the context containing (bound) type variables etc.,
<math xmlns="http://www.w3.org/1998/Math/MathML"/> can be read as <code>entails</code>. Thus, the rule can be
read as follows: if the type B is a subtype of type A in context (i.e.
with constraints on type variables specified in ), and if type C is a
subtype of B, then C is also a subtype of A in context .</p>
</div>
<div class="paragraph">
<p>In rules, we sometimes omit the environment if it is not needed. New
information is sometimes added to the environment, in particular,
substitutions (that is binding type variables to a type). The set of
substitutions is written with <math xmlns="http://www.w3.org/1998/Math/MathML"/> (theta). If new
substitutions are explicitly added to that set, we write
<math xmlns="http://www.w3.org/1998/Math/MathML"><mfenced close=")" open="("><mrow><mi>V</mi><mo>←</mo><mi>T</mi></mrow></mfenced></math> (<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>V</mi></math> is substituted
with type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>). Often, these bindings are computed from a
parameterized type reference which declares type arguments which are
bound to the type variables of the generic declaration. In this case we
simply write <math xmlns="http://www.w3.org/1998/Math/MathML"><mfenced close=")" open="("><mi>p</mi></mfenced></math>, in which <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math> is the
parameterized type declaration. As these new substitutions must become
part of a (newly) created environment, we then usually write
<math xmlns="http://www.w3.org/1998/Math/MathML"><mfenced close=")" open="("><mi>p</mi></mfenced></math>. These substitutions are usually
omitted.</p>
</div>
</div>
<div class="sect4">
<h5 id="_types_of_an_element"><a class="anchor" href="#_types_of_an_element"></a>Types of an Element</h5>
<div class="paragraph">
<p>A variable or other typed element may be associated with three types:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Declared type: the type explicitly specified in the code, e.g., .</p>
</li>
<li>
<p>Inferred type: the type inferred by the type inferencer, e.g.,
infers the type of s to <code>string</code>. I.e.
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Γ</mi><mo>⊢</mo><mi>s</mi><mi>:</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow></math> will be true, or
<math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mo>[</mo><mspace width="-0.167em"/><mrow><mo>[</mo><mi>s</mi></mrow></mrow></math>\!] &lt; :string $\]]. If an element is
annotated with a type ,i.e. it has a declared type, the inferred type
will always be the declared type.</p>
</li>
<li>
<p>Actual type: the actual type of a variable during runtime. This type
information is not available at compile time and ignored in this
specification.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>These types are not type declarations but type references, in fact, as
they may be parameterized. For the sake of simplicity, we often omit the
<code>Ref</code> suffix to shorten formulas. Consequently, we define the
following properties and pseudo properties for typed elements such as
variables:</p>
</div>
<div class="paragraph">
<p>The explicitly declared type, this is usually a real property of the
construct. Not all elements allow the specification of a declared type,
such as expressions.</p>
</div>
<div class="paragraph">
<p>or <math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mo>.</mo><mo>.</mo></mrow></math>: This pseudo property is the inferred type
computed by the type inferencer.</p>
</div>
<div class="paragraph">
<p>A pseudo property for elements with a <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi></math>
property. It is similar to the inferred type, i.e.
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>=</mo><mi>e</mi></math></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_auxiliary_functions"><a class="anchor" href="#_auxiliary_functions"></a>1.2. Auxiliary Functions</h3>
<div class="paragraph">
<p>This section describes some auxiliary functions required for definition
of type inference rules later on.</p>
</div>
<div class="sect3">
<h4 id="_binding"><a class="anchor" href="#_binding"></a>1.2.1. Binding</h4>
<div class="paragraph">
<p>Binding an identifier (variable reference) to a variable declaration (or
variable definition) is not part of this specification as this is
standard ECMAScript functionality. However, some valid ECMAScript
bindings are permitted due to visibility constraints.</p>
</div>
<div class="openblock definition">
<div class="content">
<div class="paragraph">
<p><strong>Definition:</strong> <a href="#binding_relation">Binding Relation</a></p>
</div>
<div class="paragraph">
<p>We define a pseudo relation
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>b</mi><mi>i</mi><mi>n</mi><mi>d</mi><mi>:</mi><mi>V</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo>×</mo><mi>V</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi><mi>D</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></math>
which binds a reference, i.e. an identifier, to a declaration (e.g.,variable
declaration).</p>
</div>
<div class="paragraph">
<p>Binding of variable references to declaration is defined by ECMAScript
already. Type references only occur in type expressions, how these are
handled is explained in [sec:Type_Expressions].</p>
</div>
<div class="paragraph">
<p>We usually omit this binding mechanism in most rules and use the
reference similarly to the declaration or definition it is bound to. If
a variable reference <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi></math>, for example, is bound to a
variable declaration <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi></math>, i.e. <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>b</mi><mi>i</mi><mi>n</mi><mi>d</mi><mfenced close=")" open="("><mi>r</mi><mi>D</mi></mfenced></math>, we
simply write <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi></math> instead of
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>b</mi><mi>i</mi><mi>n</mi><mi>d</mi><mfenced close=")" open="("><mi>r</mi><mi>D</mi></mfenced><mo>,</mo><mi>D</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi></math> to refer to the type expression (of the
variable).</p>
</div>
</div>
</div>
<div class="paragraph">
<p><sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnote_2" title="View footnote.">2</a>]</sup></p>
</div>
<div class="paragraph">
<p>A <code>DeclaredType</code> references the type declaration by its simple name that has been
imported from a module specifier. We define the method
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>b</mi><mi>i</mi><mi>n</mi><mi>d</mi></math> for declared types as well:</p>
</div>
<div class="openblock definition">
<div class="content">
<div class="paragraph">
<p><strong>Definition:</strong> <a href="#binding_relation_of_types">Binding Relation of Types</a></p>
</div>
<div class="paragraph">
<p>We define a pseudo relation
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>b</mi><mi>i</mi><mi>n</mi><mi>d</mi><mi>:</mi><mi>D</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>×</mo><mi>C</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi><mo>|</mo><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi><mo>|</mo><mi>E</mi><mi>n</mi><mi>u</mi><mi>m</mi></math>
which binds a type reference, i.e. a simple name, to the type declaration.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_merging_types"><a class="anchor" href="#_merging_types"></a>1.2.2. Merging Types</h4>
<div class="paragraph">
<p>In some cases we have to merge types, e.g., types of a union type or
item types of an array. For that purpose, we define a method
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>m</mi><mi>e</mi><mi>r</mi><mi>g</mi><mi>e</mi></math> as follows.</p>
</div>
<div class="paragraph">
<p>[Merge Function][def:Merge Function] We define a pseudo function
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>m</mi><mi>e</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>:</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>×</mo><mo>×</mo><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mfenced close=")" open="("><mrow><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi></mrow></mfenced></math></p>
</div>
<div class="paragraph">
<p>The idea of this function is to remove duplicates. For example; if a
union type contains two type expressions <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><msub><mi>e</mi><mn>1</mn></msub></math> and
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><msub><mi>e</mi><mi>k</mi></msub></math>, and if <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>τ</mi><mfenced close=")" open="("><mrow><mi>t</mi><msub><mi>e</mi><mn>1</mn></msub></mrow></mfenced><mo>=</mo><mi>τ</mi><mfenced close=")" open="("><mrow><mi>t</mi><msub><mi>e</mi><mn>2</mn></msub></mrow></mfenced></math>, then
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>m</mi><mi>e</mi><mi>r</mi><mi>g</mi><mi>e</mi><mfenced close=")" open="("><mrow><mi>τ</mi><mfenced close=")" open="("><mrow><mi>t</mi><msub><mi>e</mi><mn>1</mn></msub></mrow></mfenced></mrow><mrow><mi>τ</mi><mfenced close=")" open="("><mrow><mi>t</mi><msub><mi>e</mi><mn>2</mn></msub></mrow></mfenced></mrow></mfenced></math> contains only one element.
The order of the elements is lost, however.</p>
</div>
<div class="sect4">
<h5 id="_logic_formulars"><a class="anchor" href="#_logic_formulars"></a>Logic Formulars</h5>
<div class="paragraph">
<p>In general, we use a pragmatic mixture of pseudo code, predicate logic,
and OCL. Within constraints (also within the inference rules), the
properties defined in the grammar are used.</p>
</div>
<div class="paragraph">
<p>In some rules, it is necessary to type the rule variables. Instead of
explicitly checking the metatype (via
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>μ</mi><mfenced close=")" open="("><mi>X</mi></mfenced><mo>=</mo><mi>:</mi><mrow><mi>M</mi><mi>e</mi><mi>t</mi><mi>a</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi></mrow></math>), we precede the variable with the
type, that is: <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>:</mi><mrow><mi>M</mi><mi>e</mi><mi>t</mi><mi>a</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi></mrow><mi>X</mi></math>.</p>
</div>
<div class="paragraph">
<p>Instead of <code>type casting</code> elements, often properties are simply
accessed. If an element does not define that element, it is either
assumed to be false or null by default.</p>
</div>
<div class="paragraph">
<p>If a property <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math> is optional and not set, we write
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mo>=</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi></math> to test its absence. Note that <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mo>=</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi></math>
is different from <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mo>=</mo><mi>N</mi><mi>u</mi><mi>l</mi><mi>l</mi></math>, as the latter refers to the null
type. Non-terminals may implicitly be subclasses. In that case, the
concrete non-terminal, or type, of a property may be subject for a test
in a constraint.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_symbols_and_font_convention"><a class="anchor" href="#_symbols_and_font_convention"></a>1.2.3. Symbols and Font Convention</h4>
<div class="paragraph">
<p>Variables and their properties are printed in italic when used in
formulas (such as rules). A dot-notation is used for member access, e.g.
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>v</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></math>. Also defined functions are printed in italic,
e.g., <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mi>c</mi><mi>c</mi><mfenced close=")" open="("><mi>r</mi><mi>D</mi></mfenced></math>. Properties which define sets are usually
ordered and we assume 0-indexed access to elements, the index
subscripted, e.g., <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>v</mi><mo>.</mo><mi>m</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi><msub><mi>s</mi><mi>i</mi></msub></math>.</p>
</div>
<div class="paragraph">
<p>We use the following symbols and font conventions:</p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∧</mo></math>, <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∨</mo></math>, <math xmlns="http://www.w3.org/1998/Math/MathML"/>,
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>¬</mo></math>::
  Logical and, or, exclusive or (xor), and not.
<math xmlns="http://www.w3.org/1998/Math/MathML"/>, <math xmlns="http://www.w3.org/1998/Math/MathML"/>,
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>.</mo><mo>.</mo><mo>.</mo><mo>.</mo></math>::
  Logical implication, if and only if, and if-then-else.
<math xmlns="http://www.w3.org/1998/Math/MathML"/>, <math xmlns="http://www.w3.org/1998/Math/MathML"/>, <math xmlns="http://www.w3.org/1998/Math/MathML"/>,
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>∅</mi></math>::
  Boolean true, boolean false, null (i.e., not specified, e.g.,
  <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>v</mi><mo>.</mo><mi>s</mi><mi>u</mi><mi>p</mi><mo>=</mo></math> means that there are is no <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mi>u</mi><mi>p</mi></math>
  (super class) specified), empty set.
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∈</mo></math>, <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∉</mo></math>, <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∪</mo></math>,
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∩</mo></math>, <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>|</mo><mi>x</mi><mo>|</mo></math>::
  Element of, not an element of, union set, intersection set,
  cardinality of set x.
<math xmlns="http://www.w3.org/1998/Math/MathML"><mfenced close=")" open="("><mi>X</mi></mfenced></math>::
  Power set of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math>, i.e.
  <math xmlns="http://www.w3.org/1998/Math/MathML"><mfenced close=")" open="("><mi>X</mi></mfenced><mo>=</mo><mfenced close="}" open="{"><mrow><mi>U</mi><mi>:</mi><mi>U</mi><mo>⊆</mo><mi>X</mi></mrow></mfenced></math>.
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∃</mo></math>, <math xmlns="http://www.w3.org/1998/Math/MathML"/>, <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo></math>::
  Exists, not exists, for all; we write
  <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∃</mo><mi>x</mi><mo>,</mo><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi><mo>,</mo><mi>z</mi><mi>:</mi><mi>P</mi><mfenced close=")" open="("><mi>x</mi><mrow><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi></mrow><mi>z</mi></mfenced></math> and say <code>there exists
  <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>,</mo><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi><mo>,</mo><mi>z</mi></math> such that predicate <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi></math> is true</code>.
  Note that <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mi>:</mi><mi>P</mi><mfenced close=")" open="("><mi>x</mi></mfenced><mo>∀</mo><mi>x</mi><mi>:</mi><mo>¬</mo><mi>P</mi><mfenced close=")" open="("><mi>x</mi></mfenced></math>.
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>μ</mi><mfenced close=")" open="("><mrow><mo>.</mo><mo>.</mo></mrow></mfenced></math>::
  (mu) read <code>metatype of</code>; metatype of a variable or property, e.g.,
  <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>μ</mi><mfenced close=")" open="("><mi>x</mi></mfenced><mo>=</mo><mi>:</mi><mrow><mi>C</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi></mrow><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi></math> .
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math>::
  Sequence of elements <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>x</mi><mi>n</mi></msub></math>. E.g., if we want to
  define a constraint that the owner of a members of a class
  <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> is the class, we simply write
  <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>C</mi><mo>.</mo><mrow><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi></mrow><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>r</mi><mo>=</mo><mi>C</mi></math> instead of
  <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><mi>m</mi><mo>∈</mo><mi>C</mi><mo>.</mo><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>:</mi><mi>m</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>r</mi><mo>=</mo><mi>C</mi></math> or even more
  complicated with index variables.</p>
</div>
<div class="paragraph">
<p>Sequences are 1-based, e.g., a sequence <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math> with length
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>|</mo><mi>s</mi><mo>|</mo><mo>=</mo><mi>n</mi></math>, has elements <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>s</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>s</mi><mi>n</mi></msub></math>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_grammar"><a class="anchor" href="#_grammar"></a>2. Grammar</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lexical_conventions"><a class="anchor" href="#_lexical_conventions"></a>2.1. Lexical Conventions</h3>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-7" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-7</a>
</div>
</div>
<div class="paragraph">
<p>As a super language on top of ECMAScript, the same lexical conventions are supported as described in
[<a href="#ECMA11a">ECMA11a(p.S7)</a>] within strict mode.
Some further constraints are defined, however, restricting certain constructs. These constraints are described in the following.</p>
</div>
<div class="sect3">
<h4 id="_identifier_names_and_identifiers"><a class="anchor" href="#_identifier_names_and_identifiers"></a>2.1.1. Identifier Names and Identifiers</h4>
<div class="paragraph">
<p>Cf. [<a href="#ECMA11a">ECMA11a(p.S7.6)</a>], [<a href="#ECMA11a">ECMA11a(p.S11.1.2, p.p.63)</a>] and [<a href="#ECMA11a">ECMA11a(p.S01.2, p.p.51ff)</a>].</p>
</div>
<div class="paragraph">
<p>As a reminder, identifiers are defined as follows in the ECMAScript specification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>IdentifierName: IdentifierStart* IdentifierPart;
IdentifierStart : UnicodeLetter | '_';
                \ UnicodeEscapeSequence</code></pre>
</div>
</div>
<div class="paragraph">
<p>N4JS supports a limited form of computed-names for member declarations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>N4JSPropertyComputedName:
    '[' (SymbolLiteralComputedName | StringLiteralComputedName) ']'
;

SymbolLiteralComputedName: N4JSIdentifier '.' N4JSIdentifier ;

StringLiteralComputedName: STRING ;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As can be seen, a computed-name must be either</p>
</div>
<div class="ulist">
<ul>
<li>
<p> a symbol reference, e.g. <code>Symbol.iterator</code>,</p>
</li>
<li>
<p> a string literal, i.e., a compile time known constant. This notation is useful when interoperating with libraries that define members whose
names contain special characters (e.g., a field name starting with
commercial-at)</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1220" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1220</a>
<a href="https://jira.numberfour.eu/browse/IDE-1734" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1734</a>
</div>
</div>
<div class="paragraph">
<p>In N4JS, identifiers are further constrained in order to avoid
ambiguities and to make code more readable. Some of these constraints
will lead to errors, others only to warnings. They do not apply for
identifiers declared in definitions file (n4jsd) in order to enable
declaration of external entities.</p>
</div>
<div id="req:N4JS_identifier_restrictions" class="olist arabic">
<ol class="arabic">
<li>
<p>If the following constraints do not hold, errors are created.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Leading <code>$</code> (dollar sign) character is prohibited for any variable
name such as fields, variables, types functions and methods.</p>
</li>
<li>
<p>Leading <code> _ </code> (underscore) character is not allowed for identifying any
functions or methods.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="olist req:N4JS_identifier_recommendations">
<div class="title">N4JS identifier recommendations</div>
<ol class="req:N4JS_identifier_recommendations">
<li>
<p>If the following constraints do not hold, warnings are created.</p>
</li>
<li>
<p>Variable names should, in general, be constructed form the 26 ASCII
upper and lower case alphabetic letters (a..z, A..Z), from the 10
decimal digits (0..9) and from the _ (underline). Although the usage of
the international characters are allowed (according to the ECMAScript
specification) it is discouraged because these characters may not be
read or understood well in every circumstance.
<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnote_3" title="View footnote.">3</a>]</sup></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Type (and Type Variable) Identifiers</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>TypeIdentifier: [_A-Z][_a-zA-Z0-9]*
TypeVariableIdentifier: [_A-Z][_a-zA-Z0-9]*</code></pre>
</div>
</div>
</li>
<li>
<p>Package Identifiers</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>PackageIdentifier: [_a-z][._a-zA-Z0-9]*; // i.e. the folder names, must not end with .</code></pre>
</div>
</div>
</li>
<li>
<p>Member Identifiers and Enum Literals</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>InstanceFieldIdentifier: [_a-z][_a-zA-Z0-9]*
StaticFieldIdentifier: [_A-Z][_A-Z0-9]*([_A-Z0-9]+)*
EnumLiteral: [_A-Z][_A-Z0-9]*([_A-Z0-9]+)*</code></pre>
</div>
</div>
</li>
<li>
<p>Variable and Parameter Names</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>VariableIdentifier: [_a-zA-Z0-9]*
􏰀ParameterIdentifier: [_a-z][_a-zA-Z0-9]*</code></pre>
</div>
</div>
</li>
<li>
<p>Methods</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>MethodIdentifier: [_a-z][_a-zA-Z0-9]*;</code></pre>
</div>
</div>
</li>
<li>
<p>Annotations</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>AnnotationIdentifier: [_A-Z][_a-zA-Z0-9]*</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following rules describe how fully qualified names of elements are
created. Note that these fully qualified names cannot be used in N4JS
directly. Though they may be shown in error messages etc. to identify
elements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>TypeIdentifier:         [A-Z][a-zA-Z0-9]*;
PackageIdentifier:      [a-z][a-zA-Z0-9]*;
FQNType:                (PackageIdentifier '.')+ TypeIdentifier;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_this_keyword"><a class="anchor" href="#_this_keyword"></a>2.1.2. This Keyword</h4>
<div class="paragraph">
<p>Cf. [<a href="#ECMA11a">ECMA11a(p.S11.1.1, p.p.63)</a>]</p>
</div>
</div>
<div class="sect3">
<h4 id="_regular_expression_literals"><a class="anchor" href="#_regular_expression_literals"></a>2.1.3. Regular Expression Literals</h4>
<div class="paragraph">
<p>Cf. [<a href="#ECMA11a">ECMA11a(p.S7.8.5)</a>]</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-95" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-95</a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_automatic_semicolon_insertion"><a class="anchor" href="#_automatic_semicolon_insertion"></a>2.1.4. Automatic Semicolon Insertion</h4>
<div class="paragraph">
<p>Cf. [<a href="#ECMA11a">ECMA11a(p.S7.9)</a>]</p>
</div>
<div class="paragraph">
<p><a href="#AC">ASI</a> is supported by the parser, however warnings are issued. </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-95" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-95</a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jsdoc"><a class="anchor" href="#_jsdoc"></a>2.1.5. JSDoc</h4>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-56" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-56</a>
<a href="https://jira.numberfour.eu/browse/IDE-57" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-57</a>
</div>
</div>
<div class="paragraph">
<p>JSDoc are comments similar to JavaDoc in Java for documenting types,
functions and members. There is no semantic information expressed in
JSDoc, that is, the behavior of a program must not change if all the
JSDoc is removed. The JSDoc tags and overall syntax is a mixture of tags
defined by the <a href="https://developers.google.com/closure/compiler/docs/js-for-compiler">Google Closure Compiler</a>, Java&#8217;s <a href="http://www.oracle.com/technetwork/java/javase/documentation/index-jsp-135444.html">JavaDoc</a> tool and N4-specific tags.</p>
</div>
<div class="paragraph">
<p>JSDoc comments are multiline comments, starting with `/**
`</p>
</div>
<div class="paragraph">
<p>(instead of simple multiline comments, starting with `/*
`).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>MultiLineComment: '/*' MultiLineCommentChars? '*/'  // from ECMAScript specification
JSDoc:            '/**' MultiLineCommentChars? '*/'</code></pre>
</div>
</div>
<div class="paragraph">
<p>In general, JSDoc comments are placed directly before the annotated
language element. In some cases, this is slightly different, such as for
method parameters, for example, where it is then explicitly specified.</p>
</div>
<div class="paragraph">
<p>The content of JSDoc comments will be covered in more detail in upcoming
chapters. For documentation purposes, multi- and single-line
descriptions are used in several constructs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>MLVALUE:         ([^@]+[^\n]+)+;
SLVALUE:         ([^\n]+);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>MLVALUE</code> </dt>
<dd>
<p>short for <code>multi-line value</code>. This is usually only used for the
general description of types or members.</p>
</dd>
<dt class="hdlist1"><code>SLVALUE</code> </dt>
<dd>
<p>short for <code>single-line value</code>. This is a description which ends at
the end of a line. It is usually used in combination with other tags,
e.g., to further describe a parameter of a method.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_names"><a class="anchor" href="#_names"></a>3. Names</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Visibility</em> defines the scope in which a declaration is visible, that
is in which context references can be bound to the declaration. <em>Access
control</em> defines the extent to which types and members are accessible
beyond their immediate context. Access control may, therefore, restrict
the visibility of a declaration by limiting its scope.</p>
</div>
<div class="paragraph">
<p><em>Extensibility</em> refers to whether a given type can be subtyped, or in
the case of members, whether they can be overridden. Access control is a
prerequisite for extensibility which is further explained in <a href="#N4_Specific_Classifiers">[N4_Specific_Classifiers]</a></p>
</div>
<div class="sect2">
<h3 id="_access_control"><a class="anchor" href="#_access_control"></a>3.1. Access Control</h3>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-84" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-84</a>
<a href="https://jira.numberfour.eu/browse/IDE-556" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-556</a>
</div>
</div>
<div class="paragraph">
<p>Types from one project may or may not be made
accessible to another project. Likewise, members from a given type may
or may not be made accessible to members existing outside that type. For
example, if a developer writes an application which uses a library,
which types within that library can the application see? Given a type
that is set as visible, which members of that type can the application
see?</p>
</div>
<div class="paragraph">
<p>Accessing a type or member actually means that a reference is bound to a
declaration with the same identifier.</p>
</div>
<div class="paragraph">
<p>We distinguish the following contexts from which an element is accessed
as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Module or type: access from elements in the same module or type.</p>
</li>
<li>
<p>Subtype: access from a subtype.</p>
</li>
<li>
<p>Project: access from the same project.</p>
</li>
<li>
<p>Vendor: access from different project of the same vendor.</p>
</li>
<li>
<p>World: access from anything else.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Accessibility is defined by modifiers on types and members, e.g , via
the statement, and by the annotation. Extensibility is defined by the
annotation respectively.</p>
</div>
</div>
<div class="sect2">
<h3 id="_accessibility_of_types_top_level_variables_and_function_declarations"><a class="anchor" href="#_accessibility_of_types_top_level_variables_and_function_declarations"></a>3.2. Accessibility of Types, Top-Level Variables and Function Declarations</h3>
<div class="paragraph">
<p>  </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-84" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-84</a>
<a href="https://jira.numberfour.eu/browse/IDE-556" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-556</a>
<a href="https://jira.numberfour.eu/browse/IDE-707" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-707</a>
</div>
</div>
<div class="paragraph">
<p>We define types (classes, interfaces, enums) whereby each type has members (fields and methods, depending on the kind of type).
When we define a type, we need to define whether it is visible only for the specifying module, project or whether that type should be accessible from outside of that project.</p>
</div>
<div class="paragraph">
<p>The same is true for variable declarations and function declarations
defined as top-level elements of a module.</p>
</div>
<div class="paragraph">
<p>The following type access modifiers are supported by N4JS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">enum TypeAccessModifier:      project
                            | public;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a type is not exported, its visibility is private. If a type has
declared visibility , it may additionally be marked as internal via the
annotation . Thus, we have the following set of type access modifiers:</p>
</div>
<div class="paragraph">
<p>TAM = <math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mo>,</mo><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi><mi>@</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>n</mi><mi>a</mi><mi>l</mi><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mo>,</mo><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mo>)</mo></mrow></math></p>
</div>
<div class="paragraph">
<p>That is, in N4JS, only the type access modifiers and are available. The
redundant modifier serves only documentation purpose and can be
synthesized if the modifier is preset.</p>
</div>
<div class="paragraph">
<p>All other modifiers used here are synthesized as shown in the next
example:</p>
</div>
<div class="listingblock">
<div class="title">Synthesized Type Access Modifiers in N4JS</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class C0 {}                         // private
export class C1 {}                  // project
export project class C1 {}          // project
export @Internal public class C1 {} // public@Internal
export public class C2 {}           // public

var v0;                             // private
export var v1;                      // project
export project var v1;              // project
export @Internal public var v3;     // public@Internal
export public var v2;               // public


function f0() {}                    // private
export function f1() {}             // project
export project function f1() {}     // project
export @Internal public function f3() {} // public@Internal
export public function f2() {}      // public</code></pre>
</div>
</div>
<div class="paragraph">
<p>The access control levels are defined as listed in .</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Type Access Control</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="5"><strong>Type Access</strong></th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">Modifier</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">Module</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">Project</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">Vendor</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">World</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>private</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>project</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>public@Internal</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>public</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>A</mi><mi>M</mi></math> is a totally ordered set:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow><mi>l</mi><mi>t</mi><mi>;</mi><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow><mi>l</mi><mi>t</mi><mi>;</mi><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi><mi>@</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow><mi>l</mi><mi>t</mi><mi>;</mi><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow></math></p>
</div>
<div class="paragraph">
<p>The following constraints for type access modifiers for a given type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>
(which may be a classifier declaration, a function or a variable) must
hold:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is an error if <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> is not exported but defined as
<code>project</code>, <code>public</code> or
<code>public@Internal</code>.</p>
</li>
<li>
<p>It is an error if an annotation <code>@Internal</code> is
present on a module private or <code>project</code> visible
type.</p>
</li>
<li>
<p>The type modifier for all built-in ECMAScript types is
<code>public</code>.</p>
</li>
<li>
<p>The <em>default modifier</em> for user declared exported declarations is
<code>project</code>. That is, this modifier is assumed if no
modifier is explicitly specified.</p>
</li>
</ul>
</div>
<div class="openblock definition">
<div class="content">
<div class="paragraph">
<p><strong>Definition:</strong> <a href="#type_accessibility_t">Type Accessibility T</a></p>
</div>
<div class="paragraph">
<p>The function <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>α</mi><mi>T</mi></msub><mi>:</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo>×</mo><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>D</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>B</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi>a</mi><mi>n</mi></math>
computes whether a given type, (top-level) variable or function
reference can access the declaration that it references.
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>α</mi><mi>T</mi></msub></math> is defined with .</p>
</div>
<div class="paragraph">
<p>Formally, we define <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>α</mi><mi>T</mi></msub></math> for a given reference
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi></math> and a module top level variable, function or type
declaration <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi></math> as follows: <sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnote_4" title="View footnote.">4</a>]</sup>
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><msub><mi>α</mi><mi>T</mi></msub><mfenced close=")" open="("><mi>r</mi><mi>D</mi></mfenced></mrow><mrow><mi>D</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>=</mo><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><msub><mi>α</mi><mi>T</mi></msub><mfenced close=")" open="("><mi>r</mi><mi>D</mi></mfenced></mrow><mrow><mi>D</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>=</mo><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi><mi>@</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>r</mi><mo>.</mo><mi>v</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>o</mi><mi>r</mi><mo>=</mo><mi>D</mi><mo>.</mo><mi>v</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>o</mi><mi>r</mi></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><msub><mi>α</mi><mi>T</mi></msub><mfenced close=")" open="("><mi>r</mi><mi>D</mi></mfenced></mrow><mrow><mi>D</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>=</mo><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>r</mi><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo>=</mo><mi>D</mi><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><msub><mi>α</mi><mi>T</mi></msub><mfenced close=")" open="("><mi>r</mi><mi>D</mi></mfenced></mrow><mrow><mi>D</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>=</mo><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>r</mi><mo>.</mo><mi>m</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>l</mi><mi>e</mi><mo>=</mo><mi>D</mi><mo>.</mo><mi>m</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>l</mi><mi>e</mi></mrow></math>
If the type of the arguments is clear from the context, we simply write
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi><mfenced close=")" open="("><mi>r</mi><mi>D</mi></mfenced></math> instead of <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>α</mi><mi>T</mi></msub><mfenced close=")" open="("><mi>r</mi><mi>D</mi></mfenced></math>.</p>
</div>
<div class="paragraph">
<p>Accessibility for types is only checked for types that manifest
themselves in the concrete syntax of the N4JS file. Types that do not
have to be written to concrete syntax may be used even if they are
generally not accessible. This is illustrated by the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">export public class D {
    public takeC(): C { .. }
    public acceptC(c: C): void { .. }
}
/* private */ class C {}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var d: D = new D()
d.acceptC( d.takeC() )</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_accessibility_of_members"><a class="anchor" href="#_accessibility_of_members"></a>3.2.1. Accessibility of Members</h4>
<div class="paragraph">
<p>  </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-84" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-84</a>
<a href="https://jira.numberfour.eu/browse/IDE-556" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-556</a>
<a href="https://jira.numberfour.eu/browse/IDE-707" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-707</a>
</div>
</div>
<div class="paragraph">
<p>Accessibility at the member level is only applicable when the type
itself is accessible. If you cannot access the type, you cannot access
any of its members. Note that inherited members (from an interface or
class) become members of a class. For example, if <code>B extends A</code>, and if <code>A</code> is not
accessible to some client <code>C</code> but <code>B</code> is, then the members of <code>A</code> are indirectly
accessible to <code>C</code> in so far as they are accessed via <code>B</code>. This is true in
particular for interfaces, as their properties are possibly merged into
the consuming class (cf. <a href="#Implementation_of_members">[Implementation_of_members]</a>).</p>
</div>
<div class="paragraph">
<p>The following member access modifiers are supported by N4JS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">enum MemberAccessModifier:    private
                            | project
                            | protected
                            | public;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The modifiers and may be annotated with . Thus, we can define the
following set of member access modifiers:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>M</mi><mi>A</mi><mi>M</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>=</mo><mfenced close="}" open="{"><mrow><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow></mrow><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>t</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>e</mi><mi>d</mi><mi>@</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>t</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>e</mi><mi>d</mi></mrow><mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow></mrow><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi><mi>@</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow><mrow><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow><mtext>
</mtext></mrow></mfenced></math>
<code>protected@Internal</code> and <code>public@Internal</code> are synthesized tags and were
introduced as shorthand notation for the <code>@Internal</code> annotation together with <code>protected</code> or <code>public</code> access modifiers.
The modifier is the default one and it can be omitted.
As with the type access modifiers, not all member access modifiers are
available in N4JS. Instead, they are synthesized from different
construct as shown in the next example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">export @Internal public class C {

    private f0;                 // private
    f1;                         // project
    project f2;                 // project
    @Internal protected f3;     // protected@Internal
    protected f4;               // protected
    @Internal public f5;        // public@Internal
    public f6;                  // public

    private m0() {}             // private
    m1() {}                     // project
    project m2() {}             // project
    @Internal protected m3() {} // protected@Internal
    protected m4() {}           // protected
    @Internal public m5() {}    // public@Internal
    public  m6() {}             // public
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi><mi>A</mi><mi>M</mi></math> does not define a totally ordered set. However, its
subset
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>M</mi><mi>A</mi><mi>M</mi><mo>\</mo><mfenced close="}" open="{"><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi><mi>@</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow></mfenced></math> is a totally
ordered set <sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnote_5" title="View footnote.">5</a>]</sup>:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow><mi>l</mi><mi>t</mi><mi>;</mi><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow><mi>l</mi><mi>t</mi><mi>;</mi><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>t</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>e</mi><mi>d</mi><mi>@</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow><mi>l</mi><mi>t</mi><mi>;</mi><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>t</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>e</mi><mi>d</mi></mrow><mi>l</mi><mi>t</mi><mi>;</mi><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow></math></p>
</div>
<div class="paragraph">
<p><a href="#Member Access Controls">[Member Access Controls]</a> shows which members are accessible from where.</p>
</div>
<div class="paragraph">
<p>[[Member Access Controls]]</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Member Access Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Access Modifier</th>
<th class="tableblock halign-center valign-top">Inside Module</th>
<th class="tableblock halign-center valign-top">Inside Project</th>
<th class="tableblock halign-center valign-top">Vendor</th>
<th class="tableblock halign-center valign-top">Vendor Subtypes</th>
<th class="tableblock halign-center valign-top">Other Projects</th>
<th class="tableblock halign-center valign-top">Everywhere</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>private</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>project</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>protected@Internal</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>protected</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>public@Internal</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>public</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>We define the relation
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>=</mo><mspace width="1.0em"/><mi>:</mi><mspace width="1.0em"/><mi>T</mi><mi>A</mi><mi>M</mi><mo>×</mo><mi>M</mi><mi>A</mi><mi>M</mi></math> as follows:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>=</mo><mspace width="1.0em"/><mi>:</mi><mspace width="1.0em"/><mi>T</mi><mi>A</mi><mi>M</mi><mo>×</mo><mi>M</mi><mi>A</mi><mi>M</mi><mi>a</mi><mi>s</mi><mi>f</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>o</mi><mi>w</mi><mi>s</mi><mi>:</mi><mo>=</mo><mspace width="1.0em"/><mi>:</mi><mi>:</mi><mo>=</mo><mfenced close="}" open="{"><mrow><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mfenced close=")" open="("><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow></mfenced></mrow><mfenced close=")" open="("><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow></mfenced><mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mfenced close=")" open="("><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi><mi>@</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi><mi>@</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow></mfenced></mrow><mfenced close=")" open="("><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow></mfenced></mfenced></math>
We further define the relation <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>≥</mo><mi>:</mi><mi>T</mi><mi>A</mi><mi>M</mi><mo>×</mo><mi>M</mi><mi>A</mi><mi>M</mi></math> as follows:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>t</mi><mi>a</mi><mi>m</mi><mo>≥</mo><mi>m</mi><mi>a</mi><mi>m</mi></mrow><mrow><mo>∃</mo><mi>m</mi><mi>a</mi><msup><mi>m</mi><mi>'</mi></msup><mo>∈</mo><mi>M</mi><mi>A</mi><mi>M</mi><mi>:</mi><mi>t</mi><mi>a</mi><mi>m</mi><mo>=</mo><mi>m</mi><mi>a</mi><msup><mi>m</mi><mi>'</mi></msup><mo>∧</mo><mi>m</mi><mi>a</mi><msup><mi>m</mi><mi>'</mi></msup><mo>≥</mo><mi>m</mi><mi>a</mi><mi>m</mi></mrow></math>
Less, greater then etc. are defined accordingly.</p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>α</mi><mi>m</mi></msub></math>]
The function
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>α</mi><mi>m</mi></msub><mi>:</mi><mi>M</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo>×</mo><mi>M</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>D</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>B</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi>a</mi><mi>n</mi></math>
computes if a given reference can access the member declaration that it
references.</p>
</div>
<div class="paragraph">
<p>Note that <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><msub><mi>a</mi><mi>m</mi></msub></math> and <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>b</mi><mi>i</mi><mi>n</mi><mi>d</mi></math> are different
functions. A reference can only bind to a declaration if it can access
the declaration. However, bind requires more condition to work (correct
metatypes, no shadowing etc).</p>
</div>
<div class="paragraph">
<p>Formally, we define <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>α</mi><mi>m</mi></msub></math> for a given reference
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi></math> and member declaration <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> as
follows:
<sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnote_6" title="View footnote.">6</a>]</sup></p>
</div>
<div class="paragraph">
<p><sup class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnote_7" title="View footnote.">7</a>]</sup>]</p>
</div>
<div class="literalblock">
<div class="content">
<pre> math:[\[\begin{aligned}
&amp;\infer{\alpha_m(r, M)}{M.acc = \lenum{public}}\\
&amp;\infer{\alpha_m(r, M)}{r.vendor = M.vendor &amp; M.acc = \lenum{public@Internal}}\\
&amp;\infer{\alpha_m(r, M)}{r.owner \in r.receiver.super^* &amp; M.acc = \lenum{protected}}\\
&amp;\infer{\alpha_m(r, M)}{r.owner \in r.receiver.super^* &amp; r.vendor = M.vendor &amp; M.acc = \lenum{protected@Internal}}\\
&amp;\infer{\alpha_m(r, M)}{r.project = M.project &amp; M.acc = \lenum{project}}\\
&amp;\infer{\alpha_m(r, M)}{r.module = r.module &amp; M.acc =\lenum{private}}\\
\end{aligned}\]]</pre>
</div>
</div>
<div class="paragraph">
<p>If the type of the arguments is clear from the context, we simply write
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi><mfenced close=")" open="("><mi>r</mi><mi>M</mi></mfenced></math> instead of <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>α</mi><mi>m</mi></msub><mfenced close=")" open="("><mi>r</mi><mi>M</mi></mfenced></math>.</p>
</div>
<div class="paragraph">
<p>Although private members are accessible inside a module, it is not
possible to redefine (override etc.) these members (see <a href="#Redefinition_of_Members">[Redefinition_of_Members]</a>).</p>
</div>
<div class="paragraph">
<p>The following constraints for member access modifiers must hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <em>default modifier</em> for members of user-declared classes is
<code>project</code>.</p>
</li>
<li>
<p>The <em>default modifier</em> for members of interfaces is the same as the
visibility of the interface itself, except for private interfaces. For
private interfaces, the default modifier for members is
<code>project</code>.</p>
</li>
<li>
<p>The modifier for enum literals is always
<code>public</code>.</p>
</li>
<li>
<p>Private members of a classifier are visible and accessible within a
module, i.e. you can access the private method of a class, for instance,
when the use of the class as receiver is in the same module where the
class has been defined. In case of inheritance, private members are
visible if the host (e.g. the class) is in the same module as the
provider (the extended class). This also means that abstract members of
a class are allowed to be defined private as they may be overridden
within a module.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">export project interface I {
    project foo();
}

// This interface may be used publicly, but since the inherited method foo() is project visible only,
// it is not possible to implement that interface in other projects.
export public interface J extends I {
}

// Since the visibility of foo is set to public here, it is possible to implement this interface in other projects.
export public interface K extends I {
    @Override public foo();
}

// Since foo is private, it is not possible to subclass the class in other modules. Still, it
// is possible to use it in other projects.
// XPECT noerrors --&gt;
export public abstract class C {
    private abstract foo();

    public static C instance() {
        // return some default instance
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As demonstrated in the following snippet, class can be used but not
subclassed in other modules:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">import C from "C"

// XPECT errors --&gt; "Cannot extend class C: cannot implement one or more non-accessible abstract members: method C.foo." at "C"
export public abstract class Sub extends C {
}

// XPECT noerrors --&gt;
var c: C = C.instance();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Members of non-visible types are, in general, not visible for a client.
Members may become visible, however, if they are accessed via a visible
type which inherits these members. The following examples demonstrate
two different scenarios:</p>
</div>
<div class="paragraph">
<p>[[ex:Declaring type vs receiver type]]
It is especially noteworthy that the declaring type of a member is
generally not considered for the accessibility of that member but only
the receiver type is relevant.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class Base {
    public m(b: Base): void {}
}
export public class ApiType extends Base {
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">import * as N from "Base";

var t = new N.ApiType();
// member can be accessed although type Base is not exported:
t.m(t);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The property access to the member <code>m</code> is valid because it fulfills the
constraints for accessibility. The receiver of the property access is <code>t</code> of
type <code>ApiType</code>. That type is exported and accessible. Therefore, the inherited
member <code>m</code> is also considered valid since it is also defined <code>public</code>.</p>
</div>
<div class="paragraph">
<p>This rule allows for defining a common functionality in module or
project visible types that becomes accessible via exported, visible
subtypes.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates the behavior when
non-visible types are used as return types. In this case, all the
members of the non-visible types are not accessible, even if they have a
public access modifier.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class A {
    foo(): void{}
}
export public class C {
    public getHidden(): A { return new A() };
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">import * as Nfrom "A"

class Client {
    f(): void {
        var c = new N.C();
        // XPECT noerrors --&gt; Getting an instance the hidden type is possible
        var hidden = c.getHidden();
        // XPECT errors --&gt; "The method foo is not visible." at "foo"
        hidden.foo();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_valid_names"><a class="anchor" href="#_valid_names"></a>3.2.2. Valid Names</h4>
<div class="paragraph">
<p>For identifier and property names, the same constraints as in ECMAScript
[<a href="#ECMA11a">ECMA11a(p.S7.6)</a>]
[<a href="#ECMA11a">ECMA11a(p.S7.6.1.2)</a>]
[<a href="#ECMA11a">ECMA11a(p.S11.6)</a>] are applied.</p>
</div>
<div class="paragraph">
<p>Identifier names in N4JS are defined similar to [<a href="#ECMA11a">ECMA11a(p.S11.6)</a>], making it possible to even use reserved words (keywords etc.). For some element types, errors
or warnings are issued in order to prevent problems when using these
names.</p>
</div>
<div class="paragraph">
<p>5Forbidden Identifier Names in   N4JS[req:Identifier_Names_in_N4JS] In
N4JS mode, errors are generated in the following cases:</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/207" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-207</a>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A name of a type equals</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>an access modifier</p>
</li>
<li>
<p><code>set</code> or <code>get</code></p>
</li>
<li>
<p>an ECMAScript keyword</p>
</li>
<li>
<p>a boolean literal</p>
</li>
<li>
<p>the name of a base type</p>
</li>
</ol>
</div>
</li>
<li>
<p>The name of a function or function expression equals (but not the
method)</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>an ECMAScript keyword</p>
</li>
<li>
<p>a reserved future ECMAScript word</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>6Undesired Identifier Names in
N4JS[req:Undesired_Identifier_Names_in_N4JS] In N4JS mode, warnings are
generated in the following cases:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The name of a member (of a non external type)</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>equals the name of a base type <sup class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnote_8" title="View footnote.">8</a>]</sup> but the type of the variable is different from that type</p>
</li>
<li>
<p>is not static nor const but starts with an upper case letter</p>
</li>
</ol>
</div>
</li>
<li>
<p>The name of a non-external n4 types (class, interface, enum) starts
with a lower case letter</p>
</li>
<li>
<p>The name of a variable (incl. formal parameter or catch variable and
fields)</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>equals an N4JS keyword</p>
</li>
<li>
<p>equals the name of a base type but the type of the variable is
different from that type</p>
</li>
<li>
<p>is not const but starts with an upper case letter</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_qualified_names"><a class="anchor" href="#_qualified_names"></a>3.2.3. Qualified Names</h4>
<div class="paragraph">
<p>In N4JS source code, types can only be referenced using their simple
name. There is no such thing as a fully-qualified type name in N4JS or
ECMAScript. Types are uniquely identified by their simple name, maybe
together with an import and the module specifier given there. Clashes
between simple names of imported type and locally declared types can be
resolved by importing the type under an alias.</p>
</div>
<div class="paragraph">
<p>In some cases, however, we need to define references to types or even
members. For example, if we want to reference certain members in JSDoc
comments or for unambiguous error messages. For this reason, we formally
define qualified names even if they cannot occur in source code.</p>
</div>
<div class="paragraph">
<p><a href="#tab:typenames">Type Names</a> shows the different names of a given type <code>C</code>, defined in a module
<code>M.n4js</code>, defined in a package <code>p</code> of a project <code>MyProject</code>.</p>
</div>
<table id="tab:typenames" class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. Different forms of module and type specifiers.</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-center valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simple Type Name</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>C</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Plain) Module Specifier</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>p/M</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Complete Module Specifier</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>MyProject/p/M</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Complete Type Specifier</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>MyProject/p/M.C</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Simple type names are used throughout N4JS code in order to refer to
types. The different forms of module specifiers are only used in import
declarations in the string following the keyword.</p>
</div>
</div>
<div class="sect3">
<h4 id="_name_duplicates"><a class="anchor" href="#_name_duplicates"></a>3.2.4. Name Duplicates</h4>
<div class="paragraph">
<p>There might be cases where two (or more) scopes created by different
entities with the same (simple) name overlap. Those situations can be
referred to as shadowing, hiding, or obscuring. While they are not the
same, many of those cases are not allowed in N4JS. For simplicity we
refer to them all as shadowing or duplication (see below). Rule of thumb
is that N4JS allows everything that is allowed in JavaScript StrictMode.</p>
</div>
<div class="sect4">
<h5 id="_lexical_environment"><a class="anchor" href="#_lexical_environment"></a>Lexical Environment</h5>
<div class="paragraph">
<p>N4JS handles scopes similar to ECMAScript, so that function scope is
applied to variables declared with <code>var</code> (and parameters), and block scope for
variables is declared with <code>let</code> or <code>const</code>. In general, ECMAScript defines <em>Lexical
Environments</em> as a specification type used to define the association of
Identifiers to specific variables and functions based upon the lexical
nesting structure of ECMAScript code. [<a href="#ECMA11a">ECMA11a(p.10.2)</a>].</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Elements that introduce lexical environments: </dt>
<dd>
<p><code>FunctionDefinition</code>, <code>VariableDeclaration</code>, <code>CatchBlock</code>, <code>WithStatement</code>,
<code>ImportDeclaration</code></p>
</dd>
<dt class="hdlist1">N4JS specific declarations: </dt>
<dd>
<p><code>N4ClassDeclaration</code>, <code>N4InterfaceDeclaration</code>,
<code>N4EnumDeclaration</code>, <code>N4MethodDeclaration</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Additionally, a built-in lexical environment that defines global scope
exists for every <code>Script</code>.</p>
</div>
<div class="paragraph">
<p>Since N4JS is extended (and a bit more strict) JS strict mode, <em>Object
environment record</em>s created by <code>WithStatement</code> are not taken into account when
resolving duplicates. This applies to both N4JS mode and JS strict mode.
In unrestricted JS the <code>WithStatement</code> is allowed but duplicates are not validated.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title"></div>
</td>
<td class="content">
In case of names introduced by <code>ImportDeclaration</code>s only <code>NamedImportSpecifiers</code>s are taken into account (their import name or its alias if available). <code>WildcardImportSpecifiers</code>s are not taken into
account. Potential optimizations by compiler or user annotation are also
not currently taken into account during analysis.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_duplicates_and_shadowing"><a class="anchor" href="#_duplicates_and_shadowing"></a>Duplicates and Shadowing</h5>
<div class="openblock definition">
<div class="content">
<div class="paragraph">
<p><strong>Definition:</strong> <a href="#shadowing_overriding_duplicates">Shadowing Overriding Duplicates</a></p>
</div>
<div class="paragraph">
<p>Two elements with the same name declared in the same lexical environment
(cf. [<a href="#ECMA11a">ECMA11a(p.S10.2.2.1)</a>] are called <em>duplicates</em>.
An element defined in an environment <em>shadows</em> all elements with the same name in outer environments.</p>
</div>
<div class="paragraph">
<p>In class hierarchies, a member with the same name as a member defined in
a supertype is said to override the latter. Overriding is discussed in .</p>
</div>
<div class="paragraph">
<p>For the following constraints, we make the following assumptions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Names of function expressions or declarations are handles similar to
locally declared elements in the function. Function declarations are
additionally declaring a name in their outer scope.</p>
</li>
<li>
<p>The implicit formal parameter <code>arguments</code> is treated similar to declared formal
parameters.</p>
</li>
<li>
<p>Formal parameters are defined in the lexical environment of a
function, that is, they are defined in the same lexical environment as
local <code>var</code>-variables or other declarations in that function.</p>
</li>
<li>
<p>The "global" environment contains objects globally defined by the
execution environment.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>There must be no two elements defined in the same lexical environment with the same name,
that is, there must be no duplicates.</p>
</div>
<div class="paragraph">
<p>8Forbidden Shadowing[req:Forbidden_Shadowing] In general, shadowing is
allowed in N4JS. But it is not allowed in the following cases:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>No element defined in the standard global scope must be shadowed.</p>
</li>
<li>
<p>There must be no function shadowing another function.</p>
</li>
<li>
<p>Elements defined in catch blocks must not shadow elements defined
all parent non-catch-block environments.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the script environment, it is not allowed to use the name
’arguments’.
<sup class="footnote">[<a id="_footnoteref_9" class="footnote" href="#_footnote_9" title="View footnote.">9</a>]</sup></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="#Forbidden shadowing">[Forbidden shadowing]</a> shows nested lexical environments with named elements declared inside (all named <code>x</code> here), the forbidden cases are marked with arrows (the
numbers at the left side refer to the numbers in
[req:Forbidden_Shadowing].</p>
</div>
<div class="paragraph">
<p>[[Forbidden shadowing]]
<span class="image"><img src="fig/shadowing.png" alt="Forbidden shadowing"></span></p>
</div>
<div class="paragraph">
<p>Rational:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We expect only few named nested functions. Since this is expected to
be a rare case, no shadowing should occur there as this is maybe not
expected by the programmer.</p>
</li>
<li>
<p>It is typical that nested environments define local variables. In
particular helper variables (such as <code>i: number i</code> or <code>s: string</code> ) are expected to be used quite
often. Since this is a typical case, we allow shadowing for local
variables.</p>
</li>
<li>
<p>Function declarations may shadow type declarations. However, both
entities are to be handled completely differently, so that an error will
occur if the shadowing is ignored by the programmer anyway.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_types"><a class="anchor" href="#_types"></a>4. Types</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview"><a class="anchor" href="#_overview"></a>4.1. Overview</h3>
<div class="paragraph">
<p>N4JS is essentially ECMAScript with the inclusion of
types. In the following sections we will describe how types are defined
and used in N4JS.</p>
</div>
<div class="paragraph">
<p>Besides standard JavaScript types, the following metatypes are
introduced:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Classifiers, that is class or interface (see )</p>
</li>
<li>
<p>Enum</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Classifiers, methods and functions may be declared generic.</p>
</div>
<div class="paragraph">
<p>Types are related to each other by the subtype relation.</p>
</div>
<div class="openblock definition">
<div class="content">
<div class="paragraph">
<p><strong>Definition:</strong> <a href="#subtype_relation">Subtype Relation</a></p>
</div>
<div class="paragraph">
<p>We use subtype<math xmlns="http://www.w3.org/1998/Math/MathML"/>
for the general subtype relation or type conformance. In nominal typing,
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>T</mi><mi>S</mi></math> means that <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> is a (transitive)
supertype of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>. Generally in structural typing, this means
that <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> conforms to <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math>. <math xmlns="http://www.w3.org/1998/Math/MathML"/>
is defined transitive reflexive by default. We write <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mi>t</mi><mi>;</mi></math> to
refer to the transitive non-reflexive relation, that is
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>T</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>S</mi><mi>T</mi><mi>S</mi><mo>∧</mo><mi>T</mi><mo>≠</mo><mi>S</mi></math></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Whether nominal or structural typing is used depends on the declaration
of the type or the reference. This is explained further in .</p>
</div>
<div class="paragraph">
<p>For convenience reasons, we sometimes revert the operator, that is
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>T</mi><mi>S</mi><mi>S</mi><mi>:</mi><mi>g</mi><mi>t</mi><mi>;</mi><mi>T</mi></math> We write
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>S</mi></math> if <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> is not type conforming
to <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math>. (cf. [<a href="#Gosling12a">Gosling12a(p.S4.10)</a>])</p>
</div>
<div class="paragraph">
<p>Join and meet are defined as follows:</p>
</div>
<div class="openblock definition">
<div class="content">
<div class="paragraph">
<p><strong>Definition:</strong> <a href="#join_and_meet">Join and Meet</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre> A type math:[$J$] is called a
_join_ (or least common supertype, ) of a pair of types math:[$S$]
and math:[$T$], written math:[$S \join T = J$], if +
math:[\[\begin{aligned}
&amp; S \subtype J\\
&amp; T \subtype J\\
&amp; \forall L: (S\subtype L) \land (T\subtype L) \to J\subtype L\end{aligned}\]]
Similarly, we say that a type math:[$M$] is a _meet_ (or greatest
common subtype, ) of math:[$S$] and math:[$T$], written
math:[$S \meet T = M$], if +
math:[\[\begin{aligned}
&amp; M \subtype  S\\
&amp; M \subtype  T\\
&amp; \forall L: (L\subtype S) \land (L\subtype T) \to L\subtype M\end{aligned}\]]</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that this declarative definition needs to be specified in detail
for special cases, such as union and intersection types. Usually, the
union type of two types is also the join.</p>
</div>
<div class="paragraph">
<p>summarizes all predefined types, that is primitive and built-in
ECMAScript and N4JS types. Specific rules for the subtype relation are
defined in the following sections. This type hierarchy shows <code>any</code> and <code>undefined</code> as the
top and bottom type (cf. [<a href="#Pierce02a">Pierce02a(p.15.4)</a>]) We define these types here explicitly:</p>
</div>
<div class="openblock definition">
<div class="content">
<div class="paragraph">
<p><strong>Definition:</strong> <a href="#top_and_bottom_type">Top and Bottom Type</a></p>
</div>
<div class="paragraph">
<p>We call <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>o</mi><mi>p</mi></math>
the top type, if for all types <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> the relation
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>T</mi><mi>o</mi><mi>p</mi></math> is true. We call <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi><mi>o</mi><mi>t</mi></math> the
bottom type, if for all types <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> the relation
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi><mi>o</mi><mi>t</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>T</mi></math> is true. In N4JS, <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>o</mi><mi>p</mi><mo>=</mo><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>a</mi><mi>n</mi><mi>y</mi><mi>}</mi></math>, the
bottom type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi><mi>o</mi><mi>t</mi><mo>=</mo><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>u</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>}</mi></math>.</p>
</div>
<div class="paragraph">
<p><code>null</code> is almost similar to <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi><mi>o</mi><mi>t</mi></math>, except that it is not a subtype
of <code>undefined</code>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="fig/cdPredefinedTypesHierarchy.png" alt="cdPredefinedTypesHierarchy" title="Predefined Types Hierarchy"></span></p>
</div>
<div class="paragraph">
<p>For every primitive type there is a corresponding built-in type as
defined in [<a href="#ECMA11a">ECMA11a</a>], e.g. and . There is no inheritance supported for
primitive types and built-in types – these types are final.</p>
</div>
<div class="paragraph">
<p>Although the diagram shows inheritance between <code>void</code> and <code>undefined</code>, this relationship is only semantic: <code>void</code> is a refinement of <code>undefined</code> from a type system viewpoint. The
same applies to the relation of <code>Object</code> as well as the subtypes shown for <code>string</code> and <code>String</code>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>[[ex:Type Examples, Class Hierarchy]]
In the following examples, we assume the following classes to be given:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>// C &lt;: B &lt;: A
class A{}
class B extends A{}
class C extends B{}

// independent types X, Y, and Z
class X{} class Y{} class Z{}

// interfaces I, I1 &lt;: I, I2 &lt;: I, I3
interface I
interface I1 extends I {}
interface I2 extends I {}
interface I3 {}

// class implementing the interfaces
class H1 implements I1{}
class H12 implements I1,I2{}
class H23 implements I2,I3{}

// a generic class with getter (contra-variance) and setter (co-variance)
class G&lt;T&gt; {
    get(). T;
    set(x: T): void;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_type_expressions"><a class="anchor" href="#_type_expressions"></a>4.2. Type Expressions</h3>
<div class="paragraph">
<p>In contrast to ECMAScript, N4JS defines static
types. Aside from simple type references, type expressions may be used
to specify the type of variables.</p>
</div>
<div class="sect3">
<h4 id="_syntax"><a class="anchor" href="#_syntax"></a>4.2.1. Syntax</h4>
<div class="paragraph">
<p>summarizes the type expression grammar. Depending on the context, not
all constructs are allowed. For example, the variadic modifier is only
allowed for function parameters.</p>
</div>
<div class="paragraph">
<p>References to user-declared types are expressed via <code>ParameterizedTypeRef</code>. This is also true
for non-generic types, as the type arguments are optional.
See <a href="#_parameterized_types">Parameterized Types</a> for details on that reference.</p>
</div>
<div class="paragraph">
<p>For qualified names and type reference names, see</p>
</div>
<div class="paragraph">
<p>The type expressions are usually added to parameter, field, or variable
declarations as a suffix, separated with colon (’:’). The same is true
for function, method, getter or setter return types. Exceptions in the
cases of object literals or destructuring are explained later on.</p>
</div>
<div class="exampleblock">
<div class="content">
The following two listings show the very same code and type annotations are provided on
the left hand side. For simplicity, is always used as type
expression.
<sup class="footnote">[<a id="_footnoteref_10" class="footnote" href="#_footnote_10" title="View footnote.">10</a>]</sup>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>var x: string;
var s: string = "Hello";
function f(p: string): string {
    return p;
}
class C {
    f: string;
    s: string = "Hello";
    m(p: string): string {
        return p;
    }
    get x(): string {
        return this.f;
    }
    set x(v: string) {
        this.f = v;
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>var x;
var s = "Hello";
function f(p) {
    return p;
}
class C {
    f;
    s = "Hello";
    m(p) {
        return p;
    }
    get x() {
        return this.f;
    }
    set x(v) {
        this.f = v;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code on the right hand side is almost all valid ECMAScript 2015,
with the exception of field declarations in the class. These are moved
into the constructor by the N4JS transpiler.</p>
</div>
</div>
<div class="sect3">
<h4 id="_properties"><a class="anchor" href="#_properties"></a>4.2.2. Properties</h4>
<div class="paragraph">
<p>Besides the properties indirectly defined by the grammar, the following
pseudo properties are used for type expressions: Properties of :</p>
</div>
<div class="paragraph">
<p>If true, variable of that type is variadic. This is only allowed for
parameters. Default value: <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mi>a</mi><mi>l</mi><mi>s</mi><mi>e</mi></math>.</p>
</div>
<div class="paragraph">
<p>If true, variable of that type is optional. This is only allowed for
parameters and return types. This actually means that the type
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> actually is a union type of . Default value:
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mi>a</mi><mi>l</mi><mi>s</mi><mi>e</mi></math>.</p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>o</mi><mi>p</mi><mi>t</mi><mi>v</mi><mi>a</mi><mi>r</mi><mo>=</mo><mi>v</mi><mi>a</mi><mi>r</mi><mo>∨</mo><mi>o</mi><mi>p</mi><mi>t</mi></math>, reflect the facts that a variadic
parameter is also optional (as its cardinality is <math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mo>[</mo><mn>0.</mn><mo>.</mo><mi>n</mi></mrow></math>).$]</p>
</div>
<div class="paragraph">
<p>Pseudo property referencing the variable declaration (or expression)
which <code>owns</code> the type expression.</p>
</div>
</div>
<div class="sect3">
<h4 id="_semantics"><a class="anchor" href="#_semantics"></a>4.2.3. Semantics</h4>
<div class="paragraph">
<p>The ECMAScript types <em>undefined</em> and <em>null</em> are also supported. These
types cannot be referenced directly, however. Note that <code>void</code> and <em>undefined</em>
are almost similar. Actually, the inferred type of a types element with
declared type of <code>void</code> will be <em>undefined</em>. The difference between void and
undefined is that an element of type void can never have another type,
while an element of type undefined may be assigned a value later on and
thus become a different type. <code>void</code> is only used for function and method return types.</p>
</div>
<div class="paragraph">
<p>Note that not any type reference is allowed in any context. Variables or
formal parameters must not be declared <code>void</code> or union types must not be
declared dynamic, for example. These constraints are explained in the
following section.</p>
</div>
<div class="paragraph">
<p>The types mentioned above are described in detail in the next sections.
They are hierarchically defined and the following list displays all
possible types. Note that all types are actually references to types. A
type variable can only be used in some cases, e.g., the variable has to
be visible in the given scope.</p>
</div>
<h5 id="_ecmascript_types" class="discrete">ECMAScript Types</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">Predefined Type</dt>
<dd>
<p>Predefined types, such as String, Number, or Object; and .</p>
</dd>
<dt class="hdlist1">Array Type</dt>
<dd>
<p><a href="#_array_object_type">Array Object Type</a>.</p>
</dd>
<dt class="hdlist1">Function Type</dt>
<dd>
<p>Described in <a href="#../06_funtions/Functions.adoc">[../06_funtions/Functions.adoc]</a>, <a href="../06_funtions/Functions.html#function_type">[../06_funtions/Functions#function_type]</a>.</p>
</dd>
<dt class="hdlist1">Any Type</dt>
<dd>
<p><a href="#_any_type">Any Type</a>.</p>
</dd>
</dl>
</div>
<h5 id="_n4types" class="discrete">N4Types</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">Declared Type</dt>
<dd>
<p>(Unparameterized) Reference to defined class <a href="#_classes">Classes</a> or enum <a href="#_enums">Enums</a>.</p>
</dd>
<dt class="hdlist1">Parameterized Type</dt>
<dd>
<p>Parameterized reference to defined generic class or interface; <a href="#_parameterized_types">Parameterized Types</a>.</p>
</dd>
<dt class="hdlist1">This Type</dt>
<dd>
<p><a href="#_this_type">This Type</a>.</p>
</dd>
<dt class="hdlist1">Constructor and Type Type</dt>
<dd>
<p>Class type, that is the meta class of a defined class or interface, <a href="#_constructor_and_classifier_type">Constructor and Classifier Type</a>.</p>
</dd>
<dt class="hdlist1">Union Types</dt>
<dd>
<p>Union of types, <a href="#_union_type">Union Type</a>.</p>
</dd>
<dt class="hdlist1">Type Variable</dt>
<dd>
<p>Type variable, <a href="#_type_variables">Type Variables</a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Type expressions are used to explicitly declare the type of a variable,
parameter and return type of a function or method, fields (and object
literal properties).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_type_inference"><a class="anchor" href="#_type_inference"></a>4.3. Type Inference</h3>
<div class="paragraph">
<p>If no type is explicitly declared, it is inferred based on the given
context, as in the expected type of expressions or function parameters,
for example. The type inference rules are described in the remainder of
this specification.</p>
</div>
<div class="openblock definition">
<div class="content">
<div class="paragraph">
<p><strong>Definition:</strong> <a href="#default_type">Default Type</a></p>
</div>
<div class="paragraph">
<p>In N4JS mode , if no type is explicitly
specified and if no type information can be inferred, <code>any</code> is assumed as the default type.</p>
</div>
<div class="paragraph">
<p>In JS mode, the default type is <code>any+</code>.</p>
</div>
<div class="paragraph">
<p>Once the type of a variable is either declared or inferred, it is not
supposed to be changed.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>[Variable type is not changeable] Given the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>var x: any;
x = 42;
x-5; // error: any is not a subtype of number.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Type of <code>x</code> is declared as <code>any</code> in line 1. Although a number is assigned to <code>x</code> in line 2, the type of <code>x</code> is not changed. Thus an error is issued in line 3 because the type of <code>x</code> is still <code>any</code>.</p>
</div>
<div class="paragraph">
<p>At the moment, N4JS does not support type guards or, more general, effect system (cf. [<a href="#Nielson99a">Nielson99a</a>]).</p>
</div>
</div>
<div class="sect2">
<h3 id="_generic_and_parameterized_types"><a class="anchor" href="#_generic_and_parameterized_types"></a>4.4. Generic and Parameterized Types</h3>
<div class="paragraph">
<p>Some notes on terminology:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Type Parameter vs. Type Argument</dt>
<dd>
<p>A type parameter is a declaration containing type variables. A type
argument is a binding of a type parameter to a concrete type or to
another type parameter. Binding to another type parameter can further
restrict the bounds of the type parameter.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This is similar to function declarations (with formal parameters) and
function calls (with arguments).</p>
</div>
<div class="sect3">
<h4 id="_generic_types"><a class="anchor" href="#_generic_types"></a>4.4.1. Generic Types</h4>
<div class="paragraph">
<p>A class declaration or interface declaration with type parameters
declares a generic type. A generic type declares a family of types. The
type parameters have to be bound with type arguments when referencing a
generic type.</p>
</div>
</div>
<div class="sect3">
<h4 id="_type_variables"><a class="anchor" href="#_type_variables"></a>4.4.2. Type Variables</h4>
<div class="paragraph">
<p>A type variable is an identifier used as a type in the context of a
generic class definition, generic interface definition or generic method
definition. A type variable is declared in a type parameter as follows.</p>
</div>
<h5 id="_syntax_2" class="discrete">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>TypeVariable:
    name=IDENTIFIER
        ('extends' declaredUpperBounds+=ParameterizedTypeRef
            ('&amp;' declaredUpperBounds+=ParameterizedTypeRef)*
        )?
;</code></pre>
</div>
</div>
<div class="paragraph">
<p>[Type Variable as Upper Bound][ex:Type Variable as Upper Bound] Note
that type variables are also interpreted as types. Thus, the upper bound
of a type variable may be a type variable as shown in the following
snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class G&lt;T&gt; {
    &lt;X extends T&gt; foo(x: X): void { }
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="type-variables-properties"><a class="anchor" href="#type-variables-properties"></a>Properties</h5>
<div class="paragraph">
<p>A type parameter defines a type variable, which type may be constrained
with an upper bound.</p>
</div>
<div class="paragraph">
<p>Properties of <code>TypeVariable</code>:</p>
</div>
<div class="paragraph">
<p>Type variable, as type variable contains only an identifier, we use type
parameter instead of type variable (and vice versa) if the correct
element is clear from the context.</p>
</div>
<div class="paragraph">
<p>Upper bounds of concrete type bound to the type variable, i.e. a super
class.</p>
</div>
</div>
<div class="sect4">
<h5 id="type-variables-semantics"><a class="anchor" href="#type-variables-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>[[req:10Type Variables]]</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enum is not a valid metatype in <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>U</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>B</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>d</mi><mi>s</mi></math>.</p>
</li>
<li>
<p>Wildcards are not valid in <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>U</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>B</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>d</mi><mi>s</mi></math>.</p>
</li>
<li>
<p>Primitives are not valid in <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>U</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>B</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>d</mi><mi>s</mi></math>.</p>
</li>
<li>
<p>Type variables are valid in <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>U</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>B</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>d</mi><mi>s</mi></math>. </p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/830" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-830</a>
</div>
</div>
<div class="paragraph">
<p>A type variable can be used in any type expression contained in the
generic class, generic interface, or generic function / method
definition.</p>
</div>
<div class="paragraph">
<p>[F-bounded quantification][ex:F_bounded_quantification] Using a type
variable in the upper bound reference may lead to recursive definition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class Chain&lt;C extends Chain&lt;C, T&gt;, T&gt; {
    next() : C { return null; }
    m() : T { return null; }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="type-variables-type-inference"><a class="anchor" href="#type-variables-type-inference"></a>Type Inference</h5>
<div class="paragraph">
<p>In many cases, type variables are not directly used in subtype relations
as they are substituted with the concrete types specified by some type
arguments. In these cases, the ordinary subtype rules apply without
change. However, there are other cases in which type variables cannot be
substituted:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Inside a generic declaration.</p>
</li>
<li>
<p>If the generic type is used as raw type.</p>
</li>
<li>
<p>If a generic function / method is called without type arguments and
without the possibility to infer the type from the context.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In these cases, an unbound type variable may appear on one or both sides
of a subtype relation and we require subtype rules that take type
variables into account.</p>
</div>
<div class="paragraph">
<p>It is important to note that while type variables may have a declared
upper bound, they cannot be simply replaced with that upper bound and
treated like existential types. The following example illustrates this:</p>
</div>
<div class="paragraph">
<p>[Type variables vs. existential
types][ex:TypeVariablesVsExistentialTypes]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class A {}
class B extends A {}
class C extends B {}

class G&lt;T&gt; {}

class X&lt;T extends A, S extends B&gt; {

    m(): void {

        // plain type variables:
        var t: T;
        var s: S;

        t = s;  // ERROR: "S is not a subtype of T." at "s"

        // existential types:
        var ga: G&lt;? extends A&gt;;
        var gb: G&lt;? extends B&gt;;

        ga = gb;  // ok!
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Even though the upper bound of is a subtype of ’s upper bound (since
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>A</mi></math>), we cannot infer that is a subtype of (line 15),
because there are valid concrete bindings for which this would not be
true: for example, if were bound to and to .</p>
</div>
<div class="paragraph">
<p>This differs from existential types (see and and line 21):
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi></math> ).</p>
</div>
<div class="paragraph">
<p>We thus have to define subtype rules for type variables, taking the
declared upper bound into account. If we have a subtype relation in
which a type variable appears on one or both sides, we distinguish the
following cases:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If we have type variables on both sides: the result is true if and
only if there is the identical type variable on both sides.</p>
</li>
<li>
<p>If we have a type variable on the left side and no type variable on
the right side: the result is true if and only if the type variable on
the left has one or more declared upper bounds.
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mfenced close=")" open="("><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mo>.</mo><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>U</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>B</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>d</mi><mi>s</mi></mrow></mfenced><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></math><br>
This is the case for
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mfenced close=")" open="("><mrow><mi>T</mi><mi>e</mi><mi>x</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>s</mi><mi>B</mi></mrow></mfenced><mi>}</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>A</mi><mi>}</mi></math> in which T is an
unbound type variable and A, B two classes with <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>A</mi></math>.</p>
</li>
<li>
<p>In all other cases the result is false.<br>
This includes cases such as<br>
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>B</mi><mi>}</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mfenced close=")" open="("><mrow><mi>T</mi><mi>e</mi><mi>x</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>s</mi><mi>A</mi></mrow></mfenced><mi>}</mi></math> which is always
false, even if <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>A</mi></math> or<br>
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mfenced close=")" open="("><mrow><mi>T</mi><mi>e</mi><mi>x</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>s</mi><mi>A</mi></mrow></mfenced><mi>}</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mfenced close=")" open="("><mrow><mi>S</mi><mi>e</mi><mi>x</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>s</mi><mi>B</mi></mrow></mfenced><mi>}</mi></math> which
is always false, even if <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi><mo>=</mo><mi>B</mi></math>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We thus obtain the following defintion:</p>
</div>
<div class="paragraph">
<p>[Subtype Relation for Type
Variables][def:SubtypeRelationForTypeVariables] For two types
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mo>,</mo><mi>S</mi></math> of which at least one is a type variable, we define</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if both <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> and <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> are type variables:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>T</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>S</mi></mrow><mrow><mi>T</mi><mo>=</mo><mi>S</mi></mrow></math></p>
</li>
<li>
<p>if <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> is a type variable and <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> is not:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>T</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>S</mi></mrow><mrow><mrow><mi>T</mi><mo>.</mo><mstyle mathvariant="italic"><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>U</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>B</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>d</mi><mi>s</mi></mstyle><mo>.</mo><mstyle mathvariant="italic"><mi>s</mi><mi>i</mi><mi>z</mi><mi>e</mi></mstyle><mi>g</mi><mi>t</mi><mi>;</mi><mn>0</mn></mrow><mrow><mi> </mi><mo>∧</mo><mi> </mi><mo>∀</mo><mi>t</mi><mo>∈</mo><mi>T</mi><mo>.</mo><mstyle mathvariant="italic"><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>U</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>B</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>d</mi><mi>s</mi></mstyle><mi>:</mi><mi>t</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>S</mi></mrow></mrow></math></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_parameterized_types"><a class="anchor" href="#_parameterized_types"></a>4.4.3. Parameterized Types</h4>
<div class="paragraph">
<p>References to generic types (cf. ) can be parameterized with type
arguments. A type reference with type arguments is called parameterized
type.</p>
</div>
<div class="sect4">
<h5 id="parameterized-types-syntax"><a class="anchor" href="#parameterized-types-syntax"></a>Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ParameterizedTypeRef:
    ParameterizedTypeRefNominal | ParameterizedTypeRefStructural;

ParameterizedTypeRefNominal:
    declaredType=[Type|TypeReferenceName]
    (=&gt; '&lt;' typeArgs+=TypeArgument (',' typeArgs+=TypeArgument)* '&gt;')?;

ParameterizedTypeRefStructural:
    definedTypingStrategy=TypingStrategyUseSiteOperator
    declaredType=[Type|TypeReferenceName]
    (=&gt;'&lt;' typeArgs+=TypeArgument (',' typeArgs+=TypeArgument)* '&gt;')?
    ('with' TStructMemberList)?;

TypeArgument returns TypeArgument:
    Wildcard | TypeRef;

Wildcard returns Wildcard:
    '?'
    (
          'extends' declaredUpperBound=TypeRef
        | 'super' declaredLowerBound=TypeRef
    )?
;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="parameterized-types-properties"><a class="anchor" href="#parameterized-types-properties"></a>Properties</h5>
<div class="paragraph">
<p>Properties of parameterized type references (nominal or structural):</p>
</div>
<div class="paragraph">
<p>Referenced type by type reference name (either the simple name or a
qualified name, e.g. in case of namespace imports).</p>
</div>
<div class="paragraph">
<p>The type arguments, may be empty.</p>
</div>
<div class="paragraph">
<p>Typing strategy, by default nominal, see for details</p>
</div>
<div class="paragraph">
<p>in case of structural typing, reference can add additional members to
the structural type, see for details.</p>
</div>
<div class="paragraph">
<p><strong>Pseudo Properties:</strong></p>
</div>
<div class="paragraph">
<p>The <code>ImportSpecifier</code>, may be null if this is a local type reference. Note that this may
be a <code>NamedImportSpecifier</code>. See \autoref{sec:Import_Statement} for details for details.</p>
</div>
<div class="paragraph">
<p>Returns simple name of type, that is either the simple name as declared,
or the alias in case of an imported type with alias in the import
statement.</p>
</div>
</div>
<div class="sect4">
<h5 id="parameterized-types-semantics"><a class="anchor" href="#parameterized-types-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>The main purpose of a parameterized type reference is to simply refer to
the declared type. If the declared type is a generic type, the
parameterized type references defines a <em>substitution</em> of the type
parameters of a generic type with actual type arguments. A type argument
can either be a concrete type, a wildcard or a type variable declared in
the surrounding generic declaration. The actual type arguments must
conform to the type parameters so that code referencing the generic type
parameters is still valid.</p>
</div>
<div class="paragraph">
<p>[[req:11 Parameterized Types]]
For a given parameterized
type reference <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi></math> with<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo>=</mo><mi>R</mi><mo>.</mo><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi></math>, the following constraints must hold:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The actual type arguments must conform to the type parameters, that
is:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>|</mo><mi>G</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>P</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>|</mo><mo>=</mo><mo>|</mo><mi>R</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>A</mi><mi>r</mi><mi>g</mi><mi>s</mi><mo>|</mo><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∧</mo><mo>∀</mo><mi> </mi><mi>i</mi><mo>,</mo><mn>0</mn><mi>l</mi><mi>t</mi><mi>;</mi><mi>i</mi><mi>l</mi><mi>t</mi><mi>;</mi><mo>|</mo><mi>R</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>A</mi><mi>r</mi><mi>g</mi><mi>s</mi><mo>|</mo><mi>:</mi><mrow><mi>R</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>A</mi><mi>r</mi><mi>g</mi><msub><mi>s</mi><mi>i</mi></msub></mrow><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mrow><mi>R</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>P</mi><mi>a</mi><mi>r</mi><msub><mi>s</mi><mi>i</mi></msub></mrow><mtext>
</mtext></math></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We define type erasure similar to Java [<a href="#Gosling12a">Gosling12a(p.S4.6)</a>] as a "mapping from types (possibly including parameterized types and type variables) to types (that are never parameterized types or type variables)". We write $T°$ for the erasure of type $T$.\footnote{The notation $|T|$ used in [<a href="#Gosling12a">Gosling12a</a>] conflicts with the notation of cardinality of sets, which we use in case of union or intersection types for types as well. The notation used here is inspired by [<a href="#Crary02a">Crary02a</a>], in which  a mapping is defined between a typed language $\lambda$ to an untyped language $\lambda°$.}</p>
</div>
<div class="paragraph">
<p>[Parameterized Type, Raw Type][def:Parameterized_Type] A parameterized
type reference <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi></math> defines a parameterized type
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>, in which all type parameters of
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi><mo>.</mo><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>T</mi><mi>p</mi><mi>e</mi></math> are substituted with the actual values of
the type arguments. We call the type <math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>T</mi><mn>0</mn></msup></math>, in which all
type parameters of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi><mo>.</mo><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi></math> are ignored, the <em>raw
type</em> or <em>erasure</em> of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>.</p>
</div>
<div class="paragraph">
<p>We define for types in general:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The erasure <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mi>x</mi></math> of a parameterized type
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mi>l</mi><mi>t</mi><mi>;</mi><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub><mi>g</mi><mi>t</mi><mi>;</mi></math> is simply <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi></math>.</p>
</li>
<li>
<p>The erasure of a type variable is the erasure of its upper bound.</p>
</li>
<li>
<p>The erasure of any other type is the type itself.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This concept of type erasure is purely defined for specification
purposes. It is not to be confused with the <code>real</code> type erasure which
takes place at runtime, in which almost no types (except primitive
types) are available.</p>
</div>
<div class="paragraph">
<p>That is, the type reference in <code>var G&lt;string&gt; gs;</code>
actually defines a type <code>G&lt;string&gt;</code>, so that
<math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>g</mi><mi>s</mi></mrow><mo>=</mo><mrow><mi>G</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>g</mi><mi>t</mi><mi>;</mi></mrow></math>. It may reference a type
defined by a class declaration <code>class G&lt;T&gt; </code>.
It is important that the type <code>G&lt;string&gt;</code> is different from <code>G&lt;T&gt;</code>.</p>
</div>
<div class="paragraph">
<p>If a parameterized type reference <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi></math> has no type arguments,
then it is similar to the declared type. That is,
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi><mo>=</mo><mi>T</mi><mo>=</mo><mi>R</mi><mo>.</mo><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi></math> if (and only if)
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>|</mo><mi>R</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>A</mi><mi>r</mi><mi>g</mi><mi>s</mi><mo>|</mo><mo>=</mo><mn>0</mn></math>.</p>
</div>
<div class="paragraph">
<p>In the following, we do not distinguish between parameter type reference
and parameter type – they are both two sides of the same coin.</p>
</div>
<div class="paragraph">
<p>In Java, due to backward compatibility
(generics were only introduced in Java 1.5), it is possible to use raw
types in which we refer to a generic type without specifying any type
arguments. This is not possible in N4JS, as there is no unique
interpretation of the type in that case as shown in the following
example. Given the following declarations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class A{}
class B extends A{}
class G&lt;T extends A&gt; { t: T; }
var g: G;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, variable refers to the <em>raw type</em> . This is forbidden in
N4JS, because two interpretations are possible:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>is of type</p>
</li>
<li>
<p>is of type</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the first case, an existential type would be created, and<br>
<br>
must fail.</p>
</div>
<div class="paragraph">
<p>In the second case,<br>
<br>
must fail.</p>
</div>
<div class="paragraph">
<p>In Java, both assignments work with raw types, which is not really save.
To avoid problems due to different interpretations, usage of raw types
is not allowed in N4JS.<sup class="footnote">[<a id="_footnoteref_11" class="footnote" href="#_footnote_11" title="View footnote.">11</a>]</sup></p>
</div>
<div class="paragraph">
<p>Calls to generic functions and methods can also be parameterized, this
is described in [sec:Function_Calls]. Note that invocation of generic
functions or methods does not need to be parameterized.</p>
</div>
<div class="paragraph">
<p>[Type Conformance][def:Type_Conformance] We define type conformance for
non-primitive type references as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>* For two non-parameterized types math:[$T^0$] and
math:[$S^0$], math:[\[\begin{aligned}
    \infer{T^0 &lt;: S^0}{S^0 \in T^0.sup^* \cup T^0.interfaces^*}
    \end{aligned}\]]
* For two parameterized types math:[$T&lt;T_1,...,T_n&gt;$] and
math:[$S&lt;S_1,...,S_m&gt;$] math:[\[\begin{aligned}
    \infer{\hspace{10em}T &lt;: S\hspace{10em}}{
        {T^0&lt;:S^0} \\
        {(n=0 \lor m=0 \lor (n=m \to \forall i:}\\
        \hspace{2em} {T_i.upperBound &lt;: S_i.upperBound} \\
        \hspace{1em} \land {T_i.lowerBound :&gt; S_i.lowerBound}))}
    \end{aligned}\]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>[[ex:Subtyping with parameterized types]]
Let classes A, B, and C are defined as in the chapter beginning
(<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>B</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>A</mi></math>). The following subtype relations are
evaluated as indicated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>G&lt;A&gt; &lt;: G&lt;B&gt;                        -&gt; false
G&lt;B&gt; &lt;: G&lt;A&gt;                        -&gt; false
G&lt;A&gt; &lt;: G&lt;A&gt;                        -&gt; true
G&lt;A&gt; &lt;: G&lt;?&gt;                        -&gt; true
G&lt;? extends A&gt; &lt;: G&lt;? extends A&gt;    -&gt; true
G&lt;? super A&gt; &lt;: G&lt;? super A&gt;        -&gt; true
G&lt;? extends A&gt; &lt;: G&lt;? extends B&gt;    -&gt; false
G&lt;? extends B&gt; &lt;: G&lt;? extends A&gt;    -&gt; true
G&lt;? super A&gt; &lt;: G&lt;? super B&gt;        -&gt; true
G&lt;? super B&gt; &lt;: G&lt;? super A&gt;        -&gt; false
G&lt;? extends A&gt; &lt;: G&lt;A&gt;              -&gt; false
G&lt;A&gt; &lt;: G&lt;? extends A&gt;              -&gt; true
G&lt;? super A&gt; &lt;: G&lt;A&gt;                -&gt; false
G&lt;A&gt; &lt;: G&lt;? super A&gt;                -&gt; true
G&lt;? super A&gt; &lt;: G&lt;? extends A&gt;      -&gt; false
G&lt;? extends A&gt; &lt;: G&lt;? super A&gt;      -&gt; false
G&lt;?&gt; &lt;: G&lt;? super A&gt;                -&gt; false
G&lt;? super A&gt; &lt;: G&lt;?&gt;                -&gt; true
G&lt;?&gt; &lt;: G&lt;? extends A&gt;              -&gt; false
G&lt;? extends A&gt; &lt;: G&lt;?&gt;              -&gt; true</code></pre>
</div>
</div>
<div class="paragraph">
<p>shows the subtype relations of parameterized types (of a single generic
type), which can be used as a cheat sheet.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="fig/cdVarianceChart.png" alt="cdVarianceChart">
</div>
<div class="title">Figure 1. cdVarianceChart</div>
</div>
<div class="paragraph">
<p>Cheat sheet: subtype relation of parameterized types]</p>
</div>
<div class="paragraph">
<p>[[ex:Subtyping between different generic types]]
Let classes
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi></math> and <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>H</mi></math> be two generic classes where:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class G&lt;T&gt; {}
class H&lt;T&gt; extends G&lt;T&gt; {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given a simple, non-parameterized class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi></math>, the following
subtype relations are evaluated as indicated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>G&lt;A&gt; &lt;: G&lt;A&gt;                        -&gt; true
H&lt;A&gt; &lt;: G&lt;A&gt;                        -&gt; true
G&lt;A&gt; &lt;: H&lt;A&gt;                        -&gt; false</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="parameterized-types-type-inference"><a class="anchor" href="#parameterized-types-type-inference"></a>Type Inference</h5>
<div class="paragraph">
<p>Type inference for parameterized types uses the concept of existential types (in Java, a slightly modified version called capture conversion is implemented).</p>
</div>
<div class="paragraph">
<p><sup class="footnote">[<a id="_footnoteref_12" class="footnote" href="#_footnote_12" title="View footnote.">12</a>]</sup> for <em>Featherweight Java with Generics</em>].</p>
</div>
<div class="paragraph">
<p>The concept of existential types with wildcard capture (a special kind of existential type) is published in [<a href="#Torgersen05">Torgersen05</a>], further developed in [<a href="#Cameron08b">Cameron08b</a>] (further developed in  [<a href="#Cameron09a">Cameron09a</a>] [<a href="#Summers10">Summers10</a>], also see [<a href="#Wehr08a">Wehr08a</a>] for a similar approach).
The key feature of the Java generic wildcard handling is called capture conversion, described in [<a href="#Gosling12a">Gosling12a(p.S5.1.10)</a>].
However, there are some slight differences to Java 6 and 7, only with Java 8 similar results can be expected.
All these papers include formal proofs of certain aspects, however even these paper lack proof of other aspect</p>
</div>
<div class="paragraph">
<p>The idea is quite simple: All unbound wildcards are replaced with
freshly created new types <sup class="footnote">[<a id="_footnoteref_13" class="footnote" href="#_footnote_13" title="View footnote.">13</a>]</sup>, fulfilling the
constraints defined by the wildcard’s upper and lower bound. These newly
created types are then handled similar to real types during type
inference and type conformance validation.</p>
</div>
<div class="paragraph">
<p>[[ex:Existential Type]]
The inferred type of a variable
declared as</p>
</div>
<div class="paragraph">
<p>,</p>
</div>
<div class="paragraph">
<p>that is the parameterized type, is an existential type
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>E</mi><mn>1</mn></msub></math>, which is a subtype of A. If you have another variable
declared as</p>
</div>
<div class="paragraph">
<p>another type <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>E</mi><mn>2</mn></msub></math> is created, which is also a subtype of A.
Note that <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>E</mi><mn>1</mn></msub><mo>≠</mo><msub><mi>E</mi><mn>2</mn></msub></math>! Assuming typical setter or getter
in G, e.g. and , the following code snippet will produce an error:</p>
</div>
<div class="paragraph">
<p>This is no surprise, as actually returns a type <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>E</mi><mn>1</mn></msub></math>, which
is not a subtype of <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>E</mi><mn>2</mn></msub></math>.</p>
</div>
<div class="paragraph">
<p>The upper and lower bound declarations are, of course, still available
during type inference for these existential types. This enables the type
inferencer to calculate the join and meet of parameterized types as
well.</p>
</div>
<div class="paragraph">
<p>[[req:12Join of Parameterized Types]]
The join of two parameterized types <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mi>l</mi><mi>t</mi><mi>;</mi><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub><mi>g</mi><mi>t</mi><mi>;</mi></math> and
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>H</mi><mi>l</mi><mi>t</mi><mi>;</mi><msub><mi>S</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>S</mi><mi>m</mi></msub><mi>g</mi><mi>t</mi><mi>;</mi></math> is the join of the raw types, this join
is then parameterized with the join of the upper bounds of of type
arguments and the meet of the lower bounds of the type arguments.</p>
</div>
<div class="paragraph">
<p>For all type rules, we assume that the upper and lower bounds of a
non-generic type, including type variables, simply equal the type
itself, that is for a given type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>, the following
constraints hold: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mfenced close=")" open="("><mi>T</mi></mfenced><mo>=</mo><mi>l</mi><mi>o</mi><mi>w</mi><mi>e</mi><mi>r</mi><mfenced close=")" open="("><mi>T</mi></mfenced><mo>=</mo><mi>T</mi></math></p>
</div>
<div class="paragraph">
<p>[[ex:Upper and lower bound of parameterized types]]
Assuming the given classes listed above, the
following upper and lower bounds are expected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>G&lt;A&gt;            -&gt; upperBound = lowerBound = A
G&lt;? extends A&gt;  -&gt; lowerBound = null, upperBound = A
G&lt;? super A&gt;    -&gt; lowerBound = A, upperBound = any
G&lt;?&gt;            -&gt; lowerBound = null, upperBound = any</code></pre>
</div>
</div>
<div class="paragraph">
<p>This leads to the following expected subtype relations: </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/260" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-260</a>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>(? extends A) &lt;: A  -&gt; true
(? super A) &lt;: A    -&gt; false
A &lt;: (? extends A)  -&gt; false
A &lt;: (? super A)    -&gt; true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that there is a slight difference to Java: In N4JS it is not
possible to use a generic type in a raw fashion, that is to say without
specifying any type arguments. In Java this is possible due to backwards
compatibility with early Java versions in which no generics were
supported.</p>
</div>
<div class="paragraph">
<p>In case an upper bound of a type variable shall consist only of a few
members, it seems convenient to use additional structural members, like
on interface I2 in the
example <a href="#ex:Use declared interfaces for lower bounds">[ex:Use declared interfaces for lower bounds]</a> below. However,
type variables must not be constrained using structural types (see
constraint <a href="#Use_Site_Structural_Typing">[Use_Site_Structural_Typing]</a>). Hence, the recommended
solution is to use an explicitly declared interface that uses definition
site structural typing for these constraints as an upper bound (see
interface in the example).</p>
</div>
<div class="paragraph">
<p>[[ex:Use declared interfaces for lower bounds]]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>interface I1&lt;T extends any with {prop : int}&gt; { // error
}

interface ~J {
    prop : int;
}
interface I2&lt;T extends J&gt; {
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_primitive_ecmascript_types"><a class="anchor" href="#_primitive_ecmascript_types"></a>4.5. Primitive ECMAScript Types</h3>
<div class="paragraph">
<p>
N4JS provides the same basic types as ECMAScript [<a href="#ECMA11a">ECMA11a(p.p.28)</a>].</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-40" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-40</a>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title"></div>
</td>
<td class="content">
In ECMAScript, basic types come in two flavors: as primitive types [<a href="#ECMA11a">ECMA11a(p.S8Types, p.p.28)</a>] and as Objects [<a href="#ECMA11a">ECMA11a(p.S15, p.p.102)</a>].
In N4JS, primitive types are written with lower cases, object types with first case capitalized.
For example, <code>string</code> is the primitive ECMAScript string type, while <code>String</code> is an object.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following ECMAScript primitive types are supported, they are written
with lower case letters::</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>undefined</code>: [<a href="#ECMA11a">ECMA11a(p.S8.3)</a>]; cannot be used in type expression, see void below.</p>
</li>
<li>
<p><code>null</code> [<a href="#ECMA11a">ECMA11a(p.S8.3)</a>]; cannot be used in type expression</p>
</li>
<li>
<p><code>boolean</code>  [<a href="#ECMA11a">ECMA11a(p.S8.3)</a>]</p>
</li>
<li>
<p><code>string</code> [<a href="#ECMA11a">ECMA11a(p.S8.4)</a>]</p>
</li>
<li>
<p><code>number</code> [<a href="#ECMA11a">ECMA11a(p.S8.5)</a>]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Although Object is a primitive type in [<a href="#ECMA11a">ECMA11a(p.S8.5)</a>], it is interpreted here as an
object type and described in .</p>
</div>
<div class="paragraph">
<p>Please note that primitive types are values (= no objects) so they have
no properties and you cannot inherit from them.</p>
</div>
<div class="sect3">
<h4 id="_undefined_type"><a class="anchor" href="#_undefined_type"></a>4.5.1. Undefined Type</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-495" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-495</a>
</div>
</div>
<div class="paragraph">
<p>The <code>undefined</code> type cannot be declared explicitly by the user by means of a type
expression. Every variable that has not been assigned to a value has
this value and type respectively. This applies also to functions that
have no or an empty return statement. Note in ECMAScript there are three
undefined elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>undefined</code> as type (as used here)</p>
</li>
<li>
<p><code>undefined</code> as value (the only value of the undefined type)</p>
</li>
<li>
<p><code>undefined</code> is a property of the global object with undefined (value) as initial
value. Since ECMAScript 5 it is not allowed to reassign this property
but this is not enforced by all ECMAScript/JavaScript engines.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The type <code>undefined</code> will be inferred to false in a boolean expression. It is
important to note that something that is not assigned to a value is <code>undefined</code> but not <code>null</code>.</p>
</div>
<div class="paragraph">
<p>Although it is not possible to use <code>undefined</code> in a type expression, there are two
ways of declaring an element as undefined:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For functions, the return type can be declared <code>void</code>, which is almost
similar to <code>undefined</code>, see <a href="#_void_type">Void Type</a>.</p>
</li>
<li>
<p>(Local) Variables can be declared as by using the annotation <code>@Undefined</code>. This does not only set the type to <code>undefined</code>, but also prevents users from assigning a value to this variable. That is, <code>@Undefined</code> basically means that the value of the
variable is constantly set to <code>undefined</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>[[ex:Undefined Annotation]]
The following examples illustrate the use of the annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>var @Undefined undef;
undef = 1; // will issue an error!</code></pre>
</div>
</div>
<div class="paragraph">
<p>The type <code>undefined</code> is a subtype of all types. That is,
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>u</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>T</mi></mrow><mrow/></math> is an axiom and
true for all types <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_null_type"><a class="anchor" href="#_null_type"></a>4.5.2. Null Type</h4>
<div class="paragraph">
<p>The <code>null</code> type cannot be declared explicitly by the user. Only the keyword <code>null</code> is inferred to type <code>null</code>.</p>
</div>
<div class="sect4">
<h5 id="null-type-semantics"><a class="anchor" href="#null-type-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>In contrast to <code>undefined</code>, it expresses the intentional absence of a value.</p>
</div>
<div class="paragraph">
<p>The <code>null</code> type can be assigned to any other type. That is, the type <code>null</code> is a
subtype of all other types except <code>undefined</code>:</p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi></mrow><mi> </mi><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>}</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>}</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mo>≠</mo><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>u</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi></mrow></math></p>
</div>
<div class="paragraph">
<p>Please note that</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>null==undefined</code> evaluates to <code>true</code></p>
</li>
<li>
<p><code>null===undefined</code> evaluates to <code>false</code></p>
</li>
<li>
<p><code>typeof null</code> evaluates to <code>object</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only the <code>null</code> keyword is inferred to type null. If <code>null</code> is assigned to a variable, the type of the variable is not changed. This is true, in particular,
for variable declarations. For example in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>var x = null;</code></pre>
</div>
</div>
<div class="paragraph">
<p>the type of variable <code>x</code> is inferred to <code>any</code> (cf. <a href="#Var Statement">[Var Statement]</a>).</p>
</div>
<div class="paragraph">
<p>The type <code>null</code> will be inferred to false in a boolean expression.</p>
</div>
<div class="paragraph">
<p>The call <code>typeof null</code> will return ’object’.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_primitive_boolean_type"><a class="anchor" href="#_primitive_boolean_type"></a>4.5.3. Primitive Boolean Type</h4>
<div class="paragraph">
<p>Represents a logical entity having two values, true and false.</p>
</div>
<div class="paragraph">
<p>Please note that a boolean primitive is coerced to a number in a
comparison operation so that</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Source</th>
<th class="tableblock halign-center valign-middle">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var a = true; console.log(a == 1)</code></pre>
</div>
</div></div></td>
<th class="tableblock halign-center valign-middle"><p class="tableblock">prints true</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var b = false; console.log(b == 0)</code></pre>
</div>
</div></div></td>
<th class="tableblock halign-center valign-middle"><p class="tableblock">prints true</p></th>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="primitive-boolean-type-semantics"><a class="anchor" href="#primitive-boolean-type-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>The type is subtype of :
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>b</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi>a</mi><mi>n</mi></mrow><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mrow><mi>a</mi><mi>n</mi><mi>y</mi></mrow></mrow><mrow/></math></p>
</div>
<div class="paragraph">
<p>Variables of type <code>boolean</code> can be auto-converted (coerced) to <code>Boolean</code>, as described in <a href="#_auto_boxing_and_coercing">Auto-Boxing and Coercing</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_primitive_string_type"><a class="anchor" href="#_primitive_string_type"></a>4.5.4. Primitive String Type</h4>
<div class="paragraph">
<p>A finite sequence of zero or more 16-bit unsigned integer values
(elements). Each element is considered to be a single UTF-16 code unit.</p>
</div>
<div class="paragraph">
<p>Also string as primitive type has no properties, you can access the
properties available on the object String as string will be coerced to
String on the fly but just for that property call, the original variable
keeps its type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>var a = "MyString"
console.log(typeof a) // string
console.log(a.length) // 8
console.log(typeof a) // string</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can handle a primitive <code>string</code> like an object type <code>String</code> but with these
exceptions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>typeof "MyString"</code> is <code>'string'</code> but<code>typeof new String("MyString")</code> is <code>'object'</code></p>
</li>
<li>
<p><code>"MyString" instanceof String</code> or <code>instanceof Object</code> will return <code>false</code>, for <code>new String("MyString")</code> both checks evaluate to <code>true</code></p>
</li>
<li>
<p><code>console.log(eval("2+2"))</code> returns <code>4</code>, <code>console.log(eval(new String("2+2")))</code> returns string <code>"2+2"</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This marks a difference to Java. In JavaScript, Unicode escape sequences
are never interpreted as a special character.</p>
</div>
<div class="sect4">
<h5 id="primitive-string-type-semantics"><a class="anchor" href="#primitive-string-type-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>The <code>string</code> type is a subtype of <code>any</code>:</p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mrow><mi>a</mi><mi>n</mi><mi>y</mi></mrow></mrow><mrow/></math></p>
</div>
<div class="paragraph">
<p>It is supertype of the N4JS primitive type <code>pathselector</code>, and <code>i18nKey</code>.
<a href="#_primitive_pathselector_and_i18nkey">Primitive Pathselector and I18nKey</a></p>
</div>
<div class="paragraph">
<p>However, variables of type <code>string</code> can be auto-converted (coerced) to <code>string</code>, as described in <a href="#Autoboxing and coercing">[Autoboxing and coercing]</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_primitive_number_type"><a class="anchor" href="#_primitive_number_type"></a>4.5.5. Primitive Number Type</h4>
<div class="paragraph">
<p>In ECMAScript numbers are usually 64-bit floating point numbers. For
details see [<a href="#ECMA11a">ECMA11a(p.8.5)</a>].
With prefix <code>0</code> you indicate that the number is octal based and with prefix <code>0x</code> it is marked as hexadecimal based.</p>
</div>
<div class="paragraph">
<p><code>NaN</code> can be produced by e.g.  '`0 / 0`’ or ’<code>1 - x</code>’. <code>typeof NaN</code> will return <code>number</code>.</p>
</div>
<div class="sect4">
<h5 id="primitive-number-type-semantics"><a class="anchor" href="#primitive-number-type-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>The type <code>number</code> is subtype of <code>any</code>:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi></mrow><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>a</mi><mi>n</mi><mi>y</mi><mi>}</mi><mi>}</mi><mrow/><mtext>
</mtext></math></p>
</div>
<div class="paragraph">
<p>However, variables of type <code>number</code> can be auto-converted (coerced) to <code>Number</code>, as
described in <a href="#_integer_literals">Integer Literals</a> .</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_primitive_type_int"><a class="anchor" href="#_primitive_type_int"></a>4.5.6. Primitive Type int</h4>
<div class="paragraph">
<p>Actually ECMAScript defines an internal type <code>int32</code>. A number of this type is
returned by the binary or operation using zero as operand, e.g.
ECMAScript’s internal type int32 can be represented in N4JS by a
built-in primitive type called <code>int</code>. For details on how numeric literals map to types <code>number</code> and <code>int</code>, refer to <a href="#integer Literals">[integer Literals]</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title"></div>
</td>
<td class="content">
for the time being, built-in type <code>int</code> is synonymous to type <code>number</code>. This means one can be assigned to the other and a value declared to be of type <code>int</code> may actually be a 64-bit floating point number.
<sup class="footnote">[<a id="_footnoteref_14" class="footnote" href="#_footnote_14" title="View footnote.">14</a>]</sup>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_primitive_symbol_type"><a class="anchor" href="#_primitive_symbol_type"></a>4.5.7. Primitive Symbol Type</h4>
<div class="paragraph">
<p>The primitive type <code>symbol</code> is directly as in ECMAScript 6. Support for symbols is kept to a minimum in N4JS. While this primitive type can be used
without any restrictions, the only value of this type available in N4JS
is the built-in symbol <code>Symbol.iterator</code>. Other built-in symbols from ECMAScript 6 and the creation of new symbols are not supported. For more details, see <a href="#Primitive Symbol Type Object Type">[Primitive Symbol Type Object Type]</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_primitive_n4js_types"><a class="anchor" href="#_primitive_n4js_types"></a>4.6. Primitive N4JS Types</h3>
<div class="paragraph">
<p>Additionally to the primitive ECMAScript types, the following
N4JS-specific primitive types are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>any: enables ECMAScript-like untyped variable declarations</p>
</li>
<li>
<p>void: almost similar to undefined, except it can be used as a return
type of functions and methods</p>
</li>
<li>
<p>unknown: inferred in case of a type inference error</p>
</li>
<li>
<p>pathSelector&lt;T&gt;, i18nKey: subtypes of string</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_any_type"><a class="anchor" href="#_any_type"></a>4.6.1. Any Type</h4>
<div class="paragraph">
<p>Any type is the default type of all variables for without a type
declaration. It has no properties. A value of any other type can be
assigned to a variable of type <code>any</code>, but a variable declared  <code>any</code> can only be assigned to another variable declared with the type <code>any</code>.</p>
</div>
<div class="sect4">
<h5 id="any-type-semantics"><a class="anchor" href="#any-type-semantics"></a>Semantics</h5>
<div class="paragraph">
<p><code>any</code> is supertype of all other types. That is,
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mi>`</mi><mi>`</mi><mi>a</mi><mi>n</mi><mi>y</mi></mrow><mi>}</mi><mrow/></math>
is an axiom and true for all types.</p>
</div>
</div>
<div class="sect4">
<h5 id="any-type-type-inference"><a class="anchor" href="#any-type-type-inference"></a>Type Inference</h5>
<div class="paragraph">
<p>If a variable is explicitly declared as type <code>any</code>, the inferred type of that variable will always be <code>any</code>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-106" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-106</a>
</div>
</div>
<div class="sect5">
<h6 id="_default_type_of_variables"><a class="anchor" href="#_default_type_of_variables"></a>Default Type of Variables</h6>
<div class="paragraph">
<p>If a type annotation is missing and no initializer is provided, then the
type of a variable is implicitly set to <code>any</code>.</p>
</div>
<div class="paragraph">
<p>In that case, the inferred type of that variable will always be <code>any</code> as well.
If an initializer is provided, the declared type of the variable will be
set to the inferred type of the initializer. Therefore in the latter
case, the inferred type of the variable will always be the type of the
initializer (cf. <a href="#Var_Statement">[Var_Statement]</a>).</p>
</div>
<div class="paragraph">
<p>If a variable is declared as type , it can be used just as every
variable can be used in raw ECMAScript. Since every property can be get
and set, the types of properties is inferred as as well. This is
formally expressed in <a href="#_identifier">Identifier</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_void_type"><a class="anchor" href="#_void_type"></a>4.6.2. Void Type</h4>
<div class="paragraph">
<p>The type <code>void</code> is the type returned by the ECMAScript <code>void</code> operator (see <a href="#Unary Expressions">[Unary Expressions]</a>), which is similar to <code>undefined</code>. However, the type <code>undefined</code> cannot be expressed explicitly in type
expressions. Instead, it is possible to declare the return type of a
function or method as <code>void</code> in order to state that the function does not return anything.</p>
</div>
<div class="sect4">
<h5 id="void-type-semantics"><a class="anchor" href="#void-type-semantics"></a>Semantics</h5>
<div class="ulist">
<ul>
<li>
<p>The type <code>void</code> may only be used to declare the return type of a function or method.</p>
</li>
<li>
<p>If a function <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi></math> is declared to return <code>void</code>, an error is created if a return statement contains an expression:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>f</mi><mo>.</mo><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>=</mo><mrow><mi>v</mi><mi>o</mi><mi>i</mi><mi>d</mi></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∀</mo><mi>r</mi><mo>,</mo><mi>μ</mi><mfenced close=")" open="("><mi>r</mi></mfenced><mo>=</mo><mrow><mi>R</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>S</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow><mo>,</mo><mi>r</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>F</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mi>f</mi><mi>:</mi><mi>r</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo></math></p>
</li>
<li>
<p>If a function <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi></math> is declared to return <code>void</code>, an error is issued if the function is called in any statement or expression but an expression statement directly: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>f</mi><mo>.</mo><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>=</mo><mrow><mi>v</mi><mi>o</mi><mi>i</mi><mi>d</mi></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∀</mo><mi>e</mi><mo>,</mo><mi>b</mi><mi>i</mi><mi>n</mi><mi>d</mi><mfenced close=")" open="("><mi>e</mi><mi>f</mi></mfenced><mi>:</mi><mi>μ</mi><mfenced close=")" open="("><mrow><mi>e</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>r</mi></mrow></mfenced><mo>=</mo><mrow><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>S</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow></math></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following type hierarchy is defined: <code>void</code> is only a subtype of itself but
not of any other type and no other type is a subtype of void.
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>v</mi><mi>o</mi><mi>i</mi><mi>d</mi></mrow><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mrow><mi>v</mi><mi>o</mi><mi>i</mi><mi>d</mi></mrow></mrow><mrow/></math>
Since <code>void</code> cannot be
used as the type of variables, fields, formal parameters, etc., a
function or method with a return type of void cannot be used as an
lvalue, e.g. it may not appear on the left-hand side of an assignment or
in the argument list of a call expression (note the difference to plain
JavaScript).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_unknown_type"><a class="anchor" href="#_unknown_type"></a>4.6.3. Unknown Type</h4>
<div class="paragraph">
<p>Internally N4JS defines the type <code>unknown</code>.
This type cannot be used by the user.
Instead, it is inferred in case of errors.
<code>unknown</code> behaves almost similar to <code>any+</code>.
However no error messages once a variable or expression has been
inferred to <code>unknown</code> in order to avoid consequential errors.</p>
</div>
</div>
<div class="sect3">
<h4 id="_primitive_pathselector_and_i18nkey"><a class="anchor" href="#_primitive_pathselector_and_i18nkey"></a>4.6.4. Primitive Pathselector and I18nKey</h4>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-55" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-55</a>
<a href="https://jira.numberfour.eu/browse/IDE-379" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-379</a>
</div>
</div>
<div class="paragraph">
<p>N4JS introduces three new types which are subtypes of string. These
types are, in fact, translated to strings and do not add any new
functionality. They are solely defined for enabling additional
validation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pathSelector&lt;T&gt;}</code> is a generic type for specifying path selector expressions. PathSelectors are used to specify a path to a property in a (JSON-like) model tree.</p>
</li>
<li>
<p>The type variable defines the context type (or type of the
root of the tree) in which the selector is to be validated. A path
selector is defined as a string literal that has to conform to the path
selector grammar . [<a href="#PathSelector">PathSelector</a>]. The context type is then used to perform a semantic
validation of the path selector.</p>
</li>
<li>
<p>is a string which refers to an internationalization key. The type is
used to reference resource keys specified in resource files. In a
project <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math>, the type defines the transitive set of all
resource keys accessible from <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math>. Since resource keys are
specified as strings, this means that the type defines a subset of all
string literals that can be assigned to a variable of type in the
current project. That means that an assignment of a string literal to a
variable of type is only valid if that string literal is contained in
the set defined by . Resource keys are declared in the properties files
of a project and all resource keys from a project are accessible to any
project depending on it.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="pathselector-semantics"><a class="anchor" href="#pathselector-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>The N4JS primitive types <code>i18nKey</code> and <code>pathSelector&lt;T&gt;</code> are basically only marker types of strings
for enabling additional validation. Thus, they are completely
interchangeable with string types:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>i</mi><mn>18</mn><mi>n</mi><mi>K</mi><mi>e</mi><mi>y</mi></mrow><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow></mrow><mrow/><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mrow><mi>i</mi><mn>18</mn><mi>n</mi><mi>K</mi><mi>e</mi><mi>y</mi></mrow></mrow><mrow/><mtext>
</mtext><mrow><mrow><mi>p</mi><mi>a</mi><mi>t</mi><mi>h</mi><mi>S</mi><mi>e</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>T</mi><mi>g</mi><mi>t</mi><mi>;</mi></mrow><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow></mrow><mrow/><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mrow><mi>p</mi><mi>a</mi><mi>t</mi><mi>h</mi><mi>S</mi><mi>e</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>T</mi><mi>g</mi><mi>t</mi><mi>;</mi></mrow></mrow><mrow/></math></p>
</div>
<div class="paragraph">
<p>As special literals for these N4JS types do not exist, the type has to
be explicitly specified in order to enable the additional validation.
Note that this validation cannot be applied for more complicated
expressions with parts which cannot be evaluated at compile time. For
example, cannot be evaluated at compile time.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_built_in_ecmascript_object_types"><a class="anchor" href="#_built_in_ecmascript_object_types"></a>4.7. Built-in ECMAScript Object Types</h3>
<div class="paragraph">
<p>
N4JS supports all built-in ECMAScript objects [<a href="#ECMA11a">ECMA11a(p.S15)</a>], interpreted as classes.
Some of these object types are object versions of primitive types. The
object types have the same name as their corresponding primitive type,
but start with an upper case letter.</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-40" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-40</a>
</div>
</div>
<div class="paragraph">
<p>The following types, derived from certain ECMAScript predefined objects
and constructs, are supported by means of built-in types as they are
required by certain expressions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Object</code>   [<a href="#ECMA11a">ECMA11a(p.p111)</a>];</p>
</li>
<li>
<p><code>Function</code>  [<a href="#ECMA11a">ECMA11a(p.p117)</a>]; representing functions and function objects <a href="#Function_Type">[Function_Type]</a> but also methods  (<a href="#methods">[methods]</a>)</p>
</li>
<li>
<p><code>Array</code>    [<a href="#ECMA11a">ECMA11a(p.1p122)</a>], representing array objects, see <a href="#_array_object_type">Array Object Type</a></p>
</li>
<li>
<p><code>String</code> [<a href="#ECMA11a">ECMA11a(p.p141)</a>]</p>
</li>
<li>
<p><code>Boolean</code> [<a href="#ECMA11a">ECMA11a(p.p141)</a>]</p>
</li>
<li>
<p><code>Number</code> [<a href="#ECMA11a">ECMA11a(p.p141)</a>]</p>
</li>
<li>
<p><code>RegExp</code> [<a href="#ECMA11a">ECMA11a(p.p180)</a>]; they can be constructed by means of special literals (cf. <a href="#_literals">Literals</a>)</p>
</li>
<li>
<p>global object type</p>
</li>
<li>
<p><code>Symbol</code></p>
</li>
<li>
<p><code>Promise</code></p>
</li>
<li>
<p><code>Iterator</code> and <code>Iterable</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All other ECMAScript types ([<a href="#ECMA11a">ECMA11a(p.S15)</a>], such as <code>Math</code>, <code>Date</code>, or <code>Error</code> are supported by means of predefined classes.
ECMAScript 2015 types are defined in the ECMAScript
2015 runtime environment. Since they are defined and used similar to
user defined classes, they are not explained in further detail here.
These predefined objects are kind of subtypes of .</p>
</div>
<div class="sect3">
<h4 id="ECMAScript-objects-semantics"><a class="anchor" href="#ECMAScript-objects-semantics"></a>4.7.1. Semantics</h4>
<div class="paragraph">
<p>It is not possible to inherit from any of the built-in ECMAScript object
types except for <code>Object</code> and <code>Error</code>, that is, to use one of these types as supertype
of a class. From the N4JS language’s point of view, these built-in types
are all final.</p>
</div>
</div>
<div class="sect3">
<h4 id="_object_type"><a class="anchor" href="#_object_type"></a>4.7.2. Object Type</h4>
<div class="paragraph">
<p><code>Object</code> [<a href="#ECMA11a">ECMA11a(p.S8.6)</a>] is the (implicit) supertype of all declared (i.e., non-primtive) types, including native types.
It models the ECMAScript type <code>Object</code>, except that no properties may be dynamically added to it.
In order to declare a variable to which properties can be dynamically added, the type <code>Object+</code> has to be declared (cf. <a href="#_type_modifiers">Type Modifiers</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_function_object_type"><a class="anchor" href="#_function_object_type"></a>4.7.3. Function Object Type</h4>
<div class="paragraph">
<p>The built-in object type <code>Function</code>, a subtype of <code>Object</code>, represents all functions, regardless of how they are defined (either via function expression,
function declaration, or method declaration).
They are described in detail in <a href="#_function_object_type">Function Object Type</a>.</p>
</div>
<div class="paragraph">
<p>Since <code>Function</code> is the supertype of all functions regardless of number and types
of formal parameters, return type, and number and bounds of type
parameters, it would not normally be possible to invoke an instance of <code>Function</code>.
For the time being, however, an instance of <code>Function</code> can be invoked, any number
of arguments may be provided and the invocation may be parameterized
with any number of type arguments (which will be ignored), i.e. 
[req:Function_Call_Constraints] and
[req:Parameterized_Function_Call_Constraints] do not apply.</p>
</div>
</div>
<div class="sect3">
<h4 id="_array_object_type"><a class="anchor" href="#_array_object_type"></a>4.7.4. Array Object Type</h4>
<div class="paragraph">
<p>The <code>Array</code> type is generic with one type parameter,
which is the item type. An array is accessed with the index operator,
the type of the index parameter is <code>Number</code>. The type of the stored values is
<em>typeArgs[0]</em> (cf. <a href="#Array_Literal">[Array_Literal]</a>). Due to type erasure, the item type is not
available during runtime, that is to say there are no reflective methods
returning the item type of an array.</p>
</div>
<div class="paragraph">
<p>For an array type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi></math>, the following conditions must be true:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>|</mo><mi>A</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>A</mi><mi>r</mi><mi>g</mi><mi>s</mi><mo>|</mo><mo>=</mo><mn>1</mn></math></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_string_object_type"><a class="anchor" href="#_string_object_type"></a>4.7.5. String Object Type</h4>
<div class="paragraph">
<p>Object type version of <code>string</code>. It is highly recommend to use the primitive
version only. Note that is is not possible to assign a primitive typed
value to an object typed variable.</p>
</div>
</div>
<div class="sect3">
<h4 id="_boolean_object_type"><a class="anchor" href="#_boolean_object_type"></a>4.7.6. Boolean Object Type</h4>
<div class="paragraph">
<p>Object type version of <code>boolean</code>. It is highly recommend to use the primitive
version only. Note that is is not possible to assign a primitive typed
value to an object typed variable.</p>
</div>
</div>
<div class="sect3">
<h4 id="_number_object_type"><a class="anchor" href="#_number_object_type"></a>4.7.7. Number Object Type</h4>
<div class="paragraph">
<p>Object type version of <code>number</code>. It is highly recommend to use the primitive
version only. Note that is is not possible to assign a primitive typed
value to an object typed variable.</p>
</div>
</div>
<div class="sect3">
<h4 id="_global_object_type"><a class="anchor" href="#_global_object_type"></a>4.7.8. Global Object Type</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-245" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-245</a>
</div>
</div>
<div class="paragraph">
<p>This is the globally accessible namespace which contains element such as
undefined, and in case of browsers, window. Depending on the runtime
environment, the global object may has different properties defined by
means of dynamic polyfills.</p>
</div>
</div>
<div class="sect3">
<h4 id="_symbol"><a class="anchor" href="#_symbol"></a>4.7.9. Symbol</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1220" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1220</a>
</div>
</div>
<div class="paragraph">
<p>The symbol constructor function of ECMAScript 2015. Support for symbols
is kept to a minimum in N4JS:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>creating symbols with <code>var sym = Symbol("description")</code> is not supported.</p>
</li>
<li>
<p>creating shared symbols with <code>var sym = Symbol.for("key")</code> is not supported. Also the inverse <code>Symbol.keyFor(sym)</code> is not
supported.</p>
</li>
<li>
<p>retrieving built-in symbols via properties in <code>Symbol</code> is supported, however,
the only built-in symbol available in N4JS is the iterator symbol that
can be retrieved with <code>Symbol.iterator</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The rationale for this selective support for symbols in N4JS is to allow
for the use (and custom definition) of iterators and iterables and their
application in the loop with as little support for symbols as possible.</p>
</div>
</div>
<div class="sect3">
<h4 id="_promise"><a class="anchor" href="#_promise"></a>4.7.10. Promise</h4>
<div class="paragraph">
<p><code>Promise</code> is provided as a built-in type as in ECMAScript 2015. Also see
[sec:Asynchronous_Functions] for asynchronous functions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_iterator_interface"><a class="anchor" href="#_iterator_interface"></a>4.7.11. Iterator Interface</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1220" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1220</a>
</div>
</div>
<div class="paragraph">
<p>A structurally typed interface for <em>iterators</em> as defined by the
ECMAScript 6 iterator protocol.</p>
</div>
<div class="listingblock">
<div class="title">Iterable in N4JS</div>
<div class="content">
<pre class="highlightjs highlight"><code>// providedByRuntime
export public interface ~Iterator&lt;T&gt;  {
    public next(): IteratorEntry&lt;T&gt;
}

// providedByRuntime
export public interface ~IteratorEntry&lt;T&gt; {
    public done: boolean;
    public value: T?;
}</code></pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Interface IteratorEntry was introduced mainly to work around IDEBUG-273; after solving this bug, this interface could be removed and replaced with a corresponding structural type reference as return type of method next() </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/273" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-273</a>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_iterable_interface"><a class="anchor" href="#_iterable_interface"></a>4.7.12. Iterable Interface</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1220p" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1220p</a>
</div>
</div>
<div class="paragraph">
<p>A structurally typed interface for objects that can be iterated over,
i.e. <em>iterables</em> as defined by the ECMAScript 6 iterator protocol.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>// providedByRuntime
export public interface ~Iterable&lt;T&gt; {
    public [Symbol.iterator](): Iterator&lt;T&gt;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this interface’s method is special in that a symbol is used as
identifier. You can use the ordinary syntax for computed property names
in ECMAScript 6 for overriding / implementing or invoking this method.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_built_in_n4js_types"><a class="anchor" href="#_built_in_n4js_types"></a>4.8. Built-In N4JS Types</h3>
<div class="paragraph">
<p>N4JS additionally provides some built-in classes which are always available with the need to explicitly import them.</p>
</div>
<div class="sect3">
<h4 id="_n4object"><a class="anchor" href="#_n4object"></a>4.8.1. N4Object</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-547" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-547</a>
</div>
</div>
<div class="paragraph">
<p>Although <code>N4Object</code> is a built-in type, it is not the default supertype. It is a
subtype of <code>Object</code>.</p>
</div>
<div class="sect4">
<h5 id="N4Object-semantics"><a class="anchor" href="#N4Object-semantics"></a>Semantics</h5>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>N</mi><mn>4</mn><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo></mrow><mrow/></math></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_n4class"><a class="anchor" href="#_n4class"></a>4.8.2. N4Class</h4>
<div class="paragraph">
<p>The type <code>N4Class</code> is used for extended reflection in N4JS.</p>
</div>
</div>
<div class="sect3">
<h4 id="_iterablen"><a class="anchor" href="#_iterablen"></a>4.8.3. IterableN</h4>
<div class="paragraph">
<p>Currently there are built-in types <code>Iterable2&lt;T1,T2&gt;</code>&#8230;&#8203;<code>Iterable9&lt;T1,&#8230;&#8203;,T9&gt;</code>. They are mainly intended for type system support of array destructuring literals.</p>
</div>
<div class="paragraph">
<p>Not documented in detail yet, because we want to gain experience with
current solution, first, and major refinement might be incoming&#8230;&#8203;</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_type_modifiers"><a class="anchor" href="#_type_modifiers"></a>4.9. Type Modifiers</h3>
<div class="paragraph">
<p>Type expressions can be further described with type
modifiers. The type modifiers add additional constraints to the type
expression which are then used to perform a stricter validation of the
source code. Type modifiers can not be used in type arguments.</p>
</div>
<div class="paragraph">
<p>The general type modifiers <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi></math>, <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mi>o</mi><mi>n</mi><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi></math>
and <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mi>y</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>i</mi><mi>c</mi></math> can be used for variables, attributes, method
parameters and method types. Optional and variadic modifiers can only be
applied for formal parameters.</p>
</div>
<div class="sect3">
<h4 id="_dynamic"><a class="anchor" href="#_dynamic"></a>4.9.1. Dynamic</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-144" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-144</a>
</div>
</div>
<div class="paragraph">
<p>The dynamic type modifier marks a type as being dynamic. A dynamic type
behaves like a normal JavaScript object, so you can read/write any
property and call any method on it. The default behavior for a type is
to be static, that is no new properties can be added and no unknown
properties can be accessed.</p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi></math> and <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi></math> is always true. Using dynamically
added members of a dynamic type is never type safe. Using the operator
on a subtype of is not allowed.</p>
</div>
<div class="paragraph">
<p>15Non-Dynamic Primitive Types[req:Non-Dynamic Primitive Types]</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>All primitive types except <code>any</code> must not be declared dynamic.</p>
</li>
<li>
<p>Only parameterized type references and this type reference can be
declared dynamic. <sup class="footnote">[<a id="_footnoteref_15" class="footnote" href="#_footnote_15" title="View footnote.">15</a>]</sup></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_optional"><a class="anchor" href="#_optional"></a>4.9.2. Optional</h4>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-145" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-145</a>
<a href="https://jira.numberfour.eu/browse/IDE-1076" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1076</a>
</div>
</div>
<div class="paragraph">
<p>Only formal parameters and return types can be marked as optional.</p>
</div>
<div class="paragraph">
<p>An optional formal parameter can be omitted when calling the function /
method; an omitted parameter has the value <code>undefined</code>. Every parameter after an
optional parameter also has to be optional or variadic.</p>
</div>
<div class="paragraph">
<p>An optional return type indicates that the function / method need not be
left via a return statement with an expression; in that case the return
value is <code>undefined</code>. For constraints on using the optional modifier, see <a href="#_function_object_type">Function Object Type</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Type_Modifiers_Variadic"><a class="anchor" href="#Type_Modifiers_Variadic"></a>4.9.3. Variadic</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-146" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-146</a>
</div>
</div>
<div class="paragraph">
<p>Only method parameters can be marked as
variadic. Marking a parameter as variadic indicates that method accepts
a variable number of parameters. A variadic parameter implies that the
parameter is also optional as the cardinality is defined as
<math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mo>[</mo><mn>0.</mn><mo>.</mo><mo>*</mo></mrow></math>$]. No further parameter can be defined after a
variadic parameter.</p>
</div>
<div class="paragraph">
<p>For a parameter <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math>, the
following condition must hold: <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi><mi>p</mi><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi></math>.</p>
</div>
<div class="paragraph">
<p>A parameter can, however, be declared either optional or variadic. That
is to say that one can either write <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>=</mo></math> (optional) or
<math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi></math>, but not <math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>=</mo></math></p>
</div>
<div class="paragraph">
<p>Declaring a variadic method parameter of type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> causes the
type of the method parameter to become <code>Array&lt;T&gt;</code>. That is, declaring <code>function(string &#8230;&#8203;tags)</code> causes <code>tags</code> to be
an <code>Array&lt;string&gt;</code> and not just a scalar <code>string</code> value.</p>
</div>
<div class="paragraph">
<p>To make this work at runtime, the compiler will generate code that
constructs the <code>method parameter</code> from the <code>arguments</code> parameter explicitly passed to the function.</p>
</div>
<div class="paragraph">
<p>
At runtime, a variadic
parameter is never set to undefined. Instead, the array may be empty.
This must be true even if preceding parameters are optionally and not
arguments are passed at runtime.</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/106" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-106</a>
</div>
</div>
<div class="paragraph">
<p>For more constraints on using the variadic modifier, see <a href="#_function_object_type">Function Object Type</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_union_and_intersection_type_composed_types"><a class="anchor" href="#_union_and_intersection_type_composed_types"></a>4.10. Union and Intersection Type (Composed Types)</h3>
<div class="paragraph">
<p>Given two or more existing types, it is possible to compose a new type
by forming either the union or intersection of the base types. The
following sections define these <em>union</em> and <em>intersection types</em> in
detail.</p>
</div>
<div class="sect3">
<h4 id="_union_type"><a class="anchor" href="#_union_type"></a>4.10.1. Union Type</h4>
<div class="paragraph">
<p>  </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-142" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-142</a>
<a href="https://jira.numberfour.eu/browse/IDE-385" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-385</a>
<a href="https://jira.numberfour.eu/browse/IDE-383" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-383</a>
</div>
</div>
<div class="paragraph">
<p>Union type reflect the dynamic nature of JavaScript. Union types can be
used almost everywhere (e.g., in variable declarations or in formal
method parameters). The type inferencer usually avoids returning union
types and prefers single typed joins or meets. <em>The most common use
case for union types is for emulating method overloading</em>, as we
describe later on.</p>
</div>
<div class="paragraph">
<p><sup class="footnote">[<a id="_footnoteref_16" class="footnote" href="#_footnote_16" title="View footnote.">16</a>]</sup> and [<a href="#Igarashi07a">Igarashi07a</a>], other languages that explicitly support the notion of union type include Ceylon [<a href="#King13a">King13a(p.3.2.4/5)</a>]</p>
</div>
<div class="sect4">
<h5 id="union-type-syntax"><a class="anchor" href="#union-type-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>For convenience, we repeat the definition of union type expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>UnionTypeExpression: 'union' '{' typeRefs+=TypeRefWithoutModifiers (',' typeRefs+=TypeRefWithoutModifiers)* '}';</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="union-type-semantics"><a class="anchor" href="#union-type-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>An union type states that the type of a variable may be one or more
types contained in the union type. In other words, a union type is a
kind of type set, and the type of a variable is contained in the type
set. Due to interfaces, a variable may conform to multiple types.</p>
</div>
<div class="paragraph">
<p>For a given union type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi><mo>=</mo><mrow><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub></mrow></math>, the following conditions must hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Non-empty: At least one element has to be specified:
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>s</mi><mo>≠</mo><mi>∅</mi></math> (<math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>n</mi><mo>≥</mo><mn>1</mn><mo>)</mo></mrow></math></p>
</li>
<li>
<p>Non-dynamic: The union type itself must not be declared dynamic:
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>¬</mo><mi>U</mi><mo>.</mo><mi>d</mi><mi>y</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>i</mi><mi>c</mi></math></p>
</li>
<li>
<p>Non-optional elements:
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><mi>T</mi><mo>∈</mo><mi>U</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>s</mi><mo>¬</mo><mi>T</mi><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi></math></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Let <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi></math> be an union type.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The union type is a common supertype of all its element types:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>T</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>U</mi></mrow><mrow><mi>T</mi><mo>∈</mo><mi>U</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>s</mi></mrow></math></p>
</li>
<li>
<p>More generally, a type is a subtype of a union type, if it is a
subtype of at least one type contained in the union:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>S</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>U</mi></mrow><mrow><mo>∃</mo><mi>T</mi><mo>∈</mo><mi>U</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>s</mi><mi>:</mi><mi>S</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>T</mi></mrow></math></p>
</li>
<li>
<p>A union type is a subtype of a type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math>, if all types of
the union are subtypes of that type. <sup class="footnote">[<a id="_footnoteref_17" class="footnote" href="#_footnote_17" title="View footnote.">17</a>]</sup>}]
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>U</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>S</mi></mrow><mrow><mo>∀</mo><mi>T</mi><mo>∈</mo><mi>U</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>s</mi><mi>:</mi><mi>T</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>S</mi></mrow></math></p>
</li>
<li>
<p>Commutativity: The order of element does not matter:
<math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>A</mi><mo>,</mo><mi>B</mi></mrow><mo>=</mo><mrow><mi>B</mi><mo>,</mo><mi>A</mi></mrow></math></p>
</li>
<li>
<p>Associativity:
<math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>A</mi><mo>,</mo><mrow><mi>B</mi><mo>,</mo><mi>C</mi></mrow></mrow><mo>=</mo><mrow><mrow><mi>A</mi><mo>,</mo><mi>B</mi></mrow><mo>,</mo><mi>C</mi></mrow></math></p>
</li>
<li>
<p>Uniqueness of elements: A union type may not contain duplicates
(similar to sets): <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∀</mo><mn>1</mn><mo>≤</mo><mi>i</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>k</mi><mo>≤</mo><mi>n</mi><mo>,</mo><mrow><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub></mrow><mi>:</mi><msub><mi>T</mi><mi>i</mi></msub><mo>≠</mo><msub><mi>T</mi><mi>k</mi></msub></math></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi></math> be an union type. The following simplification rules
are always automatically applied to union types.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Simplification of union type with one element: If a union type
contains only one element, it is reduced to the element:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>T</mi><mi>T</mi></math></p>
</li>
<li>
<p>Simplification of union types of union types: A union type
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi></math> containing another union types <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>V</mi></math> is
reduced to a single union type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>W</mi></math>, with
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>W</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>s</mi><mo>=</mo><mi>U</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>s</mi><mo>∪</mo><mi>V</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>s</mi></math>:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><msub><mi>S</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>S</mi><mrow><mi>k</mi><mo>-</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>m</mi></msub><mo>,</mo><msub><mi>S</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mo>,</mo><msub><mi>S</mi><mi>n</mi></msub></mrow><mrow><msub><mi>S</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>S</mi><mrow><mi>k</mi><mo>-</mo><mn>1</mn></mrow></msub><mo>,</mo><mrow><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>m</mi></msub></mrow><mo>,</mo><msub><mi>S</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mo>,</mo><msub><mi>S</mi><mi>n</mi></msub></mrow></math></p>
</li>
<li>
<p>Simplification of union type with undefined or null: Since undefined
is the bottom type, and null is kind of a second button type, they are
removed from the union: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mrow><mi>k</mi><mo>-</mo><mn>1</mn></mrow></msub><mo>,</mo><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>u</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi></mrow><mo>,</mo><msub><mi>T</mi><mi>k</mi></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub></mrow><mi>}</mi><mrow><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mrow><mi>k</mi><mo>-</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>T</mi><mi>k</mi></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub></mrow><mtext>
</mtext><mrow><mrow><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mrow><mi>k</mi><mo>-</mo><mn>1</mn></mrow></msub><mo>,</mo><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi></mrow><mo>,</mo><msub><mi>T</mi><mi>k</mi></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub></mrow><mi>}</mi><mrow><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mrow><mi>k</mi><mo>-</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>T</mi><mi>k</mi></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub></mrow><mtext>
</mtext></math> Note that the simplification rules for union types
with one element are applied first.</p>
</li>
<li>
<p>The structural typing strategy is propagated to the types of the
union: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub></mrow><mrow><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub></mrow></math></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Remarks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The simplification rules may be applied recursively.</p>
</li>
<li>
<p>For given types <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>A</mi></math>, and the union type
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi><mo>=</mo><mrow><mi>A</mi><mo>,</mo><mi>B</mi></mrow></math>, <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi><mo>≠</mo><mi>B</mi></math>. The types are
equivalent, however: <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mo>=</mo><mi>U</mi></math> and
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mo>=</mo><mi>A</mi></math>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><sup class="footnote">[<a id="_footnoteref_18" class="footnote" href="#_footnote_18" title="View footnote.">18</a>]</sup>), in
which the union is defined to be <code>the same type as</code> <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi></math>.
Although the meaning of <code>same</code> is not clear, it is possibly used as a
synonym for <code>equivalent</code>.]</p>
</div>
<div class="paragraph">
<p>Let A, B, and C be defined as in the chapter beginning (<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>B</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>A</mi></math>)</p>
</div>
<div class="paragraph">
<p>The following subtyping relations with union types are to be evaluated
as follows <sup class="footnote">[<a id="_footnoteref_19" class="footnote" href="#_footnote_19" title="View footnote.">19</a>]</sup>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>A &lt;: union{A}                                   -&gt; true
A &lt;: union{A,B}                                 -&gt; true
B &lt;: union{A,B}                                 -&gt; true
C &lt;: union{A,B}                                 -&gt; true
A &lt;: union{B,C}                                 -&gt; false
B &lt;: union{B,C}                                 -&gt; true
C &lt;: union{B,C}                                 -&gt; true
union{A} &lt;: A                                   -&gt; true
union{B} &lt;: A                                   -&gt; true
union{B,C} &lt;: A                                 -&gt; true
union{A,B} &lt;: B                                 -&gt; false
union{X,Z} &lt;: union{Z,X}                        -&gt; true
union{X,Y} &lt;: union{X,Y,Z}                      -&gt; true
union{X,Y,Z} &lt;: union{X,Y}                      -&gt; false</code></pre>
</div>
</div>
<div class="paragraph">
<p>The simplification constraints are used by the type inferrer. It may be
useful, however, to define union types with superfluous elements, as the
next example demonstrates</p>
</div>
<div class="paragraph">
<p>[[ex:Superfluous elements in union type]]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class A{}
class B extends A{}
class C extends A{}

function foo(p: union{A,B}) {..}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Although <code>B</code> is superfluous, it may indicate that the function handles
parameters of type differently than one of type <code>A</code> or <code>C</code>.</p>
</div>
<div class="paragraph">
<p>Although a union type is a <code><a href="#Acronyms">LCST</a></code> of its contained (non-superfluous) types, the
type inferrer usually does not create new union types when computing the
join of types. If the join of types including at least one union type is
calculated, the union type is preserved if possible. The same is true
for meet.</p>
</div>
<div class="paragraph">
<p>For the definition of join and meet for union types, we define how a
type is added to a union type:</p>
</div>
<div class="paragraph">
<p>The union of union types is defined similar to the union of sets.
The union is not simplified, but it contains no duplicates.</p>
</div>
<div class="paragraph">
<p>If a type A is contained in a union type, then the union type is a
common supertype, and (since it is the union itself) also the <code><a href="#Acronyms">LCST</a></code> of both types.
This finding is the foundation of the definition of join of a (non-union) type with a union type:</p>
</div>
<div class="paragraph">
<p>The join <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>J</mi></math> of a union type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi></math> with a type
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> is the union of both types:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mfenced close=")" open="("><mrow><mi>U</mi><mi>T</mi></mrow></mfenced><mo>=</mo><mi>J</mi></mrow><mrow><mi>J</mi><mo>=</mo><mi>U</mi><mo>∪</mo><mi>T</mi></mrow></math></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Remarks: </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Joining a union type with another type is not similar to joining the
elements of the union type directly with another type. That is
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>A</mi><mi> </mi><mrow><mtext>join</mtext></mrow><mi> </mi><mrow><mi>u</mi><mi>n</mi><mi>i</mi><mi>o</mi><mi>n</mi><mrow><mo>{</mo></mrow></mrow><mi>B</mi><mo>,</mo><mi>C</mi><mrow><mo>}</mo></mrow><mo>≠</mo><mi>A</mi><mi> </mi><mrow><mtext>join</mtext></mrow><mi> </mi><mi>B</mi><mi> </mi><mrow><mtext>join</mtext></mrow><mi> </mi><mi>C</mi></math></p>
</li>
<li>
<p>The computed join is simplified according to the constraints defined
above.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The meet of union types is defined as the meet of the elements.
That is <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mrow><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub></mrow><mi>S</mi></mrow><mrow><msub><mi>T</mi><mn>1</mn></msub><mi>S</mi><msub><mi>T</mi><mi>n</mi></msub><mi>S</mi></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mrow><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub></mrow><mrow><msub><mi>S</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>S</mi><mi>m</mi></msub></mrow></mrow><mrow><msub><mi>T</mi><mn>1</mn></msub><msub><mi>S</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mn>1</mn></msub><msub><mi>S</mi><mi>m</mi></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub><msub><mi>S</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub><msub><mi>S</mi><mi>m</mi></msub></mrow></math></p>
</div>
<div class="paragraph">
<p>Remarks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The meet of a union type with another type is not a union type itself.
This gets clear when looking at the definition of meet and union type.
While for a given <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi><mo>=</mo><mrow><mi>A</mi><mo>,</mo><mi>B</mi></mrow></math>, <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>U</mi></math> and
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>U</mi></math>, the opposite <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>A</mi></math> is usually not true
(unless <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi></math> can be simplified to <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi></math>). So, for
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi><mi>U</mi></math>, usually <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi></math> cannot be the meet.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>
The upper and lower bound of a union type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi></math> is a union type <math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>U</mi><mi>'</mi></msup></math>
containing the upper and lower bound of the elements of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi></math>:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mfenced close=")" open="("><mrow><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub></mrow></mfenced><mi>:</mi><mo>=</mo><mrow><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mfenced close=")" open="("><msub><mi>T</mi><mn>1</mn></msub></mfenced><mo>,</mo><mo>,</mo><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mfenced close=")" open="("><msub><mi>T</mi><mn>1</mn></msub></mfenced></mrow><mtext>
</mtext><mi>l</mi><mi>o</mi><mi>w</mi><mi>e</mi><mi>r</mi><mfenced close=")" open="("><mrow><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub></mrow></mfenced><mi>:</mi><mo>=</mo><mrow><mi>l</mi><mi>o</mi><mi>w</mi><mi>e</mi><mi>r</mi><mfenced close=")" open="("><msub><mi>T</mi><mn>1</mn></msub></mfenced><mo>,</mo><mo>,</mo><mi>l</mi><mi>o</mi><mi>w</mi><mi>e</mi><mi>r</mi><mfenced close=")" open="("><msub><mi>T</mi><mn>1</mn></msub></mfenced></mrow><mtext>
</mtext></math></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/260" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-260</a>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_warnings"><a class="anchor" href="#_warnings"></a>Warnings</h5>
<div class="paragraph">
<p>In case the <code>any</code> type is used in a union type, all other types in the union
type definition become obsolete. However, defining other typers along
with the <code>any</code> type might seem reasonable in case those other types are
treated specifically and thus are mentioned explicitly in the
definition. Nevertheless the use of the <code>any</code> type produces a warning, since
its use can indicate a misunderstanding of the union type concept and
since documentation can also be done in a comment.</p>
</div>
<div class="paragraph">
<p>No union type shall conatin an type:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>n</mi><mi>y</mi><mo>∈</mo><mi>U</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>s</mi></math></p>
</div>
<div class="paragraph">
<p>Similar to the documentary purpose of using specific classes along with
the <code>any</code> type is the following case. When two types are used, one of them a
subtype of the other, then this subtype is obsolete. Still it can be
used for documentary purposes. However, a warning will be produced to
indicate unecessary code. The warning is only produced when both of the
types are either classes or interfaces, since e.g. structural types are
supertypes of any classes or interfaces.</p>
</div>
<div class="paragraph">
<p>Union types shall not
contain class or interface types which are a subtype of another class or
interface type that also is contained in the union type.
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>T</mi><mi>T</mi><mo>∈</mo><mi>U</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>s</mi><mi>:</mi><mo>∃</mo><mi>T</mi><mo>∈</mo><mi>U</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>s</mi><mi>:</mi><mtext>
</mtext><mfenced close=")" open="("><mrow><mi>T</mi><mi>T</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>T</mi><mo>∧</mo><mi>i</mi><mi>s</mi><mi>C</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>O</mi><mi>r</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi><mfenced close=")" open="("><mi>T</mi></mfenced><mo>∧</mo><mi>i</mi><mi>s</mi><mi>C</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>O</mi><mi>r</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi><mfenced close=")" open="("><mrow><mi>T</mi><mi>T</mi></mrow></mfenced></mrow></mfenced></math></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_intersection_type"><a class="anchor" href="#_intersection_type"></a>4.10.2. Intersection Type</h4>
<div class="paragraph">
<p>  </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-142" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-142</a>
<a href="https://jira.numberfour.eu/browse/IDE-385" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-385</a>
<a href="https://jira.numberfour.eu/browse/IDE-383" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-383</a>
</div>
</div>
<div class="paragraph">
<p>Intersection type reflects the dynamic nature of JavaScript, similar to
union type. As in Java, intersection type is used to define the type
boundaries of type variables in type parameter definitions. They are
inferred by the type inferencer for type checking (as a result of join
or meet). In contrast to Java, however, intersection type can be
declared explicitly by means of intersection type expression.
<sup class="footnote">[<a id="_footnoteref_20" class="footnote" href="#_footnote_20" title="View footnote.">20</a>]</sup> and [<a href="#Laurent12a">Laurent12a</a>], other languages supporting explicit notion of intersection type include Ceylon
[<a href="#King13a">King13a(p.3.2.4/5)</a>].</p>
</div>
<div class="sect4">
<h5 id="intersection-type-syntax"><a class="anchor" href="#intersection-type-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>For convenience, we repeat the definition of intersection type
expression and of type variables in which intersection types can be
defined as in Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>InterSectionTypeExpression: 'intersection' '{' typeRefs+=TypeRefWithoutModifiers (',' typeRefs+=TypeRefWithoutModifiers)* '}';

TypeVariable:   name=IDENTIFIER ('extends' declaredUpperBounds+=ParameterizedTypeRefNominal ('&amp;' declaredUpperBounds+=ParameterizedTypeRefNominal)*)?</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="intersection-type-semantics"><a class="anchor" href="#intersection-type-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>An intersection type may contain several interfaces but only one class.
It virtually declares a subclass of this one class and implements all
interfaces declared in the intersection type. If no class is declared in
the intersection type, the intersection type virtually declares a
subclass of an N4Object instead. This virtual subclass also explains why
only one single class may be contained in the intersection.</p>
</div>
<div class="paragraph">
<p>27Intersection Type For a given intersection type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math>, the
following conditions must hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The intersection must contain at least one type:
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>s</mi><mo>≠</mo><mi>∅</mi></math></p>
</li>
<li>
<p>Only one class must be contained in the intersection type:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mo>(</mo><mrow><mo>∃</mo><mi>C</mi><mo>∈</mo><mi>I</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>s</mi><mi>:</mi><mi>μ</mi><mn>169</mn><mi>;</mi><mo>=</mo><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>C</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>}</mi><mo>)</mo></mrow><mi>T</mi><mo>∈</mo><mi>I</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>s</mi><mo>∖</mo><mi>C</mi><mi>:</mi><mi>μ</mi><mfenced close=")" open="("><mi>T</mi></mfenced><mo>=</mo><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>C</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>}</mi></mrow></math></p>
<div class="paragraph">
<p>For the time being, only a warning is produced when more than one class
is contained in the intersection type .</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-2302" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-2302</a>
</div>
</div>
</li>
<li>
<p>Non-optional elements:
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><mi>T</mi><mo>∈</mo><mi>I</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>s</mi><mo>¬</mo><mi>T</mi><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi></math></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>28Intersection Type Subtyping Rules[Intersection Type Subtyping Rules]
Let <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math> be an intersection type.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An intersection type is a subtype of another type, if at least one of
its contained types is a subtype of that type: footnote:[This rule is a
generalization of the subtyping rules given in</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>[<a href="#Laurent12a">Laurent12a</a>]Table 2, $\cap^1_l$ and $\cap^2_l$</p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>I</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>S</mi></mrow><mrow><mo>∃</mo><mi>T</mi><mo>∈</mo><mi>I</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>s</mi><mi>:</mi><mi>T</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>S</mi></mrow></math></p>
</div>
<div class="ulist">
<ul>
<li>
<p>A type is a subtype of an intersection type, if it is a subtype of all
types contained in the intersection type: <sup class="footnote">[<a id="_footnoteref_21" class="footnote" href="#_footnote_21" title="View footnote.">21</a>]</sup>Table 2, $\cap^1_l$ and $\cap^2_l$</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>S</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>I</mi></mrow><mrow><mo>∀</mo><mi>T</mi><mo>∈</mo><mi>I</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>s</mi><mi>:</mi><mi>S</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>T</mi></mrow></math></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Non-optional elements:
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><mi>T</mi><mo>∈</mo><mi>I</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>s</mi><mo>¬</mo><mi>T</mi><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi></math></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math> be an
intersection type. The following simplification rules are always
automatically applied to intersection types.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The structural typing strategy is propagated to the types of the
intersection: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub></mrow><mrow><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub></mrow></math></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These subtyping rules are similar to Ceylon.
<sup class="footnote">[<a id="_footnoteref_22" class="footnote" href="#_footnote_22" title="View footnote.">22</a>]</sup>]</p>
</div>
<div class="paragraph">
<p>During validation, intersection types containing union or other
intersection types may be inferred. In this case, the composed types are
flattened. The aforementioned constraints must hold. We also implicitly
use this representation in this specification.</p>
</div>
<div class="paragraph">
<p>Let A, B, and C be defined as in the chapter beginning
(<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>B</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>A</mi></math>)</p>
</div>
<div class="paragraph">
<p>The following subtyping relations with intersection types are to be
evaluated as follows <sup class="footnote">[<a id="_footnoteref_23" class="footnote" href="#_footnote_23" title="View footnote.">23</a>]</sup>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>A &lt;: intersection{A}                            -&gt; true
A &lt;: intersection{A,A}                          -&gt; true
intersection{A,X} &lt;: A                          -&gt; true
intersection{X,A} &lt;: A                          -&gt; true
A &lt;: intersection{A,X}                          -&gt; false
intersection{A,X} &lt;: intersection{X,A}          -&gt; true
H12 &lt;: intersection{I1,I2}                      -&gt; true
intersection{I1,I2} &lt;: H12                      -&gt; false
H1 &lt;: intersection{I1,I2}                       -&gt; false
H23 &lt;: intersection{I1,I2}                      -&gt; false
B &lt;: intersection{A}                            -&gt; true
intersection{I1,I2} &lt;: I                        -&gt; true
H12 &lt;: intersection{I,I2}                       -&gt; true
A &lt;: intersection{A,Any}                        -&gt; true
intersection{A,Any} &lt;: A                        -&gt; true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The join of intersection types is defined as the join of the elements. That is
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mrow><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub></mrow><mi>S</mi></mrow><mrow><msub><mi>T</mi><mn>1</mn></msub><mi>S</mi><msub><mi>T</mi><mi>n</mi></msub><mi>S</mi></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mrow><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub></mrow><mrow><msub><mi>S</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>S</mi><mi>m</mi></msub></mrow></mrow><mrow><msub><mi>T</mi><mn>1</mn></msub><msub><mi>S</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mn>1</mn></msub><msub><mi>S</mi><mi>m</mi></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub><msub><mi>S</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub><msub><mi>S</mi><mi>m</mi></msub></mrow></math></p>
</div>
<div class="paragraph">
<p>30Meet with intersection Type[req:Meet_with_intersection_Type] The meet
of intersection types is defined over their elements. That is
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mrow><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub></mrow><mi>S</mi></mrow><mrow><msub><mi>T</mi><mn>1</mn></msub><mi>S</mi><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub><mi>S</mi></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mrow><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub></mrow><mrow><msub><mi>S</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>S</mi><mi>m</mi></msub></mrow></mrow><mrow><msub><mi>T</mi><mn>1</mn></msub><msub><mi>S</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mn>1</mn></msub><msub><mi>S</mi><mi>m</mi></msub><mo>,</mo><mspace width="1em"/><mo>,</mo><mspace width="1em"/><msub><mi>T</mi><mi>n</mi></msub><msub><mi>S</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub><msub><mi>S</mi><mi>m</mi></msub></mrow></math></p>
</div>
<div class="paragraph">
<p>
The upper and lower bound of an intersection type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math> is a union type
<math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>I</mi><mi>'</mi></msup></math> containing the upper and lower bound of the elements of
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math>: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mfenced close=")" open="("><mrow><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub></mrow></mfenced><mi>:</mi><mo>=</mo><mrow><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mfenced close=")" open="("><msub><mi>T</mi><mn>1</mn></msub></mfenced><mo>,</mo><mo>,</mo><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mfenced close=")" open="("><msub><mi>T</mi><mn>1</mn></msub></mfenced></mrow><mtext>
</mtext><mi>l</mi><mi>o</mi><mi>w</mi><mi>e</mi><mi>r</mi><mfenced close=")" open="("><mrow><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub></mrow></mfenced><mi>:</mi><mo>=</mo><mrow><mi>l</mi><mi>o</mi><mi>w</mi><mi>e</mi><mi>r</mi><mfenced close=")" open="("><msub><mi>T</mi><mn>1</mn></msub></mfenced><mo>,</mo><mo>,</mo><mi>l</mi><mi>o</mi><mi>w</mi><mi>e</mi><mi>r</mi><mfenced close=")" open="("><msub><mi>T</mi><mn>1</mn></msub></mfenced></mrow><mtext>
</mtext></math></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/260" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-260</a>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_warnings_2"><a class="anchor" href="#_warnings_2"></a>Warnings</h5>
<div class="paragraph">
<p>Using <code>any</code> types in intersection types is obsolete since they do not change
the resulting intersection type. E.g. the intersection type of A, B and <code>any</code>
is equivialent to the intersection type of A and B. However, using the <code>any</code>
type is no error because it can be seen as a neutral argument to the
intersection. Nevertheless the use of the <code>any</code> type produces a warning, since
its use can indicate a misunderstanding of the intersection type concept
and since it always can be omitted.</p>
</div>
<div class="paragraph">
<p>No intersection type shall conatin an type:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>n</mi><mi>y</mi><mo>∈</mo><mi>I</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>s</mi></math></p>
</div>
<div class="paragraph">
<p>The use of the <code>any</code> type in an intersection type is similar to the following
case. When two types are used, one of them a supertype of the other,
then this supertype is obsolete. Hence, a warning will be produced to
indicate unecessary code. The warning is only produced when both of the
types are either classes or interfaces, since e.g. structural types are
supertypes of any classes or interfaces.</p>
</div>
<div class="paragraph">
<p>Intersection types shall not contain class or interface types which are a supertype of
another class or interface type that also is contained in the
intersection type. <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>T</mi><mo>∈</mo><mi>I</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>s</mi><mi>:</mi><mo>∃</mo><mi>T</mi><mi>T</mi><mo>∈</mo><mi>I</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>s</mi><mi>:</mi><mtext>
</mtext><mfenced close=")" open="("><mrow><mi>T</mi><mi>T</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>T</mi><mo>∧</mo><mi>i</mi><mi>s</mi><mi>C</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>O</mi><mi>r</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi><mfenced close=")" open="("><mi>T</mi></mfenced><mo>∧</mo><mi>i</mi><mi>s</mi><mi>C</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>O</mi><mi>r</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi><mfenced close=")" open="("><mrow><mi>T</mi><mi>T</mi></mrow></mfenced></mrow></mfenced></math></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_composed_types_in_wildcards"><a class="anchor" href="#_composed_types_in_wildcards"></a>4.10.3. Composed Types in Wildcards</h4>
<div class="paragraph">
<p>Composed types may appear as the bound of a wildcard. The following
constraints apply
<sup class="footnote">[<a id="_footnoteref_24" class="footnote" href="#_footnote_24" title="View footnote.">24</a>]</sup></p>
</div>
<div class="paragraph">
<p>A composed type may appear as the upper or lower bound of a wildcard. In the covariant case,
the following subtype relations apply:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>union{ G&lt;? extends A&gt;, G&lt;? extends B&gt; }  &lt;:  G&lt;? extends union{A,B}&gt;
G&lt;? extends intersection{A,B}&gt;  &lt;:  intersection{ G&lt;? extends A&gt;, G&lt;? extends B&gt; }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the contra variant case, the following subtype relations apply:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>union{ G&lt;? super A&gt;, G&lt;? super B&gt; }  &lt;:  G&lt;? super intersection{A,B}&gt;
G&lt;? super union{A,B}&gt;  &lt;:  intersection{ G&lt;? super A&gt;, G&lt;? super B&gt; }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_property_access_for_composed_types"><a class="anchor" href="#_property_access_for_composed_types"></a>4.10.4. Property Access for Composed Types</h4>
<div class="paragraph">
<p>It is possible to directly access properties of union and intersection
types. The following sections define which properties are accessible.</p>
</div>
<div class="sect4">
<h5 id="_properties_of_union_type"><a class="anchor" href="#_properties_of_union_type"></a>Properties of Union Type</h5>
<div class="paragraph">
<p>As an (unfortunately oversimplified) rule of thumb, the properties of a
union type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi><mo>=</mo><msub><mi>T</mi><mn>1</mn></msub><mo>|</mo><msub><mi>T</mi><mn>2</mn></msub></math> are simply the intersection of the
properties
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>i</mi><mi>e</mi><mi>s</mi><mo>=</mo><msub><mi>T</mi><mn>1.</mn></msub><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>i</mi><mi>e</mi><mi>s</mi><mo>∩</mo><msub><mi>T</mi><mn>2.</mn></msub><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>i</mi><mi>e</mi><mi>s</mi></math>. It is
not quite that simple, however, as the question of "equality" with
regards to properties has to be answered.</p>
</div>
<div class="paragraph">
<p>For a given union type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi><mo>=</mo><msub><mi>T</mi><mn>1</mn></msub><mo>|</mo><msub><mi>T</mi><mn>2</mn></msub></math>, the following
constraints for its members must hold:</p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><mi> </mi><mi>a</mi><mo>∈</mo><mi>U</mi><mo>.</mo><mi>a</mi><mi>t</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>b</mi><mi>u</mi><mi>t</mi><mi>e</mi><mi>s</mi><mi>:</mi></math>
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∀</mo><mi> </mi><mi>k</mi><mo>∈</mo><mfenced close="}" open="{"><mn>1</mn><mn>2</mn></mfenced><mi>:</mi><mo>∃</mo><mi> </mi><msub><mi>a</mi><mi>k</mi></msub><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub><mo>.</mo><mi>a</mi><mi>t</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>b</mi><mi>u</mi><mi>t</mi><mi>e</mi><mi>s</mi><mi>:</mi><msub><mi>a</mi><mi>k</mi></msub><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mi>g</mi><mi>t</mi><mi>;</mi><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>e</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∧</mo><mi>a</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>=</mo><mi>m</mi><mi>i</mi><mi>n</mi><mfenced close=")" open="("><mrow><msub><mi>a</mi><mn>1.</mn></msub><mi>a</mi><mi>c</mi><mi>c</mi></mrow><mrow><msub><mi>a</mi><mn>2.</mn></msub><mi>a</mi><mi>c</mi><mi>c</mi></mrow></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∧</mo><mi>a</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><msub><mi>a</mi><mn>1.</mn></msub><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><msub><mi>a</mi><mn>2.</mn></msub><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∧</mo><mi>a</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mo>=</mo><msub><mi>a</mi><mn>1.</mn></msub><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mo>=</mo><msub><mi>a</mi><mn>2.</mn></msub><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi></math></p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><mi> </mi><mi>m</mi><mo>∈</mo><mi>U</mi><mo>.</mo><mi>m</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi><mi>s</mi><mi>:</mi></math>
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∃</mo><mi> </mi><msub><mi>m</mi><mn>1</mn></msub><mo>∈</mo><msub><mi>T</mi><mn>1.</mn></msub><mi>m</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi><mi>s</mi><mo>,</mo><msub><mi>m</mi><mn>2</mn></msub><mo>∈</mo><msub><mi>T</mi><mn>2.</mn></msub><mi>m</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi><mi>s</mi><mo>,</mo><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><mrow><mtext>with</mtext></mrow><mi> </mi><mi>p</mi><mo>=</mo><mi>m</mi><mo>.</mo><mi>f</mi><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>∧</mo><msup><mi>p</mi><mi>'</mi></msup><mo>=</mo><msub><mi>m</mi><mn>1.</mn></msub><mi>f</mi><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>∧</mo><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi><mo>=</mo><msub><mi>m</mi><mn>2.</mn></msub><mi>f</mi><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>,</mo><mrow><mtext>WLOG</mtext></mrow><mi> </mi><mo>|</mo><msup><mi>p</mi><mi>'</mi></msup><mo>|</mo><mo>≤</mo><mo>|</mo><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi><mo>|</mo><mi>:</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="1.2em"/><mo>∀</mo><mi>k</mi><mo>∈</mo><mfenced close="}" open="{"><mn>1</mn><mn>2</mn></mfenced><mi>:</mi><msub><mi>m</mi><mi>k</mi></msub><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mi>g</mi><mi>t</mi><mi>;</mi><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>e</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∧</mo><mi>m</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>=</mo><mi>m</mi><mi>i</mi><mi>n</mi><mfenced close=")" open="("><mrow><msub><mi>m</mi><mn>1.</mn></msub><mi>a</mi><mi>c</mi><mi>c</mi></mrow><mrow><msub><mi>m</mi><mn>2.</mn></msub><mi>a</mi><mi>c</mi><mi>c</mi></mrow></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∧</mo><mi>m</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><msub><mi>m</mi><mn>1.</mn></msub><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><msub><mi>m</mi><mn>2.</mn></msub><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∧</mo><mi>m</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mo>=</mo><msub><mi>m</mi><mn>1.</mn></msub><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mo>|</mo><msub><mi>m</mi><mn>2.</mn></msub><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∧</mo><mo>∀</mo><mi> </mi><mi>i</mi><mi>l</mi><mi>t</mi><mi>;</mi><mo>|</mo><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi><mo>|</mo><mi>:</mi><msub><mi>p</mi><mi>i</mi></msub><mi> </mi><mrow><mtext>exists with</mtext></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><msub><mi>p</mi><mi>i</mi></msub><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mfenced close="" open="{"><mtable><mtr><mtd><msub><mrow><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi></mrow><mi>i</mi></msub><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>i</mi><mo>≥</mo><mo>|</mo><msup><mi>p</mi><mi>'</mi></msup><mo>|</mo><mo>∨</mo><msub><msup><mi>p</mi><mi>'</mi></msup><mi>i</mi></msub><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><msub><mrow><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi></mrow><mi>i</mi></msub><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mtd></mtr><mtr><mtd><msub><msup><mi>p</mi><mi>'</mi></msup><mi>i</mi></msub><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>+</mo><mrow><mtext>"</mtext><mtext>"</mtext></mrow><mo>+</mo><msub><mrow><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi></mrow><mi>i</mi></msub><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mtext>else</mtext></mrow></mtd></mtr></mtable></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><msub><mi>p</mi><mi>i</mi></msub><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mo>=</mo><mfenced close="" open="{"><mtable><mtr/><mtr><mtd><msub><msup><mi>p</mi><mi>'</mi></msup><mrow><mo>|</mo><msup><mi>p</mi><mi>'</mi></msup><mo>|</mo><mo>-</mo><mn>1</mn></mrow></msub><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>&amp;</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><msub><mrow><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi></mrow><mi>i</mi></msub><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>i</mi><mo>≥</mo><mo>|</mo><msup><mi>p</mi><mi>'</mi></msup><mo>|</mo><mo>∧</mo><msub><msup><mi>p</mi><mi>'</mi></msup><mrow><mo>|</mo><msup><mi>p</mi><mi>'</mi></msup><mo>|</mo><mo>-</mo><mn>1</mn></mrow></msub><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi></mtd><mtd/></mtr><mtr><mtd><msub><mrow><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi></mrow><mi>i</mi></msub><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mtext>else</mtext></mrow></mtd><mtd/></mtr></mtable></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><msub><mi>p</mi><mi>i</mi></msub><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi><mo>=</mo><mfenced close="" open="{"><mtable><mtr/><mtr><mtd><msub><mrow><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi></mrow><mi>i</mi></msub><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mtext>else</mtext></mrow></mtd><mtd/></mtr></mtable></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><msub><mi>p</mi><mi>i</mi></msub><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi><mo>=</mo><mfenced close="" open="{"><mtable><mtr/><mtr><mtd><msub><mrow><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi></mrow><mi>i</mi></msub><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>i</mi><mo>≥</mo><mo>|</mo><msup><mi>p</mi><mi>'</mi></msup><mo>|</mo><mo>∧</mo><mi>i</mi><mo>=</mo><mo>|</mo><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi><mo>|</mo><mo>-</mo><mn>1</mn></mtd><mtd/></mtr><mtr><mtd><mi>f</mi><mi>a</mi><mi>l</mi><mi>s</mi><mi>e</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mtext>else</mtext></mrow></mtd><mtd/></mtr></mtable></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∧</mo><mrow><mo>(</mo><mi>l</mi><mo>=</mo><mo>|</mo><msup><mi>p</mi><mi>'</mi></msup><mo>|</mo><mo>=</mo><mo>|</mo><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi><mo>|</mo><mo>∧</mo><mo>¬</mo><mfenced close=")" open="("><mrow><msub><msup><mi>p</mi><mi>'</mi></msup><mrow><mi>l</mi><mo>-</mo><mn>1</mn></mrow></msub><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi><mo>∧</mo><msub><mrow><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi></mrow><mrow><mi>l</mi><mo>-</mo><mn>1</mn></mrow></msub><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi></mrow></mfenced><mo>∧</mo><mo>∃</mo><mi>v</mi><mo>∈</mo><mrow><mo>{</mo><mrow><msup><mi>p</mi><mi>'</mi></msup><mo>&lt;</mo><mi>e</mi><mi>m</mi><mo>&gt;</mo><mrow><mi>l</mi><mo>-</mo><mn>1</mn></mrow><mo>,</mo><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi><mo>&lt;</mo><mo>/</mo><mi>e</mi><mi>m</mi><mo>&gt;</mo><mrow><mi>l</mi><mo>-</mo><mn>1</mn></mrow><mo>}</mo></mrow><mi>v</mi><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi><mi>:</mi><msub><mi>p</mi><mi>l</mi></msub><mi> </mi><mrow><mtext>exists with</mtext></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><msub><mi>p</mi><mi>l</mi></msub><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>v</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><msub><mi>p</mi><mi>i</mi></msub><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mo>=</mo><mi>v</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><msub><mi>p</mi><mi>i</mi></msub><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi><mo>=</mo><mi>t</mi><mi>r</mi><mi>u</mi><mi>e</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><msub><mi>p</mi><mi>i</mi></msub><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi><mo>=</mo><mi>t</mi><mi>r</mi><mi>u</mi><mi>e</mi></mrow></mrow></math></p>
</div>
<div class="paragraph">
<p>Remarks on union type’s members:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fields of the same type are merged to a composed field with the same
type. Fields of different types are merged to a getter and setter.</p>
</li>
<li>
<p>The return type of a composed getter is the <em>union</em> type of the return
types of the merged getters.</p>
</li>
<li>
<p>The type of a composed setter is the <em>intersection</em> type of the types
of the merged setters.</p>
</li>
<li>
<p>Fields can be combined with getters and/or setters:</p>
<div class="ulist">
<ul>
<li>
<p>fields combined with getters allow read-access.</p>
</li>
<li>
<p>non-const fields combined with setters allow write-access.</p>
</li>
<li>
<p>non-const fields combined with getters <em>and</em> setters, i.e. each type
has either a non-const field or both a getter and a setter of the given
name, allow both read- and write-access.</p>
<div class="paragraph">
<p>Again, types need not be identical; for read-access the <em>union</em> of the
fields’ types and the getters’ return types is formed, for write-access
the <em>intersection</em> of the fields’ types and the setters’ types is
formed. In the third case above, types are combined independently for
read- and write-access if the getters and setters have different types.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>The name of a method’s parameter is only used for error or warning
messages and cannot be referenced otherwise.</p>
</li>
<li>
<p>The return type of a composed method is the <em>union</em> type of the return
types of the merged methods.</p>
</li>
<li>
<p>A composed method parameter’s type is the <em>intersection</em> type of the
merged parameters types.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_properties_of_intersection_type"><a class="anchor" href="#_properties_of_intersection_type"></a>Properties of Intersection Type</h5>
<div class="paragraph">
<p>As an (unfortunately oversimplified) rule of thumb, the properties of an
intersection type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi><mo>=</mo><msub><mi>T</mi><mn>1</mn></msub><mi>&amp;</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><msub><mi>T</mi><mn>2</mn></msub></math> are the union of properties
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>i</mi><mi>e</mi><mi>s</mi><mo>=</mo><msub><mi>T</mi><mn>1.</mn></msub><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>i</mi><mi>e</mi><mi>s</mi><mo>∪</mo><msub><mi>T</mi><mn>2.</mn></msub><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>i</mi><mi>e</mi><mi>s</mi></math>. It is
not quite that simple, however, as the question of "equality” with
regards to properties has to be answered.</p>
</div>
<div class="paragraph">
<p>For a given intersection type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi><mo>=</mo><msub><mi>T</mi><mn>1</mn></msub><mi>&amp;</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><msub><mi>T</mi><mn>2</mn></msub></math>, the following
constraints for its members must hold:
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><mi>a</mi><mo>∈</mo><mi>I</mi><mo>.</mo><mi>a</mi><mi>t</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>b</mi><mi>u</mi><mi>t</mi><mi>e</mi><mi>s</mi><mi>:</mi></math> <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mfenced close=")" open="("><mrow><mo>∃</mo><msub><mi>a</mi><mn>1</mn></msub><mo>∈</mo><msub><mi>T</mi><mn>1.</mn></msub><mi>a</mi><mi>t</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>b</mi><mi>u</mi><mi>t</mi><mi>e</mi><mi>s</mi></mrow><mrow><msub><mi>a</mi><mn>1.</mn></msub><mi>a</mi><mi>c</mi><mi>c</mi><mi>g</mi><mi>t</mi><mi>;</mi><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow></mfenced><mo>∨</mo><mfenced close=")" open="("><mrow><mo>∃</mo><msub><mi>a</mi><mn>2</mn></msub><mo>∈</mo><msub><mi>T</mi><mn>2.</mn></msub><mi>a</mi><mi>t</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>b</mi><mi>u</mi><mi>t</mi><mi>e</mi><mi>s</mi></mrow><mrow><msub><mi>a</mi><mn>2.</mn></msub><mi>a</mi><mi>c</mi><mi>c</mi><mi>g</mi><mi>t</mi><mi>;</mi><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∧</mo><mi>a</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mfenced close="" open="{"><mtable><mtr><mtd><msub><mi>a</mi><mn>1.</mn></msub><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><msub><mi>a</mi><mn>1</mn></msub><mo>≠</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi><mo>∧</mo><mfenced close=")" open="("><mrow><msub><mi>a</mi><mn>2</mn></msub><mo>=</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi><mo>∨</mo><msub><mi>a</mi><mn>2.</mn></msub><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><msub><mi>a</mi><mn>1.</mn></msub><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow></mfenced></mtd></mtr><mtr><mtd><msub><mi>a</mi><mn>2.</mn></msub><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mtext>else</mtext></mrow></mtd></mtr></mtable></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∧</mo><mi>a</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>=</mo><mfenced close="" open="{"><mtable><mtr><mtd><msub><mi>a</mi><mn>1.</mn></msub><mi>a</mi><mi>c</mi><mi>c</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><msub><mi>a</mi><mn>1</mn></msub><mo>≠</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi><mo>∧</mo><mfenced close=")" open="("><mrow><msub><mi>a</mi><mn>2</mn></msub><mo>=</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi><mo>∨</mo><msub><mi>a</mi><mn>2.</mn></msub><mi>a</mi><mi>c</mi><mi>c</mi><mo>≤</mo><msub><mi>a</mi><mn>1.</mn></msub><mi>a</mi><mi>c</mi><mi>c</mi></mrow></mfenced></mtd></mtr><mtr><mtd><msub><mi>a</mi><mn>2.</mn></msub><mi>a</mi><mi>c</mi><mi>c</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mtext>else</mtext></mrow></mtd></mtr></mtable></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∧</mo><mi>a</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mo>=</mo><mfenced close="" open="{"><mtable><mtr><mtd><msub><mi>a</mi><mn>1.</mn></msub><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>&amp;</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><msub><mi>a</mi><mn>2.</mn></msub><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><msub><mi>a</mi><mn>1</mn></msub><mo>≠</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi><mo>∧</mo><msub><mi>a</mi><mn>2</mn></msub><mo>≠</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi></mtd></mtr><mtr><mtd><msub><mi>a</mi><mn>1.</mn></msub><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><msub><mi>a</mi><mn>1</mn></msub><mo>≠</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi></mtd></mtr><mtr><mtd><msub><mi>a</mi><mn>2.</mn></msub><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mtext>else</mtext></mrow><mfenced close=")" open="("><mrow><msub><mi>a</mi><mn>2</mn></msub><mo>≠</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi></mrow></mfenced></mtd></mtr></mtable></mfenced></math></p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><mi>m</mi><mo>∈</mo><mi>I</mi><mo>.</mo><mi>m</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi><mi>s</mi><mi>:</mi></math>
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mfenced close=")" open="("><mrow><mo>∃</mo><msub><mi>m</mi><mn>1</mn></msub><mo>∈</mo><msub><mi>T</mi><mn>1.</mn></msub><mi>m</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi><mi>s</mi></mrow><mrow><msub><mi>m</mi><mn>1.</mn></msub><mi>a</mi><mi>c</mi><mi>c</mi><mi>g</mi><mi>t</mi><mi>;</mi><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow></mfenced><mo>∨</mo><mfenced close=")" open="("><mrow><mo>∃</mo><msub><mi>m</mi><mn>2</mn></msub><mo>∈</mo><msub><mi>T</mi><mn>1.</mn></msub><mi>m</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi><mi>s</mi></mrow><mrow><msub><mi>m</mi><mn>2.</mn></msub><mi>a</mi><mi>c</mi><mi>c</mi><mi>g</mi><mi>t</mi><mi>;</mi><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow></mfenced><mi>:</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><mrow><mtext>with</mtext></mrow><mi> </mi><mi>p</mi><mo>=</mo><mi>m</mi><mo>.</mo><mi>f</mi><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mo>∧</mo><mrow><mtext>if</mtext></mrow><mi> </mi><msub><mi>m</mi><mn>1</mn></msub><mi> </mi><mrow><mtext>exists</mtext></mrow><mi> </mi><msup><mi>p</mi><mi>'</mi></msup><mo>=</mo><msub><mi>m</mi><mn>1.</mn></msub><mi>f</mi><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi><mi> </mi><mrow><mtext>(else</mtext><mspace width="1ex"/><mrow><msup><mi>p</mi><mi>'</mi></msup><mo>=</mo><mi>∅</mi></mrow><mtext>)</mtext></mrow><mo>,</mo><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mo>∧</mo><mrow><mtext>if</mtext></mrow><mi> </mi><msub><mi>m</mi><mn>2</mn></msub><mi> </mi><mrow><mtext>exists</mtext></mrow><mi> </mi><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi><mo>=</mo><msub><mi>m</mi><mn>2.</mn></msub><mi>f</mi><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi><mi> </mi><mrow><mtext>(else</mtext><mspace width="1ex"/><mrow><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi><mo>=</mo><mi>∅</mi></mrow><mtext>)</mtext></mrow><mo>,</mo><mrow><mtext>WLOG</mtext></mrow><mo>|</mo><msup><mi>p</mi><mi>'</mi></msup><mo>|</mo><mo>≤</mo><mo>|</mo><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi><mo>|</mo><mi>:</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="1.0em"/><mi>m</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mfenced close="" open="{"><mtable><mtr><mtd><msub><mi>m</mi><mn>1.</mn></msub><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><msub><mi>m</mi><mn>1</mn></msub><mo>≠</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi><mo>∧</mo><mfenced close=")" open="("><mrow><msub><mi>m</mi><mn>2</mn></msub><mo>=</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi><mo>∨</mo><msub><mi>m</mi><mn>2.</mn></msub><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><msub><mi>m</mi><mn>1.</mn></msub><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow></mfenced></mtd></mtr><mtr><mtd><msub><mi>m</mi><mn>2.</mn></msub><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mtext>else</mtext></mrow></mtd></mtr></mtable></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∧</mo><mi>m</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>=</mo><mfenced close="" open="{"><mtable><mtr><mtd><msub><mi>m</mi><mn>1.</mn></msub><mi>a</mi><mi>c</mi><mi>c</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><msub><mi>m</mi><mn>1</mn></msub><mo>≠</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi><mo>∧</mo><mfenced close=")" open="("><mrow><msub><mi>m</mi><mn>2</mn></msub><mo>=</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi><mo>∨</mo><msub><mi>m</mi><mn>2.</mn></msub><mi>a</mi><mi>c</mi><mi>c</mi><mo>≤</mo><msub><mi>m</mi><mn>1.</mn></msub><mi>a</mi><mi>c</mi><mi>c</mi></mrow></mfenced></mtd></mtr><mtr><mtd><msub><mi>m</mi><mn>2.</mn></msub><mi>a</mi><mi>c</mi><mi>c</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mtext>else</mtext></mrow></mtd></mtr></mtable></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∧</mo><mi>m</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mo>=</mo><mfenced close="" open="{"><mtable><mtr><mtd><msub><mi>m</mi><mn>1.</mn></msub><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>&amp;</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><msub><mi>m</mi><mn>2.</mn></msub><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><msub><mi>m</mi><mn>1</mn></msub><mo>≠</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi><mo>∧</mo><msub><mi>m</mi><mn>2</mn></msub><mo>≠</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi></mtd></mtr><mtr><mtd><msub><mi>m</mi><mn>1.</mn></msub><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><msub><mi>m</mi><mn>1</mn></msub><mo>≠</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi></mtd></mtr><mtr><mtd><msub><mi>m</mi><mn>2.</mn></msub><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mtext>else</mtext></mrow><mfenced close=")" open="("><mrow><msub><mi>m</mi><mn>2</mn></msub><mo>≠</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi></mrow></mfenced></mtd></mtr></mtable></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∧</mo><mo>∀</mo><mi> </mi><mi>i</mi><mi>l</mi><mi>t</mi><mi>;</mi><mo>|</mo><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi><mo>|</mo><mi>:</mi><msub><mi>p</mi><mi>i</mi></msub><mi> </mi><mrow><mtext>exists with</mtext></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><msub><mi>p</mi><mi>i</mi></msub><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mfenced close="" open="{"><mtable><mtr><mtd><msub><mrow><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi></mrow><mi>i</mi></msub><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>i</mi><mo>≥</mo><mo>|</mo><msup><mi>p</mi><mi>'</mi></msup><mo>|</mo><mo>∨</mo><msub><mrow><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi></mrow><mi>i</mi></msub><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><msub><msup><mi>p</mi><mi>'</mi></msup><mi>i</mi></msub><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mtd></mtr><mtr><mtd><msub><msup><mi>p</mi><mi>'</mi></msup><mi>i</mi></msub><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>+</mo><mrow><mtext>"</mtext><mtext>"</mtext></mrow><mo>+</mo><msub><mrow><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi></mrow><mi>i</mi></msub><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mtext>else</mtext></mrow></mtd></mtr></mtable></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><msub><mi>p</mi><mi>i</mi></msub><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mo>=</mo><mfenced close="" open="{"><mtable><mtr/><mtr><mtd><msub><msup><mi>p</mi><mi>'</mi></msup><mrow><mo>|</mo><msup><mi>p</mi><mi>'</mi></msup><mo>|</mo><mo>-</mo><mn>1</mn></mrow></msub><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mo>|</mo><msub><mrow><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi></mrow><mi>i</mi></msub><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>i</mi><mo>≥</mo><mo>|</mo><msup><mi>p</mi><mi>'</mi></msup><mo>|</mo><mo>∧</mo><msub><msup><mi>p</mi><mi>'</mi></msup><mrow><mo>|</mo><msup><mi>p</mi><mi>'</mi></msup><mo>|</mo><mo>-</mo><mn>1</mn></mrow></msub><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi></mtd><mtd/></mtr><mtr><mtd><msub><mrow><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi></mrow><mi>i</mi></msub><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mtext>else</mtext></mrow></mtd><mtd/></mtr></mtable></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><msub><mi>p</mi><mi>i</mi></msub><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi><mo>=</mo><mrow><mo>(</mo><mrow><mo>∃</mo><mi>k</mi><mo>≤</mo><mi>m</mi><mi>i</mi><mi>n</mi><mfenced close=")" open="("><mrow><mo>|</mo><msup><mi>p</mi><mi>'</mi></msup><mo>|</mo><mo>-</mo><mn>1</mn></mrow><mi>i</mi></mfenced><mi>:</mi><msup><mi>p</mi><mi>'</mi></msup><mo>&lt;</mo><mi>e</mi><mi>m</mi><mo>&gt;</mo><mi>k</mi><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi><mo>)</mo></mrow><mo>∨</mo><mfenced close=")" open="("><mrow><mo>∃</mo><mi>k</mi><mo>≤</mo><mi>i</mi><mi>:</mi><msup><mi>p</mi><mi>'</mi></msup><msub><mi>'</mi><mi>k</mi></msub><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi></mrow></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><msub><mi>p</mi><mi>i</mi></msub><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi><mo>=</mo><mfenced close="" open="{"><mtable><mtr/><mtr><mtd><msub><mrow><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi></mrow><mi>i</mi></msub><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>i</mi><mo>≥</mo><mo>|</mo><msup><mi>p</mi><mi>'</mi></msup><mo>|</mo><mo>∧</mo><mi>i</mi><mo>=</mo><mo>|</mo><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi><mo>|</mo><mo>-</mo><mn>1</mn></mtd><mtd/></mtr><mtr><mtd><mi>f</mi><mi>a</mi><mi>l</mi><mi>s</mi><mi>e</mi></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mtext>else</mtext></mrow></mtd><mtd/></mtr></mtable></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∧</mo><mrow><mo>(</mo><mi>l</mi><mo>=</mo><mo>|</mo><msup><mi>p</mi><mi>'</mi></msup><mo>|</mo><mo>=</mo><mo>|</mo><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi><mo>|</mo><mo>∧</mo><mi>l</mi><mi>g</mi><mi>t</mi><mi>;</mi><mn>0</mn><mo>∧</mo><mo>¬</mo><mrow><mo>(</mo><mrow><mi>p</mi><mo>&lt;</mo><mo>/</mo><mi>e</mi><mi>m</mi><mo>&gt;</mo><mrow><mi>l</mi><mo>-</mo><mn>1</mn></mrow><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi><mo>)</mo></mrow><mo>∧</mo><mo>∃</mo><mi>v</mi><mo>∈</mo><mrow><mo>{</mo><mrow><msup><mi>p</mi><mi>'</mi></msup><mo>&lt;</mo><mi>e</mi><mi>m</mi><mo>&gt;</mo><mrow><mi>l</mi><mo>-</mo><mn>1</mn></mrow><mo>,</mo><msup><mi>p</mi><mi>'</mi></msup><mi>'</mi><mo>&lt;</mo><mo>/</mo><mi>e</mi><mi>m</mi><mo>&gt;</mo><mrow><mi>l</mi><mo>-</mo><mn>1</mn></mrow><mo>}</mo></mrow><mi>v</mi><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi><mi>:</mi><msub><mi>p</mi><mi>l</mi></msub><mi> </mi><mrow><mtext>exists with</mtext></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><msub><mi>p</mi><mi>l</mi></msub><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>v</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><msub><mi>p</mi><mi>i</mi></msub><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mo>=</mo><mi>v</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><msub><mi>p</mi><mi>i</mi></msub><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi><mo>=</mo><mi>t</mi><mi>r</mi><mi>u</mi><mi>e</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><msub><mi>p</mi><mi>i</mi></msub><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi><mo>=</mo><mi>t</mi><mi>r</mi><mi>u</mi><mi>e</mi></mrow></mrow></mrow></mrow></math></p>
</div>
<div class="paragraph">
<p>Remarks on intersection type’s methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The name of a method’s parameter is only used for error or warning
messages and cannot be referenced otherwise.</p>
</li>
<li>
<p>The return type of a method is the <em>intersection</em> type of the return
types of the merged methods.</p>
</li>
<li>
<p>A method parameter’s type is the <em>union</em> type of the merged parameters
types.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_constructor_and_classifier_type"><a class="anchor" href="#_constructor_and_classifier_type"></a>4.11. Constructor and Classifier Type</h3>
<div class="paragraph">
<p>A class definition as described in <a href="#_classes">Classes</a> declares types. Often, it is
necessary to access these types directly, for example to access static
members or for dynamic construction of instances. These two use cases
are actually slightly different and N4JS provides two different types,
one for each use case: constructor and classifier type.<sup class="footnote">[<a id="_footnoteref_25" class="footnote" href="#_footnote_25" title="View footnote.">25</a>]</sup> The constructor is basically the
classifier type with the additional possibility to call it via in order
to create new instances of the declared type.</p>
</div>
<div class="paragraph">
<p>Both <code>meta</code> types are different from Java’s type <code>Class&lt;T&gt;</code>, as the latter has a defined set of members, while the N4JS metatypes will have members
according to a class definition. The concept of constructors as
metatypes is similar to ECMAScript 2015 [<a href="#ECMA15a">ECMA15a(p.14.5)</a>]..</p>
</div>
<div class="sect3">
<h4 id="_syntax_3"><a class="anchor" href="#_syntax_3"></a>4.11.1. Syntax</h4>
<div class="listingblock">
<div class="content">
<pre>ConstructorTypeRef returns ConstructorTypeRef: 'constructor' '{' typeArg = [TypeArgument] '}';

ClassifierTypeRef returns ClassifierTypeRef: 'type' '{' typeArg = [TypeRef] '}';</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_semantics_2"><a class="anchor" href="#_semantics_2"></a>4.11.2. Semantics</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-786" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-786</a>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Static members of a type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> are actually members of the
classifier type .</p>
</li>
<li>
<p>The keyword in a static method of a type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> actually
binds to the classifier type .</p>
</li>
<li>
<p>The constructor type is a subtype of the classifier type :
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>∀</mo><mi>T</mi><mi>:</mi><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mfenced close="}" open="{"><mi>T</mi></mfenced><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mfenced close="}" open="{"><mi>T</mi></mfenced><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo></math></p>
</li>
<li>
<p>If a class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi></math> is a subtype (subclass) of a class
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi></math>, then the classifier type also is a subtype of :
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mfenced close="}" open="{"><mi>B</mi></mfenced><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mfenced close="}" open="{"><mi>A</mi></mfenced><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo></mrow><mrow><mi>B</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>A</mi></mrow></math></p>
</li>
<li>
<p>If a class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi></math> is a subtype (subclass) of a class
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi></math>, and if the constructor function of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi></math> is a
subtype of the constructor function of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi></math>, then the
classifier type also is a subtype of :
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mfenced close="}" open="{"><mi>B</mi></mfenced><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mrow><mo>{</mo><mi>A</mi><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo></mrow></mrow><mi>}</mi><mrow><mrow><mi>B</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>A</mi></mrow><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>B</mi><mo>.</mo><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>A</mi><mo>.</mo><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow></mrow></math>
The subtype relation of the constructor function is
defined in . In the case of the default constructor, the type of the
object literal argument depends on required attributes.</p>
<div class="paragraph">
<p>This subtype relation for the constructor type is enforced if the
constructor of the super class is marked as <code>final</code>, see <a href="#Constructor">[Constructor]</a> for details.</p>
</div>
</li>
<li>
<p>The type of a classifier declaration or classifier expression is the
constructor of that class:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>C</mi><mi>:</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mrow><mo>[</mo><mi>C</mi></mrow></mrow></mrow></math>}}
            {\mu&#169; \in \{ \type{classifierDefinition} \} }
\end{aligned}\]]</p>
</li>
<li>
<p>A class cannot be called as a function in ECMAScript. Thus, the
constructor and type type are only subtype of :
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>∀</mo><mi>T</mi><mi>:</mi><mtext>
</mtext><mo>∀</mo><mi>T</mi><mi>:</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mfenced close="}" open="{"><mi>T</mi></mfenced></mrow><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mrow><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mfenced close="}" open="{"><mi>T</mi></mfenced></mrow><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mrow><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow><mtext>
</mtext></math></p>
</li>
<li>
<p>If the type argument of the constructor is not a declared type
(i.e., a wildcard or a type variable with bounds), the constructor
cannot be used in a new expression. Thus, the constructor function
signature becomes irrelevant for subtype checking. In that case, the
following rules apply: 
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mfenced close="}" open="{"><mi>S</mi></mfenced></mrow><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mfenced close="}" open="{"><mi>T</mi></mfenced></mrow></mrow><mrow><mi>S</mi><mo>.</mo><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>T</mi><mo>.</mo><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>T</mi><mo>.</mo><mi>l</mi><mi>o</mi><mi>w</mi><mi>e</mi><mi>r</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>S</mi><mo>.</mo><mi>l</mi><mi>o</mi><mi>w</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>μ</mi><mfenced close=")" open="("><mi>T</mi></mfenced><mo>≠</mo><mrow><mi>D</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>W</mi><mi>i</mi><mi>t</mi><mi>h</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>M</mi><mi>o</mi><mi>d</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>r</mi></mrow></mrow></math></p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/221" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-221</a>
</div>
</div>
<div class="paragraph">
<p>Note that this is only true for the right hand side
of the subtyping rule. A constructor type with a wildcard is never a
subtype of a constructor type without a wildcard.</p>
</div>
<div class="paragraph">
<p>The figure <a href="#cdConstructorClassifierType">Classifier and Constructor Type Subtype Relations</a> shows the subtype relations defined by the preceding rules.</p>
</div>
<div id="cdConstructorClassifierType" class="imageblock">
<div class="content">
<img src="fig/cdConstructorClassifierType.png" alt="cdConstructorClassifierType">
</div>
<div class="title">Figure 2. Classifier and Constructor Type Subtype Relations</div>
</div>
<div class="paragraph">
<p>Consequences:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Overriding of static methods is possible and by using the constructor
or classifier type, polymorphism for static methods is possible as well.</p>
<div class="paragraph">
<p>[[ex:Static Polymorphism]]</p>
</div>
<div class="listingblock">
<div class="content">
<pre>class A {
    static foo(): string { return "A"; }
    static bar(): string { return this.foo(); }
}
class B extends A {
    @Override
    static foo(): string { return "B"; }
}

A.bar(); // will return "A"
B.bar(); // will return "B", as foo() is called polymorphical</pre>
</div>
</div>
</li>
<li>
<p>It is even possible to refer to the constructor of an abstract class.
The abstract class itself cannot provide this constructor (it only
provides a type..), that is to say only concrete subclasses can provide
constructors compatible to the constructor.</p>
<div class="paragraph">
<p>[[ex:Constructor of Abstract Class]]</p>
</div>
<div class="listingblock">
<div class="content">
<pre>abstract class A {}
class B extends A {}
function f(ctor: constructor{A}): A { return new ctor(); }

f(A); // not working: type{A} is not a subtype of constructor{A}.
f(B); // ok</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Allowing wildcards on constructor type references has pragmatic reasons.
The usage of constructor references usually indicates very dynamic
scenarios. In some of these scenarios, e.g., in case of dynamic creation
of objects in the context of generic testing or injectors, arbitrary
constructors may be used. Of course, it won’t be possible to check the
correct new expression call in these cases – and using new expressions
is prevented by N4JS if the constructor reference contains a wildcard.
But other constraints, implemented by the client logic, may guarantee
correct instantiation via more dynamic constructors, for example via the
ECMAScript 2015 reflection API. In order to simplify these scenarios and
preventing the use of <code>any</code>, wildcards are supported in constructors. Since a
constructor with a wildcard cannot be used in a new expression anyway,
using a classifier type is usually better than using a constructor type
with wildcard.</p>
</div>
<div class="paragraph">
<p>Using wildcards on classifier types would have the same meaning as using
the upper bound directly. That is, a type reference <code>type{? extends C}</code> can simply be replaced with <code>type{c}</code>, and <code>type{?}</code> with <code>type{any}</code>.</p>
</div>
<div class="paragraph">
<p>To conclude this chapter, let us compare the different types introduced
above depending on whether they are used with wildcards or not:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>having a value of type <code>constructor{C}</code>, we know we have &#8230;&#8203;</p>
<div class="ulist">
<ul>
<li>
<p>a constructor function of <code>{C}</code> or a subclass of <code>{C}</code>,</p>
</li>
<li>
<p>that can be used for instantiation (i.e. the represented class is not
abstract),</p>
</li>
<li>
<p>that has a signature compatible to the owned or inherited constructor
of <code>{C}</code>.</p>
<div class="paragraph">
<p>This means we have the constructor function of class <code>{C}</code> (but only if is
non-abstract) or the constructor function of any non-abstract subclass
of <code>{C}</code> with an override compatible signature to that of `{C}&#8217;s constructor
function.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>having a value of type <code>constructor{? extends C}</code>, we know we have &#8230;&#8203;</p>
<div class="ulist">
<ul>
<li>
<p>a constructor function of <code>{C}</code> or a subclass of <code>{C}</code>,</p>
</li>
<li>
<p>that can be used for instantiation (i.e. the represented class is not
abstract).</p>
<div class="paragraph">
<p>So, same situation as before except that we know nothing about the
constructor function’s signature. However, if <code>{C}</code> has a covariant
constructor, cf. <a href="#Covariant_Constructors">[Covariant_Constructors]</a>, we can still conclude that we have an override compatible constructor function to that of <code>{C}</code>, because classes with
covariant constructors enforce all their subclasses to have override
compatible constructors.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>have a value of type <code>type{? extends C}</code> or <code>type{C}</code> (the two types are equivalent), we know we
have &#8230;&#8203;</p>
<div class="ulist">
<ul>
<li>
<p>an object representing a type (often constructor functions are used
for this, e.g. in the case of classes, but could also be a plain object,
e.g. in the case of interfaces),</p>
</li>
<li>
<p>that represents type <code>{C}</code> or a subtype thereof,</p>
</li>
<li>
<p>that cannot be used for instantiation (e.g. could be the constructor
function of an abstract class, the object representing an interface,
etc.).</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Slightly simplified, we can say that in the first above case we can
always use the value for creating an instance with <code>new</code>, in the second case
only if the referenced type has a covariant constructor, cf. <a href="#Covariant_Constructors">[Covariant_Constructors]</a>, and never
in the third case.</p>
</div>
</div>
<div class="sect3">
<h4 id="_constructors_and_prototypes_in_ecmascript_2015"><a class="anchor" href="#_constructors_and_prototypes_in_ecmascript_2015"></a>4.11.3. Constructors and Prototypes in ECMAScript 2015</h4>
<div class="paragraph">
<p><a href="#Constructors and prototypes">The figure below for two classes A and B in ECMAScript 2015</a> shows the constructors, prototypes, and the relations between them for
the following ECMAScript 2015 code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>class A {}
class B extends A {}

var b = new B();</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the diagram shows plain ECMAScript 2015 only. Further note
that <code>A</code> is defined without an  <code>extends</code> clause, which is what ECMAScript 2015 calls a <em>base class</em> (as opposed to a <em>derived class</em>). The constructor of a
base class always has Function.prototype as its prototype. If we had
defined <code>A</code> as <code>class A extends Object {}</code> in the listing above, then the constructor of <code>A</code> would have Object’s constructor as its prototype (depicted in as a dashed red
arrow), which would make a more consistent overall picture.</p>
</div>
<div class="paragraph">
<p>[[Constructors and prototypes]]
image::fig/ctorsProtosInES6.png[title="Constructors and prototypes for two classes A and B in ECMAScript 2015 (not N4JS!)"]</p>
</div>
<div class="paragraph">
<p>Base classes in the above sense are not available in N4JS. If an N4JS
class does not provide an <code>extends</code> clause, it will implicitly inherit from
built-in class <code>N4Object</code>, if it provides an <code>extends</code> clause stating <code>Object</code> as its super type, then it corresponds to what is shown in <a href="#Constructors and prototypes">[Constructors and prototypes]</a> with the red dashed arrow.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_this_type"><a class="anchor" href="#_this_type"></a>4.12. This Type</h3>
<div class="paragraph">
<p>  </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-377" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-377</a>
<a href="https://jira.numberfour.eu/browse/IDE-785" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-785</a>
<a href="https://github.com/NumberFour/N4JS/issues/228" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-228</a>
</div>
</div>
<div class="paragraph">
<p>The keyword may represent either a literal (cf. <a href="#ex:This keyword and type in instance and static context">[ex:This keyword and type in instance and static context]</a>) or may refer to the type. In this section, we describe the latter case.</p>
</div>
<div class="paragraph">
<p>Typical use cases of the type include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>declaring the return type of instance methods</p>
</li>
<li>
<p>declaring the return type of static methods</p>
</li>
<li>
<p>as formal parameter type of constructors in conjunction with use-site
structural typing</p>
</li>
<li>
<p>the parameter type of a function type expression, which appears as
type of a method parameter</p>
</li>
<li>
<p>the parameter type in a return type expression (<code>this</code>,<code>constructor{this}</code>)</p>
</li>
<li>
<p>an existential type argument inside a return type expression for
methods (e.g.<code>ArrayList&lt;? extends this&gt; method(){&#8230;&#8203;}</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The precise rule where it may appear is given below in <a href="#req:37 This Type">[req:37 This Type]</a>.</p>
</div>
<div class="paragraph">
<p>The <code>this</code> type is similar to a type variable, and it is bound to the declared
or inferred type of the receiver. If it is used as return type, all
return statements of the methods must return the <code>this</code> keyword or a variable
value implicitly inferred to a <code>this</code> type (e.g. <code>var x = this; return x;</code>).</p>
</div>
<div class="paragraph">
<p>[[Simple This Type]]
.Simple This Type</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class A {
    f(): this {
        return this;
    }
})
class B extends A {}

var a: A; var b: B;
a.f(); // returns something with the type of A
b.f(); // returns something with the type of B</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>this</code> can be thought of as a type variable which is implicitly substituted with
the declaring class (i.e. this type used in a class <code>{A}</code> actually means <code>&lt;? extends A&gt;</code>).</p>
</div>
<div class="sect3">
<h4 id="this-type-syntax"><a class="anchor" href="#this-type-syntax"></a>4.12.1. Syntax</h4>
<div class="listingblock">
<div class="content">
<pre>ThisTypeRef returns ThisTypeRef:
    ThisTypeRefNominal | ThisTypeRefStructural;

ThisTypeRefNominal returns ThisTypeRefNominal:
    {ThisTypeRefNominal} 'this'
;

ThisTypeRefStructural  returns ThisTypeRefStructural:
        typingStrategy=TypingStrategyUseSiteOperator
        'this'
        ('with' '{' ownedStructuralMembers+=TStructMember* '}')?
;</pre>
</div>
</div>
<div class="paragraph">
<p>The keyword <code>this</code> and the type expression <code>this</code> look similar, however they can refer
to different types. The type always refers to the type of instances of a
class. The <code>this</code> keyword refers to the type of instances of the class in case
of instance methods, but to the classifier the of the class in case of
static methods. See  <a href="#This_Keyword">[This_Keyword]</a> for details.</p>
</div>
<div class="paragraph">
<p>[[ex:This keyword and type in instance and static context]]
Note that the following code is not working, because some usages below are
not valid in N4JS. This is only to demonstrate the types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class C {
    instanceMethod() {
        var c: this = this;
    }
    static staticMethod() {
        var C: type{this} = this;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Structural typing and additional members in structural referenced types
is described in <a href="#Structural_Typing">[Structural_Typing]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="this-keyword-semantics"><a class="anchor" href="#this-keyword-semantics"></a>4.12.2. Semantics</h4>
<div class="paragraph">
<p>[[req:37 This Type]]</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-538" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-538</a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>used in the context of a class is actually inferred to an existential
type inside the class itself.</p>
</li>
<li>
<p>the type may only be used</p>
<div class="ulist">
<ul>
<li>
<p>as the type of a formal parameter of a constructor, if and only if
combined with use-site structural typing.</p>
</li>
<li>
<p>at covariant positions within member declarations, except for static
members of interfaces.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Remarks</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Due to the function subtype relation and constraints on overriding
methods (in which the overriding method has to be a subtype of the
overridden method), it is not possible to use the type in formal
parameters but only as return type. The following listing demonstrates
that problem:</p>
<div class="listingblock">
<div class="content">
<pre>class A {
    bar(x: this): void { ... } // error
    // virtually defines: bar(x: A): void
}
class B extends A {
    // virtually defines: bar(x: B): void
}</pre>
</div>
</div>
<div class="paragraph">
<p>As the <code>this</code> type is replaced similar to a type variable, the virtually
defined method <code>bar</code> in is not override compatible with <code>bar</code> in <code>{A}</code>.</p>
</div>
<div class="paragraph">
<p>In case of constructors, this problem does not occur because a subclass
constructor does not need to be override compatible with the constructor
of the super class. Using <code>this</code> as the type of a constructor’s parameter,
however, would mean that you can only create an instance of the class if
you already have an instance (considering that due to the lack of method
overloading a class can have only a single constructor), making creation
of the first instance impossible. Therefore, <code>this</code> is also disallowed as the
type of a constructor’s parameter.</p>
</div>
</li>
<li>
<p>The difference between the type <code>this</code> and the keyword <code>this</code> is when and how the
actual type is set: The actual type of the <code>this</code> type is computed at compile
(or validation) time and is always the containing type (of the member in
which the type expression is used) or a subtype of that type – this is
not a heuristic, this is so by definition. In contrast, the actual type
of the keyword <code>this</code> is only available at runtime, while the type used at
compilation time is only a heuristically computed type, in other words,
a good guess.</p>
</li>
<li>
<p>The value of the <code>this</code> type is, in fact, not influenced by any <code>@This</code> annotations.
Instead of using <code>this</code> in these cases, the type expressions in the <code>@This</code> annotations can be used.</p>
</li>
<li>
<p>The <code>this</code> type is always bound to the instance-type regardless of the
context it occurs in (non-static or static). To refer to the
this-classifier (static type) the construct <code>type{this}</code> is used. </p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-785" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-785</a>
</div>
</div>
<div class="paragraph">
<p>[[ex:this type in function-type-expression]]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class A {
    alive: boolean = true;
    methodA(func: {function(this)}): string {
       func(this);   // applying the passed-in function
       return "done";
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The use of <code>this</code> type is limited to situations where it cannot be referred in
mixed co- and contra-variant ways. In the following example the problem
is sketched up. <sup class="footnote">[<a id="_footnoteref_26" class="footnote" href="#_footnote_26" title="View footnote.">26</a>]</sup></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/263" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-263</a>
</div>
</div>
<div class="paragraph">
<p>[[ex:problems with this type and type arguments]]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>// Non-working example, see problem in line 15.
class M&lt;V&gt; {  public value: V;  }
class A {
    public store: M&lt;{function(this)}&gt;; // usually not allowed, but let's assume it would be possible----
}
class B extends A { public x=0; } // type of store is M&lt;{function(B)}&gt;

var funcA = function(a: A) {/*...something with a...*/}
var funcB = function(b: B) { console.log(b.x); }
var a: A = new A();  var b: B = new B();
b.store.value = funcA  // OK, since {function(A)} &lt;: {function(B)}
b.store.value = funcB  // OK.

var a2: A = b; // OK, since B is a subtype of A
a2.store.value( a ) // RUNTIME ERROR, the types are all correct, but remember b.store.value was assigned to funcB, which can only handle subtypes of B !</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_enums"><a class="anchor" href="#_enums"></a>4.13. Enums</h3>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-327" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-327</a>
<a href="https://jira.numberfour.eu/browse/IDE-980" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-980</a>
</div>
</div>
<div class="paragraph">
<p>Enums are an ordered set of literals. Although enums are not true
classes, they come with built-in methods for accessing value, name and
type name of the enum.</p>
</div>
<div class="paragraph">
<p>In N4JS, two flavours of enumerations are distinguished: ordinary enums
(N4JS) and string based enums. Ordinary enums (or in short, enums) are
used while programming in N4JS. String based enums are introduced to
access enumerations derived from standards, mainly developed by the W3C,
in order to access the closed set of string literals defined in webIDL
syntax.</p>
</div>
<div class="sect3">
<h4 id="_enums_n4js"><a class="anchor" href="#_enums_n4js"></a>4.13.1. Enums (N4JS)</h4>
<div class="paragraph">
<p>Definition and usage of an enumeration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// assume this file to be contained in a package "myPackage"
enum Color {
    RED, GREEN, BLUE
}

enum Country {
    DE : "276",
    US : "840",
    TR : "792"
}

var red: Color = Color.RED;
var us: Country = Country.US;

console.log(red.name); // --&gt; RED
console.log(red.value); // --&gt; RED
console.log(red.n4class.fqn); // --&gt; myPackage.Color
console.log(red.toString()); // --&gt; RED

console.log(us.name); // --&gt; US
console.log(us.value); // --&gt; 840
console.log(us.n4classfqn); // --&gt; myPackage.Country
console.log(us.toString()); // --&gt; 840</pre>
</div>
</div>
<div class="sect4">
<h5 id="enums-syntax"><a class="anchor" href="#enums-syntax"></a>Syntax</h5>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-8" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-8</a>
<a href="https://jira.numberfour.eu/browse/IDE-327" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-327</a>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>N4EnumDeclaration:
        annotations+=Annotation*
        (accessModifier=N4JSTypeAccessModifier)?
        'enum' name=IDENTIFIER
        '{'
            literals+=N4EnumLiteral (',' literals+= N4EnumLiteral)*
        '}' ;

N4EnumLiteral:
        name=IDENTIFIER (':' value=StringLiteral)?</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="enums-semantics"><a class="anchor" href="#enums-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>The enum declaration <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>E</mi></math> is of type <code>type{E}</code> and every enumeration is
implicitly derived from <code>{N4Enum}</code>. There are similarities to other languages such
as Java, for example, where the literals of an enum are treated as final
static fields with the type of the enumeration and the concrete
enumeration provides specific static methods including the literals.
This leads to the following typing rules:</p>
</div>
<div class="paragraph">
<p>For a given enumeration declaration <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>E</mi></math> with literals <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>L</mi></math>, the following
type rules are defined:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Every enumeration <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>E</mi></math> is a subtype of the base type :
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>E</mi></mrow><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mrow><mi>N</mi><mn>4</mn><mi>E</mi><mi>n</mi><mi>u</mi><mi>m</mi></mrow><mi>}</mi><mi>}</mi><mrow/></math></p>
</li>
<li>
<p>Every literal <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>L</mi></math> of an enumeration <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>E</mi></math> is
of the type of the enumeration: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>L</mi><mi>:</mi><mi>E</mi></mrow><mrow><mi>L</mi><mo>∈</mo><mi>E</mi><mo>.</mo><mi>l</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>l</mi><mi>s</mi></mrow></math> That means that every literal is a subtype of :
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>L</mi><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>N</mi><mn>4</mn><mi>E</mi><mi>n</mi><mi>u</mi><mi>m</mi><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo></mrow><mrow><mi>L</mi><mo>∈</mo><mi>E</mi><mo>.</mo><mi>l</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>l</mi><mi>s</mi></mrow></math></p>
</li>
<li>
<p>Since the implementation of enumerations may vary per runtime, enum
literals are not objects: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>L</mi><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo></mrow><mrow><mi>L</mi><mo>∈</mo><mi>E</mi><mo>.</mo><mi>l</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>l</mi><mi>s</mi></mrow></math></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The base enumeration type is defined as follows <sup class="footnote">[<a id="_footnoteref_27" class="footnote" href="#_footnote_27" title="View footnote.">27</a>]</sup></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>/**
 * Base class for all enumeration, literals are assumed to be static constant fields of concrete subclasses.
 */
public object N4Enum extends any {

    /**
     * Returns the name of a concrete literal
     */
    public get name(): string

    /**
     * Returns the value of a concrete literal. If no value is
     * explicitly set, it is similar to the name.
     */
    public get value(): string

    /**
     * Returns a string representation of a concrete literal, it returns
     * the same result as value()
     */
     public toString(): string

    /**
     * Returns the meta class object of this enum literal for reflection.
     * The very same meta class object can be retrieved from the enumeration type directly.
     */
    public static get n4type(): N4EnumType

    //IDE-785 this as return type in static

    /**
     * Returns array of concrete enum literals
     */
    public static get literals(): Array&lt;? extends this&gt;

    /**
     * Returns concrete enum literal that matches provided name,
     * if no match found returns undefined.
     */
    public static findLiteralByName(name: string): this

    /**
     * Returns concrete enum literal that matches provided value,
     * if no match found returns undefined.
     */
    public static findLiteralByValue (value: string): this
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Enums do not define a type hierarchy except that they are subtypes of <code>N4Enum</code>.
In particular, <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>E</mi><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></math> for all enums. Still,
enums could be used similarly to objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>enum types could be used on the right hand side of the <code>instanceof</code> operator.</p>
</li>
<li>
<p>enum variables could be used with the <code>typeof</code> operator, returning the simple
name of the enumaration.</p>
</li>
<li>
<p>enum variables used with the <code>+</code> operator will always be converted to <code>string</code>.</p>
</li>
<li>
<p>enum variables must not be used in a context in which a boolean or number type is expected.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>[[req:39Unique literal names]]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><mi>i</mi><mo>,</mo><mi>j</mi><mi>:</mi><mi>l</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>l</mi><mi>s</mi><mrow><mo>[</mo><mi>i</mi></mrow></math>.name = literals[j].name \iff i = j$]
Literal names have to be unique.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>[[req:40Enum Literals are Singletons]]
Enum literals are singletons:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>∀</mo><msub><mi>e</mi><mn>1</mn></msub><mo>,</mo><msub><mi>e</mi><mn>2</mn></msub><mo>,</mo><mi>μ</mi><mfenced close=")" open="("><msub><mi>e</mi><mn>1</mn></msub></mfenced><mo>=</mo><mi>μ</mi><mfenced close=")" open="("><msub><mi>e</mi><mn>2</mn></msub></mfenced><mo>=</mo><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mi>N</mi><mn>4</mn><mi>E</mi><mi>n</mi><mi>u</mi><mi>m</mi><mi>L</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>l</mi><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mo>∧</mo><msub><mi>e</mi><mn>1</mn></msub><mo>=</mo><msub><mi>e</mi><mn>2</mn></msub><mi>:</mi><msub><mi>e</mi><mn>1</mn></msub><mo>&lt;</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mo>=</mo><mo>=</mo><mi>}</mi><msub><mi>e</mi><mn>2</mn></msub><msub><mi>e</mi><mn>1</mn></msub><mo>&lt;</mo><mo>/</mo><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>&gt;</mo><mo>=</mo><mo>=</mo><mo>=</mo><mi>}</mi><msub><mi>e</mi><mn>2</mn></msub></math></p>
</div>
<div class="paragraph">
<p>[[ex:Enumeration List]]
Due to the common base type <code>N4Enum</code> it is possible to define generics accepting only enumeration, as shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>enum Color { R, G, B}

class EList&lt;T extends N4Enum&gt; {
    add(t: T) {}
    get(): T { return null; }
}

var colors: EList&lt;Color&gt;;
colors.add(Color.R);
var c: Color = colors.get();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_string_based_enums"><a class="anchor" href="#_string_based_enums"></a>4.13.2. String-Based Enums</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1221" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1221</a>
</div>
</div>
<div class="paragraph">
<p>In current web standards [<a href="#W3C:Steen:14:XL">W3C:Steen:14:XL</a>], definitions of enumerations are often given in webIDL syntax.
While the webIDL-definition assembles a set of unique
string literals as a named enum-entity, the language binding to
ECMAScript refers to the usage of the members of these enumerations
only. Hence, if an element of an enumeration is stored in a variable or
field, passed as a parameter into a method or function or given back as
a result, the actual type in JavaScript will be <code>string</code>. To provide the N4JS
user with some validations regarding the validity of a statement at
compile time, a special kind of subtypes of <code>string</code> are introduced: the
string-based enum using the <code>@StringBased</code> annotation. (See also other string-based
types like <code>pathSelector&lt;T&gt;</code> and <code>i18nKey</code> in <a href="#_primitive_pathselector_and_i18nkey">Primitive Pathselector and I18nKey</a>.)</p>
</div>
<div class="paragraph">
<p>String-based enums do not have any kind of runtime representation;
instead, the transpiler will replace each reference to a literal of a
string-based enum by a corresponding string literal in the output code.
Furthermore, no meta-information is available for string-based enums,
i.e. the <code>n4type</code> property is not available. The only exception is the static
getter <code>literals</code>: it is available also for string-based enums and has the same
meaning. In case of string-based enums, however, there won’t be a getter
used at runtime; instead, the transpiler replaces every read access to
this getter by an array literal containing a string literal for each of
the enum’s literals.</p>
</div>
<div class="paragraph">
<p>[[req:41String-Based Enum Type Rules]]
For a string-based enum declaration <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>E</mi><mi>S</mi></msub></math> with literals
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>L</mi><mi>S</mi></msub></math> the following type rules are defined:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Every string-based enumeration <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>E</mi><mi>S</mi></msub></math> is a subtype of the
base type <code>N4StringBasedEnum</code>: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><msub><mi>E</mi><mi>S</mi></msub></mrow><mrow><mi>N</mi><mn>4</mn><mi>S</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>B</mi><mi>a</mi><mi>s</mi><mi>e</mi><mi>d</mi><mi>E</mi><mi>n</mi><mi>u</mi><mi>m</mi></mrow></mrow><mrow/><mtext>
</mtext><mrow><mi>w</mi><mi>h</mi><mi>i</mi><mi>c</mi><mi>h</mi><mi>i</mi><mi>t</mi><mi>s</mi><mi>e</mi><mi>l</mi><mi>f</mi><mi>i</mi><mi>s</mi><mi>n</mi><mi>o</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>l</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>d</mi><mi>t</mi><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>d</mi><mi>a</mi><mi>r</mi><mi>d</mi><mi>e</mi><mi>n</mi><mi>u</mi><mi>m</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mrow><mi>N</mi><mn>4</mn><mi>E</mi><mi>n</mi><mi>u</mi><mi>m</mi></mrow></mrow><mrow><mrow><mi>N</mi><mn>4</mn><mi>S</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>B</mi><mi>a</mi><mi>s</mi><mi>e</mi><mi>d</mi><mi>E</mi><mi>n</mi><mi>u</mi><mi>m</mi></mrow><mrow><mi>N</mi><mn>4</mn><mi>E</mi><mi>n</mi><mi>u</mi><mi>m</mi></mrow></mrow><mrow/><mtext>
</mtext><mrow><mrow><mi>N</mi><mn>4</mn><mi>E</mi><mi>n</mi><mi>u</mi><mi>m</mi></mrow><mrow><mi>N</mi><mn>4</mn><mi>S</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>B</mi><mi>a</mi><mi>s</mi><mi>e</mi><mi>d</mi><mi>E</mi><mi>n</mi><mi>u</mi><mi>m</mi></mrow></mrow><mrow/></math></p>
</li>
<li>
<p><code>N4StringBasedEnum</code> is a subtype of <code>string</code>
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>N</mi><mn>4</mn><mi>S</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>B</mi><mi>a</mi><mi>s</mi><mi>e</mi><mi>d</mi><mi>E</mi><mi>n</mi><mi>u</mi><mi>m</mi></mrow><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow></mrow><mrow/></math></p>
</li>
<li>
<p>Each literal in <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>L</mi><mi>S</mi></msub></math> of a string-based enumeration
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>E</mi><mi>S</mi></msub></math> is of the type of the string-based enumeration.
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>l</mi><msub><mi>E</mi><mi>S</mi></msub></mrow><mrow><mi>l</mi><mo>∈</mo><msub><mi>E</mi><mi>S</mi></msub><mo>.</mo><msub><mi>L</mi><mi>S</mi></msub></mrow></math></p>
</li>
<li>
<p><a href="#req:39Unique literal names">[req:39Unique literal names]</a> also applies for <code>N4StringBasedEnum</code>.</p>
</li>
<li>
<p>[<a href="#req:40Enum Literals are Singletons">[req:40Enum Literals are Singletons]</a>]
also applies for <code>N4StringBasedEnum</code>.</p>
</li>
<li>
<p>References to string-based enums may only be used in the following
places:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>in type annotations</p>
</li>
<li>
<p>in property access expressions to refer to one of the enum’s
literals</p>
</li>
<li>
<p>in property access expressions to read from the static getter <code>literals</code></p>
<div class="paragraph">
<p>In particular, it is invalid to use the type of a string-based enum as a
value, as in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">    @StringBased enum Color { RED, GREEN, BLUE }
    var c = Color;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Gecko-Engine webIDL XMLHttpRequestResponseType as taken from [<a href="#W3C:Steen:14:XL">W3C:Steen:14:XL</a>]</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">enum XMLHttpRequestResponseType {
  "",
  "arraybuffer",
  "blob",
  "document",
  "json",
  "text" //, ... and some mozilla-specific additions
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Compatible Definition of this Enumeration in N4JS, provided through a
runtime-library definition:</p>
</div>
<div class="listingblock">
<div class="title">File in source-folder: w3c/dom/XMLHttpRequestResponseType.n4js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">@StringBased enum XMLHttpRequestResponseType {
  vacant : "",
  arrayBuffer : "arraybuffer",
  blob : "blob",
  document : "document",
  json : "json",
  text : "text"
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Usage of the enumeration in the definition files of the runtime-library.
Note the explicit import of the enumeration.</p>
</div>
<div class="listingblock">
<div class="title">XMLHttpRequestResponse.n4jsd</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">@@ProvidedByRuntime
import XMLHttpRequestResponseType from "w3c/dom/XMLHttpRequestResponseType";
@Global
export external public class XMLHttpRequestResponse extends XMLHttpRequestEventTarget {
  // ...
  // Setter Throws TypeError Exception
  public responseType: XMLHttpRequestResponseType;
  // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Client code importing the runtime-library as defined above can now use
the Enumeration in a type-safe way:</p>
</div>
<div class="listingblock">
<div class="title">String-Based Enumeration Usage</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">import XMLHttpRequestResponseType from "w3c/dom/XMLHttpRequestResponseType";

public function process(req: XMLHttpRequest) : void {
  if( req.responseType == XMLHttpRequestResponseType.text ) {
    // do stuff ...
  } else {
       // signal unrecognized type.
       var errMessage: req.responseType + " is not supported"; // concatination of two strings.
       show( errMessage );
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="_classifiers" class="sect0"><a class="anchor" href="#_classifiers"></a>Classifiers</h1>
<div class="sect1">
<h2 id="_n4js_specific_classifiers"><a class="anchor" href="#_n4js_specific_classifiers"></a>5. N4JS Specific Classifiers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>N4JS provides three new metatypes: class, interface, and
enums. In this section we describe classes and interfaces. These
metatypes, called <em>classifiers</em>, share some common properties which
are described before type specific properties are outlined in the
following sections.</p>
</div>
<div class="paragraph">
<p>All of these metatypes can be marked with type access modifiers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">enum N4JSTypeAccessModifier: project | public;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_properties_2"><a class="anchor" href="#_properties_2"></a>5.1. Properties</h3>
<div class="paragraph">
<p>Properties defined by syntactic elements:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>annotations</code>: </dt>
<dd>
<p>Arbitrary annotations, see <a href="#_annotations">Annotations</a> for details.</p>
</dd>
<dt class="hdlist1"><code>accessModifier</code>: </dt>
<dd>
<p>N4JS type access modifier: <code>public</code>, or <code>project</code>;  <code>public</code> can be combined with <code>@Internal</code>; if
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mi>x</mi><mi>p</mi><mi>o</mi><mi>r</mi><mi>t</mi></math> is <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mi>r</mi><mi>u</mi><mi>e</mi></math> the default is else the
default is <code>private</code>.
task:IDE-84[]</p>
</dd>
<dt class="hdlist1"><code>name</code>: </dt>
<dd>
<p>The simple name of a classifier. If the classifier is defined by an
anonymous class expression, an artificial but unique name is created.
The name needs to be a valid identifier, see <a href="#Valid_Names">[Valid_Names]</a>.</p>
</dd>
<dt class="hdlist1"><code>typePars</code>: </dt>
<dd>
<p>Collection of type parameters of a generic classifier; empty by default.</p>
</dd>
<dt class="hdlist1"><code>ownedMembers</code>: </dt>
<dd>
<p>Collection of owned members, i.e. methods and fields defined directly in
the classifier and, if present, the explicitly defined constructor.
Depending on the concrete classifier, additional constraints are
defined.</p>
</dd>
<dt class="hdlist1"><code>typingStrategy</code>: </dt>
<dd>
<p>The definition-site typing strategy. By default nominal typing is used.
See <a href="#Structural_Typing">[Structural_Typing]</a>for details.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following pseudo properties are defined via annotations:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>export</code>: </dt>
<dd>
<p>Boolean property set to true if the <code>export</code> modifier is set. If value is true,
the classifier may be accessible outside the project. task:IDE-84[]</p>
</dd>
<dt class="hdlist1"><code>final</code>: </dt>
<dd>
<p>Boolean property which is set to final if annotation <code>@Final</code> is set. Also see
<a href="#Final_Extensibility">[Final_Extensibility]</a></p>
</dd>
<dt class="hdlist1"><code>deprecated</code>: </dt>
<dd>
<p>Boolean property set to true if annotation <code>@Deprecated</code> is set.
task:IDE-138[]</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>We additionally define the following pseudo properties:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>acc</code>: </dt>
<dd>
<p>Type access modifier as described in <a href="#Accessibility_of_Types">[Accessibility_of_Types]</a>, it is the aggregated value of the
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>M</mi><mi>o</mi><mi>d</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>r</mi></math> and the <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mi>x</mi><mi>p</mi><mi>o</mi><mi>r</mi><mi>t</mi></math> property.</p>
</dd>
<dt class="hdlist1"><code>owned{Fields|Methods|Getters|Setters|Accessors}</code>: </dt>
<dd>
<p>Filters ownedMembers by metatype, short for<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>∈</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo>,</mo><mi>μ</mi><mfenced close=")" open="("><mi>x</mi></mfenced><mo>=</mo><mrow><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi></mrow></math> etc.</p>
</dd>
<dt class="hdlist1"><code>members</code>: </dt>
<dd>
<p>Reflexive transitive closure of all members of a classifier and its
super classifiers, see below on how this is calculated.</p>
</dd>
<dt class="hdlist1"><code>fields|methods|getters|setters|accessors</code>: </dt>
<dd>
<p>Filters members by metatype, short for<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>∈</mo><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo>,</mo><mi>μ</mi><mfenced close=")" open="("><mi>x</mi></mfenced><mo>=</mo><mrow><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi></mrow></math> etc.</p>
</dd>
<dt class="hdlist1"><code>superClassifiers</code>: </dt>
<dd>
<p>Classes and interface may extend or implement classes or interfaces. Any
class or interface extended or interface implemented is called <em>super
classifier</em>. We distinguish the directly subtyped classifiers and from
the transitive closure of supertypes <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mi>u</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>C</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>r</mi><msup><mi>s</mi><mo>*</mo></msup></math></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_common_semantics_of_classifiers"><a class="anchor" href="#_common_semantics_of_classifiers"></a>5.2. Common Semantics of Classifiers</h3>
<div class="paragraph">
<p>For a given type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>, and supertypes<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mi>u</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>C</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo>=</mo><mfenced close="}" open="{"><msub><mi>S</mi><mn>1</mn></msub><mrow><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi></mrow><msub><mi>S</mi><mi>n</mi></msub></mfenced></math> directly subtyped
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>,<br>
the following constraints must be true:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The supertypes must be accessible to the subtype:
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>S</mi><mn>1</mn></msub><mo>,</mo><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi><mo>,</mo><msub><mi>S</mi><mi>n</mi></msub></math> must be accessible to <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>.</p>
</li>
<li>
<p>All type parameters of the direct supertypes have to be bound by
type arguments in the subtype and the type arguments have to be
substitutable types of the type parameters.
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∀</mo><mn>0</mn><mi>l</mi><mi>t</mi><mi>;</mi><mi>i</mi><mo>≤</mo><mi>k</mi><mi>:</mi><mo>∀</mo><mi>P</mi><mo>∈</mo><msub><mi>S</mi><mi>i</mi></msub><mi>:</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mo>∃</mo><mi>A</mi><mo>∈</mo><msub><mi>C</mi><mo>.</mo></msub><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>A</mi><mi>r</mi><mi>g</mi><mi>s</mi><mi>:</mi><mi>b</mi><mi>i</mi><mi>n</mi><mi>d</mi><mfenced close=")" open="("><mi>A</mi><mi>P</mi></mfenced><mo>∧</mo><mi>A</mi><mo>.</mo><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>B</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>d</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>P</mi><mo>.</mo><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>B</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>d</mi></math></p>
</li>
<li>
<p>Wildcards may not be used as type argument when binding a
supertype’s type parameters.</p>
</li>
<li>
<p>A classifier cannot be directly subtyped directly multiple times:
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><msub><mi>S</mi><mi>i</mi></msub><mo>,</mo><msub><mi>S</mi><mi>j</mi></msub><mfenced close=")" open="("><mi>i</mi><mrow><mi>j</mi><mo>∈</mo><mfenced close="}" open="{"><mrow><mn>1.</mn><mo>.</mo><mi>n</mi></mrow></mfenced></mrow></mfenced><mi>:</mi><msub><mi>S</mi><mi>i</mi></msub><mo>=</mo><msub><mi>S</mi><mi>j</mi></msub><mi>i</mi><mo>=</mo><mi>j</mi></math></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In order to simplify the following constraints, we use the pseudo
property <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi></math> to refer to all members of a classifier.
This includes all members directly declared by the classifier itself,
i.e. the <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi></math>, and all members inherited from its
super classifiers. The concrete mechanisms for inheriting a member are
different and further constraint (cf. <a href="#Redefinition_of_Members">[Redefinition_of_Members]</a>). A classifier only inherits its members from its direct supertypes, although the supertypes may contains
members inherited from their supertypes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_classes"><a class="anchor" href="#_classes"></a>5.3. Classes</h3>
<div class="sect3">
<h4 id="_definition_of_classes"><a class="anchor" href="#_definition_of_classes"></a>5.3.1. Definition of Classes</h4>
<div class="paragraph">
<p>Classes are either declared with a class declaration on top level, or
they can be used as anonymous classes in expressions. The latter may
have a name, which may be used for error messages and reflection.</p>
</div>
<div class="paragraph">
<p>At the current stage, class expressions are effectively disabled at
least until the semantics of them are finalized in ECMAScript 6.</p>
</div>
<div class="paragraph">
<p>In N4JS (as in many other languages) multi-inheritance of classes is not
supported. Although the <code>diamond problem</code> (of functions being defined
in both superclasses) could be solved via union and intersection types,
this would lead to problems when calling these super implementations.
This is particularly an issue due to JavaScript not supporting multiple
prototypes.
<sup class="footnote">[<a id="_footnoteref_28" class="footnote" href="#_footnote_28" title="View footnote.">28</a>]</sup>
Interfaces, however, allow for multi-inheritance. Since the
former can also define functions with bodies, this is not a hard
restriction.</p>
</div>
<div class="sect4">
<h5 id="class-syntax"><a class="anchor" href="#class-syntax"></a>Syntax</h5>
<div class="listingblock">
<div class="title">Syntax N4 Class Declaration and Expression</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">N4ClassDeclaration &lt;Yield&gt;:
    =&gt;(
        {N4ClassDeclaration}
        annotations+=Annotation*
        (declaredModifiers+=N4Modifier)*
        'class' typingStrategy=TypingStrategyDefSiteOperator? name=BindingIdentifier&lt;Yield&gt;?
    )
    TypeVariables?
    ClassExtendsClause&lt;Yield&gt;?
    Members&lt;Yield&gt;
;

N4ClassExpression &lt;Yield&gt;:
    {N4ClassExpression}
    'class' name=BindingIdentifier&lt;Yield&gt;?
    ClassExtendsClause&lt;Yield&gt;?
    Members&lt;Yield&gt;;


fragment ClassExtendsClause &lt;Yield&gt;*:
    'extends' (
          =&gt;superClassRef=ParameterizedTypeRefNominal ('implements' ClassImplementsList)?
        | superClassExpression=LeftHandSideExpression&lt;Yield&gt;
    )
    | 'implements' ClassImplementsList
;

fragment ClassImplementsList*:
    implementedInterfaceRefs+=ParameterizedTypeRefNominal
    (',' implementedInterfaceRefs+=ParameterizedTypeRefNominal)*
;

fragment Members &lt;Yield&gt;*:
    '{'
    ownedMembers+=N4MemberDeclaration&lt;Yield&gt;*
    '}'
;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="class-properties"><a class="anchor" href="#class-properties"></a>Properties</h5>
<div class="paragraph">
<p>These are the properties of class, which can be specified by the user:
Syntax N4 Class Declaration and Expression</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>abstract</code>: </dt>
<dd>
<p>Boolean flag indicating whether class may be instantiable; default is
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mi>a</mi><mi>l</mi><mi>s</mi><mi>e</mi></math>, see <a href="#_abstract_classes">Abstract Classes</a>.</p>
</dd>
<dt class="hdlist1"><code>external</code>: </dt>
<dd>
<p>Boolean flag indicating whether class is a declaration without
implementation or with an external (non-N4JS) implementation; default is
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mi>a</mi><mi>l</mi><mi>s</mi><mi>e</mi></math>, see <a href="#Definition_Site_Structural_Typing">[Definition_Site_Structural_Typing]</a>.</p>
</dd>
<dt class="hdlist1"><code>defStructural</code>: </dt>
<dd>
<p>Boolean flag indicating whether subtype relation uses nominal or
structural typing, see <a href="#Definition_Site_Structural_Typing">[Definition_Site_Structural_Typing]</a> for details.</p>
</dd>
<dt class="hdlist1"><code>superType/sup</code>: </dt>
<dd>
<p>The type referenced by <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mi>u</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi></math> is called direct
superclass of a class, and vice versa the class is a direct subclass of
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mi>u</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi></math>. Instead of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mi>u</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi></math>, we
sometimes simply write <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mi>u</mi><mi>p</mi></math>. The derived set
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mi>u</mi><msup><mi>p</mi><mo>+</mo></msup></math> is defined as the transitive closures of all direct
and indirect superclasses of a class. If no supertype is explicitly
stated, classes are derived from <code>N4Object</code>.</p>
</dd>
<dt class="hdlist1"><code>implementedInterfaces$/$interfaces$]</code>: </dt>
<dd>
<p>Collection of interfaces directly <em>implemented</em> by the class; empty by
default. Instead of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>e</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>d</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi><mi>s</mi></math>, we simply write
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi><mi>s</mi></math>.</p>
</dd>
<dt class="hdlist1"><code>ownedCtor</code>: </dt>
<dd>
<p>Explicit constructor of a class (if any), see <a href="#Constructor">[Constructor]</a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>And we additionally define the following pseudo properties:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ctor</code>: </dt>
<dd>
<p>Explicit or implicit constructor of a class, see .</p>
</dd>
<dt class="hdlist1"><code>fields</code>: </dt>
<dd>
<p>Further derived properties for retrieving all methods (property
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>m</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi><mi>s</mi></math>), fields (property <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mi>s</mi></math>), static
members (property <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mi>O</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi></math>), etc. can easily be
added by filtering properties <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi></math> or
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi></math>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="class-type-inference"><a class="anchor" href="#class-type-inference"></a>Type Inference</h5>
<div class="paragraph">
<p>The type of a class declaration or class expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>
(i.e., a class definition in general) is of type <code>{C}</code> if it is not abstract,
that is if it can be instantiated. If it is abstract, the type of the
definition simply is <code>{C}</code>:</p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>C</mi><mi>:</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>C</mi></mrow></mrow><mrow><mo>¬</mo><mi>C</mi><mo>.</mo><mi>a</mi><mi>b</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>C</mi><mi>:</mi><mrow><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>C</mi></mrow></mrow><mrow><mi>C</mi><mo>.</mo><mi>a</mi><mi>b</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi></mrow></math></p>
</div>
<div class="paragraph">
<p>The type of supertypes and implemented interfaces is always the nominal type, even
if the supertype is declared structurally.
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>T</mi><mo>.</mo><mi>s</mi><mi>u</mi><mi>p</mi><mi>:</mi><mi>S</mi></mrow><mrow><mi>b</mi><mi>i</mi><mi>n</mi><mi>d</mi><mfenced close=")" open="("><mrow><mi>T</mi><mo>.</mo><mi>s</mi><mi>u</mi><mi>p</mi></mrow><mi>S</mi></mfenced></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>I</mi><mi>:</mi><mi>S</mi></mrow><mrow><mi>I</mi><mo>∈</mo><mi>T</mi><mo>.</mo><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>b</mi><mi>i</mi><mi>n</mi><mi>d</mi><mfenced close=")" open="("><mi>I</mi><mi>S</mi></mfenced></mrow></math></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="class-semantics"><a class="anchor" href="#class-semantics"></a>5.3.2. Semantics</h4>
<div class="paragraph">
<p>This section deals with the (more or less) type-independent constraints
on classes.</p>
</div>
<div class="paragraph">
<p>Class expressions are not fully supported at the moment. </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-171" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-171</a>
</div>
</div>
<div class="openblock definition">
<div class="content">
<div class="paragraph">
<p><strong>Definition:</strong> <a href="#transitive_closure_of_members">Transitive closure of members</a></p>
</div>
<div class="paragraph">
<p>The reflexive transitive closure of members of a class is indirectly defined
by the override and implementation constraints defined in .</p>
</div>
<div class="paragraph">
<p>Note that since overloading is forbidden, the following constraint is
true:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><msub><mi>m</mi><mn>1</mn></msub><mo>,</mo><msub><mi>m</mi><mn>2</mn></msub><mo>∈</mo><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>:</mi><msub><mi>m</mi><mn>1.</mn></msub><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><msub><mi>m</mi><mn>2.</mn></msub><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><msub><mi>m</mi><mn>1</mn></msub><mo>=</mo><msub><mi>m</mi><mn>2</mn></msub><mo>∨</mo><mi>a</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>o</mi><mi>r</mi><mi>P</mi><mi>a</mi><mi>i</mi><mi>r</mi><mfenced close=")" open="("><msub><mi>m</mi><mn>1</mn></msub><msub><mi>m</mi><mn>2</mn></msub></mfenced></math>
<sup class="footnote">[<a id="_footnoteref_29" class="footnote" href="#_footnote_29" title="View footnote.">29</a>]</sup></p>
</div>
<div class="paragraph">
<p>Remarks: Class and method definition is quite similar to the proposed
ECMAScript version 6 draft [<a href="#ECMA15a">ECMA15a(p.S13.5)</a>], except that an N4 class and members may
contain</p>
</div>
<div class="ulist">
<ul>
<li>
<p>annotations, abstract and access modifiers</p>
</li>
<li>
<p>fields</p>
</li>
<li>
<p>types</p>
</li>
<li>
<p>implemented interfaces</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that even <code>static</code> is used in ECMAScript 6.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Mixing in members (i.e. interface’s methods with default implementation
or fields) is similar to mixing in members from roles as defined in [<a href="#Dart13a">Dart13a(p.S9.1)</a>]. It is also similar to default implementations in Java 8 [<a href="#Gosling15a">Gosling15a</a>]. In Java, however,
more constraints exist, (for example, methods of interfaces must be
public).</p>
</div>
<div class="paragraph">
<p>This first example shows a very simple class with a field, a constructor and a method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class C {
    data: any;

    constructor(data: any) {
        this.data = data;
    }

    foo(): void { }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>[[ex:Extend and implement]]
The following example demonstrate how a class can extend a superclass and implement an
interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">interface I {
    foo(): void
}
class C{}
class X extends C implements I {
    @Override
    foo(): void {}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> is a subtype of another classifier
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> (which can be a class or interface) if the other
classifier <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> is (transitively) contained in the supertypes
(superclasses or implemented interfaces) of the class:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>T</mi><mi>C</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi></mrow><mi> </mi><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mrow><mo>[</mo><mi>T</mi><mi>C</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi></mrow></mrow></math>\ right}{left=right}[shortcut] \\
\infer{\tee \type{TClass}\ left \subtype[TClass]\ right}{\tee  left.superType.declaredType \subtype right}\end{aligned}\]]</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The implicit supertype of all classes is <code>N4Object</code>. All classes with no
explicit supertype are inherited from <code>N4Object</code>.</p>
</li>
<li>
<p>If the supertype is explicitly set to <code>Object</code>, then the class is not
derived from <code>N4Object</code>. Meta-information is created similar to an <code>N4Object</code>-derived class. Usually, there is no reason to explicitly derive a class from <code>Object</code>.</p>
</li>
<li>
<p>External classes are implicitly derived from , unless they are
annotated with <code>@N4JS</code>(cf.<a href="#External_Declarations">[External_Declarations]</a>).</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_final_modifier"><a class="anchor" href="#_final_modifier"></a>5.3.3. Final Modifier</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-147" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-147</a>
</div>
</div>
<div class="paragraph">
<p>Extensibility refers to whether a given classifier can be subtyped.
Accessibility is a prerequisite for extensibility. If a type cannot be
seen, it cannot be subclassed. The only modifier influencing the
extensibility directly is the annotation <code>@Final</code>, which prevents all subtyping.
The following table shows how to prevent other projects or vendors from
subtyping by also restricting the accessibility of the constructor:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. Extensibility of Types</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Type <code>C</code> Settings</th>
<th class="tableblock halign-center valign-top" colspan="3">Subclassed in</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Project</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Vendor</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>World</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>C.final</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>C.ctor.accessModifier=\lenum{project}</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>C.ctor.accessModifier=\lenum{public@Internal}</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Since interfaces are always to be implemented, they must not be declared
final.</p>
</div>
</div>
<div class="sect3">
<h4 id="_abstract_classes"><a class="anchor" href="#_abstract_classes"></a>5.3.4. Abstract Classes</h4>
<div class="paragraph">
<p>A class with modifier <code>abstract</code> is called an <em>abstract class</em> and has its
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mi>b</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi></math> property set to true. Other classes are called
<em>concrete</em> classes.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> must be declared abstract if it owns or
inherits one or more abstract members and neither C nor any interfaces
implemented by C implements these members. 
A concrete class has to, therefore, implement all abstract members of its superclasses’
implemented interfaces. Note that a class may implement fields with
field accessors and vice versa. </p>
</li>
<li>
<p>An abstract class may not be instantiated. </p>
</li>
<li>
<p>An abstract class cannot be set to final (with annotation @Final).</p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-553" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-553</a>
<a href="https://jira.numberfour.eu/browse/IDE-553" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-553</a>
<a href="https://jira.numberfour.eu/browse/IDE-148" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-148</a>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A member declared as abstract must not have a method body (in
contrary a method not declared as abstract have to have a method body). </p>
</li>
<li>
<p>Only methods, getters and setters can be declared as abstract
(fields cannot be abstract). </p>
</li>
<li>
<p>It is not possible to inherit from an abstract class which contains
abstract members which are not visible in the subclass.</p>
</li>
<li>
<p>An abstract member cannot be set to final (with annotation @Final). </p>
</li>
<li>
<p>Static members may not be declared abstract.</p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-553" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-553</a>
<a href="https://jira.numberfour.eu/browse/IDE-553" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-553</a>
<a href="https://jira.numberfour.eu/browse/IDE-553" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-553</a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_non_instantiable_classes"><a class="anchor" href="#_non_instantiable_classes"></a>5.3.5. Non-Instantiable Classes</h4>
<div class="paragraph">
<p>To make a class non-instantiable outside a defining compilation unit,
i.e. disallow creation of instances for this class, simply declare the
constructor as private.  This can be used for singletons.</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-149" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-149</a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_superclass"><a class="anchor" href="#_superclass"></a>5.3.6. Superclass</h4>
<div class="paragraph">
<p>47Superclass For a class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> with a supertype
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi><mo>=</mo><mi>C</mi><mo>.</mo><mi>s</mi><mi>u</mi><mi>p</mi></math>, the following constraints must hold</p>
</div>
<div class="ulist">
<ul>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi><mo>.</mo><mi>s</mi><mi>u</mi><mi>p</mi></math> must reference a class declaration <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math></p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> must be be extendable in the project of
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math></p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi><mo>∉</mo><mi>C</mi><mo>.</mo><mi>s</mi><mi>u</mi><msup><mi>p</mi><mo>+</mo></msup></math></p>
</li>
<li>
<p>All abstract members in <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> must be accessible from
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><mi>M</mi><mo>∈</mo><mi>S</mi><mo>.</mo><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>:</mi><mi>M</mi><mo>.</mo><mi>a</mi><mi>b</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mo>⇒</mo></math>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> is accessible from <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math><br>
(note that <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> need not be an owned member of
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> and that this constraint applies even if <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>
is abstract).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All members of superclasses become members of a class. This is true even
if the owning classes are not directly accessible to a class. The
member-specific access control is not changed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_interfaces"><a class="anchor" href="#_interfaces"></a>5.4. Interfaces</h3>
<div class="paragraph">
<p>   </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-12" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-12</a>
<a href="https://jira.numberfour.eu/browse/IDE-169" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-169</a>
<a href="https://jira.numberfour.eu/browse/IDE-328" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-328</a>
<a href="https://jira.numberfour.eu/browse/IDE-1236" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1236</a>
</div>
</div>
<div class="sect3">
<h4 id="_definition_of_interfaces"><a class="anchor" href="#_definition_of_interfaces"></a>5.4.1. Definition of Interfaces</h4>
<div class="sect4">
<h5 id="interfaces-syntax"><a class="anchor" href="#interfaces-syntax"></a>Syntax</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-8" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-8</a>
</div>
</div>
<div class="listingblock">
<div class="title">Syntax N4 Interface Declaration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">N4InterfaceDeclaration &lt;Yield&gt;:
    =&gt; (
        {N4InterfaceDeclaration}
        annotations+=Annotation*
        (declaredModifiers+=N4Modifier)*
        'interface' typingStrategy=TypingStrategyDefSiteOperator? name=BindingIdentifier&lt;Yield&gt;?
    )
    TypeVariables?
    InterfaceImplementsList?
    Members&lt;Yield&gt;
;

fragment InterfaceImplementsList*:
    'implements' superInterfaceRefs+=ParameterizedTypeRefNominal
        (',' superInterfaceRefs+=ParameterizedTypeRefNominal)*
;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="interfaces-properties"><a class="anchor" href="#interfaces-properties"></a>Properties</h5>
<div class="paragraph">
<p>These are the additional properties of interfaces, which can be
specified by the user:</p>
</div>
<div class="paragraph">
<p>Collection of interfaces extended by this interface; empty by default.
Instead of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mi>u</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi><mi>s</mi></math>, we simply write
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi><mi>s</mi></math>.</p>
</div>
</div>
<div class="sect4">
<h5 id="interfaces-type-inference"><a class="anchor" href="#interfaces-type-inference"></a>Type Inference</h5>
<div class="paragraph">
<p>The type of an interface declaration <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math> is of type <code>I</code>:</p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>I</mi><mi>:</mi><mrow><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>I</mi></mrow></mrow><mrow/></math></p>
</div>
</div>
<div class="sect4">
<h5 id="interfaces-semantics"><a class="anchor" href="#interfaces-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>Interfaces are used to describe the public <a href="#AC">API</a> of a classifier. The main
requirement is that the instance of an interface, which must be an
instance of a class since interfaces cannot have instances, provides all
members declared in the interface. Thus, a (concrete) class implementing
an interface must provide implementations for all the fields, methods,
getters and setters of the interface (otherwise it the class must be
declared abstract). The implementations have to be provided either
directly in the class itself, through a superclass, or by the interface
if the member has a default implementation.</p>
</div>
<div class="paragraph">
<p>A field declaration in an interface denotes that all implementing
classes can either provide a field of the same name and the same(!) type
or corresponding field accessors. If no such members are defined in the
class or a (transitive) superclass, the field is mixed in from the
interface automatically. This is also true for the initializer of the
field.</p>
</div>
<div class="paragraph">
<p>All instance methods, getters and setters declared in an interface are
implicitly abstract if they do not provide a default implementation. The
modifier <code>abstract</code> is not required, therefore, in the source code. The following
constraints apply:</p>
</div>
<div class="paragraph">
<p>For any interface <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math>, the following must hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Interfaces may not be instantiated.</p>
</li>
<li>
<p>Interfaces cannot be set to final (with annotation @Final):
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>¬</mo><mi>I</mi><mo>.</mo><mi>f</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi></math>.</p>
</li>
<li>
<p>Members of an interface must not be declared private. The default
access modifier in interfaces is the the type’s visibility or , if the
type’s visibility is .</p>
</li>
<li>
<p>Members of an interface, except methods, must not be declared :
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>∀</mo><mi>m</mi><mo>∈</mo><mi>I</mi><mo>.</mo><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>:</mi><mi>m</mi><mo>.</mo><mi>f</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi><mo>⇒</mo><mi>m</mi><mo>∈</mo><mi>I</mi><mo>.</mo><mi>m</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi><mi>s</mi></math> (note: not allowing field accessors to be declared
final was a deliberate decision, because it would complicate the
internal handling of member redefinition; might be reconsidered at a
later time)</p>
</li>
<li>
<p>The literal may not be used in the initializer expression of a field
of an interface.<br>
This restriction is required, because the order of implementation of
these fields in an implementing class cannot be guaranteed. This applies
to both instance and static fields in interfaces, but in case of static
fields, <code>this</code> is also disallowed due to <a href="#StaticMembersOfInterfaces">[StaticMembersOfInterfaces]</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It is possible to declare members in interfaces with a smaller
visibility as the interface itself. In that case, clients of the
interface may be able to use the interface but not to implement it.</p>
</div>
<div class="paragraph">
<p>In order to simplify modeling of runtime types, such as elements,
interfaces do not only support the notation of static methods but
constant data fields as well. Since <a href="#AC">IDL</a> [<a href="#OMG14a">OMG14a</a>] is used to describe these elements in specifications (and mapped to JavaScript via rules described in [<a href="#W3C12a">W3C12a</a>])
constant data fields are an often-used technique there and they can be
modeled in N4JS 1:1.</p>
</div>
<div class="paragraph">
<p>As specified in <a href="#Defining and Calling Constructors">[Defining and Calling Constructors]</a>, interfaces
cannot contain a constructor i.e.
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><mi>m</mi><mo>∈</mo><mi>I</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi><mi>s</mi><mi>:</mi><mi>m</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><msup><mo>≠</mo><mi>'</mi></msup><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><msup><mi>r</mi><mi>'</mi></msup></math>.</p>
</div>
<div class="paragraph">
<p>[[ex:Simple Interfaces]]
The following example shows
the syntax for defining interfaces. The second interface extends the
first one. Note that methods are implicitly defined abstract in
interfaces.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">interface I {
    foo(): void
}
interface I2 extends I {
    someText: string;
    bar(): void
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a classifier <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> <em>implements</em> an interface
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math>, we say <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math> is <em>implemented</em> by
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>. If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> redefines members declared in
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math>, we say that these members are <em>implemented</em> by
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>. Members not redefined by <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> but with a
default implementations are <em>mixed in</em> or <em>consumed by</em> <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>.
We all cases we call <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>A the <em>implementor</em>.</p>
</div>
<div class="paragraph">
<p>Besides the general constraints described in , the following constraints
must hold for extending or implementing interfaces:</p>
</div>
<div class="paragraph">
<p>For a given type
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math>, and <math xmlns="http://www.w3.org/1998/Math/MathML"><mfenced close="}" open="{"><msub><mi>I</mi><mn>1</mn></msub><mrow><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi></mrow><msub><mi>I</mi><mi>n</mi></msub></mfenced></math> directly extended by
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math>, the following constraints must be true:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Only interfaces can extend interfaces:
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi><mo>,</mo><msub><mi>I</mi><mn>1</mn></msub><mo>,</mo><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi><mo>,</mo><msub><mi>I</mi><mi>n</mi></msub></math> must be interfaces.</p>
</li>
<li>
<p>An interface may not directly extend the same interface more than
once:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>I</mi><mi>i</mi></msub><mo>=</mo><msub><mi>I</mi><mi>j</mi></msub><mo>⇒</mo><mi>i</mi><mo>=</mo><mi>j</mi></math> for any
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mo>,</mo><mi>j</mi><mo>∈</mo><mfenced close="}" open="{"><mrow><mn>1.</mn><mo>.</mo><mi>n</mi></mrow></mfenced></math>.</p>
</li>
<li>
<p>An interface may (indirectly) extend the same interface
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>J</mi></math> more than once only if</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>J</mi></math> is not parameterized, or</p>
</li>
<li>
<p>in all cases <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>J</mi></math> is extended with the same type
arguments for all invariant type parameters.</p>
<div class="paragraph">
<p>Note: for type parameters of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>J</mi></math> that are declared covariant
or contravariant on definition site, different type arguments may be
used.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>All abstract members in <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>I</mi><mi>i</mi></msub></math>,
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mo>∈</mo><mfenced close="}" open="{"><mn>1</mn><mrow><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi></mrow><mi>n</mi></mfenced></math>, must be accessible from
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math>:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><mi>i</mi><mo>∈</mo><mfenced close="}" open="{"><mn>1</mn><mrow><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi></mrow><mi>n</mi></mfenced><mi>:</mi><mi>M</mi><mo>∈</mo><msub><mi>I</mi><mi>i</mi></msub><mo>.</mo><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo>∧</mo><mi>M</mi><mo>.</mo><mi>a</mi><mi>b</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mo>⇒</mo></math>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> is accessible from <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math><br>
(note that <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> need not be an owned member of
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>I</mi><mi>i</mi></msub></math>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>50Implementing Interfaces[req:Implementing_Interfaces] For a given type
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>, and <math xmlns="http://www.w3.org/1998/Math/MathML"><mfenced close="}" open="{"><msub><mi>I</mi><mn>1</mn></msub><mrow><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi></mrow><msub><mi>I</mi><mi>n</mi></msub></mfenced></math> directly implemented
by <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>, the following constraints must be true:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Only classes can implement interfaces: <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> must be a
Class.</p>
</li>
<li>
<p>A class can only implement interfaces: <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>I</mi><mn>1</mn></msub><mo>,</mo><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi><mo>,</mo><msub><mi>I</mi><mi>n</mi></msub></math>
must be interfaces.</p>
</li>
<li>
<p>A class may not directly implement the same interface more than
once:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>I</mi><mi>i</mi></msub><mo>=</mo><msub><mi>I</mi><mi>j</mi></msub><mo>⇒</mo><mi>i</mi><mo>=</mo><mi>j</mi></math> for any
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mo>,</mo><mi>j</mi><mo>∈</mo><mfenced close="}" open="{"><mrow><mn>1.</mn><mo>.</mo><mi>n</mi></mrow></mfenced></math>.</p>
</li>
<li>
<p>A class may (indirectly) implement the same interface
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>J</mi></math> more than once only if</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>J</mi></math> is not parameterized, or</p>
</li>
<li>
<p>in all cases <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>J</mi></math> is implemented with the same type
arguments for all invariant type parameters.</p>
<div class="paragraph">
<p>Note: for type parameters of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>J</mi></math> that are declared covariant
or contravariant on definition site, different type arguments may be
used.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>All abstract members in <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>I</mi><mi>i</mi></msub></math>,
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mo>∈</mo><mfenced close="}" open="{"><mn>1</mn><mrow><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi></mrow><mi>n</mi></mfenced></math>, must be accessible from
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><mi>i</mi><mo>∈</mo><mfenced close="}" open="{"><mn>1</mn><mrow><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi></mrow><mi>n</mi></mfenced><mi>:</mi><mi>M</mi><mo>∈</mo><msub><mi>I</mi><mi>i</mi></msub><mo>.</mo><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo>∧</mo><mi>M</mi><mo>.</mo><mi>a</mi><mi>b</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mo>⇒</mo></math>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> is accessible from <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math><br>
(note that <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> need not be an owned member of
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>I</mi><mi>i</mi></msub></math>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For default methods in interfaces, see .</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_generic_classifiers"><a class="anchor" href="#_generic_classifiers"></a>5.5. Generic Classifiers</h3>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-38" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-38</a>
<a href="https://jira.numberfour.eu/browse/IDE-39" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-39</a>
</div>
</div>
<div class="paragraph">
<p>Classifiers can be declared generic by defining a type parameter via .</p>
</div>
<div class="openblock definition">
<div class="content">
<div class="paragraph">
<p><strong>Definition:</strong> <a href="#generic_classifiers">Generic Classifiers</a></p>
</div>
<div class="paragraph">
<p>A generic classifier is a
classifier with at least one type parameter. That is, a given classifier
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> is generic if and only if
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>|</mo><mi>C</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>P</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>|</mo><mo>≥</mo><mn>1</mn></math>.</p>
</div>
<div class="paragraph">
<p>If a classifier does not define any type parameters, it is not generic,
even if its superclass or any implemented interface is generic.</p>
</div>
<div class="paragraph">
<p>The format of the type parameter expression is described in <a href="#_parameterized_types">Parameterized Types</a>. The type variable defined by the type parameter’s type expression can be used
just like a normal type inside the class definition.</p>
</div>
<div class="paragraph">
<p>If using a generic classifier as type of a variable, it may be
parameterized. This is usually done via a type expression (cf.
<a href="#sec:Parameterized_Types">[sec:Parameterized_Types]</a>) or via <code>type-arg</code> in case of supertypes. If a generic
classifier defines multiple type variables, these variables are bound in
the order of their definition. In any case, all type variables have to
be bound. That means in particular that raw types are not allowed. (cf <a href="#Parametrized_Types">[Parametrized_Types]</a> for details).</p>
</div>
<div class="paragraph">
<p>If a generic classifier is used as super classifier, the type arguments
can be type variables. Note that the type variable of the super
classifier is not lifted, that is to say that all type variables are to
be explicitly bound in the type references used in the <code>extend</code>, <code>with</code>, or <code>implements</code> section using <code>type-arg</code>. If a type variable is used in to bound a type variable of a type parameter, it has to fulfil possible type constraints (upper/lower
bound) specified in the type parameter.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
This example demonstrates how to define a generic type and how to refer to it in a
variable definition.
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>export class Container&lt;T&gt; {
    private item: T;

    getItem(): T {
        return this.item;
    }

    setItem(item: T): void {
        this.item = item;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This type can now be used as a type of a variable as follows</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">import Container from "p/Container"

var stringContainer: Container&lt;string&gt; = new Container&lt;string&gt;();
stringContainer.setItem("Hello");
var s: string = stringContainer.getItem();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In line 3, the type variable <code>T</code> of the generic class <code>Container</code> is bound to <code>string</code>.</p>
</div>
<div class="paragraph">
<p>[Binding of type variables with multiple types] For a given generic
class <code>G</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class A{}
class B{}
class C extends A{}

class G&lt;S, T extends A, U extends B&gt; {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>the variable definition</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var x: G&lt;Number,C,B&gt;;</code></pre>
</div>
</div>
<div class="paragraph">
<p>would bind the type variables as follows:<br></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>S</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Number</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Bound by first type argument, no bound constraints defined for <code>S</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>T</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>C</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Bound by second type argument, <code>C</code> must be a subtype of in order to fulfill the type constraint.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>U</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>B</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Bound by third type argument, <code>extends</code> is reflexive, that is <code>B</code> fulfills the
type constraint.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For a given generic superclass <code>SuperClass</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class SuperClass&lt;S, T extends A, U extends B&gt; {};</code></pre>
</div>
</div>
<div class="paragraph">
<p>and a generic subclass <code>SubClass</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class SubClass&lt;X extends A&gt; extends SuperClass&lt;Number, X, B&gt; {..};</code></pre>
</div>
</div>
<div class="paragraph">
<p>the variable definition</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var s: SubClass&lt;C&gt;;</code></pre>
</div>
</div>
<div class="paragraph">
<p>would bind the type variables as follows:<br></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">TypeVariable</th>
<th class="tableblock halign-center valign-top">Bound to</th>
<th class="tableblock halign-center valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>SuperClass.S</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Number</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type variable <code>s</code> of supertype <code>SuperClass</code> is bound to <code>Number</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>SuperClass.T</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>SubClass.X=C</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type variable <code>T</code> of supertype <code>SuperClass</code> is bound to type variable <code>X</code> of <code>SubClass</code>. It gets
then indirectly bound to <code>C</code> as specified by the type argument of the
variable definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>SuperClass.U</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>B</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type variable <code>U</code> of supertype <code>SuperClass</code> is auto-bound to <code>C</code> as no explicit binding for the third type variable is specified.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>SubClass.X</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>C</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bound by first type argument specified in variable definition.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_definition_site_variance"><a class="anchor" href="#_definition_site_variance"></a>5.6. Definition-Site Variance</h3>
<div class="paragraph">
<p>In addition to use-site declaration of variance in the form of Java-like
wildcards, N4JS provides support for definition-site declaration of
variance as known from languages such as C# and Scala.</p>
</div>
<div class="paragraph">
<p>The <em>variance</em> of a parameterized type states how its subtyping relates
to its type arguments’ subtyping. For example, given a parameterized
type and plain types and , we know</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if <code>G</code> is <strong>covariant</strong> w.r.t. its parameter <code>T</code>, then
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>B</mi><mi>A</mi><mo>⇒</mo><mrow><mi>G</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>B</mi><mi>g</mi><mi>t</mi><mi>;</mi></mrow><mrow><mi>G</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>A</mi><mi>g</mi><mi>t</mi><mi>;</mi></mrow></math></p>
</li>
<li>
<p>if <code>G</code> is <strong>contravariant</strong> w.r.t. its parameter <code>T</code>, then
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>B</mi><mi>A</mi><mo>⇒</mo><mrow><mi>G</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>A</mi><mi>g</mi><mi>t</mi><mi>;</mi></mrow><mrow><mi>G</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>B</mi><mi>g</mi><mi>t</mi><mi>;</mi></mrow></math></p>
</li>
<li>
<p>if <code>G</code> is <strong>invariant</strong> w.r.t. its parameter <code>T</code>, then
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>B</mi><mi>A</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>⇒</mo><mrow><mi>G</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>A</mi><mi>g</mi><mi>t</mi><mi>;</mi></mrow><mrow><mi>G</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>B</mi><mi>g</mi><mi>t</mi><mi>;</mi></mrow><mtext>
</mtext><mi>B</mi><mi>A</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>⇒</mo><mrow><mi>G</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>A</mi><mi>g</mi><mi>t</mi><mi>;</mi></mrow><mrow><mi>G</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>B</mi><mi>g</mi><mi>t</mi><mi>;</mi></mrow></math></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that variance is declared per type parameter, so a single
parameterized type with more than one type parameter may be, for
example, covariant w.r.t. one type parameter and contravariant
w.r.t. another.</p>
</div>
<div class="paragraph">
<p>Strictly speaking, a type parameter/variable itself is not co- or
contravariant; however, for the sake of simplicity we say " <code>T</code> is
covariant" as a short form for "<code>G</code> is covariant with respect to its type
parameter <code>T</code> " (for contravariant and invariant accordingly).</p>
</div>
<div class="paragraph">
<p>To declare the variance of a parameterized classifier on definition
site, simply add keyword <code>in</code> or <code>out</code> before the corresponding type parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class ReadOnlyList&lt;out T&gt; { // covariance
    // ...
}

interface Consumer&lt;in T&gt; { // contravariance
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In such cases, the following constraints apply.</p>
</div>
<div class="paragraph">
<p>Given a parameterized type with a type parameter , the following must hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>T</code> may only appear in variance-compatible positions:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>if <code>T</code> is declared on definition site to be <strong>covariant</strong>, then it may
only appear in covariant positions within the type’s non-private member
declarations.</p>
</li>
<li>
<p>if <code>T</code> is declared on definition site to be <strong>contravariant</strong>, then it
may only appear in contravariant positions within the type’s non-private
member declarations.</p>
</li>
<li>
<p>if <code>T</code> is <strong>invariant</strong>, i.e. neither declared covariant nor declared
contravariant on definition site, then it may appear in any position
(where type variables are allowed).</p>
<div class="paragraph">
<p>Thus, no restrictions apply within the declaration of private members
and within the body of field accessors and methods.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>definition-site variance may not be combined with incompatible
use-site variance:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>if <code>T</code> is declared on definition site to be <strong>covariant</strong>, then no
wildcard with a <strong>lower</strong> bound may be provided as type argument for <code>T</code>.</p>
</li>
<li>
<p>if <code>T</code> is declared on definition site to be <strong>contravariant</strong>, then no
wildcard with an <strong>upper</strong> bound may be provided as type argument for <code>T</code>.</p>
</li>
<li>
<p>if <code>T</code> is <strong>invariant</strong>, i.e. neither declared covariant nor declared
contravariant on definition site, then any kind of wildcard may be
provided as type argument.</p>
<div class="paragraph">
<p>Unbounded wildcards are allowed in all cases.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="content">
For illustration purposes, let’s compare use-site and definition-site
declaration of variance. Since use-site variance is more familiar to the
Java developer, we start with this flavor.
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class Person {
    name: string;
}
class Employee extends Person {}

interface List&lt;T&gt; {
    add(elem: T)
    read(idx: int): T
}

function getNameOfFirstPerson(list: List&lt;? extends Person&gt;): string {
    return list.read(0).name;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Function <code>getNameOfFirstPerson</code> below takes a list and returns the name of the first person in
the list. Since it never adds new elements to the given list, it could
accept <code>List</code>s of any subtype of <code>Person</code>, for example a <code>List&lt;Employee&gt;</code>. To allow this, its formal
parameter has a type of <code>List&lt;? extends Person&gt;</code> instead of <code>List&lt;Person&gt;</code>. Such use-site variance is useful whenever an invariant type, like <code>List</code> above, is being used in a way such that it can be treated as if it were co- or contravariant.</p>
</div>
<div class="paragraph">
<p>Sometimes, however, we are dealing with types that are inherently
covariant or contravariant, for example an <code>ImmutableList</code> from which we can only read elements would be covariant. In such a case, use-site declaration of
variance is tedious and error-prone: we would have to declare the
variance wherever the type is being used and would have to make sure not
to forget the declaration or otherwise limit the flexibility and
reusability of the code (for example, in the above code we could not
call <code>getNameOfFirstPerson</code> with a <code>List&lt;Employee&gt;</code>).</p>
</div>
<div class="paragraph">
<p>The solution is to declare the variance on declaration site, as in the
following code sample:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">interface ImmutableList&lt;out T&gt; {
//  add(elem: T)  // error: such a method would now be disallowed
    read(idx: int): T
}

function getNameOfFirstPerson2(list: ImmutableList&lt;Person&gt;): string {
    return list.read(0).name;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can invoke <code>getNameOfFirstPerson2</code> with a <code>List&lt;Employee&gt;</code> even though the implementor of <code>getNameOfFirstPerson2</code> did not add a
use-site declaration of covariance, because the type <code>ImmutableList</code> is declared to be covariant with respect to its parameter <code>T</code>, and this applies globally
throughout the program.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_members"><a class="anchor" href="#_members"></a>6. Members</h2>
<div class="sectionbody">
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-12" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-12</a>
<a href="https://jira.numberfour.eu/browse/IDE-381" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-381</a>
</div>
</div>
<div class="paragraph">
<p>A member is either a method (which may be a special constructor
function), a data field, or a getter or a setter. The latter two
implicitly define an accessor field. Similar to object literals, there
must be no data field with the same name as a getter or setter.</p>
</div>
<div class="paragraph">
<p>Redefinition of members (overriding, implementation and consumption) is
described in .</p>
</div>
<div class="sect2">
<h3 id="_syntax_4"><a class="anchor" href="#_syntax_4"></a>6.1. Syntax</h3>
<div class="listingblock">
<div class="title">Syntax N4JS member access modifier</div>
<div class="content">
<pre class="highlightjs highlight"><code>enum N4JSMemberAccessModifier: private | project | protected | public;

N4MemberDeclaration: N4MethodDeclaration | N4FieldDeclaration | N4GetterDeclaration | N4SetterDeclaration;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_properties_3"><a class="anchor" href="#_properties_3"></a>6.1.1. Properties</h4>
<div class="paragraph">
<p>Members share the following properties:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>annotations</code> </dt>
<dd>
<p>Arbitrary annotations, see <a href="#_annotations">Annotations</a> for details.</p>
</dd>
<dt class="hdlist1"><code>accessModifier$</code> </dt>
<dd>
<p>N4JS member access modifier: <code>private</code>, <code>project</code>, <code>potected</code>, or <code>public</code>; the latter two can be combined with <code>@Internal</code>; default is <code>project</code> for classes and private interfaces. For a non-private interface defaults to the interface’s visibility. task:IDE-84[]</p>
</dd>
<dt class="hdlist1"><code>name</code> </dt>
<dd>
<p>The simple name of the member, that is an identifier name (cf. <a href="#Valid_Names">[Valid_Names]</a>).</p>
</dd>
<dt class="hdlist1"><code>static</code> </dt>
<dd>
<p>Boolean property to distinguish instance from classifier members, see <a href="#_static_members">Static Members</a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following pseudo properties are defined via annotations:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>deprecated</code> </dt>
<dd>
<p>Boolean property set to true if annotation <code>@Deprecated</code> is set.
task:IDE-138[]</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>And we additionally define the following pseudo properties:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>acc</code> </dt>
<dd>
<p>Member access modifier as described in <a href="#Accessibility_of_Members">[Accessibility_of_Members]</a>, it is the aggregated value of
the <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>M</mi><mi>o</mi><mi>d</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>r</mi></math> and the <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mi>x</mi><mi>p</mi><mi>o</mi><mi>r</mi><mi>t</mi></math> property.</p>
</dd>
<dt class="hdlist1"><code>owner</code> </dt>
<dd>
<p>Owner classifier of the member.</p>
</dd>
<dt class="hdlist1"><code>typeRef</code> </dt>
<dd>
<p>Type of the member—this is the type of a field or the type of the method
which is a function type (and not the return type).</p>
</dd>
<dt class="hdlist1"><code>assignability</code> </dt>
<dd>
<p>Enumeration, may be one of the following values:<br></p>
<div class="paragraph">
<p><code>set</code>:  Member may only be set, i.e. it could only be used on the left hand
  side of an assignment.<br></p>
</div>
<div class="paragraph">
<p><code>get</code>:
  Member may only be retrieved, i.e. it could only be used on the right
  hand side of an assignment. This is the default setting for methods.</p>
</div>
<div class="paragraph">
<p><code>any</code>:
  Member may be set or retrieved, i.e. it could only be used on the left
  or right hand side of an assignment. This is the default setting for
  fields.</p>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title"></div>
</td>
<td class="content">
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>a</mi><mi>b</mi><mi>i</mi><mi>l</mi><mi>i</mi><mi>t</mi><mi>y</mi></math> is related but not equal to
writable modifiers used for fields. We define a partial order on this
enumeration as follows: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>l</mi><mi>t</mi><mi>;</mi><mfenced close=")" open="("><mi>l</mi><mi>r</mi></mfenced><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>:</mi><mi>:</mi><mo>=</mo><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mfenced close="}" open="{"><mfenced close=")" open="("><mrow><mi>s</mi><mi>e</mi><mi>t</mi></mrow><mrow><mi>a</mi><mi>n</mi><mi>y</mi></mrow></mfenced><mfenced close=")" open="("><mrow><mi>g</mi><mi>e</mi><mi>t</mi></mrow><mrow><mi>a</mi><mi>n</mi><mi>y</mi></mrow></mfenced></mfenced></math>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>abstract</code> </dt>
<dd>
<p>All members have a flag <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mi>b</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi></math>, which is user-defined
for methods, getters and setter, but which is always false for fields.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following pseudo property is set to make fields compatible with
properties of an object literal, however it cannot be changed:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>configurable</code> </dt>
<dd>
<p>Boolean flag reflecting the property descriptor
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mi>o</mi><mi>n</mi><mi>f</mi><mi>i</mi><mi>g</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi></math>, this is always set to false for members.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_semantics_3"><a class="anchor" href="#_semantics_3"></a>6.1.2. Semantics</h4>
<div class="paragraph">
<p>The members of a given classifier <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> must be named such
that the following constraints are met:</p>
</div>
<div class="paragraph">
<p> 
1.  No two members may have the same name, except one is static and the
other is non-static:
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><msub><mi>m</mi><mn>1</mn></msub><mo>,</mo><msub><mi>m</mi><mn>2</mn></msub><mo>∈</mo><mi>C</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo>,</mo><msub><mi>m</mi><mn>1</mn></msub><mo>≠</mo><msub><mi>m</mi><mn>2</mn></msub><mi>:</mi><msub><mi>m</mi><mn>1.</mn></msub><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>≠</mo><msub><mi>m</mi><mn>2.</mn></msub><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>∨</mo><msub><mi>m</mi><mn>1.</mn></msub><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mo>≠</mo><msub><mi>m</mi><mn>2.</mn></msub><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi></math>
2.  The member name must be a valid identifier name, see .</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-550" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-550</a>
<a href="https://jira.numberfour.eu/browse/IDE-551" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-551</a>
</div>
</div>
<div class="paragraph">
<p>Thus, over_loading_ of methods is not supported <sup class="footnote">[<a id="_footnoteref_30" class="footnote" href="#_footnote_30" title="View footnote.">30</a>]</sup> and no field
may have the same name as a method. However, over_riding_ of methods,
getters, and setters are possible, see <a href="#_redefinition_of_members">Redefinition of Members</a>. Static members may also have the same name as non-static members
<sup class="footnote">[<a id="_footnoteref_31" class="footnote" href="#_footnote_31" title="View footnote.">31</a>]</sup>, <code>ClassBody : ClassElementList</code> indicates that it is possible to have the same name for instance and static members.].</p>
</div>
<div class="paragraph">
<p>The dollar character <code>$</code> is not allowed for user-defined member
identifier, as the dollar sign is used for rewriting private members.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_methods"><a class="anchor" href="#_methods"></a>6.2. Methods</h3>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-8" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-8</a>
<a href="https://jira.numberfour.eu/browse/IDE-12" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-12</a>
</div>
</div>
<div class="paragraph">
<p>Methods are simply JavaScript functions. They are defined
similarly to methods as proposed in [<a href="#ECMA15a">ECMA15a(p.S13.5)</a>] except for the type information
and some modifiers.</p>
</div>
<div class="sect3">
<h4 id="_syntax_5"><a class="anchor" href="#_syntax_5"></a>6.2.1. Syntax</h4>
<div class="listingblock">
<div class="title">Syntax Method Declaration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">N4MethodDeclaration &lt;Yield&gt;:
    =&gt; ({N4MethodDeclaration}
        annotations+=Annotation*
        accessModifier=N4JSMemberAccessModifier?
        (abstract?=’abstract’ | static?=’static’)?
        TypeVariables?
        (
                generator?='*' LiteralOrComputedPropertyName&lt;Yield&gt; -&gt; MethodParamsReturnAndBody &lt;Generator=true&gt;
            |   AsyncNoTrailingLineBreak LiteralOrComputedPropertyName&lt;Yield&gt; -&gt; MethodParamsReturnAndBody &lt;Generator=false&gt;
        )
    ) ';'?
;

fragment MethodParamsAndBody &lt;Generator&gt;*:
    StrictFormalParameters&lt;Yield=Generator&gt;
    (body=Block&lt;Yield=Generator&gt;)?
;

fragment MethodParamsReturnAndBody &lt;Generator&gt;*:
    StrictFormalParameters&lt;Yield=Generator&gt;
    (':' returnTypeRef=TypeRef)?
    (body=Block&lt;Yield=Generator&gt;)?
;

fragment LiteralOrComputedPropertyName &lt;Yield&gt;*:
    name=IdentifierName | name=STRING | name=NumericLiteralAsString
    | '[' (=&gt;((name=SymbolLiteralComputedName&lt;Yield&gt; | name=StringLiteralAsName) ']') | computeNameFrom=AssignmentExpression&lt;In=true,Yield&gt; ']')
;

SymbolLiteralComputedName &lt;Yield&gt;:
    BindingIdentifier&lt;Yield&gt; ('.' IdentifierName)?
;

BindingIdentifier &lt;Yield&gt;:
    IDENTIFIER
    | &lt;!Yield&gt; 'yield'
    | N4Keyword
;

IdentifierName: IDENTIFIER | ReservedWord | N4Keyword;
NumericLiteralAsString: DOUBLE | INT | OCTAL_INT | HEX_INT | SCIENTIFIC_INT;
StringLiteralAsName: STRING;

// see ~\autoref{sec:Asynchronous_Functions}~
fragment AsyncNoTrailingLineBreak *: (declaredAsync?='async' NoLineTerminator)?;

fragment StrictFormalParameters &lt;Yield&gt;*:
    '(' (fpars+=FormalParameter&lt;Yield&gt; (',' fpars+=FormalParameter&lt;Yield&gt;)*)? ')'
;

FormalParameter &lt;Yield&gt;:
    {FormalParameter} BindingElementFragment&lt;Yield&gt;
;

fragment BindingElementFragment &lt;Yield&gt;*:
    (=&gt; bindingPattern=BindingPattern&lt;Yield&gt;
    | annotations+=Annotation*
        (
            variadic?='...'? name=BindingIdentifier&lt;Yield&gt; ColonSepTypeRef?
        )
    )
    ('=' initializer=AssignmentExpression&lt;In=true, Yield&gt;)?
;

fragment ColonSepTypeRef*:
    ':' declaredTypeRef=TypeRef
;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_properties_4"><a class="anchor" href="#_properties_4"></a>6.2.2. Properties</h4>
<div class="paragraph">
<p>Methods have all the properties of members and the following additional
properties can be explicitly defined:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>abstract</code> </dt>
<dd>
<p>Method is declared but not defined.</p>
</dd>
<dt class="hdlist1"><code>typePars</code> </dt>
<dd>
<p>Collection of type parameters of a generic method; empty by default.</p>
</dd>
<dt class="hdlist1"><code>returnTypeRef</code> </dt>
<dd>
<p>Return type of the method, default return type is
<math xmlns="http://www.w3.org/1998/Math/MathML"><mstyle mathvariant="italic"><mi>V</mi><mi>o</mi><mi>i</mi><mi>d</mi></mstyle></math>. The type of the method as a member of the
owning classifier is not the method’s return type but is instead a
function type.</p>
</dd>
<dt class="hdlist1"><code>fpars</code> </dt>
<dd>
<p>List of formal parameters, may be left empty.</p>
</dd>
<dt class="hdlist1"><code>body</code> </dt>
<dd>
<p>The body of the method (this is not available in the pure types model)</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following pseudo properties are defined via annotations:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>final</code> </dt>
<dd>
<p>Boolean flag set to true if annotation <code>@Final</code> is set. Flag indicates that
method must not be overridden in subclasses; see <a href="#Final_Methods">[Final_Methods]</a>.</p>
</dd>
<dt class="hdlist1"><code>declaresOverride</code> </dt>
<dd>
<p>Flag set to true if annotation <code>@Overrides</code> is set. Flag indicates that method must
override a method of a superclass; see , .</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Additionally, we define the following pseudo properties:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>overrides</code> </dt>
<dd>
<p>True if method overrides a super method or implements an interface
method, false otherwise.</p>
</dd>
<dt class="hdlist1"><code>typeRef</code> </dt>
<dd>
<p>Type of the method. This is, in fact, a function type (and not the
return type).</p>
</dd>
<dt class="hdlist1"><code>enumerable</code> </dt>
<dd>
<p>The following pseudo property is set to make methods compatible with
properties of an object literal, however it cannot be changed:</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Boolean flag reflecting the property descriptor
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mi>n</mi><mi>u</mi><mi>m</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi></math>, this is always set to false for methods.</p>
</div>
</div>
<div class="sect3">
<h4 id="_semantics_4"><a class="anchor" href="#_semantics_4"></a>6.2.3. Semantics</h4>
<div class="paragraph">
<p>Since methods are ECMAScript functions, all constraints specified in
<a href="#Function_Type">[Function_Type]</a> apply to methods as well. This section describes default values and
function type conformance which is required for overriding and
implementing methods.</p>
</div>
<div class="paragraph">
<p>In addition, method declarations and definitions have to comply with the
constraints for naming members of classifiers (cf. <a href="#Member_Names">[Member_Names]</a>)
and with the constraints detailed in the following sections on final
methods (<a href="#Final_Methods">[Final_Methods]</a>), abstract methods (<a href="#Abstract_Methods">[Abstract_Methods]</a>
and method overriding and implementation (<a href="#_overriding_of_members">Overriding of Members</a>, <a href="#_implementation_of_members">Implementation of Members</a>).</p>
</div>
<div class="paragraph">
<p>The following constraints are defined for methods in ECMAScript 6 [<a href="#ECMA15a">ECMA15a(p.207)</a>]</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>It is a Syntax Error if any element of the BoundNames of
StrictFormalParameters also occurs in the VarDeclaredNames of
FunctionBody.</code></p>
</li>
<li>
<p><code>It is a Syntax Error if any element of the BoundNames of
StrictFormalParameters also occurs in the LexicallyDeclaredNames of
FunctionBody.</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Methods – like functions – define a variable execution environment and
therefore provide access to the actual passed-in parameters through the
implicit variable inside of their bodies (c.f. <a href="#Arguments_Objects">[Arguments_Objects]</a>).</p>
</div>
<div class="paragraph">
<p>Methods are similar to function definitions but they must not be
assigned to or from variables. The following code issues an error
although the type of the method would be compatible to the type of the
variable :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class C {
    m(): void {}
}
var v: {function():void} = new C().m;</code></pre>
</div>
</div>
<div class="paragraph">
<p>54Method Assignment[req:Method_Assignment]</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Different from ECMAScript 2015, methods are defined as readonly,
that is, it is not possible to dynamically re-assign a property defined
as method with a new value. This is because assigning or re-assigning a
method breaks encapsulation. Methods are the <a href="#AC">API</a> of a class, their
implementation is internal to the class.</p>
</li>
<li>
<p>When assigning a method to a variable, a warning is issued since
this would lead to an detached this reference inside the method when it
is called without explicitly providing the receiver. No warning is
issued only if it is guaranteed that no problems will occur:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The method’s body can be determined at compile time (i.e., it has
been declared <code>@Final</code>) and it lacks usages of <code>this</code> or <code>super</code>. This is true for instance and static methods.</p>
</li>
<li>
<p>The method is the constructor. </p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/224" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-224</a>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title"></div>
</td>
<td class="content">
The following code demonstrates problems arising when
methods are assigned to variables in terms of function expressions.
Given are two classes and instances of each class as follows:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class C {
    m(): void { }
    static k(): void {}
}
class D extends C {
    @Override m(): void { this.f()}
    f(): void {}

    @Override static k(): void { this.f()}
    static f(): void {}
}
var c: C = new C();
var d: C = new D(); // d looks like a C</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assigning an instance method to a variable could cause problems, as the
method assumes this to be bound to the class in which it is defined.
This may work in some cases, but will cause problems in particular in
combination with method overriding:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>var v1: {@This(C)function():void} = c.m;
var v2: {@This(C)function():void} = d.m;

v1.call(c);
v2.call(c);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Calling <code>c.m</code> indirectly via <code>v1</code> with <code>c</code> as this object will work. However, it won’t
work for <code>v2</code>: the method is overridden in <code>D</code>, and the method in expects other
methods available in <code>D</code> but not in <code>C</code>. That is, the last call would lead to a
runtime error as method <code>f</code> which is called in <code>D.m</code> won’t be available.</p>
</div>
<div class="paragraph">
<p>The same scenario occurs in case of static methods if they are retrieved
polymorphically via the variables of type <code>constructor{C}</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var ctor: constructor{C} = C;
var dtor: constructor{C} = D;

var v3: {@This(constructor{C})function():void} = ctor.k;
var v4: {@This(constructor{C})function():void} = dtor.k;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In both cases, the problem could be solved by restricting these kinds of
assignments to final methods only. In the static case, the problem would
also be solved by accessing the static method directly via the class
type (and not polymorphically via the constructor). Both restrictions
are severe but would be necessary to avoid unexpected runtime problems.</p>
</div>
<div class="paragraph">
<p>The following example shows a problem with breaking the encapsulation of
a class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class C {
    x: any = "";
    f(): void { this.g(this); }
    g(c: C): void { c.h(); }
    h(): void {}
}
class D extends C {

    @Override f(): void {
        this.g(this.x);
    }
    @Override g(c: any) {
        // do nothing, do not call h())
    }
}

var c = new C();
var d = new D();

var v5: {@This(C)function():void} = c.f;
var v6: {@This(C)function():void} = d.f;

v5.call(c)
v6.call(c)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In <code>D</code>, method <code>g</code> is overridden to accept more types as the original method
defined in <code>C</code>. Calling this new method with receiver type <code>C</code> (as done in the
last line) will cause problems, as in <code>D</code> not only <code>f</code> has been adapted but also <code>g</code>. Eventually, this would lead to a runtime error as well.</p>
</div>
</div>
<div class="sect3">
<h4 id="_final_methods"><a class="anchor" href="#_final_methods"></a>6.2.4. Final Methods</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-157" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-157</a>
</div>
</div>
<div class="paragraph">
<p>By default, methods can be overridden. To prevent a method from being
overridden, it must be annotated with <code>@Final</code>.</p>
</div>
<div class="paragraph">
<p>Of course, a method cannot be declared both abstract and final
(cf. <a href="#Abstract_Member">[Abstract_Member]</a>). Private methods are implicitly declared
final. Because static methods can be overridden in subclasses (which is
different to Java), they also can be marked as final.</p>
</div>
<div class="paragraph">
<p>Default methods in interfaces, cf. <a href="#sec:Default_Methods_in_Interfaces">[sec:Default_Methods_in_Interfaces]</a>, may also be declared <code>@Final</code>.</p>
</div>
<div class="paragraph">
<p>If a method in an interface is provided with a body, it may be declared
final. This will ensure that the given method’s body will be in effect
for all instances of the interface. Note that this means that; (a) a
class implementing that interface must not define a method with the same
name and (b) a class inheriting a method of that name cannot implement
this interface. The latter case is illustrated here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">interface I {
    @Final m(): void {}
}

class C1 {
    m(): void {}
}

// error at "I": "The method C1.m cannot override final method I.m."
class C2 extends C1 implements I {
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_abstract_methods"><a class="anchor" href="#_abstract_methods"></a>6.2.5. Abstract Methods</h4>
<div class="paragraph">
<p>A method can be declared without defining it, i.e. without providing a
method body, and is then called an <em>abstract method</em>. Such methods
must be declared with modifier <code>abstract</code> and have their property
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mi>b</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi></math> set to true. Constraints for abstract methods are
covered in <a href="#Abstract_Member">[Abstract_Member]</a> (see <a href="#Abstract_Classes">[Abstract_Classes]</a>).</p>
</div>
<div class="paragraph">
<p>In interfaces, methods are always abstract by default and they do not
have to be marked as abstract. If a method in an interface provides a
body, then this is the default implementation. See <a href="#_implementation_of_members">Implementation of Members</a> about how the default implementation may be mixed in the consumer.</p>
</div>
</div>
<div class="sect3">
<h4 id="_generic_methods"><a class="anchor" href="#_generic_methods"></a>6.2.6. Generic Methods</h4>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-38" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-38</a>
<a href="https://jira.numberfour.eu/browse/IDE-39" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-39</a>
</div>
</div>
<div class="paragraph">
<p>Methods of generic classes can, of course, refer to the type variables
defined by type parameters of the generic class. These type variables
are used similarly to predefined or declared types. Additionally,
methods may be declared generic independently from their containing
class. That is to say that type parameters (with type variables) can be
defined for methods as well, just like for generic functions (see
<a href="#_generic_functions">Generic Functions</a>).</p>
</div>
<div class="paragraph">
<p>For a given generic method <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>m</mi></math> of a class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>, the following
constraint must hold:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><mi> </mi><mi>t</mi><msub><mi>p</mi><mi>m</mi></msub><mo>∈</mo><mi>m</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>P</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>,</mo><mi>t</mi><msub><mi>p</mi><mi>C</mi></msub><mo>∈</mo><mi>C</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>P</mi><mi>a</mi><mi>r</mi><mi>s</mi><mi>:</mi><mi>t</mi><msub><mi>p</mi><mi>m</mi></msub><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>≠</mo><mi>t</mi><msub><mi>p</mi><mi>C</mi></msub><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></math></p>
</div>
<div class="paragraph">
<p>Since type variables can be used similarly to types in the scope of a
generic class, a generic method may refer to a type variable of its
containing class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class C {
    &lt;T&gt; foo(p: T p): T { return p;}
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a generic type parameter is not used as a formal parameter type or
the return type, a warning is generated unless the method overrides a
member inherited from a super class or interface.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_default_methods_in_interfaces"><a class="anchor" href="#_default_methods_in_interfaces"></a>6.3. Default Methods in Interfaces</h3>
<div class="paragraph">
<p>If a method declared in an interface defines a body, then this is the
so-called <em>default implementation</em> and the method is called a <em>default
method</em>. This will be mixed into an implementor of the interface if,
and only if, neither the implementing class nor any of its direct or
indirect superclasses already provides an implementation for this
method; for details see <a href="#_member_consumption">Member Consumption</a>. Since the implementor is not known, some constraints exist for the body. I.e., no access to super is possible,
cf. <a href="#req:Access_Super_Member_with_Super_Literal">[req:Access_Super_Member_with_Super_Literal]</a>.</p>
</div>
<div class="paragraph">
<p>In order to declare an interface to provide a default implementation in
a definition file, annotation <code>@ProvidesDefaultImplementation</code> can be used, cf.
<a href="#req:External_class_interface_members">[req:External_class_interface_members]</a>.</p>
</div>
<div class="paragraph">
<p>When a method in an interface is provided with a default implementation,
it may even be declared <code>@Final</code>, see <a href="#Final_Methods">[Final_Methods]</a>.</p>
</div>
<div class="sect3">
<h4 id="_asynchronous_methods"><a class="anchor" href="#_asynchronous_methods"></a>6.3.1. Asynchronous Methods</h4>
<div class="paragraph">
<p>N4JS implements the async/await concept proposed for ECMAScript 7, which
provides a more convenient and readable syntax for writing asynchronous
code compared to using built-in type Promise directly. This concept can
be applied to methods in exactly the same way as to declared functions.
See <a href="#Asynchronous_Functions">[Asynchronous_Functions]</a> and <a href="#Asynchronous_Arrow_Functions">[Asynchronous_Arrow_Functions]</a> for details.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_constructors"><a class="anchor" href="#_constructors"></a>6.4. Constructors</h3>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-159" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-159</a>
</div>
</div>
<div class="paragraph">
<p>A constructor is a special function defined on a class which returns an
instance of that class. The constructor looks like a normal method with
name "constructor". The constructor can be defined explicitly or
implicitly and every class has an (implicit) constructor.</p>
</div>
<div class="paragraph">
<p>For a given a class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>, the constructor is available via
two properties:</p>
</div>
<div class="paragraph">
<p>the explicitly defined constructor (if any).</p>
</div>
<div class="paragraph">
<p>the explicit or implicit constructor.</p>
</div>
<div class="paragraph">
<p>If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> is provided with an explicit constructor, we have
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi><mo>.</mo><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo>=</mo><mi>C</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>C</mi><mi>t</mi><mi>o</mi><mi>r</mi></math> and
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>C</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo>∈</mo><mi>C</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi></math>. Note that
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi><mo>.</mo><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo>∉</mo><mi>C</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi><mi>s</mi></math> in all cases.</p>
</div>
<div class="paragraph">
<p>The return type of the constructor of a class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> is
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>. If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> has type parameters
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi><msub><mi>T</mi><mi>n</mi></msub></math>, then the return type is
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi><mi>l</mi><mi>t</mi><mi>;</mi><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub><mi>g</mi><mi>t</mi><mi>;</mi></math>. The constructor is called with the
operator. Since the return type of a constructor is implicitly defined
by the class, it is to be omitted. By this definition, a constructor
looks like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class C {
    public constructor(s: string) {
        // init something
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Constructors define a variable execution environment and therefore
provide access to the actual passed-in parameters through the implicit
variable inside of their bodies (c.f. <a href="#Arguments_Object">[Arguments_Object]</a>).</p>
</div>
<div class="paragraph">
<p>For a constructor <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></math> of a class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>, the following conditions
must hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></math> must neither be abstract nor static nor final and
it must not be annotated with <code>@Override</code>.</p>
</li>
<li>
<p>If a class does not explicitly define a constructor then the
constructor’s signature of the superclass constructor is assumed.</p>
</li>
<li>
<p>If a class defines a constructor with formal parameters then this
constructor has to be called explicitly in constructors defined in
subclasses.</p>
</li>
<li>
<p>If a super constructor is called explicitly, this call must be the
only expression of an expression statement which has to be the first
statement of the body.</p>
</li>
<li>
<p>Constructors may appear in interfaces, but some restrictions apply:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>constructors in interfaces must not have a body.</p>
</li>
<li>
<p>constructors in interfaces or their containing interface or one of
its direct or indirect super interfaces must be annotated with <code>@CovariantConstructor</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>A constructor must not have an explicit return type declaration.</p>
</li>
<li>
<p>The implicit return type of a constructor is <code>this?</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Properties of object literals may be called <code>constructor</code>. However they are not
recognized as constructors in these cases.</p>
</div>
<div class="paragraph">
<p>[[req:Initialization of Final Fields in the Constructor]]</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Required attributes must be initialized:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><mi>a</mi><mo>∈</mo><mi>C</mi><mo>.</mo><mi>a</mi><mi>t</mi><mi>t</mi><mi>r</mi><mi>:</mi><mi>a</mi><mo>.</mo><mi>r</mi><mi>e</mi><mi>q</mi><mi>u</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>d</mi><mo>∃</mo><mi>e</mi><mo>∈</mo><mi>r</mi><mo>.</mo><mi>e</mi><mi>l</mi><mi>e</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>s</mi><mi>:</mi><mi>a</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>e</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></math></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note on syntax: ECMAScript 6 defines constructors similarly, [<a href="#ECMA15a">ECMA15a(p.S13.5)</a>]. In
ECMAScript 6 the super constructor is not called automatically as well.</p>
</div>
<div class="paragraph">
<p>The super literal used in order to call super methods is further
described in <a href="#Super_keyword">[Super_keyword]</a>.</p>
</div>
<div class="sect3">
<h4 id="_structural_this_type_in_constructor_and_spec_parameter"><a class="anchor" href="#_structural_this_type_in_constructor_and_spec_parameter"></a>6.4.1. Structural This Type in Constructor and Spec Parameter</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-651" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-651</a>
</div>
</div>
<div class="paragraph">
<p>The use of a structural this reference as a formal parameter type is
possible only in constructors. This parameter can be annotated with <code>@Spec</code>
which causes the compiler to generate initialization code.</p>
</div>
<div class="paragraph">
<p>Simply using <code>$~~$this</code> as a type in the constructor causes the constructor to
require an object providing all public fields of the class for
initialization purposes. The fields have to be set manually as shown in
the following code snippet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class A{
    public s: string;
    public constructor(src: ~~this) {
        this.s = src.s;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remarks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The type of the formal parameter <code>this</code> refers to the
structural field type, see for details on structural typing. It contains
all public fields of the type.</p>
</li>
<li>
<p>Subclasses may override the constructor and introduce additional
parameters. They have to call the super constructor explicitly, however,
providing a parameter with at least all required attributes of the
superclass. Usually the type <code>this</code> is replaced with the actual subclass, but
in the case of a <code>super()</code> call the <code>this</code> type of structural formal parameters is
replaced with the <code>this</code> type of the superclass, hence only required fields of
the superclass must be present. </p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/262" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-262</a>
</div>
</div>
<div class="paragraph">
<p>As with other structural references, it is possible to add the
structural reference with additional structural members, which can be
used to initialize private fields which become not automatically part of
the structural field type. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class A{
    public s: string;
    private myPrivateNumber: number;
    public constructor(src: ~~this with { x: number; }) {
        this.s = src.s;
        this.myPrivateNumber = src.x;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Defining additional members may become a problem if a subclass defines
public fields with the same name, as the <code>$~~$this</code> type will contain these fields
in the subclass. This is marked as an error in the subclass.</p>
</div>
<div class="paragraph">
<p>
.Names of additional members of structural this type in constructor</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/81" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-81</a>
</div>
</div>
<div class="paragraph">
<p>If the structural this type is used in a constructor of a class
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>, and if this structural reference contains an additional
structural member <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi><mi>M</mi></math>, the following constraints must hold
true:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>For any subclass <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>, with
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi><mo>.</mo><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo>=</mo><mi>C</mi><mo>.</mo><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></math> (the subclass does not define its own
constructor), <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> must not contain a public member with same
name as <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi><mi>M</mi></math>: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>S</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>C</mi><mo>,</mo><mi>S</mi><mo>.</mo><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo>=</mo><mi>C</mi><mo>.</mo><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mi>M</mi><mo>∈</mo><mi>S</mi><mo>.</mo><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>:</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="5.0em"/><mi>M</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>=</mo><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow><mo>∧</mo><mi>M</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>S</mi><mi>M</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></math></p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> itself must not contain a public member with same
name as <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi><mi>M</mi></math>: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>M</mi><mo>∈</mo><mi>C</mi><mo>.</mo><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>:</mi><mi>M</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>=</mo><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow><mo>∧</mo><mi>M</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>S</mi><mi>M</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></math></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_field_name_conflicts_with_structural_member_name"><a class="anchor" href="#_field_name_conflicts_with_structural_member_name"></a>Field name conflicts with structural member name</h5>
<div class="paragraph">
<p>The situation described in <a href="#req:Fields_and_constructor_this_type_members">[req:Fields_and_constructor_this_type_members]</a> is
demonstrated in the following code fragment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class A {
    private myPrivateNumber: number;
    public constructor(src: ~~this with { x: number; }) {
        this.myPrivateNumber = src.x;
    }
}

class B extends A {
    public x: number; // will cause an error message
}</code></pre>
</div>
</div>
<div id="spec-style-constructor" class="dlist">
<dl>
<dt class="hdlist1">@Spec-style Constructor </dt>
<dd>
<p>The tedious process of copying the members of the parameter to the
fields of the class can be automated via the annotation if the argument
has <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mrow><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi></mrow></math> structural
initializer field typing. For more details about this typing can be
found in <a href="#sec:Structural_Read_only_Write_only_and_Initializer_Field_Typing">[sec:Structural_Read_only_Write_only_and_Initializer_Field_Typing]</a>. This can be used as shown in the following listing:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class A {
    public constructor(@Spec spec: ~i~this) {}
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_spec_style_constructor"><a class="anchor" href="#_spec_style_constructor"></a>Spec-style Constructor</h5>
<div id="req:Spec_style_Constructor" class="olist arabic">
<ol class="arabic">
<li>
<p>Annotation <code>@Spec</code> may only appear on a formal parameter of a constructor.</p>
</li>
<li>
<p>Only a single formal parameter of a constructor may be annotated
with  <code>@Spec</code>.</p>
</li>
<li>
<p>If a formal parameter is annotated with <code>@Spec</code>, the parameter’s type must
be <math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi></mrow></math> or
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mrow><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi></mrow></math> (i.e. use-site
structurally typed <math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi></mrow></math>).</p>
</li>
<li>
<p>Fields provided by the parameter, but not defined in the structural
field type, are <em>not</em> used to set fields.</p>
</li>
<li>
<p>Non-<code>public</code> fields explicitly added to the spec
parameter are copied as well. </p>
</li>
<li>
<p>Even if the <code>@Spec</code> annotation is used, the super constructor must be called
accordingly.</p>
</li>
<li>
<p>The type of an additional member which match owned non-public field
must be subtype of the field’s type: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>∀</mo><mi>s</mi><mo>∈</mo><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo>.</mo><mi>f</mi><mi>p</mi><mi>a</mi><mi>r</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>l</mi><mi>M</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo>,</mo><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo>.</mo><mi>f</mi><mi>p</mi><mi>a</mi><mi>r</mi><mo>.</mo><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>:</mi><mtext>
</mtext><mspace width="2.0em"/><mo>∃</mo><mi>f</mi><mo>∈</mo><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>r</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mi>s</mi><mo>⇒</mo><mi>s</mi><mi>f</mi></math></p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mrow><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi></mrow></math> constructor
ignores superfluous properties provided by an object literal. These
ignored properties are <em>not</em> used to set
non-<math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow></math> fields.</p>
</li>
<li>
<p>Since use-site structural initializer field types can be defined via
public, non-static, non-optional writable fields,
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mrow><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi></mrow></math> constructor accepts
those properties provided by an object literal which has the
corresponding readble fields. These properties will be initialzed.</p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/134" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-134</a>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_example_anonymous_interface_in_constructor"><a class="anchor" href="#_example_anonymous_interface_in_constructor"></a>Example: Anonymous Interface in Constructor</h5>
<div class="paragraph">
<p>The base class <code>A</code> in the examples redefines the constructor already defined in <code>N4Object</code>. This is not
generally necessary and is only used here to make the example legible.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class A {
    public s: string;
    public constructor(@Spec spec: ~i~this) {
        // initialization of s is automatically generated
    }
}
class B extends A {
    public t: string;
    private n: number;
    public constructor(spec: ~~this with {n: number;}) {
        super(spec);    // only inherited field s is set in super constructor
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_example_spec_object_and_subclasses"><a class="anchor" href="#_example_spec_object_and_subclasses"></a>Example: Spec Object and Subclasses</h5>
<div class="paragraph">
<p>[[ex:Spec Object and Subclasses]]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class A1 {
    public s: string;
    public n: number;
    public constructor(@Spec spec: ~i~this) {}
}
class B extends A1 {
    public constructor() {
        super({s:"Hello"}); // &lt;-- error, n must be set in object literal
    }
}
class C extends A1 {
    public constructor() {
        super({s:"Hello"}); // &lt;-- error, n must be set in object literal
        this.n = 10; // &lt;-- this has no effect on the super constructor!
    }
}

class A2 {
    public s: string;
    public n: number?; // now n is optional!
    public constructor(@Spec spec: ~i~this) {}
}
class D extends A2 {
    public constructor() {
        super({s:"Hello"}); // and this is ok now!
        this.n = 10; // this explains why it is optional
    }
}

class A3 {
    public s: string;
    public n: number = 10; // now n is not required in ~~this
    public constructor(@Spec spec: ~i~this) {}
}
class E extends A3 {
    public constructor() {
        super({s:"Hello"}); // and this is ok now!
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last case (class E) demonstrates a special feature of the typing
strategy modifier in combination with the <code>tihs</code> type, see <a href="#Structural_Typing">[Structural_Typing]</a> for details.</p>
</div>
<div class="paragraph">
<p>The constructor in class <code>B</code> contains an error because the super constructor
expects all required attributes in <code>A1</code> to be set. The additional
initialization of the required field <code>A1.n</code> as seen in <code>C</code> does not change that
expectation. In this example, the field <code>n</code> should not have been defined as
required in the first place.</p>
</div>
<div class="paragraph">
<p>Optional fields like <code>n?</code> in class <code>A2</code> or fields with default values like <code>n=10</code> in
class <code>A3</code> are not required to be part of the <code>spec</code> object.</p>
</div>
</div>
<div class="sect4">
<h5 id="_superfluous_properties_in_spec_style_constructor"><a class="anchor" href="#_superfluous_properties_in_spec_style_constructor"></a>Superfluous Properties in Spec-style Constructor]</h5>
<div class="paragraph">
<p>Each non-<math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow></math> field has to be set in the constructor
via the <math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>w</mi><mi>i</mi><mi>t</mi><mi>h</mi></mrow></math> to the parameter otherwise
properties are <em>not</em> used to set non-<math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow></math>
fields.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class C {
    public s: string;
    n: number;
    constructor(@Spec spec: ~i~this) {}
}

// n is ignored here
new C( { s: "Hello", n: 42 });

// but:
var ol = { s: "Hello", n: 42 };
// "ol may be used elsewhere, we cannot issue warning here" at "ol"
new C(ol) ;

// of course this is true for all superfluous properties
// weird is not used in constructor
new C( { s: "Hello", weird: true } );</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_callable_constructors"><a class="anchor" href="#_callable_constructors"></a>6.4.2. Callable Constructors</h4>

</div>
<div class="sect3">
<h4 id="_covariant_constructors"><a class="anchor" href="#_covariant_constructors"></a>6.4.3. Covariant Constructors</h4>
<div class="paragraph">
<p>Usually, the constructor of a subclass need not be override compatible
with the constructor of its super class. By way of annotation <code>@CovariantConstructor</code> it is
possible to change this default behavior and enforce all subclasses to
have constructors with override compatible signatures. A subclass can
achieve this by either inheriting the constructor from the super class
(which is usually override compatible, with the special case of <code>@Spec</code>
constructors) or by defining a new constructor with a signature
compatible to the inherited constructor. The same rules as for method
overriding apply.</p>
</div>
<div class="paragraph">
<p>The <code>@CovariantConstructor</code> annotation may be applied to the constructor, the containing
classifier, or both. It can also be used for interfaces; in fact,
constructors are allowed in interfaces only if they themselves or the
interface is annotated with <code>@CovariantConstructor</code> (see
<a href="#req:Defining_and_Calling_Constructors">Defining and CallingConstructors</a>).</p>
</div>
<div class="openblock definition">
<div class="content">
<div class="paragraph">
<p><strong>Definition:</strong> <a href="#covariant_constructor">Covariant Constructor</a></p>
</div>
<div class="paragraph">
<p>A classifier <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> is said to <code><em>have a covariant constructor</em></code> if and
only if one of the following applies:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> has a direct super class <math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>C</mi><mi>'</mi></msup></math> and
<math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>C</mi><mi>'</mi></msup></math> is annotated with <code>@CovariantConstructor</code> or <math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>C</mi><mi>'</mi></msup></math> has a constructor annotated with <code>@CovariantConstructor</code>.</p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> has a directly implemented interface <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math>
and <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math> is annotated with  <code>@CovariantConstructor</code> or <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math> has a
constructor annotated with <code>@CovariantConstructor</code>.</p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> has a direct super class or directly implemented
interface that <code><em>has a covariant constructor</em></code> (as defined here).</p>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> does not need to have an owned(!) constructor;
also a constructor inherited from a super class can be declared
covariant.</p>
</div>
<div class="paragraph">
<p>The following rules apply to covariant constructors.</p>
</div>
<div class="paragraph">
<p>Covariant Constructors</p>
</div>
<div id="req:Covariant_Constructors" class="olist arabic">
<ol class="arabic">
<li>
<p>Annotation <code>@CovariantConstructor</code> may only be applied to classes, interfaces, and
constructors. Annotating a constructor with this annotation, or its
containing classifier, or both have all the same effect.</p>
</li>
<li>
<p>Given a class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> with an owned constructor
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></math> and a super class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi><mi>u</mi><mi>p</mi></math> that has a
covariant constructor (owned or inherited, see ), then</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi><mi>u</mi><mi>p</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></math> must be accessible from
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>,</p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></math> must be override compatible with
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></math>: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>d</mi><mi>e</mi><mi>C</mi><mi>o</mi><mi>m</mi><mi>p</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>b</mi><mi>l</mi><mi>e</mi><mfenced close=")" open="("><mrow><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow><mrow><mi>S</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow></mfenced></math></p>
<div class="paragraph">
<p>This constraint corresponds to <a href="#req:Overriding_Members">[req:Overriding_Members]</a> except for the <code>Override</code>
annotation, which is not required, here.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Given a classifier <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> implementing interface
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math> and <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math> has a covariant constructor (owned
or inherited, see <a href="#def:Covariant_Constructors">[def:Covariant_Constructors]</a>), we require</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></math> must be accessible from <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>,</p>
</li>
<li>
<p>an implementation-compatible constructor <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></math> must be
defined in C with <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>d</mi><mi>e</mi><mi>C</mi><mi>o</mi><mi>m</mi><mi>p</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>b</mi><mi>l</mi><mi>e</mi><mfenced close=")" open="("><mrow><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow><mrow><mi>I</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow></mfenced></math></p>
<div class="paragraph">
<p>This constraint corresponds to <a href="#req:Implementation_of_Interface_Members">[req:Implementation_of_Interface_Members]</a>
except for the <code>@Override</code> annotation, which is not required, here.</p>
</div>
</li>
<li>
<p>Given a classifier <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> without an owned constructor and
an extended class or interface <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi><mi>u</mi><mi>p</mi></math> that has a covariant
constructor (owned or inherited, see <a href="#def:Covariant_Constructors">[def:Covariant_Constructors]</a>), we require the inherited constructor <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></math> of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> within the context of
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> to be override compatible to itself in the context of
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi><mi>u</mi><mi>p</mi></math>. Using notation <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>m</mi><mrow><mo>[</mo><mi>T</mi></mrow></math>$] to denote that a
member <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>m</mi></math> is to be treated as defined in container type
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>, which means the this-binding is set to <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>,
we can write: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>d</mi><mi>e</mi><mi>C</mi><mi>o</mi><mi>m</mi><mi>p</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>b</mi><mi>l</mi><mi>e</mi><mrow><mo>(</mo><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mrow><mo>[</mo><mi>C</mi></mrow></mrow></math>, ctor[Sup])
    \end{aligned}\]] This constraint does not correspond to any of the
constraints for the redefinition of ordinary members.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following example demonstrates a use case for covariant
constructors. It shows a small class hierarchy using covariant
constructors, <code>Cls</code> and <code>Cls2</code>, together with a helper function <code>createAnother</code> that creates and returns a new instance of the same type as its argument <code>value</code>.</p>
</div>
<div class="sect4">
<h5 id="_covariant_constructors_2"><a class="anchor" href="#_covariant_constructors_2"></a>Covariant Constructors</h5>
<div id="ex:Covariant_Constructors" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class A {}
class B extends A {}

@CovariantConstructor
class Cls {
    constructor(p: B) {}
}
class Cls2 extends Cls {
    constructor(p: A) { // it's legal to generalize the type of parameter 'p'
        super(null);
    }
}

function &lt;T extends Cls&gt; createAnother(value: T, p: B): T {
    let ctor = value.constructor;
    return new ctor(p);
}

let x = new Cls2(new A());
let y: Cls2;

y = createAnother(x, new B());</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the code of <a href="#ex:Covariant_Constructors">[ex:Covariant_Constructors]</a> we would get an error if we changed the type of parameter <code>p</code> in the constructor of <code>Cls2</code> to some other type that is not a super type of <code>B</code>,
i.e. the type of the corresponding parameter of <code>Cls</code>’s constructor. If we
removed the <code>@CovariantConstructor</code> annotation on <code>Cls</code>, we would get an error in the new expression inside function <code>createAnother</code>.</p>
</div>
<div class="paragraph">
<p>The next example illustrates how to use <code>@CovariantConstructor</code> with interfaces and shows a behavior that might be surprising at first sight.</p>
</div>
</div>
<div class="sect4">
<h5 id="_covariant_constructors_in_interfaces"><a class="anchor" href="#_covariant_constructors_in_interfaces"></a>Covariant Constructors in Interfaces</h5>
<div id="ex:Covariant_Constructors_in_Interfaces" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>@CovariantConstructor
interface I {
    constructor(p: number)
}

class C implements I {
    // no constructor required!
}

class D extends C {
    // XPECT errors --&gt; "Signature of constructor of class D does not conform to overridden constructor of class N4Object: {function(number)} is not a subtype of {function()}." at "constructor"
    constructor(p: number) {}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Interface <code>I</code> declares a covariant constructor expecting a single parameter
of type <code>number</code>. Even though class <code>C</code> implements <code>I</code>, it does not need to define an
owned constructor with such a parameter. According to
<a href="#req:Covariant_Constructors">[req:Covariant_Constructors]</a>, it is enough for <code>C</code> to have a constructor,
either owned or inherited, that is override compatible with the one
declared by <code>I</code>. Class <code>C</code> inherits the default constructor from <code>N4Object</code>, which does not have any arguments and is thus override compatible to <code>I</code>’s
constructor.</p>
</div>
<div class="paragraph">
<p>In addition, subclasses are now required to have constructors which are
override compatible with the constructor of class <code>C</code>, i.e. the one
inherited from <code>N4Object</code>. The above example shows that this is violated even when
repeating the exact same constructor signature from interface <code>I</code>, because
that constructor now appears on the other side of the subtype test
during checking override compatibility.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_data_fields"><a class="anchor" href="#_data_fields"></a>6.5. Data Fields</h3>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-381" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-381</a>
</div>
</div>
<div class="paragraph">
<p>A data field is a simple property of a class. There must be no getter or
setter defined with the same name as the data field. In ECMAScript 6, a
class has no explicit data fields. It is possible, however, to
implicitly define a data field by simply assigning a value to a variable
of the this element (e.g. <code>this.x = 10</code> implicitly defines a field <code>x</code>).
Data fields in N4JS are similar to these implicit fields in ECMAScript 6 except that
they are defined explicitly in order to simplify validation and user
assistance.</p>
</div>
<div class="sect3">
<h4 id="data-fields-syntax"><a class="anchor" href="#data-fields-syntax"></a>6.5.1. Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>N4FieldDeclaration &lt;Yield&gt;:
    {N4FieldDeclaration}
    annotations+=Annotation*
    FieldDeclarationImpl&lt;Yield&gt;
;

fragment FieldDeclarationImpl &lt;Yield&gt;*:
    accessModifier=N4JSMemberAccessModifier?
    (static?=’static’ | const?=’const’)?
    LiteralPropertyName&lt;Yield&gt; ColonSepTypeRef? ('=' expression=Expression&lt;In=true,Yield&gt;)? ';'
;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="data-fields-properties"><a class="anchor" href="#data-fields-properties"></a>6.5.2. Properties</h4>
<div class="paragraph">
<p>Fields have the following properties which can be explicitly defined:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>typeRef</code> </dt>
<dd>
<p>Type of the field; default value is <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi><mi>n</mi><mi>y</mi></math>.</p>
</dd>
<dt class="hdlist1"><code>expr</code> </dt>
<dd>
<p>Initializer expression, i.e. sets default value.</p>
</dd>
<dt class="hdlist1"><code>static</code> </dt>
<dd>
<p>Boolean flag set to true if field is a static field.</p>
</dd>
<dt class="hdlist1"><code>const</code> </dt>
<dd>
<p>Boolean flag set to true if field cannot be changed. Note that const
fields are automatically static. Const fields need an initializer. Also
see <a href="#sec:Assignment_Modifiers">[sec:Assignment_Modifiers]</a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Note that <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi></math> is <em>not</em> the (reversed) value of the
property descriptor <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi></math> as the latter is checked at
runtime while const may or may not be checked at runtime.</p>
</div>
<div class="paragraph">
<p>The following pseudo properties are defined via annotations for setting
the values of the property descriptor:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>enumerable</code> </dt>
<dd>
<p>Boolean flag reflecting the property descriptor
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mi>n</mi><mi>u</mi><mi>m</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi></math>, set via annotation <code>@Enumerable(true|false)</code>.
The default value is <math xmlns="http://www.w3.org/1998/Math/MathML"/>.</p>
</dd>
<dt class="hdlist1"><code>declaredWriteable</code> </dt>
<dd>
<p>Boolean flag reflecting the property descriptor <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi></math>,
set via annotation <code>@Writeable(true|false)</code>. The default value is <math xmlns="http://www.w3.org/1998/Math/MathML"/>.</p>
</dd>
<dt class="hdlist1"><code>final</code> </dt>
<dd>
<p>Boolean flag making the field read-only, and it must be set in the
constructor. Also see <a href="#Assignment_Modifiers">[Assignment_Modifiers]</a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Derived values for fields</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>readable</code> </dt>
<dd>
<p>Always true for fields.</p>
</dd>
<dt class="hdlist1"><code>abstract</code> </dt>
<dd>
<p>Always false for fields.</p>
</dd>
<dt class="hdlist1"><code>writeable</code> </dt>
<dd>
<p>Set to false if field is declared const or final. In the latter case, it
may be set in the constructor (cf. <a href="#_assignment_modifiers">Assignment Modifiers</a>).</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="data-fields-semantics"><a class="anchor" href="#data-fields-semantics"></a>Semantics</h5>

</div>
<div class="sect4">
<h5 id="_attributes"><a class="anchor" href="#_attributes"></a>Attributes</h5>
<div class="paragraph">
<p>For any attribute <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi></math> if a
class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>, the following constraints must hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A required data field must not define an initializer:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mo>.</mo><mi>r</mi><mi>e</mi><mi>q</mi><mi>u</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>a</mi><mo>.</mo><mi>i</mi><mi>n</mi><mi>i</mi><mi>t</mi><mo>=</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi></math></p>
</li>
<li>
<p>There must be no other member with the same name of a data field
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi></math>. In particular, there must be no getter or setter
defined with the same name: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∀</mo><mi> </mi><mi>m</mi><mo>∈</mo><mi>f</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>r</mi><mo>.</mo><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>:</mi><mi>m</mi><mo>≠</mo><mi>f</mi><mi>m</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>≠</mo><mi>f</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></math></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If a subclass should set a different default value, this has to be done
in the constructor of the subclass.</p>
</div>
<div class="paragraph">
<p>For the relation of data fields and field accessors in the context of
extending classes or implementing interfaces see <a href="#Redefinition_of_Members">[Redefinition_of_Members]</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="data-fields-type-inference"><a class="anchor" href="#data-fields-type-inference"></a>Type Inference</h5>
<div class="paragraph">
<p>The type of a field is the type of its declaration:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>f</mi><mi>:</mi><mi>d</mi></mrow><mrow/><mtext>
</mtext></math></p>
</div>
<div class="paragraph">
<p>The type of a field declaration is either the declared type or the
inferred type of the initializer expression:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>d</mi><mi>:</mi><mi>T</mi></mrow><mrow><mi>d</mi><mo>.</mo><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>≠</mo><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>T</mi><mo>=</mo><mi>d</mi><mo>.</mo><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>d</mi><mi>:</mi><mi>T</mi></mrow><mrow><mi>d</mi><mo>.</mo><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>=</mo><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>d</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>≠</mo><mtext>
</mtext><mi>E</mi><mo>=</mo><mi>d</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>E</mi><mo>∉</mo><mfenced close="}" open="{"><mrow><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi><mo>,</mo><mi>u</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi></mrow></mfenced><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>T</mi><mo>=</mo><mi>E</mi></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>d</mi><mi>:</mi><mrow><mi>a</mi><mi>n</mi><mi>y</mi></mrow></mrow><mrow><mi>e</mi><mi>l</mi><mi>s</mi><mi>e</mi></mrow></math></p>
</div>
<div class="paragraph">
<p>If the type contains type variables they are substituted according to
type parameters which are provided by the reference:</p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>T</mi><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi></mrow><mi> </mi><mi>t</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mi>:</mi><mi>T</mi></mrow><mrow><mi>t</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mi>:</mi><mi>T</mi></mrow></math></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_assignment_modifiers"><a class="anchor" href="#_assignment_modifiers"></a>6.5.3. Assignment Modifiers</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-946" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-946</a>
</div>
</div>
<div class="paragraph">
<p>Assignment of data fields can be modified by the assignment modifiers
(similar to constant variable declarations, see <a href="#_const">Const</a>) and <code>@Final</code>.</p>
</div>
<div class="paragraph">
<p>Const Data Fields
[[req:Const_Data_Fields]
For a data field <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi></math> marked as <code>const</code>, the following constraints must hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>An initializer expression must be provided in the declaration
(except in n4jsd files): <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>f</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo>≠</mo></math></p>
</li>
<li>
<p>A constant data field is implicitly static and must be accessed only
via the classifier type. It is not possible, therefore, to use the <code>this</code>
keyword in the initializer expression of a constant field:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>s</mi><mi>u</mi><mi>b</mi><mo>∈</mo><mi>f</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><msup><mi>r</mi><mo>*</mo></msup><mi>:</mi><mi>s</mi><mi>u</mi><mi>b</mi><mo>=</mo><mi>"</mi><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi><mi>"</mi></math></p>
</li>
<li>
<p>A constant data field must not be annotated with <code>@Final</code>:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>f</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mo>⇒</mo><mo>¬</mo><mi>f</mi><mo>.</mo><mi>f</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi></math></p>
</li>
<li>
<p>Constant data fields are not writeable (cf. <a href="#req:Write_Acccess">[req:Write_Acccess]</a>):
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>f</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mo>⇒</mo><mo>¬</mo><mi>f</mi><mo>.</mo><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi></math></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_final_data_fields"><a class="anchor" href="#_final_data_fields"></a>Final Data Fields</h5>
<div class="paragraph">
<p>For a data field <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi></math> marked as <code>@Final</code>, the following constraints must hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A final data field must not be modified with <code>const</code> or <code>static</code>:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>f</mi><mo>.</mo><mi>f</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi><mo>⇒</mo><mo>¬</mo><mi>f</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mo>∧</mo><mo>¬</mo><mi>f</mi><mo>.</mo><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>S</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi></math></p>
</li>
<li>
<p>A final data field is not writeable: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>f</mi><mo>.</mo><mi>f</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi><mo>⇒</mo><mo>¬</mo><mi>f</mi><mo>.</mo><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi></math> A final field
may, however, be set in the constructor. See <a href="#req:Write_Acccess">[req:Write_Acccess]</a> for
details.</p>
</li>
<li>
<p>A final data field must be either initialized by an initializer
expression or in the constructor. If the field is initialized in the
constructor, this may be done either explicitly or via a spec-style
constructor. 
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>f</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo>≠</mo><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∨</mo><mfenced close=")" open="("><mrow><mo>∃</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>:</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>F</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mi>f</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>r</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mo>∧</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo>.</mo><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mo>.</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>=</mo><mrow><mi>"</mi><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi><mi>"</mi></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mo>∧</mo><mi>b</mi><mi>i</mi><mi>n</mi><mi>d</mi><mfenced close=")" open="("><mrow><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo>.</mo><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>y</mi></mrow><mi>f</mi></mfenced></mrow></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∨</mo><mfenced close=")" open="("><mrow><mi>f</mi><mo>.</mo><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi><mo>∧</mo><mo>∃</mo><mi>f</mi><mi>p</mi><mi>a</mi><mi>r</mi><mo>∈</mo><mi>f</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>r</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo>.</mo><mi>f</mi><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi><mi>:</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mi>f</mi><mi>p</mi><mi>a</mi><mi>r</mi><mo>.</mo><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mo>∧</mo><mo>∃</mo><mi>s</mi><mi>m</mi><mo>∈</mo><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>l</mi><mi>M</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>:</mi><mi>s</mi><mi>m</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>f</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow></mfenced></math></p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/575" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-575</a>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_field_accessors_getter_setter"><a class="anchor" href="#_field_accessors_getter_setter"></a>6.5.4. Field Accessors (Getter/Setter)</h4>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-160" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-160</a>
<a href="https://jira.numberfour.eu/browse/IDE-381" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-381</a>
</div>
</div>
<div class="paragraph">
<p>Instead of a simple data field, a field can be defined by means of the
getter and setter accessor methods. These accessor methods are similar
to the accuser methods in object literals:</p>
</div>
<div class="sect4">
<h5 id="field-acessors-syntax"><a class="anchor" href="#field-acessors-syntax"></a>Syntax</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-8" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-8</a>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>N4GetterDeclaration &lt;Yield&gt;:
    =&gt; ({N4GetterDeclaration}
    annotations+=Annotation*
    accessModifier=N4JSMemberAccessModifier?
    (abstract?='abstract' | static?='static')?
    GetterHeader&lt;Yield&gt;)
    (body=Block&lt;Yield&gt;)? ';'?
;

fragment GetterHeader &lt;Yield&gt;*:
    ('get' -&gt; LiteralOrComputedPropertyName &lt;Yield&gt; '(' ')' ColonSepTypeRef?)
;

N4SetterDeclaration &lt;Yield&gt;:
    =&gt;({N4SetterDeclaration}
        annotations+=Annotation*
        accessModifier=N4JSMemberAccessModifier?
        (abstract?='abstract' | static?='static')?
        'set'
        -&gt;LiteralOrComputedPropertyName &lt;Yield&gt;
    )
    '(' fpar=FormalParameter&lt;Yield&gt; ')' (body=Block&lt;Yield&gt;)? ';'?
;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notes with regard to syntax: Although ECMAScript 6 does not define
fields in classes, it defines getter and setter methods similarly (cf. [<a href="#ECMA15a">ECMA15a(p.S13.3, p.p.209)</a>]).</p>
</div>
</div>
<div class="sect4">
<h5 id="_getter_and_setter"><a class="anchor" href="#_getter_and_setter"></a>Getter and Setter</h5>
<div class="paragraph">
<p>[[ex:Getter and Setter]]
The getter and setter implementations usually reference data fields internally. These are to be declared explicitly (although ECMAScript allows creating fields on
the fly on their first usage (see task IDE-422 )).
The following example demonstrates a typical usage of getter and setter in combination with a data field.
The getter lazily initializes the field on demand. The setter performs
some notification.</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-422" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-422</a>
</div>
</div>
<div class="listingblock">
<div class="title">Getter Setter</div>
<div class="content">
<pre class="highlightjs highlight"><code>class A {}

class C {
    private _data: A = null;

    public get data(): A {
        if (this._data==null) {
            this._data = new A();
        }
        return this._data;
    }

    public set data(data: A) {
        this._data = data;
        this.notifyListeners();
    }

    notifyListeners(): void {
        // ...
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="field-acessors-properties"><a class="anchor" href="#field-acessors-properties"></a>Properties</h5>
<div class="paragraph">
<p>Derived values for field accessors:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>readable</code> </dt>
<dd>
<p>True for getters and false for setters.</p>
</dd>
<dt class="hdlist1"><code>writable</code> </dt>
<dd>
<p>False for getters and true for setters.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="field-accessors-semantics"><a class="anchor" href="#field-accessors-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>There must be no field or method with the same name as a field accessor
(follows from <a href="#req:Member_Names">[req:Member_Names]</a>). In addition, the following
constraints must hold:</p>
</div>
<div class="paragraph">
<p>Field Accessors</p>
</div>
<div id="req:Field_Accessors" class="ulist">
<ul>
<li>
<p>The return type of a getter must not be <code>void</code>.</p>
</li>
<li>
<p>The type of the parameter of a setter must not be <code>void</code>.</p>
</li>
<li>
<p>If a getter <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>g</mi></math> is defined or consumed (from an interface)
or merged-in (via static polyfill) in a class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> and a
setter <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math> with
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>g</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>∧</mo><mi>s</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mo>=</mo><mi>g</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi></math> is inherited by
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> from one of its super classes, then <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> must
define a setter <math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>s</mi><mi>'</mi></msup></math> with
<math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>s</mi><mi>'</mi></msup><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>g</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>∧</mo><msup><mi>s</mi><mi>'</mi></msup><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mo>=</mo><mi>g</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi></math>
<sup class="footnote">[<a id="_footnoteref_32" class="footnote" href="#_footnote_32" title="View footnote.">32</a>]</sup>.
The same applies to setters, accordingly.</p>
</li>
<li>
<p><a href="#req:Overriding_Members">[req:Overriding_Members]</a>, <a href="#req:Consumption_of_Interface_Members">[req:Consumption_of_Interface_Members]</a>, and
<a href="#req:Implementation_of_Interface_Members">[req:Implementation_of_Interface_Members]</a> apply to field accessors
accordingly (getter / setter overriding).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title"></div>
</td>
<td class="content">
A getter and setter with the same name need not have the same
type, i.e. the getter’s return type need not be the same as a subtype of
the type of the setter’s parameter (the types can be completely
unrelated).
<sup class="footnote">[<a id="_footnoteref_33" class="footnote" href="#_footnote_33" title="View footnote.">33</a>]</sup>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Getters and setters – like functions – define a variable execution
environment and therefore provide access to the actual passed-in
parameters through the implicit <code>arguments</code> variable inside of their bodies (c.f. <a href="#Arguments_Objects">[Arguments_Objects]</a>).</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_static_members"><a class="anchor" href="#_static_members"></a>6.6. Static Members</h3>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-151" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-151</a>
<a href="https://jira.numberfour.eu/browse/IDE-505" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-505</a>
</div>
</div>
<div class="paragraph">
<p>Static data fields, field accessors and methods are quite similar to
instance members, however they are not members of instances of the type
but the type itself. They are defined similarly to instance members
except that they are specified with the modifier <code>static</code>. Since they are
members of the type, the <code>this</code> keyword is not bound to instances of the class,
but again to the type itself. This is similar as in ECMAScript 6
([<a href="#ECMA15a">ECMA15a(p.14.5.15)</a>]).
Since static members are not instance but type members, it is even
possible that a static member has the same name as an instance member.</p>
</div>
<div class="paragraph">
<p>Note that static members are not only allowed in classes but also in
interfaces, but there are important differences (for example, no
inheritance of static members of interfaces, cf. Section
<a href="#Static_Members_of_Interfaces">[Static_Members_of_Interfaces]</a>) .</p>
</div>
<div class="paragraph">
<p>[[req:Static member not abstract]]
For a static field accessor or method
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math>, the following constraint must hold:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mo>¬</mo><mi>s</mi><mo>.</mo><mi>a</mi><mi>b</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi></math></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Like instance methods, static methods of classes are inherited by
subclasses and it is possible to override static methods in subclasses.
The very same override constraints are valid in this case as well.</p>
</div>
<div class="sect3">
<h4 id="_access_from_and_to_static_members"><a class="anchor" href="#_access_from_and_to_static_members"></a>6.6.1. Access From and To Static Members</h4>
<div id="req:Accessing_Static_Members" class="dlist">
<dl>
<dt class="hdlist1">Accessing Static Members</dt>
<dd>
<p>Let <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>m</mi></math> be a static member of class <code>C</code>. Except for write-access to
fields, which will be explained later, you can access <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>m</mi></math>
via:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The class declaration instance, i.e. the classifier or constructor type, <code>constructor{C}</code>, i.e. <code>C.m</code></p>
</li>
<li>
<p>The class declaration instance of a subtype, i.e. the classifier or constructor type, i.e. <code>D.m</code>, if <code>D</code> is a subclass of <code>C</code>.</p>
</li>
<li>
<p><code>v.m</code>, if <code>v</code> is a variable of type <code>C</code> (i.e. classifier type as defined in <a href="#Constructor_Type">[Constructor_Type]</a>) or a subtype thereof.</p>
</li>
<li>
<p><code>this.m</code> inside the body of any static method declared in <code>C</code> or any sub-class of <code>C</code>.</p>
</li>
<li>
<p>Via a type variable <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> which upper bound is a subclass
of <code>C</code>,<br>
e.g., <code>function &lt;T extends C&gt; f(){T.m}</code> task:GH-222[]</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>It is not possible to access instance members from static members. This is true in
particular for type variables defined by a generic classifier.</p>
</div>
<div class="paragraph">
<p>[[req:write_access_of_static_data_fields]
 
For static data fields and static setter <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi></math> the following constraint must hold:</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1071" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1071</a>
<a href="https://github.com/NumberFour/N4JS/issues/442" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-442</a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>For every assign expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi></math> with
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mo>∧</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo>.</mo><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mo>=</mo><mi>T</mi><mo>.</mo><mi>f</mi><mo>→</mo><mi>T</mi><mo>=</mo><mi>f</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>r</mi></math>.</p>
</li>
<li>
<p>For every writing unary expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi></math> with
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi><mo>.</mo><mi>o</mi><mi>p</mi><mo>∈</mo><mfenced close="}" open="{"><mrow><mo>+</mo><mo>+</mo></mrow><mrow><mo>-</mo><mo>-</mo></mrow></mfenced><mo>∧</mo><mi>f</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mo>∧</mo><mi>u</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mi>T</mi><mo>.</mo><mi>f</mi><mo>→</mo><mi>T</mi><mo>=</mo><mi>f</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>r</mi></math>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the special case of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>m</mi></math> being a static data field,
write-access is only possible via the defining type name <code>C.m</code>: . So in the
list above, only the first line can be used when assigning values to a
field. Note that this only applies to fields and
set-accessors.
<sup class="footnote">[<a id="_footnoteref_34" class="footnote" href="#_footnote_34" title="View footnote.">34</a>]</sup></p>
</div>
<div class="paragraph">
<p>It is even possible to call a static field accessor or method of a class
using dynamic polymorphism, as demonstrated in the following example:</p>
</div>
<div class="paragraph">
<p>Static members of classes, inheritance and polymorphism</p>
</div>
<div id="ex:Polymorphism_and_static_methods" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class A {
    static m(): void { console.log('A#m'); }

    static foo(): void { console.log('A#foo'); }

    static bar(): void {
        this.foo();
    }
}

class B extends A {
    @Override
    static foo(): void { console.log('B#foo'); }
}

A.m(); // will print "A#m"
B.m(); // will print "A#m" (m is inherited by B)

var t: type{A} = A;
t.foo(); // will print "A#foo"
t = B;
t.foo(); // will print "B#foo"

// using 'this':

A.bar(); // will print "A#foo"
B.bar(); // will print "B#foo"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is quite different from Java where static methods are not inherited
and references to static methods are statically bound at compile time
depending on the declared type of the receiver (and not its value):</p>
</div>
<div class="paragraph">
<p>Static members in Java</p>
</div>
<div id="ex:Static_members_in_Java" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">// !!! JAVA CODE !!!
public class C {

    static void m() { System.out.println("C#m"); }

    public static void main(String[] args) {
        final C c = null;
        c.m();  // will print "C#m" (no NullPointerException at runtime)
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_generic_static_methods"><a class="anchor" href="#_generic_static_methods"></a>6.6.2. Generic static methods</h4>
<div class="paragraph">
<p>  </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-151" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-151</a>
<a href="https://jira.numberfour.eu/browse/IDE-38" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-38</a>
<a href="https://jira.numberfour.eu/browse/IDE-39" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-39</a>
</div>
</div>
<div class="paragraph">
<p>It is not possible to refer to type variables of a generic class, as
these type variables are never bound to any concrete types. A static
method can, however, be declared generic. Generic static methods are
defined similarly to generic instance methods. Since they cannot refer
to type variables of a generic class, the constraint to avoid type
variables with equal names (see
<a href="#req:Type_variable_names_for_generic_methods">[req:Type_variable_names_for_generic_methods]</a>) does not need to hold for
generic static methods.</p>
</div>
</div>
<div class="sect3">
<h4 id="_static_members_of_interfaces"><a class="anchor" href="#_static_members_of_interfaces"></a>6.6.3. Static Members of Interfaces</h4>
<div class="paragraph">
<p>Data fields, field accessors and methods of interfaces may be declared
static. A few restrictions apply:</p>
</div>
<div id="req:StaticMembersOfInterfaces" class="olist arabic">
<ol class="arabic">
<li>
<p>Static members of interfaces may only be accessed directly via the
containing interface’s type name  (this means, of the four ways of
accessing static members of classes defined in <a href="#req:Accessing_Static_Members">[req:Accessing_Static_Members]</a> above, only the first one applies to static members of interfaces).</p>
</li>
<li>
<p>The <code>this</code> literal may not be used in static methods or field accessors of
interfaces and it may not be used in the initializer expression of
static fields of interfaces. See <a href="#req:ValidLocationForThisLiteral">[req:ValidLocationForThisLiteral]</a>.</p>
</li>
<li>
<p>The <code>super</code> literal may not be used in static methods or field accessors of
interfaces (in fact, it may not be used in interfaces at all,
cf. <a href="#req:Access_Super_Member_with_Super_Literal">[req:Access_Super_Member_with_Super_Literal]</a>).</p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/386" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-386</a>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>this</code> type as a return type for methods is only allowed for
instance methods and as an argument type only in constructors
(structurally typed). There is no need to disallow these cases for
static interface methods in the constraints above.</p>
</div>
<div class="paragraph">
<p>In general, static members may not be abstract,
cf. <a href="#req:Abstract_Member">[req:Abstract_Member]</a>, which applies here as well. Static methods
and field accessors of interfaces, therefore, always have to provide a
body.</p>
</div>
<div class="paragraph">
<p>Static members of interfaces are much more restricted than those of
classes. Compare the following example to <a href="#ex:Polymorphism_and_static_methods">[ex:Polymorphism_and_static_methods]</a> for classes above:</p>
</div>
<div class="paragraph">
<p>Example: Static members of interfaces</p>
</div>
<div id="ex:Static_members_of_interfaces" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">interface I {
    static m(): void { console.log('I#m'); }
}

interface J extends I {}

I.m(); // prints "I#m"
J.m(); // ERROR! (m is not inherited by J)

var ti: type{I} = I;
ti.m(); // ERROR! (access to m only allowed directly via type name I)
ti = J;
ti.m(); // ERROR! (access to m only allowed directly via type name I)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last line in is the reason why access to static members has to be
restricted to direct access via the type name of the containing
interfaces.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_redefinition_of_members"><a class="anchor" href="#_redefinition_of_members"></a>6.7. Redefinition of Members</h3>
<div class="paragraph">
<p>Members defined in classes or interfaces can be redefined by means of
being overridden or implemented in subclasses, sub-interfaces, or
implementing classes. Fields and methods with default implementation
defined in interfaces can be consumed by the implementor, but certain
restrictions apply.</p>
</div>
<div class="paragraph">
<p>70Override Compatible[Override Compatible] A member <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> is
<em>override compatible</em> to a member <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> if and only if the
following constraints hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The name and static modifiers are equal:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>M</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>S</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>∧</mo><mi>M</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mo>=</mo><mi>S</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi></math></p>
</li>
<li>
<p>The metatypes are compatible: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>μ</mi><mfenced close=")" open="("><mi>S</mi></mfenced><mo>=</mo><mrow><mi>M</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi></mrow><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>⇒</mo><mi>μ</mi><mfenced close=")" open="("><mi>M</mi></mfenced><mo>=</mo><mrow><mi>M</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi></mrow><mtext>
</mtext><mi>μ</mi><mfenced close=")" open="("><mi>S</mi></mfenced><mo>=</mo><mrow><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi></mrow><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>⇒</mo><mi>μ</mi><mfenced close=")" open="("><mi>M</mi></mfenced><mo>∈</mo><mrow><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mo>,</mo><mi>G</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi><mo>,</mo><mi>S</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow><mtext>
</mtext><mi>μ</mi><mfenced close=")" open="("><mi>S</mi></mfenced><mo>=</mo><mrow><mi>G</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>⇒</mo><mi>μ</mi><mfenced close=")" open="("><mi>M</mi></mfenced><mo>∈</mo><mrow><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mo>,</mo><mi>G</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow><mtext>
</mtext><mi>μ</mi><mfenced close=")" open="("><mi>S</mi></mfenced><mo>=</mo><mrow><mi>S</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>⇒</mo><mi>μ</mi><mfenced close=")" open="("><mi>M</mi></mfenced><mo>∈</mo><mrow><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mo>,</mo><mi>S</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow><mtext>
</mtext></math></p>
</li>
<li>
<p>The overridden member must not be declared final:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>¬</mo><mi>S</mi><mo>.</mo><mi>f</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi></math></p>
</li>
<li>
<p>Overridden member declared const can only be overridden (redefined)
by const members: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>S</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mo>⇔</mo><mi>M</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi></math></p>
</li>
<li>
<p>It is not possible to override a non-abstract member with an
abstract one: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>¬</mo><mi>M</mi><mo>.</mo><mi>a</mi><mi>b</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mo>∨</mo><mi>S</mi><mo>.</mo><mi>a</mi><mi>b</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi></math></p>
</li>
<li>
<p>The types are compatible: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mfenced close=")" open="("><mrow><mi>μ</mi><mfenced close=")" open="("><mi>M</mi></mfenced><mo>∈</mo><mrow><mi>M</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi><mo>,</mo><mi>G</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi><mo>,</mo><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi></mrow><mo>∧</mo><mi>μ</mi><mfenced close=")" open="("><mi>S</mi></mfenced><mo>≠</mo><mrow><mi>S</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow></mrow></mfenced><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>⇒</mo><mi>M</mi><mi>S</mi><mtext>
</mtext><mfenced close=")" open="("><mrow><mi>μ</mi><mfenced close=")" open="("><mi>M</mi></mfenced><mo>∈</mo><mrow><mi>S</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi><mo>,</mo><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi></mrow><mo>∧</mo><mi>μ</mi><mfenced close=")" open="("><mi>S</mi></mfenced><mo>≠</mo><mrow><mi>G</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow><mo>∧</mo><mo>¬</mo><mi>S</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi></mrow></mfenced><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>⇒</mo><mi>S</mi><mi>M</mi><mtext>
</mtext></math></p>
</li>
<li>
<p>The access modifier is compatible: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>M</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>≥</mo><mi>S</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi></math></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We define a relation <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>d</mi><mi>e</mi><mi>C</mi><mi>o</mi><mi>m</mi><mi>p</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>b</mi><mi>l</mi><mi>e</mi><mfenced close=")" open="("><mi>M</mi><mi>S</mi></mfenced></math> accordingly.</p>
</div>
<div class="paragraph">
<p>Members overriding or implementing other members must be declared as
override. If a member does not override another, however, it must not be
declared as override.</p>
</div>
<div class="paragraph">
<p>If and only if a member <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> of a class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> (extending a class
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> and interfaces <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>I</mi><mi>i</mi></msub></math>) does not override or
implement another member, then it must not be declared as override. That
is the following constraint must hold: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>¬</mo><mi>M</mi><mo>.</mo><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>d</mi><mi>e</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∧</mo><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><msup><mi>M</mi><mi>'</mi></msup><mo>∈</mo><mi>C</mi><mo>.</mo><mi>s</mi><mi>u</mi><mi>p</mi><mi>e</mi><mi>r</mi><mo>.</mo><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo>∪</mo><munderover><mo>⋃</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>I</mi><mi>i</mi></msub><mo>.</mo><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>:</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><msup><mi>M</mi><mi>'</mi></msup><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>M</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>∧</mo><msup><mi>M</mi><mi>'</mi></msup><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mo>=</mo><mi>M</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∧</mo><msup><mi>M</mi><mi>'</mi></msup><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mi>g</mi><mi>t</mi><mi>;</mi><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow><mtext>
</mtext></math></p>
</div>
<div class="sect3">
<h4 id="_overriding_of_members"><a class="anchor" href="#_overriding_of_members"></a>6.7.1. Overriding of Members</h4>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-12" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-12</a>
<a href="https://jira.numberfour.eu/browse/IDE-158" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-158</a>
</div>
</div>
<div class="paragraph">
<p>In general, the N4 platform supports overriding members by redefining
them in sub-classes. This definition allows for overriding of static
methods, but it does not apply to constructors because
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi><mo>.</mo><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo>∉</mo><mi>C</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi><mi>s</mi></math>.</p>
</div>
<div class="paragraph">
<p>Given a class
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> and a superclass <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi><mi>u</mi><mi>p</mi></math>. If for an instance
or static member <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> defined in <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> a member
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> exists with <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∃</mo><mi>S</mi><mo>∈</mo><mi>S</mi><mi>u</mi><mi>p</mi><mo>.</mo><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>:</mi><mi>M</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>S</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>∧</mo><mi>M</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mo>=</mo><mi>S</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi></math> then we call <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> the overriding member
and <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> the overridden member. In that case the following
constraints must hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> must be accessible from <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math></p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> must be override compatible with <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math>:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>d</mi><mi>e</mi><mi>C</mi><mi>o</mi><mi>m</mi><mi>p</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>b</mi><mi>l</mi><mi>e</mi><mfenced close=")" open="("><mi>M</mi><mi>S</mi></mfenced></math></p>
</li>
<li>
<p>If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> is a field and <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> is an accessor,
then an additional accessor <math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>M</mi><mi>'</mi></msup></math> must exists so that
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi><mo>,</mo><msup><mi>M</mi><mi>'</mi></msup></math> are an accessor pair for <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math>:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>μ</mi><mfenced close=")" open="("><mi>S</mi></mfenced><mo>=</mo><mrow><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi></mrow><mo>∧</mo><mi>μ</mi><mfenced close=")" open="("><mi>M</mi></mfenced><mo>=</mo><mrow><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>o</mi><mi>r</mi></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>⇒</mo><mo>∃</mo><msup><mi>M</mi><mi>'</mi></msup><mo>∈</mo><mi>C</mi><mo>.</mo><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>:</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="4.0em"/><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>d</mi><mi>e</mi><mi>C</mi><mi>o</mi><mi>m</mi><mi>p</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>b</mi><mi>l</mi><mi>e</mi><mfenced close=")" open="("><msup><mi>M</mi><mi>'</mi></msup><mi>S</mi></mfenced><mo>∧</mo><mfenced close="}" open="{"><mrow><mi>μ</mi><mfenced close=")" open="("><mi>M</mi></mfenced></mrow><mrow><mi>μ</mi><mfenced close=")" open="("><msup><mi>M</mi><mi>'</mi></msup></mfenced></mrow></mfenced><mo>=</mo><mrow><mi>G</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi><mo>,</mo><mi>S</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow></math></p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> must be declared as override:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>M</mi><mo>.</mo><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>d</mi><mi>e</mi></math></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Remarks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An overridden method, getter, or setter may called via <code>super</code>. Note that
this is not possible for fields.</p>
</li>
<li>
<p>There is no ’hiding’ of fields as in Java, instead there is field
overriding.</p>
</li>
<li>
<p>It is not possible to override a field with a consumed getter and an
overridden setter, because the getter is not consumed if there exists a
field in a superclass. In this case, the consuming and extending class
needs to define the accessor pair explicitly. The same is true for other
combination of accessors and fields.</p>
</li>
<li>
<p>Overriding a field usually makes only sense if the visibility of the
field is to be increased.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_of_members"><a class="anchor" href="#_implementation_of_members"></a>6.7.2. Implementation of Members</h4>
<div class="paragraph">
<p>   </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-12" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-12</a>
<a href="https://jira.numberfour.eu/browse/IDE-158" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-158</a>
<a href="https://jira.numberfour.eu/browse/IDE-700" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-700</a>
<a href="https://jira.numberfour.eu/browse/IDE-1236" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1236</a>
</div>
</div>
<div class="openblock definition">
<div class="content">
<div class="paragraph">
<p><strong>Definition:</strong> <a href="#interface_and_class_member_sets">Interface and Class Member Sets</a></p>
</div>
<div class="paragraph">
<p>For the following constraints, we define two helper sets
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>M</mi><mi>C</mi></msub></math> and <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>M</mi><mi>I</mi></msub></math> as follows: Given a
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>, and interface <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>I</mi><mn>1</mn></msub><mo>,</mo><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi><mo>,</mo><msub><mi>I</mi><mi>n</mi></msub></math>, implemented
by <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>, with <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>M</mi><mi>C</mi></msub><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>=</mo><mi>C</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo>∪</mo><mfenced close="}" open="{"><mrow><mi>m</mi><mo>∈</mo><mi>C</mi><mo>.</mo><mi>s</mi><mi>u</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>.</mo><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo>|</mo><mi>m</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mi>g</mi><mi>t</mi><mi>;</mi><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow></mrow></mfenced><mtext>
</mtext><msub><mi>M</mi><mi>I</mi></msub><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>=</mo><munderover><mo>⋃</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>I</mi><mi>i</mi></msub><mo>.</mo><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mtext>
</mtext></math> Note that these
sets already contain only non-private data fields.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_member_consumption"><a class="anchor" href="#_member_consumption"></a>Member Consumption</h5>
<div class="openblock definition">
<div class="content">
<div class="paragraph">
<p><strong>Definition:</strong> <a href="#member_consumption_and_implementation">Member Consumption and Implementation</a></p>
</div>
<div class="paragraph">
<p>A member <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> defined in an interface <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math> is <em>consumed</em> by
an implementor <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>, if it becomes a member of the class,
that is, <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi><mo>∈</mo><mi>C</mi><mo>.</mo><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi></math>.</p>
</div>
<div class="paragraph">
<p>A member <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> is consumed if there is no member defined in
the implementor with the same name and if there is no non-private
non-abstract member with that name inherited by the implementor from its
superclass.footnote:[There had been the idea of preventing static
members of being consumed. However, this would break the type subtype
relation.</p>
</div>
<div class="paragraph">
<p>If the implementor defines the member itself, then the member is
implemented rather than consumed.</p>
</div>
<div class="paragraph">
<p>The concrete rules are described in the following;</p>
</div>
<div class="paragraph">
<p>It is not always possible to directly consume a member. In general, a
rather conservative strategy is used: if two implemented interfaces
define the same (non-abstract) member then the implementor must redefine
the member in order to solve conflicts. Even if the two conflicting
members have the same types, the implementor must redefine them as we
generally assume semantic differences which the consumer has to be aware
of. Data fields defined in interfaces, in particular, are assumed to be
concrete. It is not, therefore, possible to consume a field defined in
two implemented interfaces.</p>
</div>
<div class="paragraph">
<p>Given a classifier <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> <sup class="footnote">[<a id="_footnoteref_35" class="footnote" href="#_footnote_35" title="View footnote.">35</a>]</sup>, and interfaces <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>I</mi><mn>1</mn></msub><mo>,</mo><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi><mo>,</mo><msub><mi>I</mi><mi>n</mi></msub></math>
implemented (or extended) by <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>, and sets <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>M</mi><mi>C</mi></msub></math>
and <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>M</mi><mi>I</mi></msub></math> as defined in . A non-static member
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> defined in any interface <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>I</mi><mi>i</mi></msub></math> is merged
into the consumer (<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>), if for all other (possible) members
<math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>M</mi><mi>'</mi></msup></math> of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>∀</mo><msup><mi>M</mi><mi>'</mi></msup><mo>∈</mo><msub><mi>M</mi><mi>C</mi></msub><mo>∪</mo><msub><mi>M</mi><mi>I</mi></msub><mo>∖</mo><mi>M</mi><mi>:</mi><mi>M</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><msup><mi>M</mi><mi>'</mi></msup><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>∧</mo><mo>¬</mo><msup><mi>M</mi><mi>'</mi></msup><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi></math> the following constraints hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The other member’s meta type matches the meta type of the merge
candiate: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>μ</mi><mfenced close=")" open="("><mi>M</mi></mfenced><mo>=</mo><mrow><mi>M</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi></mrow><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>⇒</mo><mi>μ</mi><mfenced close=")" open="("><msup><mi>M</mi><mi>'</mi></msup></mfenced><mo>=</mo><mrow><mi>M</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi></mrow><mtext>
</mtext><mi>μ</mi><mfenced close=")" open="("><mi>M</mi></mfenced><mo>≠</mo><mrow><mi>M</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi></mrow><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>⇒</mo><mi>μ</mi><mfenced close=")" open="("><msup><mi>M</mi><mi>'</mi></msup></mfenced><mo>∈</mo><mrow><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mo>,</mo><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>o</mi><mi>r</mi></mrow></math></p>
</li>
<li>
<p>The other member is abstract and not owned by the consumer:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>μ</mi><mfenced close=")" open="("><mi>M</mi></mfenced><mo>=</mo><mi>μ</mi><mfenced close=")" open="("><msup><mi>M</mi><mi>'</mi></msup></mfenced><mo>∨</mo><mi>μ</mi><mfenced close=")" open="("><mi>M</mi></mfenced><mo>=</mo><mrow><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><mo>⇒</mo><msup><mi>M</mi><mi>'</mi></msup><mo>.</mo><mi>a</mi><mi>b</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mo>∧</mo><msup><mi>M</mi><mi>'</mi></msup><mo>∉</mo><mi>C</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi></math></p>
</li>
<li>
<p>The merge candidate’s access modifier is not less than the modifier
of the other member: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>μ</mi><mfenced close=")" open="("><mi>M</mi></mfenced><mo>=</mo><mi>μ</mi><mfenced close=")" open="("><msup><mi>M</mi><mi>'</mi></msup></mfenced><mo>∨</mo><mi>μ</mi><mfenced close=")" open="("><mi>M</mi></mfenced><mo>=</mo><mrow><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><mo>⇒</mo><mi>M</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>≥</mo><msup><mi>M</mi><mi>'</mi></msup><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi></math></p>
</li>
<li>
<p>The merge candidate’s type compatible with the other member:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>μ</mi><mfenced close=")" open="("><mi>M</mi></mfenced><mo>∈</mo><mrow><mi>M</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi><mo>,</mo><mi>G</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi><mo>,</mo><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi></mrow><mo>∧</mo><mi>μ</mi><mfenced close=")" open="("><msup><mi>M</mi><mi>'</mi></msup></mfenced><mo>≠</mo><mrow><mi>S</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>⇒</mo><mi>M</mi><msup><mi>M</mi><mi>'</mi></msup><mtext>
</mtext><mi>μ</mi><mfenced close=")" open="("><mi>M</mi></mfenced><mo>∈</mo><mrow><mi>S</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi><mo>,</mo><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi></mrow><mo>∧</mo><mi>μ</mi><mfenced close=")" open="("><msup><mi>M</mi><mi>'</mi></msup></mfenced><mo>≠</mo><mrow><mi>G</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>⇒</mo><msup><mi>M</mi><mi>'</mi></msup><mi>M</mi></math></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_member_implementation"><a class="anchor" href="#_member_implementation"></a>Member Implementation</h5>
<div class="paragraph">
<p>For any non-static abstract member <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> defined in an interface <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math>
implemented (or extended) by a classifier <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>,
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> must be accessible from <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> and one or two
member(s) in <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> must exist which are
implementation-compatible with <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math>. The implementing
member(s) must be declared as override if they are directly defined in
the consumer.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> must be accessible from <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>.</p>
</li>
<li>
<p>An implementation-compatible member <math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>M</mi><mi>'</mi></msup></math> must exist in
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>if <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> is not a field: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>μ</mi><mfenced close=")" open="("><mi>M</mi></mfenced><mo>≠</mo><mrow><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi></mrow><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>⇒</mo><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∃</mo><msup><mi>M</mi><mi>'</mi></msup><mo>∈</mo><mi>C</mi><mo>.</mo><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>:</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>d</mi><mi>e</mi><mi>C</mi><mi>o</mi><mi>m</mi><mi>p</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>b</mi><mi>l</mi><mi>e</mi><mfenced close=")" open="("><msup><mi>M</mi><mi>'</mi></msup><mi>M</mi></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mo>∧</mo><mfenced close=")" open="("><mrow><msup><mi>M</mi><mi>'</mi></msup><mo>∈</mo><mi>C</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo>⇒</mo><msup><mi>M</mi><mi>'</mi></msup><mo>.</mo><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>d</mi><mi>e</mi></mrow></mfenced></math></p>
</li>
<li>
<p>if <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> is a field, then either an
implementation-compatible field <math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>F</mi><mi>'</mi></msup></math> or accessor pair
<math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>G</mi><mi>'</mi></msup><mo>,</mo><msup><mi>S</mi><mi>'</mi></msup></math> must exist: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>μ</mi><mfenced close=")" open="("><mi>M</mi></mfenced><mo>=</mo><mrow><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi></mrow><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>⇒</mo><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∃</mo><msup><mi>F</mi><mi>'</mi></msup><mo>∈</mo><mi>C</mi><mo>.</mo><mi>f</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mi>s</mi><mi>:</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>d</mi><mi>e</mi><mi>C</mi><mi>o</mi><mi>m</mi><mi>p</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>b</mi><mi>l</mi><mi>e</mi><mfenced close=")" open="("><msup><mi>F</mi><mi>'</mi></msup><mi>M</mi></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mo>∧</mo><mfenced close=")" open="("><mrow><msup><mi>F</mi><mi>'</mi></msup><mo>∈</mo><mi>C</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo>⇒</mo><msup><mi>F</mi><mi>'</mi></msup><mo>.</mo><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>d</mi><mi>e</mi></mrow></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∨</mo><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∃</mo><msup><mi>G</mi><mi>'</mi></msup><mo>∈</mo><mi>C</mi><mo>.</mo><mi>g</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo>,</mo><msup><mi>S</mi><mi>'</mi></msup><mo>∈</mo><mi>C</mi><mo>.</mo><mi>s</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>:</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>d</mi><mi>e</mi><mi>C</mi><mi>o</mi><mi>m</mi><mi>p</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>b</mi><mi>l</mi><mi>e</mi><mfenced close=")" open="("><msup><mi>G</mi><mi>'</mi></msup><mi>M</mi></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mo>∧</mo><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>d</mi><mi>e</mi><mi>C</mi><mi>o</mi><mi>m</mi><mi>p</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>b</mi><mi>l</mi><mi>e</mi><mfenced close=")" open="("><msup><mi>S</mi><mi>'</mi></msup><mi>M</mi></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mo>∧</mo><mfenced close=")" open="("><mrow><msup><mi>G</mi><mi>'</mi></msup><mo>∈</mo><mi>C</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo>⇒</mo><msup><mi>G</mi><mi>'</mi></msup><mo>.</mo><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>d</mi><mi>e</mi></mrow></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mo>∧</mo><mfenced close=")" open="("><mrow><msup><mi>S</mi><mi>'</mi></msup><mo>∈</mo><mi>C</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo>⇒</mo><msup><mi>S</mi><mi>'</mi></msup><mo>.</mo><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>d</mi><mi>e</mi></mrow></mfenced></math></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Methods defined in interfaces are automatically declared abstract if
they do not provide a default implementation. This can also be expressed
explicitly via adding the <code>abstract</code> modifier. If a class implementing an abstract
interface does not implement a method declared in the interface, the
class needs to be declared abstract (cf. <a href="#Abstract_Classes">[Abstract_Classes]</a>).</p>
</div>
<div class="paragraph">
<p>Consequences for method implementation:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It may be require the implementor to explicitly define a method in
order to solve type conflicts produced by methods of different
interfaces with same name but different signatures.</p>
</li>
<li>
<p>Methods in an implementor cannot decrease the accessibility of
methods from implemented interfaces, that is
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∀</mo><mi>M</mi><mo>∈</mo><mi>C</mi><mo>.</mo><mi>m</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi><mi>s</mi><mo>,</mo><msup><mi>M</mi><mi>'</mi></msup><mo>∈</mo><msub><mi>I</mi><mi>i</mi></msub><mo>.</mo><mi>m</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi><mi>s</mi><mfenced close=")" open="("><mrow><mi>i</mi><mo>=</mo><mn>1</mn><mi>n</mi></mrow></mfenced><mi>:</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><mi>M</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><msup><mi>M</mi><mi>'</mi></msup><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>⇒</mo><mi>M</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>≠</mo><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>M</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>≥</mo><msup><mi>M</mi><mi>'</mi></msup><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi></math></p>
</li>
<li>
<p>Methods in the implementor must be a supertype <sup class="footnote">[<a id="_footnoteref_36" class="footnote" href="#_footnote_36" title="View footnote.">36</a>]</sup> of methods from implemented interfaces.
That is to say the implemented methods are override-compatible.</p>
</li>
<li>
<p>There may be several methods <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>M</mi><mn>1</mn></msub><mo>,</mo><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi><mo>,</mo><msub><mi>M</mi><mi>n</mi></msub></math> defined in
different implemented interfaces and a single owned method
<math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>M</mi><mi>'</mi></msup></math> in <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>M</mi><mi>C</mi></msub></math>. In this case, the above
constraints must hold for <em>all</em> methods. In particular,
<math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>M</mi><mi>'</mi></msup></math>’s signature must conform to all conflicting methods’
signatures. This is possible by using union types for the arguments and
an intersection type as return type. Such a method <math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>M</mi><mi>'</mi></msup></math> is
said to <em>resolve</em> the conflict between the implemented (and also
inherited) methods.</p>
</li>
<li>
<p>Since abstracts methods may become part of the implementor methods,
the implementor must either define these methods or it must be declared
abstract itself. Since interfaces are abstract by default,
responsibility for implementing abstract methods is passed on to any
implementor of interfaces.</p>
</li>
<li>
<p>If two implemented interfaces provide (non-abstract) members with
the same name, they are not automatically consumed by the implementor
even if the types would be similar. In these cases, the implementor has
to redefine the members in order to be aware of possible semantic
differences. </p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-752" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-752</a>
</div>
</div>
<div class="paragraph">
<p>There is currently no separate annotation to indicate that methods are
implemented or overridden in order to solve conflicts.
We always use the <code>@Override</code> annotation.</p>
</div>
<div class="paragraph">
<p>[[ex:Method Consumption]]</p>
</div>
<div class="paragraph">
<p><a href="#tab:methodConsumption">Table Method Consumption</a> shows simple examples of above rules.
Assuming that <code>class C</code> extends super <code>class S</code> and implements interface <code>I1</code> and <code>I2</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class C extends S implements I1, I2 {...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The columns describe different scenarios in which a method (with same
name) is defined in different classifiers. We assume that the defined
methods are always non-abstract (i.e. have default implementations),
non-private and have the same signature. The last row shows which method
will be actually used in class <code>C</code>. If the method is defined in class <code>C</code>, and
if this method is printed bold, then this means that the method is
required to be defined in <code>C</code> in order to solve conflicts.</p>
</div>
<table id="tab:methodConsumption" class="tableblock frame-all grid-all spread">
<caption class="title">Table 5. Consumption of methods</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Interface <code>I1</code></p></th>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>M<sub>I1</sub></em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>M<sub>I1</sub></em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>M<sub>I1</sub></em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>M<sub>I1</sub></em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>M<sub>I1</sub></em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>M<sub>I1</sub></em></p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Interface <code>I2</code></p></th>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>M<sub>I2</sub></em></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>M<sub>I2</sub></em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>M<sub>I2</sub></em></p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">class <code>S</code></p></th>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>M<sub>S</sub></em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>M<sub>S</sub></em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>M<sub>S</sub></em></p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">class <code>C</code></p></th>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>M<sub>C</sub></em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>M<sub>C</sub></strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>M<sub>C</sub></em></p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∈</mo><mi>C</mi><mo>.</mo><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi></math></p></th>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>M<sub>I1</sub></em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>M<sub>C</sub></em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>M<sub>C</sub></em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>M<sub>S</sub></em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>M<sub>S</sub></em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>M<sub>C</sub></em></p></td>
</tr>
</tbody>
</table>
<div id="consuming-field-initializers" class="dlist">
<dl>
<dt class="hdlist1">Consuming Field Initializers </dt>
<dd>
<p>Aside from the fields themselves, an implementor <em>always</em> consumes the
field initialization if the field is consumed – this is how the
consumption is noticed at runtime.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>[[ex:Field and Field Initializer Consumption]]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">/* XPECT  output ~~~
&lt;==
stdout:
s: C , t: D ,u: I1 ,v: I2
stderr:
==&gt;
~~~ */

interface I0 {
    v: string = "I0";
}

interface I1 {
    s: string = "I1";
    t: string = "I1";
    u: string = "I1";
}

interface I2 extends I1, I0 {
    @Override
    t: string = "I2";
    @Override
    v: string = "I2";
}

class C {
    s: string = "C";
}

class D extends C implements I1, I2 {
    @Override
    t: string = "D";
}

var d = new D();

console.log(
    "s:", d.s, ", t:", d.t, ",u:", d.u, ",v:", d.v
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>We expect the following output (for each field):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>d.s = "C"</code> : <code>s</code>: is inherited from <code>C</code>, so it is not consumed from <code>I1</code> (or <code>I2</code>). Consequently,
the initializer of <code>s</code> in <code>C</code> is used.</p>
</li>
<li>
<p><code>d.t = "D"</code>: <code>t</code> is defined in <code>D</code>, solving a conflict stemming from the definition of <code>t</code> in <code>I1</code> and <code>I2</code>. Thus, the initializer of <code>t</code> in <code>D</code> is used.</p>
</li>
<li>
<p><code>d.u = "I1"</code> : <code>u</code> is only defined in <code>I1</code>, thus the initializer defined in <code>I1</code> is used.</p>
</li>
<li>
<p><code>d.v = "I2"</code> : <code>v</code> is overridden in <code>I2</code>, so is the field initializer. This is why <code>d.v</code> must be assigned to <code>I2</code> and not <code>I0</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_structural_typing"><a class="anchor" href="#_structural_typing"></a>7. Structural Typing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>   </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-673" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-673</a>
<a href="https://jira.numberfour.eu/browse/IDE-680" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-680</a>
<a href="https://jira.numberfour.eu/browse/IDE-688" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-688</a>
<a href="https://jira.numberfour.eu/browse/IDE-691" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-691</a>
</div>
</div>
<div class="paragraph">
<p>In general, N4JS uses nominal typing. This is to say that a duck is a
duck only if it is declared to be a duck. In particular when working
with external APIs, it is more convenient to use structural or duck
typing. That is, a thing that can swim and quacks like a duck, is a
duck.</p>
</div>
<div class="paragraph">
<p>Interfaces or classes can be used for this purpose with a <em>typing
strategy modifier</em> . Given a type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>, the simple ~
 (tilde)
can be added to its declaration (on definition-site) or in a reference (on
use-site) to indicate that the type system should use structural typing
rather than nominal typing.<sup class="footnote">[<a id="_footnoteref_37" class="footnote" href="#_footnote_37" title="View footnote.">37</a>]</sup> This means that some other type must provide the same
members as type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> to be deemed a structural subtype.
However, the operator cannot be used anymore with the type or reference
as this operator relies on the declaration information (or at least the
closest thing available at runtime). In this case, <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> is,
therefore, always a structural subtype of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>~</mi><mi>T</mi></math>.</p>
</div>
<div class="paragraph">
<p>Sometimes it is convenient to refer only to the fields of a classifier,
for example when the initial field values are to be provided in a
variable passed to the constructor. In that case, the type can be
modified with <code>~~</code> (two tildes). This is only possible on use-site, i.e.
on type references. Furthermore, only on the use-site, it is possible to
consider only either readable or writable or fields by using the
read-only <code>r </code> or write-only <code>w </code> structural field typing. For
initialization blocks, it is even possible to use structural initializer
field typing via the <code>i </code> operator.</p>
</div>
<div class="sect2">
<h3 id="_syntax_6"><a class="anchor" href="#_syntax_6"></a>7.1. Syntax</h3>
<div class="paragraph">
<p>Structural typing is specified using the typing strategy modifier. There
are two modifiers defined; one for definition-site and one for use-site
structural typing.</p>
</div>
<div id="lst:Structural_Type_Operator_and_References" class="listingblock">
<div class="title">Structural Type Operator and References</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">TypingStrategyUseSiteOperator returns TypingStrategy:
    '~' ('~' | STRUCTMODSUFFIX)?;

TypingStrategyDefSiteOperator returns TypingStrategy:
    '~';

terminal STRUCTMODSUFFIX:
    ('r' | 'i' | 'w') '~'
;

ParameterizedTypeRefStructural returns ParameterizedTypeRefStructural:
    definedTypingStrategy=TypingStrategyUseSiteOperator
    declaredType=[Type|TypeReferenceName]
    (=&gt; '&lt;' typeArgs+=TypeArgument (',' typeArgs+=TypeArgument)* '&gt;')?
    (=&gt; 'with' '{' astStructuralMembers+=TStructMember* '}')?
;

ThisTypeRefStructural returns ThisTypeRefStructural:
    definedTypingStrategy=TypingStrategyUseSiteOperator
    'this'
    ('with' '{' astStructuralMembers+=TStructMember* '}')?
;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_definition_site_structural_typing"><a class="anchor" href="#_definition_site_structural_typing"></a>7.2. Definition Site Structural Typing</h3>
<div class="paragraph">
<p>An interface or class can be defined to be used with structural typing
by adding the structural modifier to its definition (or, in case of
external classes, to the declaration). This changes the default type
system strategy from nominal to structural typing for that type. That
means that all types with the same members as the specified type are
subtypes of that type, except for subtypes of <code>N4Object</code>. In the latter case,
programmers are enforced to nominal declare the type relation.</p>
</div>
<div class="paragraph">
<p>If a type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> is declared as structural at its definition,
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mo>.</mo><mi>d</mi><mi>e</mi><mi>f</mi><mi>S</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>l</mi></math> is true.</p>
</div>
<div class="paragraph">
<p>[[req:Definition Site Structural Typing]]</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The structurally defined type cannot be used on the right hand side
of the <code>instanceof</code> operator:
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mi> </mi><mrow><mi>i</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi><mi>o</mi><mi>f</mi></mrow><mi> </mi><mi>T</mi><mo>⇒</mo><mo>¬</mo><mi>T</mi><mo>.</mo><mi>d</mi><mi>e</mi><mi>f</mi><mi>S</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>l</mi></math></p>
</li>
<li>
<p>A type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math> is a subtype of a structurally defined type
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> either</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>if it is not a subtype of <code>N4Object</code> <sup class="footnote">[<a id="_footnoteref_38" class="footnote" href="#_footnote_38" title="View footnote.">38</a>]</sup> but it contains all public,
non-static members of that type <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>X</mi><mi>T</mi></mrow><mrow><mrow><mi>X</mi><mrow><mi>N</mi><mn>4</mn><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow><mspace width="3.0em"/><mi>T</mi><mo>.</mo><mi>d</mi><mi>e</mi><mi>f</mi><mi>S</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>l</mi></mrow><mtext>
</mtext><mrow><mo>∀</mo><mi>m</mi><mo>∈</mo><mi>T</mi><mo>.</mo><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo>,</mo><mi>m</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>=</mo><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow><mo>,</mo><mo>¬</mo><mi>m</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mo>,</mo><mi>m</mi><mo>≠</mo><mi>T</mi><mo>.</mo><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>:</mi></mrow><mtext>
</mtext><mrow><mspace width="1.0em"/><mo>∃</mo><msup><mi>m</mi><mi>'</mi></msup><mo>∈</mo><mi>X</mi><mo>.</mo><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>:</mi></mrow><mtext>
</mtext><mrow><mspace width="2.0em"/><msup><mi>m</mi><mi>'</mi></msup><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>=</mo><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow><mo>∧</mo><mo>¬</mo><msup><mi>m</mi><mi>'</mi></msup><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mo>∧</mo><msup><mi>m</mi><mi>'</mi></msup><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>m</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow><mtext>
</mtext><mrow><mspace width="2.0em"/><mo>∧</mo><msup><mi>m</mi><mi>'</mi></msup><mi>m</mi></mrow><mtext>
</mtext><mrow><mspace width="2.0em"/><mo>∧</mo><mi>μ</mi><mfenced close=")" open="("><mi>m</mi></mfenced><mo>=</mo><mrow><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi></mrow><mi>m</mi><msup><mi>m</mi><mi>'</mi></msup></mrow></mrow></math>or</p>
</li>
<li>
<p>if it is a subtype of <code>N4Object</code> which explicitly extends or implements the
structurally defined type. <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>X</mi><mi>T</mi></mrow><mrow><mi>X</mi><mrow><mi>N</mi><mn>4</mn><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>T</mi><mo>.</mo><mi>d</mi><mi>e</mi><mi>f</mi><mi>S</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>l</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>T</mi><mo>∈</mo><mi>X</mi><mo>.</mo><mi>s</mi><mi>u</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><msup><mi>s</mi><mo>*</mo></msup></mrow></mrow></math></p>
</li>
<li>
<p>A structurally defined type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> is implicitly derived
from <code>Object</code> if no other type is specified. In particular, a structurally
defined type must not be inherited from <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>T</mi><mrow><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow></mrow><mrow><mi>T</mi><mo>.</mo><mi>d</mi><mi>e</mi><mi>f</mi><mi>S</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>l</mi></mrow></math> <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>T</mi><mo>.</mo><mi>d</mi><mi>e</mi><mi>f</mi><mi>S</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>l</mi><mo>⇒</mo><mi>T</mi><mrow><mi>N</mi><mn>4</mn><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow><mo>∧</mo><mrow><mi>N</mi><mn>4</mn><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow><mo>∉</mo><mi>T</mi><mo>.</mo><mi>s</mi><mi>u</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><msup><mi>s</mi><mo>*</mo></msup></math></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>[[ex:Declaration Site Structural Typing]]
The following snippet demonstrates the effect of definition-site
structural types by comparing them to nominal declared types:</p>
</div>
<div class="paragraph">
<p>[[lst:Declaration Site Structural Typing]]</p>
</div>
<div class="listingblock">
<div class="title">Declaration Site Structural TypingDeclaration Site Structural Typing</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">interface ~Tilde { x; y; }
interface Nominal { x; y; }
class C { public x; public y;}
class D extends C implements Tilde { }

function f(p: Tilde) {}
function g(p: Nominal) {}

f(new C());         // error: nominal typing, C does not implement ~Tilde
f(new D());         // ok, D is a nominal subtype (as it implements Tilde)
f({x:10,y:10});     // ok: Tilde is used with structural typing for non-N4-classifiers</code></pre>
</div>
</div>
<div class="paragraph">
<p>Definition site structural typing may lead to unexpected results. For
example;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class C{}
class ~E extends C{}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It may be unexpected, but <code>E</code> is not a subtype of <code>C</code>, i.e.
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>E</mi><mi>C</mi></math>! E.g., <code>instanceof</code> won’t work with <code>E</code>, while it works
with <code>C</code>!</p>
</div>
</div>
<div class="sect2">
<h3 id="_use_site_structural_typing"><a class="anchor" href="#_use_site_structural_typing"></a>7.3. Use-Site Structural Typing</h3>
<div class="paragraph">
<p>Use-site structural typing offers several typing strategy modifiers to
define the accessability of public properties of classes and interfaces.
They can be used e.g. on variable declarations like this: `var c : ~C
` .
The table <a href="#tab:Available_Fields_of_Structural_Types">[tab:Available_Fields_of_Structural_Types]</a> shows which properties
of structural types can be accessed in the different type strategies.
For example, when using the write-only structural strategy (i.e.
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math>), only the writeable fields, can be accessed
for writing. In the table, the term field to both, public datafields and
accessors of type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math>. Non-public properties are never
accessable in use-site structural types. In any field-structural type,
methods of the referenced nominal type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math> are not
available. The initializer structural typing provides readable fields
for every writeable field of the references type.</p>
</div>
<div class="paragraph">
<p>[[tab:Available Fields of Structural Types]]</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 6. Available Fields of Structural Types</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math></th>
<th class="tableblock halign-center valign-top"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math></th>
<th class="tableblock halign-center valign-top"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math></th>
<th class="tableblock halign-center valign-top"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math></th>
<th class="tableblock halign-center valign-top"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math></th>
<th class="tableblock halign-center valign-top"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">public method</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>∅</mi></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>∅</mi></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>∅</mi></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>∅</mi></math></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">public writable field</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>∅</mi></math></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>∅</mi></math></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">public readable field</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>∅</mi></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">writable fields</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Multiple structural typing strategies can be nested when there are
multiple use sites, like in the
example <a href="#ex:Nested Structural Typing Strategies">[ex:Nested Structural Typing Strategies]</a> below at the locations
ST1 and ST2. In the example, the datafield <code>a.field</code> has the nested structural
type <code>{\tsInitFld A}</code> and thus the datafield <code>a.field.df</code> is
readable. Nested structural types are evaluated on the fly when doing
subtype checks.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/12" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-12</a>
</div>
</div>
<div class="paragraph">
<p>[[ex:Nested Structural Typing Strategies]]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class A {
    public df : string;
}
interface I&lt;T&gt; {
    public field : ~r~T; // ST1
}
var a : ~i~A; // ST2</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example demonstrates the effect of the structural type
modifiers:</p>
</div>
<div class="paragraph">
<p>[[ex:Effect of structural type modifiers on use-site]]
Let’s assume the type defined on
the left. The following <em>pseudo</em> code snippets explicitly list the type
with its members virtually created by a structural modifier. Note that
this is pseudo code, as there are no real or virtual types created.
Instead, only the subtype relation is defined accordingly:</p>
</div>
<div class="paragraph">
<p>Effect of structural type modifiers on use-site</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Effect of structural type modifiers on use-site</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var c:C

class C {
    private x;
    public y;
    public f()
    private g()
    public get z():Z
    public set z(z:Z)
}
interface I {
    a;
    func();
}</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var cstructural:~C

class cstructural {

    public y;
    public f()

    public get z():Z
    public set z(z:Z)
}
interface ~I {
    a;
    func();
}</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var cfields:~~C

class cfields {

    public y;


    public get z():Z
    public set z(z:Z)
}
interface ~~I {
    a;

}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">Type</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">Structural Type</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">Structural Field Type</p></th>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var crofields:~r~C

class crofields {

    public get y():Y


    public get z():Z

}
interface ~r~I {
    public get a():A

}</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var cwofields:~w~C

class cwofields {

    public set y(y:Y)



    public set z(z:Z)
}
interface ~w~I {
    public set a(a:A)

}</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var cinitfields:~i~C

class cinitfields {

    public get y():Y


    public get z():Z

}
interface ~i~I {
    public get a():A

}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">Structural Read-only Field Type</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">Structural Write-only Field Type</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">Structural Initializer Field Type</p></th>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that even if a type is defined without the structural modifier, it
is not possible to use <code>instanceof</code> for variables declared as structural, as shown in
the next example:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class C {..}
interface I {..}

foo(c: C, i: I) {
    c instanceof C; // ok
    c instanceof I; // ok
}</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class C {..}
interface I {..}

foo(c: ~C, i: ~I) {
    °\color{red}{\underline{c}}° instanceof C; // error
    °\color{red}{\underline{c}}° instanceof I; // error
}</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class C {..}
interface I {..}

foo(c: ~~C, i: ~~I) {
    °\color{red}{\underline{c}}° instanceof C; // error
    °\color{red}{\underline{c}}° instanceof I; // error
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">Type</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">Structural Type</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">Structural Field Type</p></th>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>If a type is referenced with the structural type modifier `~</p>
</li>
<li>
<p>If a type is referenced with
the structural read-only field type modifier `~r~</p>
</li>
<li>
<p>If a type is referenced with the structural write-only field type modifier `~w~</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We call <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> the (nominal) type T, <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> the
structural version of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>, <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> the
structural field version of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>, <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>
the structural read-only field, <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> the structural
write-only field and <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> the structural
initializer field version of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>.</p>
</div>
<div id="req:Use_Site_Structural_Typing" class="olist arabic">
<ol class="arabic">
<li>
<p>The structural version of a type is a supertype of the nominal type:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>T</mi><mi>T</mi></math></p>
</li>
<li>
<p>The structural field version of a type is a supertype of the
structural type: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>T</mi><mi>T</mi></math></p>
</li>
<li>
<p>The structural read-only field version of a type is a supertype of
the structural field type: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>T</mi><mi>T</mi></math></p>
</li>
<li>
<p>The structural write-only field version of a type is a supertype of
the structural field type: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>T</mi><mi>T</mi></math></p>
</li>
<li>
<p>The structural (field) version of a type cannot be used on the right
hand side of the <code>instanceof</code> operator: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>x</mi><mi> </mi><mrow><mi>i</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi><mi>o</mi><mi>f</mi></mrow><mi> </mi><mi>E</mi><mo>⇒</mo><mi>E</mi><mi>:</mi><mi>T</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mo>¬</mo><mfenced close=")" open="("><mrow><mi>T</mi><mo>.</mo><mi>r</mi><mi>e</mi><mi>f</mi><mi>S</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>l</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="6.0em"/><mo>∨</mo><mi>T</mi><mo>.</mo><mi>r</mi><mi>e</mi><mi>f</mi><mi>S</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>l</mi><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="6.0em"/><mo>∨</mo><mi>T</mi><mo>.</mo><mi>r</mi><mi>e</mi><mi>f</mi><mi>S</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>l</mi><mi>R</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>O</mi><mi>n</mi><mi>l</mi><mi>y</mi><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="6.0em"/><mo>∨</mo><mi>T</mi><mo>.</mo><mi>r</mi><mi>e</mi><mi>f</mi><mi>S</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>l</mi><mi>W</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>O</mi><mi>n</mi><mi>l</mi><mi>y</mi><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="6.0em"/><mo>∨</mo><mi>T</mi><mo>.</mo><mi>r</mi><mi>e</mi><mi>f</mi><mi>S</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>l</mi><mi>I</mi><mi>n</mi><mi>i</mi><mi>t</mi><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi></mrow></mfenced></math> That is,
the following code will always issue an error: `x instanceof ~T</p>
</li>
<li>
<p>A type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math> is a subtype of a structural version of a
type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>, if it contains all public, non-static
members of the type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>:
<sup class="footnote">[<a id="_footnoteref_39" class="footnote" href="#_footnote_39" title="View footnote.">39</a>]</sup>
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>X</mi><mi>T</mi></mrow><mrow><mrow><mo>∀</mo><mi>m</mi><mo>∈</mo><mi>T</mi><mo>.</mo><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo>,</mo><mi>m</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>r</mi><mo>∉</mo><mrow><mi>N</mi><mn>4</mn><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow><mo>,</mo><mi>m</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>=</mo><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow><mo>,</mo><mo>¬</mo><mi>m</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mo>,</mo><mi>m</mi><mo>≠</mo><mi>T</mi><mo>.</mo><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>:</mi></mrow><mtext>
</mtext><mrow><mspace width="1.0em"/><mo>∃</mo><msup><mi>m</mi><mi>'</mi></msup><mo>∈</mo><mi>X</mi><mo>.</mo><mi>m</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>:</mi></mrow><mtext>
</mtext><mrow><mspace width="2.0em"/><msup><mi>m</mi><mi>'</mi></msup><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>=</mo><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow><mo>∧</mo><mo>¬</mo><msup><mi>m</mi><mi>'</mi></msup><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mo>∧</mo><msup><mi>m</mi><mi>'</mi></msup><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>m</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow><mtext>
</mtext><mrow><mspace width="2.0em"/><mo>∧</mo><msup><mi>m</mi><mi>'</mi></msup><mi>m</mi></mrow></mrow></math></p>
</li>
<li>
<p>A type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math> is a subtype of a structural field version of
a type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>, if it contains all public, non-static and
non-optional fields of the type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>X</mi><mi>T</mi></mrow><mrow><mrow><mo>∀</mo><mi>m</mi><mo>∈</mo><mi>T</mi><mo>.</mo><mi>f</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mi>s</mi><mo>,</mo><mi>m</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>r</mi><mo>∉</mo><mrow><mi>N</mi><mn>4</mn><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow><mo>,</mo><mi>m</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>=</mo><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow><mo>,</mo><mo>¬</mo><mi>m</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi></mrow><mtext>
</mtext><mrow><mrow><mspace width="1.0em"/><msup><mi>m</mi><mi>'</mi></msup><mo>∈</mo><mi>X</mi><mo>.</mo><mi>f</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mi>s</mi></mrow><mi>:</mi><mi>m</mi><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow><mtext>
</mtext><mrow><mspace width="1.0em"/><mo>∨</mo><mi> </mi><mo>∃</mo><msup><mi>m</mi><mi>'</mi></msup><mo>∈</mo><mi>X</mi><mo>.</mo><mi>f</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mi>s</mi><mi>:</mi></mrow><mtext>
</mtext><mrow><mspace width="3.0em"/><msup><mi>m</mi><mi>'</mi></msup><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>=</mo><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow><mo>∧</mo><mo>¬</mo><msup><mi>m</mi><mi>'</mi></msup><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mo>∧</mo><msup><mi>m</mi><mi>'</mi></msup><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>m</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow><mtext>
</mtext><mrow><mspace width="3.0em"/><mo>∧</mo><msup><mi>m</mi><mi>'</mi></msup><mi>:</mi><msub><mi>T</mi><mi>m</mi></msub><mo>∧</mo><mi>m</mi><mi>:</mi><msub><mi>T</mi><msup><mi>m</mi><mi>'</mi></msup></msub><mo>∧</mo><msub><mi>T</mi><mi>m</mi></msub><mo>=</mo><msub><mi>T</mi><msup><mi>m</mi><mi>'</mi></msup></msub></mrow><mtext>
</mtext><mrow><mspace width="3.0em"/><mo>∧</mo><msup><mi>m</mi><mi>'</mi></msup><mo>.</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>a</mi><mi>b</mi><mi>i</mi><mi>l</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo>≥</mo><mi>m</mi><mo>.</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>a</mi><mi>b</mi><mi>i</mi><mi>l</mi><mi>i</mi><mi>t</mi><mi>y</mi></mrow></mrow></math></p>
</li>
<li>
<p>A type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math> is a subtype of a structural read-only field
version of a type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>, if it contains all public,
non-optional and non-static readable fields of the type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>X</mi><mi>T</mi></mrow><mrow><mrow><mo>∀</mo><mi>m</mi><mo>∈</mo><mi>T</mi><mo>.</mo><mi>f</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mi>s</mi><mo>∪</mo><mi>T</mi><mo>.</mo><mi>g</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo>,</mo><mi>m</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>r</mi><mo>∉</mo><mrow><mi>N</mi><mn>4</mn><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow><mo>,</mo><mi>m</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>=</mo><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow><mo>,</mo><mo>¬</mo><mi>m</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi></mrow><mtext>
</mtext><mrow><mrow><mspace width="1.0em"/><msup><mi>m</mi><mi>'</mi></msup><mo>∈</mo><mi>X</mi><mo>.</mo><mi>f</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mi>s</mi><mo>∪</mo><mi>X</mi><mo>.</mo><mi>g</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>s</mi></mrow><mi>:</mi><mi>m</mi><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow><mtext>
</mtext><mrow><mspace width="1.0em"/><mo>∨</mo><mi> </mi><mo>∃</mo><msup><mi>m</mi><mi>'</mi></msup><mo>∈</mo><mi>X</mi><mo>.</mo><mi>f</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mi>s</mi><mo>∪</mo><mi>X</mi><mo>.</mo><mi>g</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>:</mi></mrow><mtext>
</mtext><mrow><mspace width="3.0em"/><msup><mi>m</mi><mi>'</mi></msup><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>=</mo><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow><mo>∧</mo><mo>¬</mo><msup><mi>m</mi><mi>'</mi></msup><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mo>∧</mo><msup><mi>m</mi><mi>'</mi></msup><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>m</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow><mtext>
</mtext><mrow><mspace width="3.0em"/><mo>∧</mo><msup><mi>m</mi><mi>'</mi></msup><mi>:</mi><msub><mi>T</mi><mi>m</mi></msub><mo>∧</mo><mi>m</mi><mi>:</mi><msub><mi>T</mi><msup><mi>m</mi><mi>'</mi></msup></msub><mo>∧</mo><msub><mi>T</mi><mi>m</mi></msub><mo>=</mo><msub><mi>T</mi><msup><mi>m</mi><mi>'</mi></msup></msub></mrow><mtext>
</mtext><mrow><mspace width="3.0em"/><mo>∧</mo><msup><mi>m</mi><mi>'</mi></msup><mo>.</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>a</mi><mi>b</mi><mi>i</mi><mi>l</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo>≥</mo><mi>m</mi><mo>.</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>a</mi><mi>b</mi><mi>i</mi><mi>l</mi><mi>i</mi><mi>t</mi><mi>y</mi></mrow></mrow></math></p>
</li>
<li>
<p>A type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math> is a subtype of a structural write-only field
version of a type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>, if it contains all public,
non-optional and non-static writable fields of the type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>X</mi><mi>T</mi></mrow><mrow><mrow><mo>∀</mo><mi>m</mi><mo>∈</mo><mi>T</mi><mo>.</mo><mi>f</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mi>s</mi><mo>∪</mo><mi>T</mi><mo>.</mo><mi>s</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo>,</mo><mi>m</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>r</mi><mo>∉</mo><mrow><mi>N</mi><mn>4</mn><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow><mo>,</mo><mi>m</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>=</mo><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow><mo>,</mo><mo>¬</mo><mi>m</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mo>,</mo><mo>¬</mo><mi>m</mi><mo>.</mo><mi>f</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow><mtext>
</mtext><mrow><mrow><mspace width="1.0em"/><msup><mi>m</mi><mi>'</mi></msup><mo>∈</mo><mi>X</mi><mo>.</mo><mi>f</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mi>s</mi><mo>∪</mo><mi>X</mi><mo>.</mo><mi>s</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>s</mi></mrow><mi>:</mi><mi>m</mi><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow><mtext>
</mtext><mrow><mspace width="1.0em"/><mo>∨</mo><mi> </mi><mo>∃</mo><msup><mi>m</mi><mi>'</mi></msup><mo>∈</mo><mi>X</mi><mo>.</mo><mi>f</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mi>s</mi><mo>∪</mo><mi>X</mi><mo>.</mo><mi>s</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>:</mi></mrow><mtext>
</mtext><mrow><mspace width="3.0em"/><msup><mi>m</mi><mi>'</mi></msup><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>=</mo><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow><mo>∧</mo><mo>¬</mo><msup><mi>m</mi><mi>'</mi></msup><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mo>∧</mo><msup><mi>m</mi><mi>'</mi></msup><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>m</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow><mtext>
</mtext><mrow><mspace width="3.0em"/><mo>∧</mo><msup><mi>m</mi><mi>'</mi></msup><mi>:</mi><msub><mi>T</mi><mi>m</mi></msub><mo>∧</mo><mi>m</mi><mi>:</mi><msub><mi>T</mi><msup><mi>m</mi><mi>'</mi></msup></msub><mo>∧</mo><msub><mi>T</mi><mi>m</mi></msub><mo>=</mo><msub><mi>T</mi><msup><mi>m</mi><mi>'</mi></msup></msub></mrow><mtext>
</mtext><mrow><mspace width="3.0em"/><mo>∧</mo><msup><mi>m</mi><mi>'</mi></msup><mo>.</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>a</mi><mi>b</mi><mi>i</mi><mi>l</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo>≥</mo><mi>m</mi><mo>.</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>a</mi><mi>b</mi><mi>i</mi><mi>l</mi><mi>i</mi><mi>t</mi><mi>y</mi></mrow></mrow></math></p>
</li>
<li>
<p>A type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math> is a subtype of a structural field version of
a type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi></math>, if it contains all public, non-static
and non-optional fields, either defined via data fields or field get
accessors, of the inferred type of <code>this</code>. <em>All fields which have an
initializer are handled as if they were optional.</em>
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>X</mi><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi></mrow><mrow><mrow><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi><mi>:</mi><mi>T</mi></mrow><mtext>
</mtext><mrow><mo>∀</mo><mi>m</mi><mo>∈</mo><mi>T</mi><mo>.</mo><mi>f</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mi>s</mi><mo>∪</mo><mi>T</mi><mo>.</mo><mi>s</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo>,</mo><mi>m</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>r</mi><mo>∉</mo><mrow><mi>N</mi><mn>4</mn><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow><mo>,</mo><mi>m</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>=</mo><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow><mo>,</mo><mo>¬</mo><mi>m</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi></mrow><mtext>
</mtext><mrow><mrow><mspace width="1.0em"/><msup><mi>m</mi><mi>'</mi></msup><mo>∈</mo><mi>X</mi><mo>.</mo><mi>f</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mi>s</mi><mo>∪</mo><mi>X</mi><mo>.</mo><mi>g</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>s</mi></mrow><mi>:</mi><mi>m</mi><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>a</mi><mi>l</mi><mo>∨</mo><mi>m</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo>≠</mo></mrow><mtext>
</mtext><mrow><mspace width="1.0em"/><mo>∨</mo><mi> </mi><mo>∃</mo><msup><mi>m</mi><mi>'</mi></msup><mo>∈</mo><mi>X</mi><mo>.</mo><mi>f</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mi>s</mi><mo>∪</mo><mi>X</mi><mo>.</mo><mi>g</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>:</mi></mrow><mtext>
</mtext><mrow><mspace width="3.0em"/><msup><mi>m</mi><mi>'</mi></msup><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mo>=</mo><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow><mo>∧</mo><mo>¬</mo><msup><mi>m</mi><mi>'</mi></msup><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mo>∧</mo><msup><mi>m</mi><mi>'</mi></msup><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>m</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow><mtext>
</mtext><mrow><mspace width="3.0em"/><mo>∧</mo><msup><mi>m</mi><mi>'</mi></msup><mi>m</mi></mrow><mo>∧</mo><msup><mi>m</mi><mi>'</mi></msup><mo>.</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>a</mi><mi>b</mi><mi>i</mi><mi>l</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo>≥</mo><mi>m</mi><mo>.</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>a</mi><mi>b</mi><mi>i</mi><mi>l</mi><mi>i</mi><mi>t</mi><mi>y</mi></mrow></math></p>
</li>
<li>
<p>A structural field type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> is a subtype of a
structural type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math>, if <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math> only
contains fields (except methods inherited from <code>Object</code>) and if
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>X</mi></math>. <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>T</mi><mi>X</mi></mrow><mrow><mi>X</mi><mo>.</mo><mi>m</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi><mi>s</mi><mo>∖</mo><mrow><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow><mo>.</mo><mi>m</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi><mi>s</mi><mo>=</mo><mi>∅</mi><mo>∧</mo><mi>T</mi><mi>X</mi></mrow></math></p>
</li>
<li>
<p>Use-site structural typing cannot be used for declaring supertypes
of classes or interfaces. That is to say that structural types cannot be
used after <code>extends</code>, <code>implements</code> or <code>eith</code> in type declarations.
<sup class="footnote">[<a id="_footnoteref_40" class="footnote" href="#_footnote_40" title="View footnote.">40</a>]</sup></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that all members of <code>N4Object</code> are excluded. This implies that extended
reflective features (cf. <a href="#reflection_meta-information">[reflection_meta-information]</a> ) are not available in the context of structural typing. The <code>instanceof</code> operator is still working as described in <a href="#Relational_Expression">[Relational_Expression]</a>, in
that it can be used to check the type of an instance.</p>
</div>
<div class="paragraph">
<p>If a type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math> is a (nominal) subtype of T, it is, of course,
also a subtype of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>X</mi><mi>T</mi></mrow><mrow><mi>X</mi><mi>T</mi></mrow></math>
This is only a shortcut for the type inference defined above.</p>
</div>
<div class="paragraph">
<p>77Definition and Use-Site Precedence</p>
</div>
<div class="paragraph">
<p>If a type is structurally typed on both definition and use-site, the rules for
use-site structural typing (<a href="#req:Use_Site_Structural_Typing">[req:Use_Site_Structural_Typing]</a>) are
applied.</p>
</div>
<div class="paragraph">
<p>Use-Site Structural Typing</p>
</div>
<div class="paragraph">
<p>The following example demonstrates the effect of the structural (field)
modifier, used in this case for function parameters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">interface I { public x: number; public foo()};
class C { public x: number; public foo() {}};

function n(p: I) {}
function f(p: ~I) {}
function g(p: ~~I) {}

n(new C());     // error: nominal typing, C does not implement I
f(new C());     // ok: C is a (structural) subtype of ~I
f({x:10});      // error, the object literal does not provide function foo()
g({x:10});      // ok: object literal provides all fields of I</code></pre>
</div>
</div>
<div class="paragraph">
<p>[[ex:Structural types variable and instanceof operator]]
It is possible to use a variable typed with a structural version of a type on the left hand side of the <code>instanceof</code> operator, as demonstrated in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class C {
    public x;
    public betterX() { return this.x||1;}
}

function f(p: ~~C) {
    if (p instanceof C) {
        console.log((p as C).betterX);
    } else {
        console.log(p.x||1);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table describes the member availability of <code>X</code> in various
typing scenarios. Such as <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math>,
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math>, <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math> and
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6669%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Member of type <em>X</em></p></th>
<td class="tableblock halign-center valign-top"><p class="tableblock">`~~X</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">`~r~X</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">`~w~X</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">`~i~X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>private m0;</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>public set m1(m) { }</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">write</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">write</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>public get m2() {&#8230;&#8203;}</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>public m3;</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read/write</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">write</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>public m4 = 'init.m4';</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read/write</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">write</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read <em>?</em>]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>public m5: any?;</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read<em>?</em>/write</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read<em>?</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">write</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>?</mi></math></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Final public m6 = 'init.m6';</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Final public m7;</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>public get m8() {&#8230;&#8203;}</code></p></td>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock">read/write</p></td>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock">read</p></td>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock">write</p></td>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock">read</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>public set m8(m) { }</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_structural_read_only_write_only_and_initializer_field_typing"><a class="anchor" href="#_structural_read_only_write_only_and_initializer_field_typing"></a>7.4. Structural Read-only, Write-only and Initializer Field Typing</h3>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1777" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1777</a>
</div>
</div>
<div class="paragraph">
<p>Structural read-only, write-only and initializer field typings are
extensions of structural field typing. Everything that is defined for
the field structural typing must comply with these extension field
typings. For the read-only type, readable fields (mutable and ones) and
setters are considered, for the write-only type; only the setters and
mutable fields are considered. Due to the hybrid nature of the
initializer type it can act two different ways. To be more precise, a
type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math> (structural initializer field type) is a supertype
of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Y</mi></math> (structural initializer field type) if for each
public, non-static, non-optional writable field (mutable data field of
setter) of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math>, there is a corresponding, public, non-static
readable field of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Y</mi></math>. All public member fields with
annotation are considered to be mandatory in the initializer field
typing constructors. The already-initialized fields can be either
omitted from, or can be re-initialized via, an initializer field typing
style constructor.</p>
</div>
<div class="paragraph">
<p>Subtype relationship between structural field typing
[[ex:Subtype relationship between structural field typing]]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class A1 {
    public s: string;
}

class A2 {
    public set s(s: string) { }
    public get s(): string { return null; }
}

class A3 {
    @Final public s: string = null;
}

class A4 {
    public get s(): string { return null; }
}

class A5 {
    public set s(s: string) { }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread matrix">
<colgroup>
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2642%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<th class="tableblock halign-left valign-top"><p class="tableblock">A1</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">~A1</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">~~A1</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">~r~A1</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">~r~A2</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">~r~A3</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">~r~A4</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">~r~A5</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">~w~A1</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">~w~A2</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">~w~A3</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">~w~A4</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">~w~A5</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">~i~A1</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">~i~A2</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">~i~A3</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">~r~A4</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">~r~A5</p></th>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">A1</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">~A1</p></th>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">~~A1</p></th>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">~r~A1</p></th>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">~r~A2</p></th>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">~r~A3</p></th>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">~r~A4</p></th>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">~r~A5</p></th>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">~w~A1</p></th>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">~w~A2</p></th>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">~w~A3</p></th>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">~w~A4</p></th>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">~w~A5</p></th>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">~i~A1</p></th>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">~i~A2</p></th>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">~i~A3</p></th>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">~r~A4</p></th>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">~r~A5</p></th>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✓</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_public_setter_annotated_with_code_providesinitializer_code"><a class="anchor" href="#_public_setter_annotated_with_code_providesinitializer_code"></a>7.5. Public Setter Annotated With <code>ProvidesInitializer</code></h3>
<div class="paragraph">
<p>Public setters with <code>ProvidesInitializer</code> annotation can declare optional fields implemented by means of field accessors instead of data fields. Data fields with an
initializer are treated as optional in the initializer field type.</p>
</div>
<div class="paragraph">
<p>It is important to note that it is valid to use the <code>ProvidesInitializer</code> annotation for
setters in <code>n4js</code> files and not only definition files.</p>
</div>
<div class="paragraph">
<p>[[ex:Setters with @ProvidesInitializer treated as optional]]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class C {
    private _y: int = 1;

    public get y() { return this._y; }
    @ProvidesInitializer
    public set y(v: int) { this._y = v; }

    public constructor(@Spec spec: ~i~this) { }
}

console.log(new C({}).y); // 1
console.log(new C({y: 42}).y); //24</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_structural_types_with_optional_fields"><a class="anchor" href="#_structural_types_with_optional_fields"></a>7.6. Structural Types With Optional Fields</h3>
<div class="paragraph">
<p>Public optional fields become a member of the structural (field) type as
well. But they will be optional in the structural type, that is to say
it is not necessary to define the field.</p>
</div>
<div class="paragraph">
<p>If a type defines an optional field then this type is always compatible
with a type that does not define a field with same name and type but is
equal in all other members.</p>
</div>
<div class="paragraph">
<p>[[ex:Optional field on one side]]</p>
</div>
<div class="listingblock">
<div class="title">Optional field on one side</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class C {
    public s: number;
    public t: string?;
}
class D {
    public s: number;
}
function f(c: ~C) {}
f(new D()); // ok: D is a (structural) subtype of ~C
function g(~D d) {}
g(new C()); // ok: C is a (structural) subtype of ~D</code></pre>
</div>
</div>
<div class="paragraph">
<p>[[ex:Optional field on one side]]</p>
</div>
<div class="listingblock">
<div class="title">Optional field on one side</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class C {
    public s: number;
    public t: string?;
}
class D {
    public s: number;
    public t: string?;
}
class E {
    public s: number;
    public t: number?;
}
class F {
    public s: number;
    public t: string;
}
function f(c: ~C) {}
f(new D()); // ok: D is a (structural) subtype of ~C
f(new E()); // error: E is not (structural) subtype of ~C, as t types differ (string vs number)
f(new F()); // ok: F is a (structural) subtype of ~C
function g(f: ~F) {}
g(new C()); // ok: C is a (structural) subtype of ~F</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_structural_types_with_access_modifier"><a class="anchor" href="#_structural_types_with_access_modifier"></a>7.7. Structural Types With Access Modifier</h3>
<div class="paragraph">
<p>The access modifier of the subtype have to provide equal or higher
visibility.</p>
</div>
<div class="paragraph">
<p>Access modifier in structural typing
[[ex:Access modifier in structural typing]]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class C {
    public s: number;
}
class D {
    project s: number;
}
function f(c: ~C) {}
f(new D()); // error: D is no (structural) subtype of ~C, as visibility of s in D is lower
function g(d: ~D) {}
g(new C()); // ok: C is a (structural) subtype of ~D, as visibility of s in C is greater-than-or-equal to s in D</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_structural_types_with_additional_members"><a class="anchor" href="#_structural_types_with_additional_members"></a>7.8. Structural Types With Additional Members</h3>
<div class="paragraph">
<p>It is possible to add additional members when structurally referencing a
declared type.</p>
</div>
<div class="sect3">
<h4 id="_syntax_7"><a class="anchor" href="#_syntax_7"></a>7.8.1. Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>TStructMember:
    TStructGetter | TStructGetterES4 | TStructSetter | TStructMethod | TStructMethodES4 | TStructField;

TStructMethod:
    =&gt;
    ({TStructMethod} ('&lt;' typeVars+=TypeVariable (',' typeVars+=TypeVariable)* '&gt;')?
    returnTypeRef=TypeRef name=TypesIdentifier '(')
        (fpars+=TAnonymousFormalParameter (',' fpars+=TAnonymousFormalParameter)*)? ')'
    ';'?;

TStructMethodES4 returns TStructMethod:
    =&gt;
    ({TStructMethod} ('&lt;' typeVars+=TypeVariable (',' typeVars+=TypeVariable)* '&gt;')?
        name=TypesIdentifier '(')
        (fpars+=TAnonymousFormalParameter (',' fpars+=TAnonymousFormalParameter)*)? ')'
        (':' returnTypeRef=TypeRef)?
    ';'?;

TStructField:
    (
        typeRef=TypeRef name=TypesIdentifier
        | name=TypesIdentifier (':' typeRef=TypeRef)?
    )
    ';';

TStructGetter:
    =&gt; ({TStructGetter}
    declaredTypeRef=TypeRef
    'get'
    name=TypesIdentifier)
    '(' ')' ';'?;

TStructGetterES4 returns TStructGetter:
    =&gt; ({TStructGetter}
    'get'
    name=TypesIdentifier)
    '(' ')' (':' declaredTypeRef=TypeRef)? ';'?;

TStructSetter:
    =&gt; ({TStructSetter}
    'set'
    name=TypesIdentifier)
    '(' fpar=TAnonymousFormalParameter ')' ';'?;

TAnonymousFormalParameter:
    typeRef=TypeRef variadic?='...'? name=TIdentifier?
    | variadic?='...'? (=&gt; name=TIdentifier ':') typeRef=TypeRef;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_semantics_5"><a class="anchor" href="#_semantics_5"></a>Semantics</h5>
<div class="paragraph">
<p>[[req:Additional structural members]]</p>
</div>
<div class="paragraph">
<p>It is only possible to add additional members to a type if use-site structural
typing is used. The following constraints must hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>For all additional members defined in a structural type reference,
the constraints for member overriding (<a href="#req:Overriding_Members">[req:Overriding_Members]</a>) apply
as well.</p>
</li>
<li>
<p>All additional members have the access modifier set to
<math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>p</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi></mrow></math>.</p>
</li>
<li>
<p>Type variables must not be augmented with additional structural
members.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Additional fields may be declared optional in the same way as fields in
classes. The rules given in <a href="#_structural_types_with_optional_fields">Structural Types With Optional Fields</a> apply accordingly. Consider the following example:</p>
</div>
<div class="paragraph">
<p>Additional optional members in structural typing</p>
</div>
<div id="ex:Additional_optional_members_in_structural_typing" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class C {
    public f1: number;
}

var c1: ~C with { f3: string; } c1;
var c2: ~C with { f3: string?; } c2;

c1 = { f1:42 };  // error: "~Object with { number f1; } is not a subtype of ~C with { string f3; }."
c2 = { f1:42 };  // ok!!</code></pre>
</div>
</div>
<div class="paragraph">
<p>Augmenting a type variable T with additional structural members can
cause collisions with another member of a type argument for T. Hence,
type variables must not be augmented with additional structural members
like in the following example.</p>
</div>
<div class="paragraph">
<p>Forbidden additional structural members on type variables</p>
</div>
<div id="ex:Forbidden_additional_structural_members_on_type_variables" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">interface I&lt;T&gt; {
    public field : ~T with {prop : int} // error "No additional structural members allowed on type variables."
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using an additional structural member on a type variable T could be seen
as a constraint to T. However, constraints like this should be rather
stated using an explicit interface like in the example below.</p>
</div>
<div class="paragraph">
<p>Use explicitly defined Interfaces</p>
</div>
<div id="ex:Use_explicitly_defined_Interfaces" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">interface ~J {
    prop : int;
}
interface II&lt;T extends J&gt; {
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_functions"><a class="anchor" href="#_functions"></a>8. Functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Functions, be they function declarations, expressions or even methods,
are internally modeled by means of a function type. In this chapter, the
general function type is described along with its semantics and type
constraints. Function definitions and expressions are then introduced in
terms of statements and expressions. Method definitions and special
usages are described in <a href="#_methods">Methods</a></p>
</div>
<div class="sect2">
<h3 id="_function_type"><a class="anchor" href="#_function_type"></a>8.1. Function Type</h3>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-12" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-12</a>
</div>
</div>
<div class="paragraph">
<p>A function type is modeled as (see [<a href="#ECMA11a">ECMA11a(p.S13, p.p.98)</a>] in ECMAScript .</p>
</div>
<div class="paragraph">
<p>Function types can be defined by means of;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A function object (<a href="#Function_Object_Type">[Function_Object_Type]</a>).</p>
</li>
<li>
<p>A function type expression (<a href="#Type_Expressions">[Type_Expressions]</a>).</p>
</li>
<li>
<p>A function declaration (<a href="#Function_Definition">[Function_Definition]</a>).</p>
</li>
<li>
<p>A method declaration (<a href="#_methods">Methods</a>).</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_properties_5"><a class="anchor" href="#_properties_5"></a>8.1.1. Properties</h4>
<div class="paragraph">
<p>In any case, a function type declares the signature of a function and
allows validation of calls to that function. A function type has the
following properties:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>typePars</code> </dt>
<dd>
<p>(0-indexed) list of type parameters (i.e. type variables) for generic
functions.</p>
</dd>
<dt class="hdlist1"><code>fpars</code> </dt>
<dd>
<p>(0-indexed) list of formal parameters.</p>
</dd>
<dt class="hdlist1"><code>returnType</code> </dt>
<dd>
<p>(possibly inferred) return type (expression) of the function or method.</p>
</dd>
<dt class="hdlist1"><code>name</code> </dt>
<dd>
<p>Name of function or method, may be empty or automatically generated (for
messages).</p>
</dd>
<dt class="hdlist1"><code>body</code> </dt>
<dd>
<p>The body of the function, it contains statements <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mi>t</mi><mi>m</mi><mi>t</mi><mi>s</mi></math>.
The body is null if a function type is defined in a type expression, and
it is the last argument in case of a function object constructor, or the
content of the function definition body.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Additionally, the following pseudo properties for functions are defined:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>thisTypeRef</code> </dt>
<dd>
<p>The this type ref is the type to which the <code>this</code>-keyword would be evaluated
if used inside the function or member. The inference rules are described
in <a href="#This_Keyword">[This_Keyword]</a>.</p>
</dd>
<dt class="hdlist1"><code>fpars</code> </dt>
<dd>
<p>List of formal parameters and the this type ref. This is only used for
sub typing rules. If <code>this</code> is not used inside the function, then <code>any</code> is set
instead of the inferred thisTypeRef to allow for more usages. The
property is computed as follows:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>t</mi><mi>f</mi><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>=</mo><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi> </mi><mrow><mtext>this is used or explicitly declared</mtext></mrow><mi> </mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mo>+</mo><mi>f</mi><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>a</mi><mi>n</mi><mi>y</mi><mo>+</mo><mi>f</mi><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi></math></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Parameters (in <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi></math>) have the following properties:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>name</code> </dt>
<dd>
<p>Name of the parameter.</p>
</dd>
<dt class="hdlist1"><code>type</code> </dt>
<dd>
<p>Type (expression) of the parameter. Note that only parameter types can
be variadic or optional.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The function definition can be annotated similar to <a href="#_methods">Methods</a> except that
the <code>final</code> and <code>abstract</code> modifiers aren’t supported for function declarations. A function declaration is always final and never abstract. Also, a function has no
property advice set.</p>
</div>
<h4 id="_semantics_6" class="discrete">Semantics</h4>
<div class="paragraph">
<p>Type Given a function type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi></math>, the following
constraints must be true:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Optional parameters must be defined at the end of the (formal)
parameter list. In particular, an optional parameter must not be
followed by a non-optional parameter:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi><mo>.</mo><mi>f</mi><mi>p</mi><mi>a</mi><mi>r</mi><msub><mi>s</mi><mi>i</mi></msub><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>a</mi><mi>l</mi><mi> </mi><mi>k</mi><mi>g</mi><mi>t</mi><mi>;</mi><mi>i</mi><mi>:</mi><mo>¬</mo><mi>F</mi><mo>.</mo><mi>f</mi><mi>p</mi><mi>a</mi><mi>r</mi><msub><mi>s</mi><mi>k</mi></msub><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi><mi>v</mi><mi>a</mi><mi>r</mi></math></p>
</li>
<li>
<p>Only the last parameter of a method may be defined as variadic
parameter:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi><mo>.</mo><mi>f</mi><mi>p</mi><mi>a</mi><mi>r</mi><msub><mi>s</mi><mi>i</mi></msub><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>d</mi><mi>i</mi><mi>c</mi><mi>i</mi><mo>=</mo><mo>|</mo><mi>F</mi><mo>.</mo><mi>f</mi><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>|</mo><mo>-</mo><mn>1</mn></math></p>
</li>
<li>
<p>If a function explicitly defines a return type, the last statement
of the transitive closure of statements of the body must be a return
statement:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>math:[\[\begin{aligned}    F.typeRef \neq Undefined \to \\
        &amp; |f.body.stmts|&gt;0 \\
        &amp; \land f.body.stmts^*_{|f.body.stmts^*|-1} isa\ \lstnfbnf{ReturnStatement}
        \end{aligned}\]]</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If a function explicitly defines a return type, all return
statements must return a type conform to that type:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>F</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mo>≠</mo><mi>U</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∀</mo><mi>r</mi><mo>∈</mo><mi>F</mi><mo>.</mo><mi>b</mi><mi>o</mi><mi>d</mi><mi>y</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>m</mi><mi>t</mi><mi>s</mi><mo>,</mo><mi>r</mi><mi> </mi><mi>i</mi><mi>s</mi><mi>a</mi><mi> </mi><mrow><mi>R</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>S</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow><mi>:</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>r</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo>≠</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi><mo>∧</mo><mrow><mi>r</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi></mrow><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mrow><mi>F</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi></mrow></math></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="function-type-inference"><a class="anchor" href="#function-type-inference"></a>8.1.2. Type Inference</h4>
<div class="openblock definition">
<div class="content">
<div class="paragraph">
<p><strong>Definition:</strong> <a href="#function_type_conformance__non_parameterized">Function Type Conformance, Non-Parameterized</a></p>
</div>
<div class="paragraph">
<p>For the given non-parameterized function types<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub></math> with
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub><mo>.</mo><mi>t</mi><mi>f</mi><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>=</mo><msub><mi>L</mi><mn>0</mn></msub><mo>,</mo><msub><mi>L</mi><mn>1</mn></msub><mo>,</mo><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi><msub><mi>L</mi><mi>k</mi></msub></math> and
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>|</mo><msub><mi>F</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>s</mi><mi>P</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>|</mo><mo>=</mo><mn>0</mn></math><br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub></math> with
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub><mo>.</mo><mi>t</mi><mi>f</mi><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>=</mo><msub><mi>R</mi><mn>0</mn></msub><mo>,</mo><msub><mi>R</mi><mn>1</mn></msub><mo>,</mo><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi><msub><mi>R</mi><mi>n</mi></msub></math> and
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>|</mo><msub><mi>F</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>s</mi><mi>P</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>|</mo><mo>=</mo><mn>0</mn></math>,<br>
we say <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub></math> conforms to <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub></math>,
written as <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><msub><mi>F</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub></math>, if and only if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub><mo>.</mo><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>=</mo><mrow><mi>v</mi><mi>o</mi><mi>i</mi><mi>d</mi></mrow></math><br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∨</mo><mfenced close=")" open="("><mrow><msub><mi>F</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub><mo>.</mo><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>=</mo><mrow><mi>v</mi><mi>o</mi><mi>i</mi><mi>d</mi></mrow><mo>∧</mo><msub><mi>F</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi></mrow></mfenced></math><br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∨</mo><mfenced close=")" open="("><mrow><msub><mi>F</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub><mo>.</mo><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><msub><mi>F</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub><mo>.</mo><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>∧</mo><mo>¬</mo><mfenced close=")" open="("><mrow><msub><mi>F</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi><mo>∧</mo><mo>¬</mo><msub><mi>F</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi></mrow></mfenced></mrow></mfenced></math></p>
</li>
<li>
<p>if <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi><mo>≤</mo><mi>n</mi></math>:</p>
<div class="ulist">
<ul>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><mi> </mi><mi>i</mi><mo>,</mo><mn>1</mn><mo>≤</mo><mi>i</mi><mo>≤</mo><mi>k</mi><mi>:</mi><mfenced close=")" open="("><mrow><msub><mi>R</mi><mi>i</mi></msub><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi><mfenced close=")" open="("><mrow><msub><mi>L</mi><mi>i</mi></msub><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi><mo>∨</mo><msub><mi>L</mi><mi>i</mi></msub><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi></mrow></mfenced></mrow></mfenced><mo>∧</mo><mfenced close=")" open="("><mrow><msub><mi>R</mi><mi>i</mi></msub><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi><msub><mi>L</mi><mi>i</mi></msub><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi></mrow></mfenced></math></p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><mi> </mi><mi>i</mi><mo>,</mo><mn>1</mn><mo>≤</mo><mi>i</mi><mo>≤</mo><mi>k</mi><mi>:</mi><msub><mi>L</mi><mi>i</mi></msub><mi>:</mi><mi>g</mi><mi>t</mi><mi>;</mi><msub><mi>R</mi><mi>i</mi></msub></math></p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>L</mi><mi>k</mi></msub><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi><mo>=</mo><mi>t</mi><mi>r</mi><mi>u</mi><mi>e</mi><mo>∀</mo><mi> </mi><mi>i</mi><mo>,</mo><mi>k</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>i</mi><mo>≤</mo><mi>n</mi><mi>:</mi><msub><mi>L</mi><mi>K</mi></msub><mi>:</mi><mi>g</mi><mi>t</mi><mi>;</mi><msub><mi>R</mi><mi>i</mi></msub></math></p>
<div class="paragraph">
<p>else (<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi><mi>g</mi><mi>t</mi><mi>;</mi><mi>n</mi></math>):</p>
</div>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><mi> </mi><mi>i</mi><mo>,</mo><mn>1</mn><mo>≤</mo><mi>i</mi><mo>≤</mo><mi>n</mi><mi>:</mi><mfenced close=")" open="("><mrow><msub><mi>R</mi><mi>i</mi></msub><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi><mfenced close=")" open="("><mrow><msub><mi>L</mi><mi>i</mi></msub><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi><mo>∨</mo><msub><mi>L</mi><mi>i</mi></msub><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi></mrow></mfenced></mrow></mfenced><mo>∧</mo><mfenced close=")" open="("><mrow><msub><mi>R</mi><mi>i</mi></msub><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi><msub><mi>L</mi><mi>i</mi></msub><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi></mrow></mfenced></math></p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><mi> </mi><mi>i</mi><mo>,</mo><mn>1</mn><mo>≤</mo><mi>i</mi><mo>≤</mo><mi>n</mi><mi>:</mi><msub><mi>L</mi><mi>i</mi></msub><mi>:</mi><mi>g</mi><mi>t</mi><mi>;</mi><msub><mi>R</mi><mi>i</mi></msub></math></p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><mi> </mi><mi>n</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>i</mi><mo>≤</mo><mi>k</mi><mi>:</mi><msub><mi>L</mi><mi>i</mi></msub><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi><mo>∨</mo><msub><mi>L</mi><mi>i</mi></msub><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi></math></p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>R</mi><mi>n</mi></msub><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi><mo>=</mo><mi>t</mi><mi>r</mi><mi>u</mi><mi>e</mi><mo>∀</mo><mi> </mi><mi>i</mi><mo>,</mo><mi>n</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>i</mi><mo>≤</mo><mi>k</mi><mi>:</mi><msub><mi>L</mi><mi>i</mi></msub><mi>:</mi><mi>g</mi><mi>t</mi><mi>;</mi><msub><mi>R</mi><mi>n</mi></msub></math></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#cdVarianceFunctionChart">Function Variance Chart</a> shows a simple example with the function type conformance relations.</p>
</div>
<div id="cdVarianceFunctionChart" class="imageblock">
<div class="content">
<img src="fig/cdVarianceFunctionChart.png" alt="cdVarianceFunctionChart">
</div>
<div class="title">Figure 3. Function Variance Chart</div>
</div>
<div class="paragraph">
<p><code>{function()} $&lt;:$ {function(A)} $&lt;:$ {function(A, A)}</code> might be surprising for Java programmers. However, in JavaScript it is
possible to call a function with any number of arguments independently
from how many formal parameters the function defines. </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-433" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-433</a>
</div>
</div>
<div class="paragraph">
<p>If a function does not define a return type, <code>any</code> is assumed if at least one
of the (indirectly) contained return statements contains an expression.
Otherwise is assumed. This is also true if there is an error due to
other constraint violations. <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>f</mi><mrow><mi>'</mi><mrow><mo>(</mo><mi>'</mi></mrow></mrow><mi>a</mi><mi>r</mi><mi>g</mi><mi>l</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi> </mi><msup><mrow><mi>'</mi><mo>)</mo></mrow><mi>'</mi></msup><mi>:</mi><mrow><mi>a</mi><mi>n</mi><mi>y</mi></mrow></mrow><mrow><mi>b</mi><mi>i</mi><mi>n</mi><mi>d</mi><mi>s</mi><mfenced close=")" open="("><mi>f</mi><mi>F</mi></mfenced><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>F</mi><mo>.</mo><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>=</mo><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∃</mo><mi>r</mi><mo>∈</mo><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>s</mi><mfenced close=")" open="("><mi>F</mi></mfenced><mi>:</mi><mi>r</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>≠</mo></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>f</mi><mrow><mi>'</mi><mrow><mo>(</mo><mi>'</mi></mrow></mrow><mi>a</mi><mi>r</mi><mi>g</mi><mi>l</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi> </mi><msup><mrow><mi>'</mi><mo>)</mo></mrow><mi>'</mi></msup><mi>:</mi><mrow><mi>v</mi><mi>o</mi><mi>i</mi><mi>d</mi></mrow></mrow><mrow><mi>b</mi><mi>i</mi><mi>n</mi><mi>d</mi><mi>s</mi><mfenced close=")" open="("><mi>f</mi><mi>F</mi></mfenced><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>F</mi><mo>.</mo><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>=</mo><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∀</mo><mi>r</mi><mo>∈</mo><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>s</mi><mfenced close=")" open="("><mi>F</mi></mfenced><mi>:</mi><mi>r</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>≠</mo></mrow></math>
with <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>s</mi><mfenced close=")" open="("><mi>F</mi></mfenced><mi>:</mi><mi>R</mi><mi>E</mi><mi>T</mi><mi>S</mi></mrow><mrow><mfenced close="}" open="{"><mrow><mi>r</mi><mo>∈</mo><mi>F</mi><mo>.</mo><mi>b</mi><mi>o</mi><mi>d</mi><mi>y</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>s</mi><mo>|</mo><mi>μ</mi><mfenced close=")" open="("><mi>r</mi></mfenced><mo>=</mo><mrow><mi>R</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>S</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow></mrow></mfenced><mo>∪</mo><munder><mo>⋃</mo><mrow><mi>s</mi><mo>∈</mo><mi>F</mi><mo>.</mo><mi>b</mi><mi>o</mi><mi>d</mi><mi>y</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>s</mi></mrow></munder><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>s</mi><mfenced close=")" open="("><mi>s</mi></mfenced></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>s</mi><mfenced close=")" open="("><mi>s</mi></mfenced><mi>:</mi><mi>R</mi><mi>E</mi><mi>T</mi><mi>S</mi></mrow><mrow><mfenced close="}" open="{"><mrow><mi>s</mi><mi>u</mi><mi>b</mi><mo>∈</mo><mi>s</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>s</mi><mo>|</mo><mi>μ</mi><mfenced close=")" open="("><mrow><mi>s</mi><mi>u</mi><mi>b</mi></mrow></mfenced><mo>=</mo><mrow><mi>R</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>S</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow></mrow></mfenced><mo>∪</mo><munder><mo>⋃</mo><mrow><mi>s</mi><mi>u</mi><mi>b</mi><mo>∈</mo><mi>s</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>s</mi></mrow></munder><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>s</mi><mfenced close=")" open="("><mrow><mi>s</mi><mi>u</mi><mi>b</mi></mrow></mfenced></mrow></math></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Function type conformance
[[ex:Function type conformance]]
The following incomplete snippet demonstrates the usage of two function variables
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mn>1</mn></math> and <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mn>2</mn></math>, in which
<math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>f</mi><mn>2</mn></mrow><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mrow><mi>f</mi><mn>1</mn></mrow></math> must hold true according to
the aforementioed constraints. A function <code>bar</code> declares a parameter
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mn>1</mn></math>, which is actually a function itself. <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mn>2</mn></math>
is a variable, to which a function expression is a assigned. Function <code>bar</code> is
then called with <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mn>2</mn></math> as an argument. Thus, the type of
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mn>2</mn></math> must be a subtype of the <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mn>1</mn></math>’s type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">function bar(f1: {function(A,B):C}) { ... }

var f1: {function(A,B):C} = function(p1,p2){...};
bar(f1);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The type of can be explicitly set via the annotation.</p>
</div>
<div class="paragraph">
<p>Function Subtyping
[[ex:Function Subtyping]]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>function f(): A {..}
function p(): void {..}

fAny(log: {function():any}) {...}
fVoid(f: {function():void}) {..}
fA(g: {function():A}) {...}

fAny(f);    // --&gt; ok       A &lt;: any
fVoid(f);   // --&gt;error     A !&lt;: void
fA(f);      // --&gt; ok (easy)    A &lt;: A

fAny(p);    // --&gt; ok       void &lt;: any
fVoid(p);   // --&gt; ok       void &lt;: void
fA(p);      // --&gt; error    void !&lt;: A</code></pre>
</div>
</div>
<div class="paragraph">
<p>Subtyping with function types
[[ex:Subtyping_with function types]]
If classes A, B, and C are defined as previously mentioned
(<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>B</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>A</mi></math>)</p>
</div>
<div class="paragraph">
<p>The following subtyping relations with function types are to be
evaluated as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>{function():void} &lt;: {function():void}              -&gt; true
{function(A):A} &lt;: {function(A):A}                  -&gt; true
{function(A):void} &lt;: {function(B):void}            -&gt; true
{function():B} &lt;: {function():A}                    -&gt; true
{function(A):B} &lt;: {function(B):A}                  -&gt; true
{function(A):A} &lt;: {function(B):void}               -&gt; true (!)
{function(A):A} &lt;: {function(B):any}                -&gt; true
{function(A):A} &lt;: {function(B)}                    -&gt; true
{function(A):void} &lt;: {function(B):any}             -&gt; false (!)
{function(A):void} &lt;: {function(B)}                 -&gt; true
{function(A):void} &lt;: {function(B):A}               -&gt; false</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following examples demonstrate the effect of optional and variadic
parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>{function(A)} &lt;: {function(B)}                      -&gt; true
{function(A...)} &lt;: {function(A)}                   -&gt; true
{function(A, A)} &lt;: {function(A)}                   -&gt; false
{function(A)} &lt;: {function(A,A)}                    -&gt; true (!)
{function(A, A...)} &lt;: {function(A)}                -&gt; true
{function(A)} &lt;: {function(A,A...)}                 -&gt; true (!)
{function(A, A...)} &lt;: {function(B)}                -&gt; true
{function(A?)} &lt;: {function(A?)}                    -&gt; true
{function(A...)} &lt;: {function(A...)}                -&gt; true
{function(A?)} &lt;: {function(A)}                     -&gt; true
{function(A)} &lt;: {function(A?)}                     -&gt; false
{function(A...)} &lt;: {function(A?)}                  -&gt; true
{function(A?)} &lt;: {function(A...)}                  -&gt; true (!)
{function(A,A...)} &lt;: {function(A...)}              -&gt; false
{function(A,A?)} &lt;: {function(A...)}                -&gt; false
{function(A?,A...)} &lt;: {function(A...)}             -&gt; true
{function(A...)} &lt;: {function(A?,A...)}             -&gt; true
{function(A...)} &lt;: {function(A?)}                  -&gt; true
{function(A?,A?)} &lt;: {function(A...)}               -&gt; true (!)
{function(A?,A?,A?)} &lt;: {function(A...)}            -&gt; true (!)
{function(A?)} &lt;: {function()}                      -&gt; true (!)
{function(A...)} &lt;: {function()}                    -&gt; true (!)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following examples demonstrate the effect of optional return types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>{function():void} &lt;: {function():void}              -&gt; true
{function():X}    &lt;: {function():void}              -&gt; true
{function():X?}   &lt;: {function():void}              -&gt; true
{function():void} &lt;: {function():Y}                 -&gt; false
{function():X}    &lt;: {function():Y}                 -&gt; X &lt;: Y
{function():X?}   &lt;: {function():Y}                 -&gt; false (!)
{function():void} &lt;: {function():Y?}                -&gt; true (!)
{function():X}    &lt;: {function():Y?}                -&gt; X &lt;: Y
{function():X?}   &lt;: {function():Y?}                -&gt; X &lt;: Y</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following examples show the effect of the annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>{@This(A) function():void} &lt;: {@This(X) function():void}    -&gt; false
{@This(B) function():void} &lt;: {@This(A) function():void}    -&gt; false
{@This(A) function():void} &lt;: {@This(B) function():void}    -&gt; true
{@This(any) function():void} &lt;: {@This(X) function():void}  -&gt; true
{function():void} &lt;: {@This(X) function():void}             -&gt; true
{@This(A) function():void} &lt;: {@This(any) function():void}  -&gt; false
{@This(A) function():void} &lt;: {function():void}             -&gt; false</code></pre>
</div>
</div>
<div class="openblock definition">
<div class="content">
<div class="paragraph">
<p><strong>Definition:</strong> <a href="#missing_definition_title">MISSING DEFINITION TITLE</a></p>
</div>
<div class="paragraph">
<p>For the given function types<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub></math> with
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub><mo>.</mo><mi>t</mi><mi>f</mi><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>=</mo><msub><mi>L</mi><mn>0</mn></msub><mo>,</mo><msub><mi>L</mi><mn>1</mn></msub><mo>,</mo><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi><msub><mi>L</mi><mi>k</mi></msub></math><br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub></math> with
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub><mo>.</mo><mi>t</mi><mi>f</mi><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>=</mo><msub><mi>R</mi><mn>0</mn></msub><mo>,</mo><msub><mi>R</mi><mn>1</mn></msub><mo>,</mo><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi><msub><mi>R</mi><mi>n</mi></msub></math>,<br>
we say <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub></math> conforms to <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub></math>,
written as <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><msub><mi>F</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub></math>, if and only if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>|</mo><msub><mi>F</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>P</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>|</mo><mo>=</mo><mo>|</mo><msub><mi>F</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>P</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>|</mo><mo>=</mo><mn>0</mn></math>:</p>
<div class="ulist">
<ul>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><msub><mi>F</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub></math>
(cf. <a href="#def:Function_Type_Conformance_NonParameterized">[def:Function_Type_Conformance_NonParameterized]</a>)</p>
</li>
</ul>
</div>
</li>
<li>
<p>else if
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>|</mo><msub><mi>F</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>P</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>|</mo><mi>g</mi><mi>t</mi><mi>;</mi><mn>0</mn><mo>∧</mo><mo>|</mo><msub><mi>F</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>P</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>|</mo><mo>=</mo><mn>0</mn></math>:</p>
<div class="ulist">
<ul>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∃</mo><mi>:</mi><mfenced close=")" open="("><mrow/></mfenced><msub><mi>F</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><msub><mi>F</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub></math>
(cf. <a href="#def:Function_Type_Conformance_NonParameterized">[def:Function_Type_Conformance_NonParameterized]</a>)</p>
<div class="paragraph">
<p>(i.e. there exists a substitution <math xmlns="http://www.w3.org/1998/Math/MathML"/> of type
variables in <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub></math> so that after substitution it
becomes a subtype of <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub></math> as defined by
<a href="#def:Function_Type_Conformance_NonParameterized">[def:Function_Type_Conformance_NonParameterized]</a>)</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>else if <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>|</mo><msub><mi>F</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>P</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>|</mo><mo>=</mo><mo>|</mo><msub><mi>F</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>P</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>|</mo></math>:</p>
<div class="ulist">
<ul>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mfenced close="}" open="{"><mrow><msubsup><mi>V</mi><mi>i</mi><mi>r</mi></msubsup><mo>←</mo><msubsup><mi>V</mi><mi>i</mi><mi>l</mi></msubsup><mo>|</mo><mn>0</mn><mo>≤</mo><mi>i</mi><mo>≤</mo><mi>n</mi></mrow></mfenced><msub><mi>F</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><msub><mi>F</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub></math>
( accordingly)</p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><mn>0</mn><mo>≤</mo><mi>i</mi><mo>≤</mo><mi>n</mi><mi>:</mi><mtext>
</mtext><mrow><msubsup><mi>V</mi><mi>i</mi><mi>l</mi></msubsup><mo>.</mo><mstyle mathvariant="italic"><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>B</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>d</mi><mi>s</mi></mstyle></mrow><mi>:</mi><mi>g</mi><mi>t</mi><mi>;</mi><mrow><msubsup><mi>V</mi><mi>i</mi><mi>r</mi></msubsup><mo>.</mo><mstyle mathvariant="italic"><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>B</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>d</mi><mi>s</mi></mstyle></mrow></math></p>
<div class="paragraph">
<p>with <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>P</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>=</mo><msubsup><mi>V</mi><mn>0</mn><mi>l</mi></msubsup><mo>,</mo><msubsup><mi>V</mi><mn>1</mn><mi>l</mi></msubsup><mo>,</mo><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi><msubsup><mi>V</mi><mi>n</mi><mi>l</mi></msubsup></math> and
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>P</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>=</mo><msubsup><mi>V</mi><mn>0</mn><mi>r</mi></msubsup><mo>,</mo><msubsup><mi>V</mi><mn>1</mn><mi>r</mi></msubsup><mo>,</mo><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi><msubsup><mi>V</mi><mi>n</mi><mi>r</mi></msubsup></math><br>
(i.e. we replace each type variable in <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub></math> by the
corresponding type variable at the same index in <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub></math>
and check the constraints from<a href="#def:Function_Type_Conformance_NonParameterized">[def:Function_Type_Conformance_NonParameterized]</a> as if <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub></math> and
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>F</mi><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub></math> were non-parameterized functions and, in
addition, the upper bounds on the left side need to be supertypes of the
upper bounds on the right side).</p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that the upper bounds on the left must be supertypes of the
right-side upper bounds (for similar reasons why types of formal
parameters on the left are required to be supertypes of the formal
parameters’ types in ). Where a particular type variable is used, on co-
or contra-variant position, is not relevant:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class A {}
class B extends A {}

class X {
    &lt;T extends B&gt; m(): T { return null; }
}
class Y extends X {
    @Override
    &lt;T extends A&gt; m(): T { return null; }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Method <code>m</code> in <code>Y</code> may return an <code>A</code>, thus breaking the contract of m in <code>X</code>, but only if it is parameterized to do so, which is not allowed for clients of <code>X</code>, only those of <code>Y</code>. Therefore, the override in the above example is valid.</p>
</div>
<div class="paragraph">
<p>The subtype relation for function types is also applied for method
overriding to ensure that an overriding method’s signature conforms to
that of the overridden method, see <a href="#req:Overriding_Members">[req:Overriding_Members]</a> (applies to
method comnsumption and implementation accordingly, see
<a href="#req:Consumption_of_Interface_Members">[req:Consumption_of_Interface_Members]</a> and
<a href="#req:Implementation_of_Interface_Members">[req:Implementation_of_Interface_Members]</a>). Note that this is very
different from Java which is far more restrictive when checking
overriding methods. As Java also supports method overloading: given two
types <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi><mo>,</mo><mi>B</mi></math> with <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>A</mi></math> and a super class
method <code>void m(B param)</code>, it is valid to override <code>m</code> as <code>void m(A param)</code> in N4JS but not in Java. In Java this would be handled as method overloading and therefore an <code>@Override</code> annotation on <code>m</code> would produce an error.</p>
</div>
<div class="paragraph">
<p>Upper and Lower Bound of a Function Type</p>
</div>
<div class="paragraph">
<p>The upper bound of a function type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi></math> is a function type with the lower bound types of the parameters and the upper bound of the return type:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mfenced close=")" open="("><mrow><mrow><mi>f</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mfenced close=")" open="("><msub><mi>P</mi><mn>1</mn></msub><mrow/><msub><mi>P</mi><mi>n</mi></msub></mfenced><mi>:</mi><mi>R</mi></mrow></mfenced><mi>:</mi><mo>=</mo><mrow><mi>f</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mfenced close=")" open="("><mrow><mi>l</mi><mi>o</mi><mi>w</mi><mi>e</mi><mi>r</mi><mfenced close=")" open="("><msub><mi>P</mi><mn>1</mn></msub></mfenced></mrow><mrow/><mrow><mi>l</mi><mi>o</mi><mi>w</mi><mi>e</mi><mi>r</mi><mfenced close=")" open="("><msub><mi>P</mi><mi>n</mi></msub></mfenced></mrow></mfenced><mi>:</mi><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mn>174</mn><mi>;</mi></math>
The lower bound of a function type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi></math> is a function type
with the upper bound types of the parameters and the lower bound of the
return type:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>l</mi><mi>o</mi><mi>w</mi><mi>e</mi><mi>r</mi><mfenced close=")" open="("><mrow><mrow><mi>f</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mfenced close=")" open="("><msub><mi>P</mi><mn>1</mn></msub><mrow/><msub><mi>P</mi><mi>n</mi></msub></mfenced><mi>:</mi><mi>R</mi></mrow></mfenced><mi>:</mi><mo>=</mo><mrow><mi>f</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mfenced close=")" open="("><mrow><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mfenced close=")" open="("><msub><mi>P</mi><mn>1</mn></msub></mfenced></mrow><mrow/><mrow><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mfenced close=")" open="("><msub><mi>P</mi><mi>n</mi></msub></mfenced></mrow></mfenced><mi>:</mi><mi>l</mi><mi>o</mi><mi>w</mi><mi>e</mi><mi>r</mi><mn>174</mn><mi>;</mi></math></p>
</div>
</div>
<div class="sect3">
<h4 id="_autoboxing_of_function_type"><a class="anchor" href="#_autoboxing_of_function_type"></a>8.1.3. Autoboxing of Function Type</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-830" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-830</a>
</div>
</div>
<div class="paragraph">
<p>Function types, compared to other types like String, come only in on
flavour: the Function object representation. There is no primitive
function type. Nevertheless, for function type expressions and function
declarations, it is possible to call the properties of Function object
directly. This is similar to autoboxing for strings.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>// function declaration
var param: number = function(a,b){}.length // 2

function a(x: number) : number { return x*x; }
// function reference
a.length; // 1

// function variable
var f = function(m,l,b){/*...*/};
f.length; // 3

class A {
    s: string;
    sayS(): string{ return this.s; }
}

var objA: A = new A();
objA.s = "A";

var objB = {s:"B"}

// function variable
var m = objA.sayS; // method as function, detached from objA
var mA: {function(any)} = m.bind(objA); // bind to objA
var mB: {function(any)} = m.bind(objB); // bind to objB

m()  // returns: undefined
mA() // returns: A
mB() // returns: B

m.call(objA,1,2,3);  // returns: A
m.apply(objB,[1,2,3]); // returns: B
m.toString(); // returns: function sayS(){ return this.s; }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arguments_object"><a class="anchor" href="#_arguments_object"></a>8.1.4. Arguments Object</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-662" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-662</a>
</div>
</div>
<div class="paragraph">
<p>A special arguments object is defined within the body of a function. It
is accessible through the implicitly-defined local variable named ,
unless it is shadowed by a local variable, a formal parameter or a
function named <code>arguments</code> or in the rare case that the function
itself is called ’arguments’ [<a href="#ECMA11a">ECMA11a(p.S10.5, p.pp59)</a>]. The argument object has array-like behavior even though it is not of type <code>array</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All actual passed-in parameters of the current execution context can
be retrieved by <math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn><mo>-</mo><mi>b</mi><mi>a</mi><mi>s</mi><mi>e</mi><mi>d</mi></math> index access.</p>
</li>
<li>
<p>The <code>length</code> property of the arguments object stores the actual number of
passed-in arguments which may differ from the number of formally defined
number of parameters <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi></math> of the containing function.</p>
</li>
<li>
<p>It is possible to store custom values in the arguments object, even
outside the original index boundaries.</p>
</li>
<li>
<p>All obtained values from the arguments object are of type <code>any</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In non-strict ES mode the property holds a reference to the function
executed [<a href="#ECMA11a">ECMA11a(p.S10.6, p.pp61)</a>].</p>
</div>
<div class="sect4">
<h5 id="_arguments_callee"><a class="anchor" href="#_arguments_callee"></a>arguments.callee</h5>
<div class="paragraph">
<p>In N4JS and in ES strict mode the use of <code>arguments.callee</code> is
prohibited.</p>
</div>
</div>
<div class="sect4">
<h5 id="_arguments_as_formal_parameter_name"><a class="anchor" href="#_arguments_as_formal_parameter_name"></a>arguments as formal parameter name</h5>
<div class="paragraph">
<p>In N4JS, the formal parameters of the function cannot be named <code>arguments</code>. This applies to all variable execution environments like field accessors (getter/setter, <a href="#Field_Accessor">[Field_Accessor]</a>), methods (<a href="#_methods">Methods</a>) and
constructors (<a href="#Constructor">[Constructor]</a>), where <code>FormalParameter</code> type is used.</p>
</div>
</div>
<div class="sect4">
<h5 id="_usage_of_arguments_object"><a class="anchor" href="#_usage_of_arguments_object"></a>Usage of arguments object</h5>
<div id="ex:Usage_of_arguments_object" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">// regular function
function a1(s1: string, n2: number) {
    var l: number = arguments.length;
    var s: string = arguments[0] as string;
}

class A {
    // property access
    get s(): string { return ""+arguments.length; } // 0
    set s(n: number) { console.log( arguments.length ); }  // 1
    // method
    m(arg: string) {
        var l: number = arguments.length;
        var s: string = arguments[0]  as string;
    }
}

// property access in object literals
var x = {
    a:5,
    get b(): string {
        return ""+arguments.length
    }
}

// invalid:
function z(){
    arguments.length // illegal, see next lines
    // define arguments to be a plain variable of type number:
    var arguments: number = 4;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ecmascript_5_function_definition"><a class="anchor" href="#_ecmascript_5_function_definition"></a>8.2. ECMAScript 5 Function Definition</h3>
<div class="sect3">
<h4 id="_function_declaration"><a class="anchor" href="#_function_declaration"></a>8.2.1. Function Declaration</h4>
<div class="sect4">
<h5 id="_syntax_8"><a class="anchor" href="#_syntax_8"></a>Syntax</h5>
<div class="paragraph">
<p>A function can be defined as described in [<a href="#ECMA11a">ECMA11a(p.S13, p.p.98)</a>] and additional annotations can be specified.
Since N4JS is based on [<a href="#ECMA15a">ECMA15a</a>], the syntax contains constructs not available in [<a href="#ECMA11a">ECMA11a</a>].
The newer constructs defined only in [<a href="#ECMA15a">ECMA15a</a>] and proposals already implemented in N4JS are described in <a href="#_ecmascript_2015_function_definition">ECMAScript 2015 Function Definition</a> and <a href="#_ecmascript_proposals_function_definition">ECMAScript Proposals Function Definition</a>.</p>
</div>
<div class="paragraph">
<p>In contrast to plain JavaScript, function declarations can be used in
blocks in N4JSl. This is only true, however, for N4JS files, not for
plain JS files. </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1043" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1043</a>
</div>
</div>
<div class="listingblock">
<div class="title">Syntax Function Declaration and Expression</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">FunctionDeclaration &lt;Yield&gt;:
    =&gt; ({FunctionDeclaration}
        annotations+=Annotation*
        (declaredModifiers+=N4Modifier)*
        -&gt; FunctionImpl &lt;Yield,Yield,Expression=false&gt;
    ) =&gt; Semi?
;


fragment AsyncNoTrailingLineBreak *: (declaredAsync?='async' NoLineTerminator)?;

fragment FunctionImpl&lt;Yield, YieldIfGenerator, Expression&gt;*:
    'function'
    (
        generator?='*' FunctionHeader&lt;YieldIfGenerator,Generator=true&gt; FunctionBody&lt;Yield=true,Expression&gt;
    |   FunctionHeader&lt;Yield,Generator=false&gt; FunctionBody&lt;Yield=false,Expression&gt;
    )
;

fragment FunctionHeader&lt;Yield, Generator&gt;*:
    TypeVariables?
    name=BindingIdentifier&lt;Yield&gt;?
    StrictFormalParameters&lt;Yield=Generator&gt;
    (-&gt; ':' returnTypeRef=TypeRef)?
;

fragment FunctionBody &lt;Yield, Expression&gt;*:
        &lt;Expression&gt; body=Block&lt;Yield&gt;
    |   &lt;!Expression&gt; body=Block&lt;Yield&gt;?
;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Properties of the function declaration and expression are described in
in <a href="#_function_type">Function Type</a>.</p>
</div>
<div class="paragraph">
<p>For this specification, we introduce a supertype
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>D</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>n</mi><mi>i</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></math> for both,
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>D</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></math> and
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></math>. This supertype contains all common
properties of these two subtypes, that is, all properties of
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></math>.</p>
</div>
<div class="paragraph">
<p>[Function Declaration with Type
Annotation][ex:Function_Declaration_with_Type_Annotation]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>// plain JS
function f(p) { return p.length }
// N4JS
function f(p: string): number { return p.length }</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_semantics_7"><a class="anchor" href="#_semantics_7"></a>Semantics</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-224" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-224</a>
</div>
</div>
<div class="paragraph">
<p>A function defined in a class’s method (or method modifier) builder is a
method, see <a href="#_methods">Methods</a> for details and additional constraints.
The metatype of a function definition is function type (<a href="#_function_type">Function Type</a>), as a function declaration is only a different syntax for creating a object.
Constraints for function type are described in <a href="#_function_type">Function Type</a>. Another consequence is that the inferred type of a function definition <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi></math> is simply its function type
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi></math>. <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>F</mi><mrow><mi>f</mi><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi></mrow></math> Note that the type
of a function definition is different from its return type
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mo>.</mo><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi></math>!</p>
</div>
<div id="req:Function_Declaration_only_on_Top_Level" class="olist arabic">
<ol class="arabic">
<li>
<p>In plain JavaScript, function declarations must only be located on
top-level, that is they must not be nested in blocks. Since this is
supported by most JavaScript engines, only a warning is issued.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_expression"><a class="anchor" href="#_function_expression"></a>8.2.2. Function Expression</h4>
<div class="paragraph">
<p>A function expression [<a href="#ECMA11a">ECMA11a(p.S11.2.5)</a>] is quite similar to a function declaration. Thus,
most details are explained in .</p>
</div>
<div class="sect4">
<h5 id="function-expression-syntax"><a class="anchor" href="#function-expression-syntax"></a>Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>FunctionExpression:
         ({FunctionExpression}
            FunctionImpl&lt;Yield=false,YieldIfGenerator=true,Expression=true&gt;
         )
;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_semantics_and_type_inference"><a class="anchor" href="#_semantics_and_type_inference"></a>Semantics and Type Inference</h5>
<div class="paragraph">
<p>In general, the inferred type of a function expression simply is the
function type as described in <a href="#_function_type">Function Type</a>. Often, the signature of a function
expression is not explicitly specified but it can be inferred from the
context. The following context information is used to infer the full
signature:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the function expression is used on the right hand side of an
assignment, the expected return type can be inferred from the left hand
side.</p>
</li>
<li>
<p>If the function expression is used as an argument in a call to another
function, the full signature can be inferred from the corresponding type
of the formal parameter declaration.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Although the signature of the function expression may be inferred from
the formal parameter if the function expression is used as argument,
this inference has some conceptual limitations. This is demonstrated in
the next example.</p>
</div>
<div class="paragraph">
<p>Example: Inference Of Function Expression’s Signature</p>
</div>
<div class="paragraph">
<p>In general, <code>{function():any}</code> is a subtype of <code>{function():void}</code> (cf. <a href="#_function_type">Function Type</a>). When the return type of a function
expression is inferred, this relation is taken into account which may
lead to unexpected results as shown in the following code snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>function f(cb: {function():void}) { cb() }
f(function() { return 1; });</code></pre>
</div>
</div>
<div class="paragraph">
<p>No error is issued: The type of the function expression actually is
inferred to <code>{function():any}</code>, because there is a return statement with an expression.
It is not inferred to <code>{function():void}</code>, even if the formal parameter of <code>f</code> suggests that.
Due to the previously-stated relation <code>{function():any} &lt;: {function():void}</code> this is correct – the client (in this
case function <code>f</code>) works perfectly well even if <code>cb</code> returns something.
The contract of arguments states that the type of the argument is a subtype
of the type of the formal parameter. This is what the inferencer takes
into account!</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ecmascript_2015_function_definition"><a class="anchor" href="#_ecmascript_2015_function_definition"></a>8.3. ECMAScript 2015 Function Definition</h3>
<div class="sect3">
<h4 id="_generator_functions"><a class="anchor" href="#_generator_functions"></a>8.3.1. Generator Functions</h4>
<div class="paragraph">
<p>Cf. [<a href="#ECMA15a">ECMA15a(p.S14.4)</a>], also see [<a href="#Kuizinas14a">Kuizinas14a</a>]. Syntax supported, semantic and transpilation not
supported yet.</p>
</div>
</div>
<div class="sect3">
<h4 id="_arrow_function_expression"><a class="anchor" href="#_arrow_function_expression"></a>8.3.2. Arrow Function Expression</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-252" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-252</a>
</div>
</div>
<div class="paragraph">
<p>This is an ECMAScript 6 expression (see [<a href="#ECMA15a">ECMA15a(p.S14.2)</a>]) for simplifying the definition of anonymous function expressions, aka
lambdas or closures. The ECMAScript Specification calls this a function
definition even though they may only appear in the context of
expressions.</p>
</div>
<div class="paragraph">
<p>Along with Assignments, Arrow function expressions have the least
precedence, e.g. they serve as the entry point for the expression tree.</p>
</div>
<div class="paragraph">
<p>Arrow function expressions can be considered syntactic window-dressing
for old-school function expressions and therefore do not support the
benefits regarding parameter annotations although parameter types may be
given explicitly. The return type can be given as type hint if desired,
but this is not mandatory (if left out, the return type is inferred).
The notation `@=>
` stands for an async arrow function (<a href="#_asynchronous_arrow_functions">Asynchronous Arrow Functions</a>).</p>
</div>
<div class="sect4">
<h5 id="arrow-function-expression-syntax"><a class="anchor" href="#arrow-function-expression-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>The simplified syntax reads like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">ArrowExpression returns ArrowFunction:
    =&gt;(
        {ArrowFunction}
        (
            '('
                ( fpars+=FormalParameterNoAnnotations ( ',' fpars+=FormalParameterNoAnnotations )* )?
            ')'
            (':' returnTypeRef=TypeRef)?
        |   fpars+=FormalParameterNoType
        )
        '=&gt;'
    ) (
        (=&gt; hasBracesAroundBody?='{' body=BlockMinusBraces '}') | body=ExpressionDisguisedAsBlock
    )
;

FormalParameterNoAnnotations returns FormalParameter:
    (declaredTypeRef=TypeRef variadic?='...'?)? name=JSIdentifier
;
FormalParameterNoType returns FormalParameter: name=JSIdentifier;

BlockMinusBraces returns Block: {Block} statements+=Statement*;

ExpressionDisguisedAsBlock returns Block:
    {Block} statements+=AssignmentExpressionStatement
;

AssignmentExpressionStatement returns ExpressionStatement: expression=AssignmentExpression;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="arrow-function-expression-semantics-and-type-inference"><a class="anchor" href="#arrow-function-expression-semantics-and-type-inference"></a>Semantics and Type Inference</h5>
<div class="paragraph">
<p>Generally speaking, the semantics are very similar to the function
expressions but the devil’s in the details:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>arguments</code>: Unlike normal function expressions, an arrow function does not
introduce an implicit <code>arguments</code> variable (<a href="#_arguments_object">Arguments Object</a>), therefore any occurrence of it in the arrow function’s body has always the same binding as an occurrence of <code>arguments</code> in the lexical context enclosing the arrow function.</p>
</li>
<li>
<p><code>this</code>: An arrow function does not introduce a binding of its own for the <code>this</code> keyword. That explains why uses in the body of arrow function have the
same meaning as occurrences in the enclosing lexical scope. As a
consequence, an arrow function at the top level has both usages of <code>arguments</code> and <code>this</code> flagged as error (the outer lexical context doesn’t provide definitions
for them).</p>
</li>
<li>
<p><code>super</code>: As with function expressions in general, whether of the arrow
variety or not, the usage of <code>super</code> isn’t allowed in the body of arrow
functions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In N4JS, a top-level arrow function can’t refer to <code>this</code> as there’s no outer lexical context that provides a binding for it.</p>
</div>
<div class="paragraph">
<p>In N4JS, a top-level arrow function can’t include usages of <code>arguments</code> in its body, again because of the missing binding for it.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ecmascript_proposals_function_definition"><a class="anchor" href="#_ecmascript_proposals_function_definition"></a>8.4. ECMAScript Proposals Function Definition</h3>
<div class="sect3">
<h4 id="_asynchronous_functions"><a class="anchor" href="#_asynchronous_functions"></a>8.4.1. Asynchronous Functions</h4>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1175" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1175</a>
<a href="https://jira.numberfour.eu/browse/IDE-1593" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1593</a>
</div>
</div>
<div class="paragraph">
<p>To improve language-level support for asynchronous code, there exists an
ECMAScript proposal
<sup class="footnote">[<a id="_footnoteref_41" class="footnote" href="#_footnote_41" title="View footnote.">41</a>]</sup> based on Promises which are provided by ES6 as built-in types.
N4JS implements this proposal.
This concept is supported for declared functions and methods (<a href="#Asynchronous_Methods">[Asynchronous_Methods]</a>) as well
as for function expressions and arrow functions (<a href="#_asynchronous_arrow_functions">Asynchronous Arrow Functions</a>).</p>
</div>
<div class="sect4">
<h5 id="asynchronous-functions-syntax"><a class="anchor" href="#asynchronous-functions-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>The following syntax rules are extracted from the real syntax rules.
They only display parts relevant to declaring a function or method as
asynchronous.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>AsyncFunctionDeclaration &lt;Yield&gt;:
        (declaredModifiers+=N4Modifier)*
        declaredAsync?='async' NoLineTerminator 'function'
        FunctionHeader&lt;Yield,Generator=false&gt;
        FunctionBody&lt;Yield=false,Expression=false&gt; Semi
;

AsyncFunctionExpression:
        declaredAsync?='async' NoLineTerminator 'function'
        FunctionHeader&lt;Yield=false,Generator=false&gt;
        FunctionBody&lt;Yield=false,Expression=true&gt;
;

AsyncArrowExpression &lt;In, Yield&gt;:
        declaredAsync?='async' NoLineTerminator '('
            (fpars+=FormalParameter&lt;Yield&gt;
                (',' fpars+=FormalParameter&lt;Yield&gt;)*)?
        ')' (':' returnTypeRef=TypeRef)? '=&gt;'
        (   '{' body=BlockMinusBraces&lt;Yield&gt; '}'
            | body=ExpressionDisguisedAsBlock&lt;In&gt;
        )
;

AsyncMethodDeclaration:
    annotations+=Annotation+ (declaredModifiers+=N4Modifier)* TypeVariables?
    declaredAsync?='async' NoLineTerminator LiteralOrComputedPropertyName&lt;Yield&gt;
    MethodParamsReturnAndBody</code></pre>
</div>
</div>
<div class="paragraph">
<p>’async’ is not a reserved word in ECMAScript and it can therefore be
used either as an identifier or as a keyword, depending on the context.
When used as a modifier to declare a function as asynchronous, then
there must be no line terminator after the <code>async</code> modifier. This enables the
parser to distinguish between using <code>async</code> as an identifier reference and a
keyword, as shown in the next example.</p>
</div>
<div class="paragraph">
<p>Async as keyword and identifier</p>
</div>
<div id="ex:Async_as_keyword_and_identifier" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">async  <b class="conum">(1)</b>
function foo() {}
// vs
async function bar(); <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>In this snippet, the <code>async</code> on line 1 is an identifier reference (referencing a
variable or parameter) and the function defined on line 2 is a
non-asynchronous function. The automatic semicolon insertion adds a
semicolon after the reference on line 1.</p>
</li>
<li>
<p>In contrast, <code>async</code> on line 3 is
recognized as a modifier declaring the function as asynchronous.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="asynchronous-functions-semantics"><a class="anchor" href="#asynchronous-functions-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>The basic idea is to make code dealing with Promises easier to write and
more readable without changing the functionality of Promises. Take this
example:</p>
</div>
<div class="listingblock">
<div class="title">A simple asynchronous function using async/await.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">// some asynchronous legacy API using promises
interface DB {}
interface DBAccess {
    getDataBase(): Promise&lt;DB,?&gt;
    loadEntry(db: DB, id: string): Promise&lt;string,?&gt;
}

var access: DBAccess;

// our own function using async/await
async function loadAddress(id: string) : string {
    try {
        var db: DB = await access.getDataBase();
        var entry: string = await access.loadEntry(db, id);
        return entry.address;
    }
    catch(err) {
        // either getDataBase() or loadEntry() failed
        throw err;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The modifier <code>async</code> changes the return type of <code>loadAddress()</code> from <code>string</code> (the declared return type) to <code>Promise&lt;string,?&gt;</code> (the actual return type).
For code inside the function, the return
type is still <code>string</code>: the value in the return statement of the last line will
be wrapped in a Promise. For client code outside the function and in
case of recursive invocations, the return type is <code>Promise&lt;string,?&gt;</code>. To raise an error, simply throw an exception, its value will become the error value of the returned Promise.</p>
</div>
<div class="paragraph">
<p>If the expression after an <code>await</code> evaluates to a <code>Promise</code>, execution of the enclosing asynchronous function will be suspended until either a success value is available (which will then make the entire await-expession evaluate to
this success value and continue execution) or until the Promise is
rejected (which will then cause an exception to be thrown at the
location of the await-expression).
If, on the other hand, the expression
after an <code>await</code> evaluates to a non-promise, the value will be simply passed
through. In addition, a warning is shown to indicate the unnecessary <code>await</code>
epression.</p>
</div>
<div class="paragraph">
<p>Note how method <code>loadAddress()</code> above can be implemented without any explicit references to the built-in type Promise.
In the above example we handle the errors of the nested asynchronous calls to <code>getDataBase()</code> and <code>loadEntry()</code> for demonstration purposes only; if we are not interested in the errors we could simply remove the try/catch block and any errors would be forwarded to the caller of <code>loadAddress()</code>.</p>
</div>
<div class="paragraph">
<p>Invoking an async function commonly adopts one of two forms: </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/620" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-620</a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>var p: Promise&lt;successType,?&gt; = asyncFn()</code></p>
</li>
<li>
<p><code>await asyncFn()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These patterns are so common that a warning is available whenever both</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>Promise</code> is omitted as expected type; and</p>
</li>
<li>
<p><code>await</code> is also omitted.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The warning aims at hinting about forgetting to wait for the result, while remaining
non-noisy.</p>
</div>
<div id="req:Async_and_Await" class="olist arabic">
<ol class="arabic">
<li>
<p><code>async</code> may be used on declared functions and methods, and for function
expressions. and arrow functions.</p>
</li>
<li>
<p>A function or method <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi></math> with a declared return type
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi></math> that is declared has an actual return type of <code>async</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title"></div>
</td>
<td class="content">
for the time being this applies also to functions with a void
return type, producing the actual return type <code>Promise&lt;void,?&gt;</code> (to be reconsidered).
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Given a function or method <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi></math> with a declared return
type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi></math> that is declared , all return statements in
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi></math> must have an expression of type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi></math> (and not
of type ).</p>
</li>
<li>
<p><code>await</code> can be used in expressions directly enclosed in an async function,
and behaves like a unary operator with the same precedence as in ES6.</p>
</li>
<li>
<p>Given an expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mstyle mathvariant="italic"><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi></mstyle></math> of type
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>, the type of <math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mo>(</mo></mrow></math>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mstyle mathvariant="italic"><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi></mstyle><mo>)</mo></mrow></math> is inferred to <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> if
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> is not a Promise or it is inferred to <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> if
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> is a Promise with a success value of type
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math>, i.e. <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi></math> .</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_asynchronous_arrow_functions"><a class="anchor" href="#_asynchronous_arrow_functions"></a>8.4.2. Asynchronous Arrow Functions</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1494" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1494</a>
</div>
</div>
<div class="paragraph">
<p>An <code>await</code> expression is allowed in the body of an async arrow function but not
in the body of a non-async arrow function. The semantics here are
intentional and are in line with similar constraint for function
expressions.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_n4js_extended_function_definition"><a class="anchor" href="#_n4js_extended_function_definition"></a>8.5. N4JS Extended Function Definition</h3>
<div class="sect3">
<h4 id="_generic_functions"><a class="anchor" href="#_generic_functions"></a>8.5.1. Generic Functions</h4>
<div class="paragraph">
<p>A generic function is a function with a list of generic type parameters.
These type parameters can be used in the function signature to declare
the types of formal parameters and the return type. In addition, the
type parameters can be used in the function body, for example when
declaring the type of a local variable.</p>
</div>
<div class="paragraph">
<p>In the following listing, a generic function <code>foo</code> is defined that has two
type parameters <code>S</code> and <code>T</code>. Thereby <code>S</code> is used as to declare the parameter type <code>Array&lt;S&gt;</code> and <code>T</code> is used as the return type and to construct the returned value in the function body.</p>
</div>
<div class="listingblock">
<div class="title">Generic Function Definition</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">function &lt;S,T&gt; foo(s: Array&lt;S&gt;): T { return new T(s); }</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a generic type parameter is not used as a formal parameter type or
the return type, a warning is generated.</p>
</div>
</div>
<div class="sect3">
<h4 id="_promisifiable_functions"><a class="anchor" href="#_promisifiable_functions"></a>8.5.2. Promisifiable Functions</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-2018" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-2018</a>
</div>
</div>
<div class="paragraph">
<p>In many existing libraries, which have been developed in
pre-ES6-promise-API times, callback methods are used for asynchronous
behavior. An asynchronous function follows the following conventions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">'function' name '(' arbitraryParameters ',' callbackFunction ')'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Usually the function returns nothing (<code>void</code>). The callback function usually
takes two arguments,in which the first is an error object and the other
is the result value of the asynchronous operation. The callback function
is called from the asynchronous function, leading to nested function
calls (aka ’callback hell’).</p>
</div>
<div class="paragraph">
<p>In order to simplify usage of this pattern, it is possible to mark such
a function or method as <code>@Promisifiable</code>. It is then possible to ’promisify’ an
invocation of this function or method, which means no callback function
argument has to be provided and a will be returned. The function or
method can then be used as if it were declared with <code>async</code>. This is
particularly useful in N4JS definition files (.n4jsd) to allow using an
existing callback-based API from N4JS code with the more convenient <code>await</code>.</p>
</div>
<div class="paragraph">
<p>Given a function with an N4JS signature</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">f(x: int, cb: {function(Error, string)}): void</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method can be annotated with <code>Promisifiable</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">@Promisifiable f(x: int, cb: {function(Error, string)}): void</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this annotation, the function can be invoked in four different
ways:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">f(42, function(err, result1) { /* ... */ });            // traditional
var promise: Promise&lt;string,Error&gt; = @Promisify f(42);  // promise
var result3: string = await @Promisify f(42);           // long
var result4: string = await f(42);                      // short</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first line is only provided for completeness and shows that a
promisifiable function can still be used in the ordinary way by
providing a callback - no special handling will occur in this case.
The second line shows how <code>f</code> can be promisified using the <code>@Promisify</code> annotation - no callback needs to be provided and instead, a <code>Promise</code> will be returned.
We can either use this promise directly or immediately <code>await</code> on it, as shown in line 3.
The syntax shown in line 4 is merely shorthand for <code>await @Promisify</code>, i.e. the
annotation is optional after <code>await</code>.</p>
</div>
<div class="paragraph">
<p>A function or method <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi></math> can be annotated with <code>@Promisifiable</code> if and only if the following constraints hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Last parameter of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi></math> is a function (the
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mi>a</mi><mi>l</mi><mi>l</mi><mi>b</mi><mi>a</mi><mi>c</mi><mi>k</mi></math>).</p>
</li>
<li>
<p>The <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mi>a</mi><mi>l</mi><mi>l</mi><mi>b</mi><mi>a</mi><mi>c</mi><mi>k</mi></math> has a signature of</p>
<div class="ulist">
<ul>
<li>
<p><code>{function(E, T0, T1, &#8230;&#8203;, Tn): V}</code>, or</p>
</li>
<li>
<p><code>{function(T0, T1, &#8230;&#8203;, Tn): V}</code></p>
<div class="paragraph">
<p>in which <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>E</mi></math> is type <code>Error</code> or a subtype thereof,
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>T</mi><mn>0</mn></msub><mo>,</mo><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub></math> are arbitrary types except or its subtypes.
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>E</mi></math>, if given, is then the type of the error value, and
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>T</mi><mn>0</mn></msub><mo>,</mo><mn>8230</mn><mi>;</mi><mn>8203</mn><mi>;</mi><mo>,</mo><msub><mi>T</mi><mi>n</mi></msub></math> are the types of the success values of the
asynchronous operation.<br>
Since the return value of the synchronous function call is not available when using <code>@Promisify</code>, <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>V</mi></math> is recommended to be <code>void</code>, but it can be any type.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>The callback parameter may be optional.
<sup class="footnote">[<a id="_footnoteref_42" class="footnote" href="#_footnote_42" title="View footnote.">42</a>]</sup></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>According to <a href="#req:Promisifiable">[req:Promisifiable]</a>, a promisifiable function or method may
or may not have a non-void return type, and that only the first
parameter of the callback is allowed to be of type <code>Error</code>, all other
parameters must be of other types.</p>
</div>
<div class="paragraph">
<p>A promisifiable function <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi></math> with one of the two valid
signatures given in <a href="#req:Promisifiable">[req:Promisifiable]</a> can be promisified with <code>Promisify</code> or
used with <code>await</code>, if and only if the following constraints hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Function <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi></math> must be annotated with <code>@Promisifiable</code>.</p>
</li>
<li>
<p>Using <code>@Promisify f()</code> without <code>await</code> returns a promise of type <code>Promise&lt;S,F&gt;</code> where</p>
<div class="ulist">
<ul>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> is <code>IterableN&lt;T0,&#8230;&#8203;,Tn&gt;</code> if <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mo>≥</mo><mn>2</mn></math>, <code>T</code> if <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mo>=</mo><mn>1</mn></math>, and <code>void</code> if <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mo>=</mo><mn>0</mn></math>.</p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi></math> is <code>E</code> if given, <code>void</code> otherwise.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Using <code>await @Promisify f()</code> returns a value of type <code>IterableN&lt;T0,&#8230;&#8203;,Tn&gt;</code> if <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mo>≥</mo><mn>2</mn></math>, <code>T</code> if <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mo>=</mo><mn>1</mn></math>, and <code>void</code> if <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mo>=</mo><mn>0</mn></math>.</p>
</li>
<li>
<p>In case of using an <code>await</code>, the annotation can be omitted.<br>
I.e., <code>await @Promisify f()</code> is equivalent to <code>await f()</code>.</p>
</li>
<li>
<p>Only call expressions using f as target can be promisified, in other
words this is illegal:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var pf = @Promisify f; // illegal code!</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conversions_and_reflection"><a class="anchor" href="#_conversions_and_reflection"></a>9. Conversions and Reflection</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_auto_boxing_and_coercing"><a class="anchor" href="#_auto_boxing_and_coercing"></a>9.1. Auto-Boxing and Coercing</h3>
<div class="paragraph">
<p>Coercing is the ability to implicitly cast one (primitive) type to
another.
Auto-Boxing is a special kind of coercing in that is the ability to automatically convert a primitive value type, such as <code>string</code>, <code>number</code>, or <code>boolean</code>, to its corresponding Object type version <code>String</code>, <code>Number</code>, <code>Boolean</code>.
The capital letters in the latter are an essential distinction.</p>
</div>
<div class="paragraph">
<p>Conversion between primitives and object-representations of a datatype
are not automatic in N4JS. Only in the cases of object-method
invocations on a primitive type (for <code>string</code> to call <code>"abc".length</code>, for example) automatic conversion is applied.</p>
</div>
<div class="paragraph">
<p>Note that N4JS specific primitive types <code>pathselector</code> and <code>i18nkey</code> are handled similarly to <code>string</code>.</p>
</div>
<div class="sect3">
<h4 id="_coercing"><a class="anchor" href="#_coercing"></a>9.1.1. Coercing</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-379" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-379</a>
</div>
</div>
<div class="paragraph">
<p>In [<a href="#ECMA11a">ECMA11a</a>], coercing is defined by means of the abstract specification method <code>ToPrimitive</code> [<a href="#ECMA11a">ECMA11a(p.S9.1)</a>], also see [<a href="#ECMA11a">ECMA11a(p.S9.10)</a>]). Other conversions, such as <code>ToNumber</code>, are not directly supported but reflected in the typing rules of expressions.</p>
</div>
<div class="paragraph">
<p>We express absence of automatic coercion here by means of subtype
relations: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>B</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi>a</mi><mi>n</mi></mrow><mrow><mi>b</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi>a</mi><mi>n</mi></mrow></mrow><mrow/><mo>|</mo><mrow><mrow><mi>b</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi>a</mi><mi>n</mi></mrow><mrow><mi>B</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi>a</mi><mi>n</mi></mrow></mrow><mrow/><mtext>
</mtext><mrow><mrow><mi>N</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi></mrow><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi></mrow></mrow><mrow/><mo>|</mo><mrow><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi></mrow><mrow><mi>N</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi></mrow></mrow><mrow/><mtext>
</mtext><mrow><mrow><mi>S</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow></mrow><mrow/><mo>|</mo><mrow><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow><mrow><mi>S</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow></mrow><mrow/><mtext>
</mtext></math></p>
</div>
<div class="paragraph">
<p>and for the N4JS specific types: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>p</mi><mi>a</mi><mi>t</mi><mi>h</mi><mi>S</mi><mi>e</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>T</mi><mi>g</mi><mi>t</mi><mi>;</mi></mrow><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow></mrow><mrow/><mtext>
</mtext><mrow><mrow><mi>i</mi><mn>18</mn><mi>n</mi><mi>K</mi><mi>e</mi><mi>y</mi></mrow><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow></mrow><mrow/><mtext>
</mtext></math></p>
</div>
<div class="paragraph">
<p>If a conversion between primitive and object type is desired, we require
the user of N4JS to actively convert the values. The reason for that is
the notably different behavior of object- and primitive-variants of a
type in expression evaluation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>var bool: boolean = false;
var Bool: Boolean = new Boolean( false );

console.log( bool ? "true" : "false"); // prints "false"
console.log( Bool ? "true" : "false"); // prints "true"!</code></pre>
</div>
</div>
<div class="paragraph">
<p>Conversion between a primitive type to its object-variant is achieved by
the <code>new</code> operator. The <code>valueOf()</code> method converts the object-variant back to a primitive value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">// objects from literals:
var bo: Boolean = new Boolean( true ); // typeof bo: object
var no: Number = new Number( 42 ); // typeof no: object
var so: String = new String( "foo" ); // typeof so: object

// to primitive
var b: boolean = bo.valueOf(); // typeof b: boolean -- true
var n: number = no.valueOf(); // typeof n: number -- 42
var s: string = so.valueOf(); // typeof s: string -- "foo"

// to object-type
bo = new Boolean( b );
no = new Number( n );
so = new String( s );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Conversion of variables of type <code>Object</code> or from one primitive type to another is expressed in terms of typing rules for expressions. That is, it is not
possible to convert any <code>Object</code> to a primitive in general, but it is possible to do so in the context of certain expressions such as additive operator.
The applied conversions are described in <a href="#Auto_Conversion_of_Class_Instances">[Auto_Conversion_of_Class_Instances]</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_auto_boxing_of_primitives"><a class="anchor" href="#_auto_boxing_of_primitives"></a>9.1.2. Auto-Boxing of Primitives</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-835" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-835</a>
</div>
</div>
<div class="paragraph">
<p>In [<a href="#ECMA11a">ECMA11a</a>], autoboxing is defined by \lstnfjs{ToObject} [<a href="#ECMA11a">ECMA11a(p.S9.9)</a>].</p>
</div>
<div class="paragraph">
<p>Auto-boxing is not directly supported in N4JS. Instead, primitive types
virtually have the same members as their corresponding object types. It
is then possible to use the auto-boxing feature when calling a member.
In general, auto-boxing is only supported for accessing built-in
read-only (immutable) properties. For example, <code>"some string value".split(" ");</code> is supported but <code>"some string value".foo=1;</code> will be rejected as String does not allow properties to be added (cf. vs. , see <a href="#Type_Modifiers_Dynamic">[Type_Modifiers_Dynamic]</a>).</p>
</div>
<div class="paragraph">
<p>Auto-boxing often leads to problems, in particular in combination with
dynamic types – this is why it is not directly supported in N4JS. For
example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>var s: String+ = "Hello"; // will produce an error to prevent the following scenario:
s.prop = 1;
console.log(s.prop); // prints "undefined"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_auto_boxing_of_function_expressions_and_declarations"><a class="anchor" href="#_auto_boxing_of_function_expressions_and_declarations"></a>9.1.3. Auto-Boxing of Function Expressions and Declarations</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-830" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-830</a>
</div>
</div>
<div class="paragraph">
<p>Function expressions and declarations always define an object of type <code>Function</code>, thus coercing or auto-boxing is not required in case of functions:</p>
</div>
<div class="paragraph">
<p>It is always possible to use a function expression where a <code>Function</code> is required, and to use an object of type <code>Function</code> where a function expression is expected.
This is only possible if the function signatures are subtype-compatible,
see <a href="#Function_Type">[Function_Type]</a> for details.</p>
</div>
<div class="paragraph">
<p>Still, it is always possible to call members of <code>Function</code>, e.g.,
<code>function(){}.length()</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_auto_conversion_of_objects"><a class="anchor" href="#_auto_conversion_of_objects"></a>9.2. Auto-Conversion of Objects</h3>
<div class="sect3">
<h4 id="_auto_conversion_of_class_instances"><a class="anchor" href="#_auto_conversion_of_class_instances"></a>9.2.1. Auto-Conversion of Class Instances</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-833" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-833</a>
</div>
</div>
<div class="paragraph">
<p>All classes defined in N4JS modules implicitly subclass <code>N4Object</code>, which is a
plain JavaScript Object type. The same auto-conversion rules defined for
JavaScript <code>Object</code> therefore apply to <code>N4Object</code> instances as well.</p>
</div>
<div class="paragraph">
<p>The basic conversion uses the abstract JavaScript function <code>ToPrimitive</code> [<a href="#ECMA11a">ECMA11a(p.S9.1)</a>], which relays on the specification method <code>Object</code>
[<a href="#ECMA11a">ECMA11a(p.S8.12.8)</a>].
<code>DefaultValue</code> calls <code>valueOf</code> or <code>toString</code> methods if they are defined by the class (in the <code>methods</code>-builder).</p>
</div>
<div class="paragraph">
<p>Note that according to the [<a href="#ECMA11a">ECMA11a</a>], in most cases, objects are first converted into primitives. That is, in most cases, no extra hint is passed to
<code>DefaultValue</code>. Thus <code>valueOf</code> usually takes precedence over toString as
demonstrated in the following example:</p>
</div>
<div class="paragraph">
<p>Auto-Conversion</p>
</div>
<div class="paragraph">
<p>Assume some classes and corresponding instances defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class A {}
class B{
    @Override public toString(): string { return "MyB"}
}
class C{
    @Override public valueOf(): any { return 10}
}
class D{
    @Override public toString(): string { return "MyD"}
    @Override public valueOf(): any { return 20}
}
var a = new A(), b = new B(), c = new C(), d = new D();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instances of these classes will be converted as demonstrated as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>console.log(a+"");                      // [object Object]
console.log(a+1);                       // [object Object]1

console.log(""+b+"");                   // MyB
console.log(1+b+1);                     // 1MyB1

console.log(c+"");                      // 10
console.log(c+1);                       // 11

console.log(d+"");                      // 20
console.log(d+1);                       // 21</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_auto_conversion_of_interface_instances"><a class="anchor" href="#_auto_conversion_of_interface_instances"></a>Auto-Conversion of Interface Instances</h5>
<div class="paragraph">
<p>Instances of interfaces actually are instances of classes at runtime.
The auto-conversion rules described in <a href="#_auto_conversion_of_class_instances">Auto-Conversion of Class Instances</a> are applied to instances declared as instances of interfaces as well.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_auto_conversion_of_enum_literals"><a class="anchor" href="#_auto_conversion_of_enum_literals"></a>9.2.2. Auto-Conversion of Enum Literals</h4>
<div class="paragraph">
<p>Enumeration values are objects and thus follow the behavior for
ECMAScript <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></math> and <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></math>. They have a
custom <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mi>o</mi><mi>S</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></math> method which returns the name of the
enumeration value.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_type_cast_and_type_check"><a class="anchor" href="#_type_cast_and_type_check"></a>9.3. Type Cast and Type Check</h3>
<div class="sect3">
<h4 id="_type_cast"><a class="anchor" href="#_type_cast"></a>9.3.1. Type Cast</h4>
<div class="paragraph">
<p>  (IDEBUG-56): Casting to TypeVars</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-161" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-161</a>
<a href="https://jira.numberfour.eu/browse/IDE-928" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-928</a>
</div>
</div>
<div class="paragraph">
<p>Type casts are expressed with the cast expression (<code>as</code>), see <a href="#As_Expression">[As_Expression]</a> for details.</p>
</div>
<div class="paragraph">
<p>We first define helper rules for the type cast constraints as follows:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>|</mo><mrow><mi>i</mi><mi>s</mi><mi>C</mi><mi>P</mi><mi>O</mi><mi>E</mi><mfenced close=")" open="("><mi>T</mi></mfenced></mrow><mrow><mi>μ</mi><mfenced close=")" open="("><mi>T</mi></mfenced><mo>∈</mo><mfenced close="}" open="{"><mrow><mi>T</mi><mi>E</mi><mi>n</mi><mi>u</mi><mi>m</mi></mrow><mrow><mi>C</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi></mrow><mrow><mi>P</mi><mi>r</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi><mi>i</mi><mi>v</mi><mi>e</mi></mrow><mrow><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi></mrow></mfenced></mrow><mtext>
</mtext><mo>|</mo><mrow><mi>i</mi><mi>s</mi><mi>C</mi><mi>P</mi><mi>O</mi><mi>E</mi><mfenced close=")" open="("><mi>T</mi></mfenced></mrow><mrow><mi>μ</mi><mi>T</mi><mo>∈</mo><mfenced close="}" open="{"><mrow><mi>C</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>r</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi></mrow><mrow><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi></mrow></mfenced><mo>∧</mo><mi>μ</mi><mfenced close=")" open="("><mrow><mi>T</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi></mrow></mfenced><mo>≠</mo><mrow><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>V</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi></mrow></mrow><mtext>
</mtext><mo>|</mo><mrow><mi>i</mi><mi>s</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi><mfenced close=")" open="("><mi>T</mi></mfenced></mrow><mrow><mi>μ</mi><mfenced close=")" open="("><mi>T</mi></mfenced><mo>∈</mo><mfenced close="}" open="{"><mrow><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi></mrow></mfenced></mrow><mtext>
</mtext><mo>|</mo><mrow><mi>i</mi><mi>s</mi><mi>B</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>d</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>V</mi><mi>a</mi><mi>r</mi><mfenced close=")" open="("><mi>T</mi></mfenced></mrow><mrow><mi>μ</mi><mfenced close=")" open="("><mi>T</mi></mfenced><mo>=</mo><mrow><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>V</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi></mrow><mo>∧</mo><mi>T</mi><mo>.</mo><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>B</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>d</mi><mi>s</mi><mo>≠</mo><mi>∅</mi></mrow><mtext>
</mtext><mo>|</mo><mrow><mi>i</mi><mi>s</mi><mi>F</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi><mi>B</mi><mi>y</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mfenced close=")" open="("><mi>T</mi></mfenced></mrow><mrow><mi>μ</mi><mfenced close=")" open="("><mi>T</mi></mfenced><mo>∈</mo><mfenced close="}" open="{"><mrow><mi> </mi><mrow><mi>T</mi><mi>E</mi><mi>n</mi><mi>u</mi><mi>m</mi></mrow></mrow><mrow><mi>P</mi><mi>r</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi><mi>i</mi><mi>v</mi><mi>e</mi></mrow></mfenced><mo>∨</mo><mfenced close="}" open="("><mrow><mi>μ</mi><mfenced close=")" open="("><mi>T</mi></mfenced><mo>=</mo><mrow><mi>C</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi></mrow><mo>∧</mo><mi>T</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>s</mi><mi>i</mi><mi>b</mi><mi>i</mi><mi>l</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo>=</mo><mrow><mi>f</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow></mrow></mfenced><mo>)</mo></mrow></math></p>
</div>
<div class="paragraph">
<p>[[req:Cast Validation At Compile Time]]
Given a type cast expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi></math> in which
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>:</mi><mi>S</mi></math> and and target type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>, the
following constraints must hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> must be a classifier, enum, primitive, function type
expression, classifier type, type variable, union or intersection type:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>μ</mi><mfenced close=")" open="("><mi>T</mi></mfenced><mo>∈</mo><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mfenced close="}" open="{"><mrow><mi>a</mi><mi>n</mi><mi>y</mi></mrow><mrow><mi>C</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi></mrow><mrow><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi></mrow><mrow><mi>E</mi><mi>n</mi><mi>u</mi><mi>m</mi></mrow><mrow><mi>P</mi><mi>r</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi><mi>i</mi><mi>v</mi><mi>e</mi></mrow><mrow><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi></mrow><mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>F</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></mrow><mrow><mi>C</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>r</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi></mrow><mrow><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>V</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi></mrow><mrow><mi>U</mi><mi>n</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mrow><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></mfenced></math></p>
</li>
<li>
<p>If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> is a subtype of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>, the cast is
unnecessary and a warning will be generated.</p>
</li>
<li>
<p>If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> and <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> are classes, enums or
primitive types, then <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> must be a subtype of
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math>. This is also true if <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> is an interface
and the type of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> cannot have subtypes, or vice versa.</p>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mo>(</mo><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mfenced close=")" open="("><mrow><mi>i</mi><mi>s</mi><mi>C</mi><mi>P</mi><mi>O</mi><mi>E</mi><mfenced close=")" open="("><mi>T</mi></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><mo>∧</mo><mfenced close=")" open="("><mrow><mi>i</mi><mi>s</mi><mi>C</mi><mi>P</mi><mi>O</mi><mi>E</mi><mfenced close=")" open="("><mi>S</mi></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="4.0em"/><mo>∨</mo><mfenced close=")" open="("><mrow><mi>μ</mi><mfenced close=")" open="("><mi>S</mi></mfenced><mo>=</mo><mrow><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mo>∧</mo><mo>∃</mo><msup><mi>S</mi><mi>'</mi></msup><mo>∈</mo><mi>S</mi><mi>:</mi><mi>i</mi><mi>s</mi><mi>C</mi><mi>P</mi><mi>O</mi><mi>E</mi><mfenced close=")" open="("><msup><mi>S</mi><mi>'</mi></msup></mfenced></mrow></mfenced></mrow></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∨</mo><mfenced close=")" open="("><mrow><mi>i</mi><mi>s</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi><mfenced close=")" open="("><mi>T</mi></mfenced><mo>∧</mo><mi>i</mi><mi>s</mi><mi>F</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi><mi>B</mi><mi>y</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mfenced close=")" open="("><mi>S</mi></mfenced></mrow></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∨</mo><mfenced close=")" open="("><mrow><mi>i</mi><mi>s</mi><mi>F</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi><mi>B</mi><mi>y</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mfenced close=")" open="("><mi>T</mi></mfenced><mo>∧</mo><mi>i</mi><mi>s</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi><mfenced close=")" open="("><mi>S</mi></mfenced></mrow></mfenced></mrow></mfenced><mi>T</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>S</mi></mrow></math></p>
</div>
</li>
<li>
<p>If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> is a class, enum or primitive type and
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> is a type-variable, then for each given boundary
<math xmlns="http://www.w3.org/1998/Math/MathML"><msubsup><mi>T</mi><mi>i</mi><mrow><mi>u</mi><mi>p</mi></mrow></msubsup></math> of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> of type class, enum or
primitive <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> must be a member of the type hierarchy:
<sup class="footnote">[<a id="_footnoteref_43" class="footnote" href="#_footnote_43" title="View footnote.">43</a>]</sup>
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mfenced close=")" open="("><mrow><mi>i</mi><mi>s</mi><mi>B</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>d</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>V</mi><mi>a</mi><mi>r</mi><mfenced close=")" open="("><mi>T</mi></mfenced><mo>∧</mo><mi>i</mi><mi>s</mi><mi>C</mi><mi>P</mi><mi>O</mi><mi>E</mi><mfenced close=")" open="("><mi>S</mi></mfenced></mrow></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><msub><mo>∀</mo><mrow><msubsup><mi>T</mi><mi>i</mi><mrow><mi>u</mi><mi>p</mi></mrow></msubsup><mo>∈</mo><mi>T</mi><mo>.</mo><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>B</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>d</mi><mi>s</mi></mrow></msub><mfenced close=")" open="("><mrow><mi>i</mi><mi>s</mi><mi>C</mi><mi>P</mi><mi>O</mi><mi>E</mi><mfenced close=")" open="("><msubsup><mi>T</mi><mi>i</mi><mrow><mi>u</mi><mi>p</mi></mrow></msubsup></mfenced><mfenced close=")" open="("><mrow><msubsup><mi>T</mi><mi>i</mi><mrow><mi>u</mi><mi>p</mi></mrow></msubsup><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>S</mi><mo>∨</mo><msubsup><mi>T</mi><mi>i</mi><mrow><mi>u</mi><mi>p</mi></mrow></msubsup><mi>:</mi><mi>g</mi><mi>t</mi><mi>;</mi><mi>S</mi></mrow></mfenced></mrow></mfenced></math></p>
</li>
<li>
<p>If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> is a union or intersection type, then the type
cast is valid if it is valid for at least one element of
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math>.</p>
</li>
<li>
<p>If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> and <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> are generics, and if
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi><mo>&lt;</mo><mi>s</mi><mi>u</mi><mi>p</mi><mo>&gt;</mo><mn>0</mn><mo>=</mo><mi>T</mi><mo>&lt;</mo><mo>/</mo><mi>s</mi><mi>u</mi><mi>p</mi><mo>&gt;</mo><mn>0</mn></math>, a cast is possible if type arguments are sub- or
supertypes of each other: <sup class="footnote">[<a id="_footnoteref_44" class="footnote" href="#_footnote_44" title="View footnote.">44</a>]</sup> <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>μ</mi><mfenced close=")" open="("><mi>S</mi></mfenced><mo>=</mo><mrow><mi>C</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>r</mi></mrow><mo>∧</mo><mi>μ</mi><mfenced close=")" open="("><mi>T</mi></mfenced><mo>=</mo><mrow><mi>C</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>r</mi></mrow><mo>∧</mo><mi>S</mi><mo>&lt;</mo><mi>s</mi><mi>u</mi><mi>p</mi><mo>&gt;</mo><mn>0</mn><mo>=</mo><mi>T</mi><mo>&lt;</mo><mo>/</mo><mi>s</mi><mi>u</mi><mi>p</mi><mo>&gt;</mo><mn>0</mn><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><mfenced close=")" open="("><mrow><mo>∀</mo><mi> </mi><mi>S</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>A</mi><mi>r</mi><msub><mi>g</mi><mi>i</mi></msub><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>T</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>A</mi><mi>r</mi><msub><mi>g</mi><mi>i</mi></msub></mrow></mfenced><mo>∨</mo><mfenced close=")" open="("><mrow><mo>∀</mo><mi> </mi><mi>T</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>A</mi><mi>r</mi><msub><mi>g</mi><mi>i</mi></msub><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>S</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>A</mi><mi>r</mi><msub><mi>g</mi><mi>i</mi></msub></mrow></mfenced></math></p>
</li>
<li>
<p>It <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> is a union type, then the type cast is valid if
it is valid for at least one element of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>.</p>
</li>
<li>
<p>It <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> is an intersection type, then the type cast is
valid if it is valid for all elements of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that <code>any</code> is a supertype of all other types, thus it is always possible
to cast a variable of type <code>any</code> to other (non-composed) types.</p>
</div>
</div>
<div class="sect3">
<h4 id="_type_check"><a class="anchor" href="#_type_check"></a>9.3.2. Type Check</h4>
<div class="paragraph">
<p>There are basically two ways of testing the type of a variable: <code>typeof</code> and <code>instanceof</code>.

N4JS supports type comparison via the ECMAScript <code>instanceof</code> operator. The operator <code>instanceof</code> retains its standard ECMAScript behavior (e.g. checking whether a value is an instance of a constructor function), but has additional functionality when used with N4JS types.</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/293" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-293</a>
</div>
</div>
<div class="paragraph">
<p>When used with an N4JS class, <code>instanceof</code> also supports checking against an interface. For N4JS enumeration values, it can be used to check whether the value is part of a specific enumeration.</p>
</div>
<div class="paragraph">
<p><code>typeof</code> only returns a string with the name of the ECMAScript type, which is <code>Object</code> for all class instances.</p>
</div>
<div class="paragraph">
<p>N4 specific <code>string</code> types, that is <code>pathSelector</code> and <code>i18nkey</code> cannot be tested during runtime. These types, therefore, must not be used in <code>instanceof</code> expressions. The same is true for string-based enums and arrays which cannot be tested during runtime, thus string-based enum and array types are not permitted on the right-hand side of <code>instancesof</code> constructs. For all types for which the evaluation result of <code>instanceof</code> could be computed at compile time, the check is unnecessary and thus it is refused by the compiler. Using structural types on the right-hand side of <code>instancesof</code> constructs is also not permitted.</p>
</div>
<div class="paragraph">
<p>In order to avoid errors at runtime, the <code>instanceof</code> operator defines appropriate constraints, see <a href="#Relational_Expression">[Relational_Expression]</a> for details.</p>
</div>
<div class="paragraph">
<p>Type Check Example</p>
</div>
<div class="paragraph">
<p>Given the following classes and variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>interface I{}
class S{}
class Sub extends S implements I{}

var x = new Sub();</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>typeof x</code> will simply return <code>object</code>. The following table shows the difference between plain JavaScript <code>instanceof</code> and N4JS’s <code>instanceof</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Check</th>
<th class="tableblock halign-center valign-top">JavaScript</th>
<th class="tableblock halign-center valign-top">N4JS</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>x instanceof Sub</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>x instanceof S</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>x instanceof I</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_reflection_meta_information"><a class="anchor" href="#_reflection_meta_information"></a>9.4. Reflection meta-information</h3>
<div class="paragraph">
<p>   </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-155" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-155</a>
<a href="https://jira.numberfour.eu/browse/IDE-561" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-561</a>
<a href="https://jira.numberfour.eu/browse/IDE-137" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-137</a>
<a href="https://jira.numberfour.eu/browse/IDE-980" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-980</a>
</div>
</div>
<div class="paragraph">
<p>All N4JS classes, interfaces and enumerations provide meta-information
that is used by the runtime and standard library.
All classifiers (including enums) provide meta-information by means of a static getter <code>n4class</code>.
Since it is static getter, it is actually an instance getter of the
constructor (or classifier) of a type, which is the only way to retrieve
that information in case of interfaces. For enums, this can be retrieved
from instances as well.</p>
</div>
<div class="paragraph">
<p>This getter is of type <code>N4Class</code> which is a built-in type just like <code>N4Object</code>. It contains the following members:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>fqn</code> </dt>
<dd>
<p>The <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi><mi>Q</mi><mi>N</mi></math> of the type.</p>
</dd>
<dt class="hdlist1"><code>n4superType</code> </dt>
<dd>
<p>The <code>N4Class</code> of the supertype, may be null if supertype is a not an .</p>
</dd>
<dt class="hdlist1"><code>allImplementedInterfaces</code> </dt>
<dd>
<p>List of The <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi><mi>Q</mi><mi>N</mi></math> of implemented interfaces (transitively
but without interfaces implemented by supertype)</p>
</dd>
<dt class="hdlist1"><code>get isClass</code> </dt>
<dd>
<p>True if the type is an N4Class.</p>
</dd>
<dt class="hdlist1"><code>get isInterface]</code> </dt>
<dd>
<p>True if the type is an N4Interface.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This meta-information is currently not available to non-N4 developers.</p>
</div>
<div class="sect3">
<h4 id="_reflection_for_classes"><a class="anchor" href="#_reflection_for_classes"></a>9.4.1. Reflection for Classes</h4>
<div class="paragraph">
<p>The meta-information for classes is available by means of <code>N4Object</code>’s static
getter <code>n4class</code>. Since it is static getter, it is actually an instance getter of the constructor of a type.</p>
</div>
<div class="paragraph">
<p>Reflection with <code>N4class</code></p>
</div>
<div class="paragraph">
<p>This example demonstrates how these reflective features are accessed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class A {}
class B extends A {}
var b = new B();
console.log(B.n4class.fqn);
console.log(b.constructor.n4class.fqn);
console.log(b.constructor.n4class.n4superType.fqn);
console.log(B.n4class.constructor.n4class.fqn);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming this code is defined in file <code>A</code>, this will output</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>A.B
A.B
A.A
N4Class</code></pre>
</div>
</div>
<div class="paragraph">
<p>The built-in types <code>N4Object</code> and <code>N4Class</code> are also accessible.
They are not defined in a module, thus their <a href="#AC">FQN</a> returns only their simple name.</p>
</div>
<div class="paragraph">
<p>Reflection with Built-In Types</p>
</div>
<div id="ex:Reflection_with_Built_In_Types" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">console.log('N4Object.n4class.fqn:      ' + N4Object.n4class.fqn)
console.log('N4Class.n4class.fqn:       ' + N4Class.n4class.fqn)

class A {}
console.log('A.n4class.fqn:             ' + A.n4class.fqn)
console.log('A.n4class.n4superType.fqn: ' + A.n4class.n4superType.fqn)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming this code is defined in file <code>A</code>, this will output</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>N4Object.n4class.fqn:      N4Object
N4Class.n4class.fqn:       N4Class
A.n4class.fqn:             A.A
A.n4class.n4superType.fqn: N4Object</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that classes extending <code>Object</code> do not provide the static <code>n4class</code> getter, hat is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>class B extends Object {}
console.log('B.n4class.fqn:             ' + B.n4class.fqn)</code></pre>
</div>
</div>
<div class="paragraph">
<p>would issue an error as cannot be resolved.</p>
</div>
<div class="paragraph">
<p>N4Class.of</p>
</div>
<div class="paragraph">
<p>The type has a method to retrieve the meta-information from instances (i.e. or enumeration literals using )
without using the constructor. </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/195" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-195</a>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class C { }
interface I {}  class IImpl implements I {}
enum E { L }

var c: C = new C();
var i: I = new IImpl();
var e: E = E.L;

console.log(C.n4type.fqn);
console.log(N4Class.of(c).fqn);

console.log(I.n4type.fqn);
console.log(N4Class.of(i).fqn);

console.log(E.n4type.fqn);
console.log(N4EnumType.of(e).fqn);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_reflection_for_interfaces"><a class="anchor" href="#_reflection_for_interfaces"></a>9.4.2. Reflection for Interfaces</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-980" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-980</a>
</div>
</div>
<div class="paragraph">
<p>The meta-information of an interface <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math> is available via
getter <code>n4class</code> defined in the <code>type{X}</code>. This field is of type <code>N4Class</code> as well. Since an interface cannot have a super classs, the property <code>n4superTypes</code> will always be empty.
Calling <code>isInterface</code> respectively on the returned <code>N4Class</code> instance will return true.</p>
</div>
</div>
<div class="sect3">
<h4 id="_reflection_for_enumerations"><a class="anchor" href="#_reflection_for_enumerations"></a>9.4.3. Reflection for Enumerations</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>var n: number; var b: boolean; var s: string;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The meta-information for enumerations is available by means of the getter <code>n4class</code>, either statically by using the enumeration type or (in terms of an
instance getter) via a literal.
Calling <code>isEnum</code> on the returned <code>N4Class</code> instance will return true.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conversion_of_primitive_types"><a class="anchor" href="#_conversion_of_primitive_types"></a>9.5. Conversion of primitive types</h3>
<div class="paragraph">
<p>Conversion between primitives is given as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>var n: number; var b: boolean; var s: string;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 33.3333%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">From</th>
<th class="tableblock halign-center valign-middle">To</th>
<th class="tableblock halign-left valign-middle">Conversion</th>
<th class="tableblock halign-center valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>number</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>Number&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>n = Number("42");//42</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>N4Primitives.parseBoolean(&#8230;&#8203;)</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code> b=N4Primitives.parseBoolean("false");</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>number</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>Boolean(&#8230;&#8203;)</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>b=Boolean(17.5); //true</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>number</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>Number.toString()</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>s=42.toString(); //"42"</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>number</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>N4Primitives.toNumber(&#8230;&#8203;)</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>n=N4Primitives.toNumber(true);</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>Boolean.toString()</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code> s=true.toString();//"true" }</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Remarks:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ECMAScript doesn’t define explicit conversion from string content.
Implicit handling states all strings with <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>g</mi><mi>t</mi><mi>;</mi></math>0==true. <code>N4Primitives.parseBoolean( x )</code> yields
true for <code>x.trim().toLowerCase().equals("true")</code></p>
</li>
<li>
<p>The call to <code>Boolean(..)</code> for the arguments <code>0, -0, null, false, NaN, undefined</code> and <code>""</code> evaluate to <code>false</code>. All other values
evaluate to <code>true</code>.</p>
</li>
<li>
<p><code>Number</code> has several methods for converting a value to string [<a href="#ECMA11a">ECMA11a(p.S15.7.4)</a>]: <code>toExponential(), to Fixed(), toPrecision()</code>.</p>
</li>
<li>
<p>ECMAScript doesn’t define explicit conversion from boolean to
number. Implicit handling states true <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>→</mo></math> 1 and
false <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>→</mo></math> 0, which <code>N4Primitives.toNumber()</code> yields.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_expressions"><a class="anchor" href="#_expressions"></a>10. Expressions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For all expressions, we define the following pseudo properties:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>containingExpression</code> </dt>
<dd>
<p>The parent expression, in which an expression is contained, may be null.</p>
</dd>
<dt class="hdlist1"><code>containingStatement</code> </dt>
<dd>
<p>The statement in which the expression is (indirectly) contained.</p>
</dd>
<dt class="hdlist1"><code>containingFunctionOrAccessor</code> </dt>
<dd>
<p>The function, method, getter or setter in which the expression is
(indirectly) contained, may be null</p>
</dd>
<dt class="hdlist1"><code>containingClass</code> </dt>
<dd>
<p>The class in which the expression is (indirectly) contained, may be
null.</p>
</dd>
<dt class="hdlist1"><code>probableThisTarget</code> </dt>
<dd>
<p>The potential target of a this keyword binding, this is not necessarily
the containing class or object literal. In case of instance methods of a
class <code>T</code>, this usually is the classifier <code>T</code>; in case of static methods, it
is the classifier type <code>type{type}</code>.</p>
</dd>
<dt class="hdlist1"><code>container</code> </dt>
<dd>
<p>The direct owner of the expression.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The expressions and statements are ordered, describing first the
constructs available in the 5th edition of ECMA-262, referred to as
[<a href="#ECMA11a">ECMA11a</a>] in the following. It is worth noting that the grammar snippets already use
newer constructs in some cases.</p>
</div>
<div class="sect2">
<h3 id="_ecmascript_5_expressions"><a class="anchor" href="#_ecmascript_5_expressions"></a>10.1. ECMAScript 5 Expressions</h3>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-232" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-232</a>
</div>
</div>
<div class="paragraph">
<p>[sec:ECMAScript_Expressions] N4JS supports the same expressions as
ECMAScript. The semantics are described in [<a href="#ECMA11">ECMA11(p.S11)</a>]  . In N4JS, some expressions
are extended for supporting the declaration of types, annotations, or
parameterized usages. These extensions and type-related aspects as well
as specific N4JS constraints are described in this section.</p>
</div>
<div class="paragraph">
<p>Some operators come in different ’flavors’, that is as binary operator,
unary pre- or postfix operators, or assignment operators. For these
operators, type constraints are only defined for the binary operator
version and the other variants are deduced to that binary version. E.g.,
’+’ and ’=’ are deduced to ’+’ (and simple assignment).</p>
</div>
<div class="sect3">
<h4 id="_the_this_literal"><a class="anchor" href="#_the_this_literal"></a>10.1.1. The this Literal</h4>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-229" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-229</a>
<a href="https://jira.numberfour.eu/browse/IDE-505" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-505</a>
</div>
</div>
<div class="paragraph">
<p>This section describes the <code>this</code> literal and the semantics of the <code>@This</code> annotation, the type <code>this</code> is described in <a href="#This_Type">[This_Type]</a>.</p>
</div>
<div class="sect4">
<h5 id="_semantics_8"><a class="anchor" href="#_semantics_8"></a>Semantics</h5>
<div class="paragraph">
<p>Semantics are similar to the original ECMAScript this keyword, see [<a href="#ECMA11a">ECMA11a(p.11.1.1, p.p.63)</a>])
Also see [<a href="#West06a">West06a</a>] and cite:[MozillaJSRef(<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this" class="bare">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this</a>)]</p>
</div>
<div class="paragraph">
<p>Regarding the location where <code>this</code> may be used, the following restrictions
apply:</p>
</div>
<div class="paragraph">
<p>The literal may not be used in</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the initializer expression of static data fields in classes.</p>
</li>
<li>
<p>the initializer expression of data fields in interfaces (applies to
both static and non-static).</p>
</li>
<li>
<p>static methods of interfaces and static field accessors of
interfaces.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>See also [req:StaticMembersOfInterfaces].</p>
</div>
<div class="paragraph">
<p>The use of <code>this</code> is illustrated with some examples as it can often be
confusing. Type inference heuristics and explanations are provided in
the next section.</p>
</div>
<div class="paragraph">
<p>this in unrestricted mode</p>
</div>
<div class="paragraph">
<p>In unrestricted mode, <code>this</code> is bound to the receiver. If there is no receiver it is bound to the global object, however, we often do not know exactly
what the global object would be.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var name = "global a"; // assume the top level is similar to the global object
this.name; // &lt;-- "global a"
function f() {
    return this.name; // &lt;-- depends on call, usually "global a"
}
var ol1 = {
    name: "John",
    greeting: "Hello " + this.name, // "Hello global a" -- we do not greet John!
}
var ol2 = {
    name: "John",
    f: function() {
        this.name; // usually "John", as we assume f is called like ol2.f()
        var g = function() {
           return this.name; // "global a"
        }
        return g(); // no receiver, this in nested function g will be global scope
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>this in strict mode</p>
</div>
<div class="paragraph">
<p>In strict mode, <code>this</code> is bound to the receiver.
If there is no receiver, it is bound to <code>undefined</code>.
Thus, we will probably get a lot of errors:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">"use strict"
var name = "global a"; // assume the top level is similar to the global object
this.name; // &lt;-- error, this is undefined, there is no receiver
function f() {
    return this.name; // &lt;-- depends on call, usually this produces an error as this is undefined
}
var ol1 = {
    name: "John",
    greeting: "Hello " + this.name, // will produce an error, as this is undefined
}
var ol2 = {
    name: "John",
    f: function() {
        this.name; // usually "John", as we assume f is called like ol2.f()
        var g = function() {
           this.name; // an error, see call below:
        }
        return g(); // no receiver, this in nested function g is undefined
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>this in N4JS mode</p>
</div>
<div class="paragraph">
<p>As in strict mode, <code>this</code> is bound to the receiver and if there is no receiver, it is bound to <code>undefined</code>. So the example above is also true for N4JS mode. Classes behave slightly differently:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class A {
    name = "John";
    greeting  = "Hello " + this.name; // works, in N4JS classes, greeting is "Hello John"

    f() {
        return this.name; // this usually is instance object, similar to object literals.
    }

    g() {
        var h = function() {
            return this.name; // as in object literals: no receiver, no this.
        }
        return h();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in N4JS classes, is always bound to the instance when used in
field initialization.</p>
</div>
</div>
<div class="sect4">
<h5 id="_type_inference_2"><a class="anchor" href="#_type_inference_2"></a>Type Inference</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-244" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-244</a>
</div>
</div>
<div class="paragraph">
<p>The type is inferred from the <code>this</code> type is bound to. The inference,
therefore, has to consider the original semantics as described in [<a href="#ECMA11a">ECMA11a(p.10.4., p.10.4.3, p.p.58)</a>]  . In
ECMAScript the type of this is unfortunately determined by the function
call and not by the function definition:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By default, <code>this</code> is bound to the global object [<a href="#ECMA11a">ECMA11a(p.10.4.1.1)</a>]   . Unfortunately it is often
unknown what the global object will be at run time (e.g., node.js
differs from browsers).</p>
</li>
<li>
<p>If a function is called without a receiver, <code>this</code> is bound to</p>
<div class="ulist">
<ul>
<li>
<p>the global object or</p>
</li>
<li>
<p>to <code>undefined</code> in strict mode.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If a function is called with a receiver,<code>this</code> is bound to the receiver
object.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Actually, <code>this</code> is bound to the newly created object if a function is called
with the <code>new</code> operator. If a function is known to be invoked with an explicit
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi><mi>A</mi><mi>r</mi><mi>g</mi></math> (<code>apply()</code> etc.), the <code>@This</code> annotation can be used to explicitly set the this type. This annotation has precedence over otherwise
inferred bindings. </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1010" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1010</a>
</div>
</div>
<div class="paragraph">
<p>In general, the actual this target can not be inferred from the context of the this
keyword. A heuristic is defined, however, to compute the probable this
type:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the this keyword is used in some function annotated with an
annotation , the type specified in the annotation is used. The inferred
type is always nominal. <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>"</mi><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi><mi>"</mi></mrow><mi>:</mi><mi>T</mi></mrow><mrow><mi>f</mi><mo>=</mo><mrow><mi>"</mi><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi><mi>"</mi></mrow><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>F</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>O</mi><mi>r</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>o</mi><mi>r</mi><mtext>
</mtext><mi>f</mi><mo>.</mo><mi>h</mi><mi>a</mi><mi>s</mi><mi>A</mi><mi>n</mi><mi>n</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mfenced close=")" open="("><mrow><mi>"</mi><mi>@</mi><mi>T</mi><mi>h</mi><mi>i</mi><mi>s</mi><mi>"</mi></mrow></mfenced><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>T</mi><mo>=</mo><mi>f</mi><mo>.</mo><mi>a</mi><mi>n</mi><mi>n</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mrow><mo>[</mo><mi>"</mi><mi>@</mi><mi>T</mi><mi>h</mi><mi>i</mi><mi>s</mi><mi>"</mi></mrow></mrow></math>}}\\
        \end{aligned}\]]</p>
</li>
<li>
<p>If the this keyword is used in some <em>instance</em> method of a
classifier or in an <em>instance</em> field initializer, is bound to the
itself. If the this keyword is used in some <em>static</em> method of a
classifier or in a <em>static</em> field initializer, the prototype type (or
constructor) of the classifier is used, that is . In both cases, the
target is determined by using the expressions’s pseudo property . If the
this keyword is used in a function expression assigned to an property of
an object literal, the type of the object literal is used. Note that
usually this is the type in instance methods, and the type in static
methods.
 <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>"</mi><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi><mi>"</mi></mrow><mi>:</mi><mi>T</mi></mrow><mrow><mi>T</mi><mo>=</mo><mrow><mi>"</mi><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi><mi>"</mi></mrow><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>b</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi><mi>T</mi><mi>h</mi><mi>i</mi><mi>s</mi><mi>T</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>T</mi><mo>≠</mo></mrow><mtext>
</mtext></math></p>
</li>
<li>
<p> In all other cases: Non-strict mode: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>"</mi><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi><mi>"</mi></mrow><mi>:</mi><mrow><mi>g</mi><mi>l</mi><mi>o</mi><mi>b</mi><mi>a</mi><mi>l</mi></mrow></mrow><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>=</mo><mrow><mi>u</mi><mi>n</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>c</mi><mi>t</mi><mi>e</mi><mi>d</mi></mrow></mrow><mtext>
</mtext></math> Strict mode and N4JS mode:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>"</mi><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi><mi>"</mi></mrow><mi>:</mi><mrow><mi>g</mi><mi>l</mi><mi>o</mi><mi>b</mi><mi>a</mi><mi>l</mi></mrow><mrow><mi>u</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi></mrow></mrow><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>≠</mo><mrow><mi>u</mi><mi>n</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>c</mi><mi>t</mi><mi>e</mi><mi>d</mi></mrow></mrow><mtext>
</mtext></math></p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-785" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-785</a>
<a href="https://jira.numberfour.eu/browse/IDE-185" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-185</a>
</div>
</div>
<div class="paragraph">
<p>If the actual this type is defined as a structural type, the structural
type information is moved to the this type itself. This is transparent
to the user in general but maybe visible in case of error messages. That
is to say that the actual this type is always a nominal type. This is
indicated by the nominal modifier f
(cf. <a href="#req:Type_Inference_Heuristic_for_This_Keyword">[req:Type_Inference_Heuristic_for_This_Keyword]</a> .1. and 2.).</p>
</div>
<div class="paragraph">
<p>91Valid Target and Argument for @This
Annotation[req:ValidTargetAndArgumentForThisAnnotation] </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-802" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-802</a>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>@This</code> annotation is only allowed on declared functions, function
expressions (including arrow functions), methods, and field accessors,
i.e. getters and setters, except static members of interfaces.</p>
</li>
<li>
<p>The type declared by way of <code>@This(..)</code> an annotation of a method or field
accessor must be a subtype of the member’s containing classifier.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It is not allowed to use more then one annotation on an element.</p>
</div>
</div>
<div class="sect4">
<h5 id="_effect_of_nominal_this_type"><a class="anchor" href="#_effect_of_nominal_this_type"></a>Effect of Nominal This Type</h5>
<div class="paragraph">
<p>Given the following declaration</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">@This(~Object with {a: string;}) f() {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since the this type is always nominal, <code>~ Object
` becomes `Object</code>. In case of method call,
however, the returned value becomes structural again. In case of error
messages the type of the return type is then</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">~this[Object] with {a: string;}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the sake of simplicity, additional structural members are usually
omitted in error messages, leading to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">~this[Object]</code></pre>
</div>
</div>
<div class="paragraph">
<p>instead of</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">this[~Object]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This and Function Declaration
[[ex:This and Function Declaration]]
This example demonstrates the usage of functions annotated with <code>@This</code>.
By using the argument  <code>union{A,B}</code> it is possible to have two completely unrelated classes as the receiver type of the function <code>logger</code>. To pass an actual object the <code>apply()</code> method of the function is used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">[language=n4js,escapeinside={^}{^}]
class A {
    log: string() { return "A was logged"; }
}

class B {
    log: string() { return "B was logged"; }
}

@This(union{A,B})
function logger() { console.log("~ "+this.log()+" ~"); }


var a: A = new A();
logger.apply(a,[]); // prints "~ A was logged ~"
logger.apply( new B(),[]) // prints "~ B was logged ~"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This and Function Expressions
[[ex:This and Function Expressions]]
In this example a function is created via a function expression. The
function is then assigned to member field of class B. Via annotating the
expression with access to the receiver of type B is enabled.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">[language=n4js,escapeinside={^}{^}]
class B {
    log(): string { return "B was logged"; }     // method
    logMe : {@This(B) function():void}; // reference to a function
}

var b: B = new B();
b.logMe = @This(B) function() { console.log("*&gt;"+this.log()+"&lt;*"); }
b.logMe(); // prints "*&gt;B was logged&lt;*"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This and Constructor Functions
[[ex:This and Constructor Functions]]
Note that if a function is called as a constructor function with new, the
type of <code>this</code> can be declared via annotation <code>@This</code>, as shown in the following
snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">[language=n4js,escapeinside={^}{^}]
@This(
    ~Object with {
        w: number; h: number;
        area: {function():number};
    })
function Box(w: number w, h: number) {
    this.w = w;
    this.h = h;
    this.area = @This(
        ~Object with {
            w: number; h: number;
            area: {function():number};
        }) function() { return this.w * this.h }
}
var bError = Box(1,2)
var bOK = new Box(1,2)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Inside the constructor function <code>Box</code>, <code>this</code> is bound to the structural type
definition due to the annotation.</p>
</div>
<div class="paragraph">
<p>Inside the nested function <code>area</code>, <code>this</code> is bound to the receiver object (if the function is called like <code>bOk.area()</code>). Again, this depends on the way the nested
function is called, which can usually not be determined at the
declaration location. The nested function must then be annotated
accordingly.</p>
</div>
<div class="paragraph">
<p>When calling this function, the type of this is checked against the
declared this type, which would cause an error in the first case.</p>
</div>
<div class="paragraph">
<p>The use of the <code>@This</code> annotation is not allowed on methods. </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-2313" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-2313</a>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title"></div>
</td>
<td class="content">
Using constructor functions is not recommended and an error or warning will be created. This is only useful for adapting third-party library code. Even in the latter case, it would probably make more sense to declare a (library) \emph{class} Rectangle rather then defining the constructor function.}
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_identifier"><a class="anchor" href="#_identifier"></a>10.1.2. Identifier</h4>
<div class="sect4">
<h5 id="_syntax_9"><a class="anchor" href="#_syntax_9"></a>Syntax</h5>
<div class="paragraph">
<p>Identifiers as expressions are identifier references. They are defined
as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">IdentifierRef &lt;Yield&gt;:
    id=[types::IdentifiableElement|BindingIdentifier&lt;Yield&gt;]
;

BindingIdentifier &lt;Yield&gt;:
    IDENTIFIER
    | &lt;!Yield&gt; 'yield'
    | N4Keyword
;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_semantics_9"><a class="anchor" href="#_semantics_9"></a>Semantics</h5>
<div class="paragraph">
<p>The type of an identifier <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math> is resolved depending on its
binding and scope respectively (cf. [<a href="#ECMA11a">ECMA11a(p.10.2.2.1GetIdentifierReference, p.p.56)</a>]  . The following scopes (aka
<em>Lexical Environments</em>) are defined:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>function local; local variables, parameters</p>
</li>
<li>
<p>zero or more function closure in case of nested functions</p>
</li>
<li>
<p>module</p>
</li>
<li>
<p>global</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These scope are nested as illustrated in .</p>
</div>
<div class="paragraph">
<p>Note that classes definitions and object literal do not define a scope:
members of a class or properties of an object literal are to be accessed
via <code>this</code>. Identifier references always reference declared elements, that is
to say either variable, function, or class declarations. Properties of
object literals or members of a class are referenced via
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>y</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mo>-</mo><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>y</mi></math> (see <a href="#_property_accessors">Property Accessors</a>).</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="fig/scopes.png" alt="Scopes"></span></p>
</div>
<div class="paragraph">
<p>An identifier may be bound to a variable (global or local variable,
parameter, variable defined in a function’s closure), or to a property
of an object. The latter case is known as property access as further
described in <a href="#_property_accessors">Property Accessors</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>//Requirement
//93Read Access to Identifier
[[req:Read_Access_to_Identifier]]
If an identifier math:[$i$] is accessed, the bound declared element
math:[$D$] must be readable if it is not used on the left-hand side
of an assignment expression. math:[\[\begin{aligned}
&amp; bind(i, D) \\
&amp; \hspace{2em}\land \not\exists\ \type{AssignmentExpression}\ ae \in i.container^*: \\
&amp; \hspace{3em} ae.left = i \\
&amp; \hspace{4em}\lor (\mu(ae.left)=\type{PropertyAccessExpression} \land ae.left.property=i): \\
&amp; \Rightarrow D.readable \\\end{aligned}\]]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_type_inference_3"><a class="anchor" href="#_type_inference_3"></a>Type Inference</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-244" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-244</a>
</div>
</div>
<div class="paragraph">
<p>An identifier reference <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math> is bound to an identifiable
element <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mo>.</mo><mi>i</mi><mi>d</mi></math>, which is expressed with the function
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>b</mi><mi>i</mi><mi>n</mi><mi>d</mi><mfenced close=")" open="("><mi>i</mi><mrow><mi>i</mi><mo>.</mo><mi>i</mi><mi>d</mi></mrow></mfenced></math>. The type of the reference is then inferred
as follows: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>I</mi><mi>d</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>r</mi><mi>R</mi><mi>e</mi><mi>f</mi></mrow><mi> </mi><mi>i</mi><mi>d</mi><mi>r</mi><mi>e</mi><mi>f</mi><mi>:</mi><mi>T</mi></mrow><mrow><mi>i</mi><mi>d</mi><mi>r</mi><mi>e</mi><mi>f</mi><mo>.</mo><mi>i</mi><mi>d</mi><mi>:</mi><mi>T</mi></mrow></math></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_literals"><a class="anchor" href="#_literals"></a>10.1.3. Literals</h4>
<div class="paragraph">
<p>cf. [<a href="#ECMA11a">ECMA11a(p.S11.1.3p.63, p.S7.8p.19ff)</a>].</p>
</div>
<div class="sect4">
<h5 id="_type_inference_4"><a class="anchor" href="#_type_inference_4"></a>Type Inference</h5>
<div class="paragraph">
<p>The type of a literal can directly be derived from the grammar. The
following axioms are defined for literals:</p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mrow><mi>N</mi><mi>u</mi><mi>l</mi><mi>l</mi><mi>L</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>l</mi></mrow><mi>:</mi><mrow><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi></mrow></mrow><mrow/><mrow><mn>7.8</mn><mn>.1</mn></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mrow><mi>B</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi>a</mi><mi>n</mi><mi>L</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>l</mi></mrow><mi>:</mi><mrow><mi>b</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi>a</mi><mi>n</mi></mrow></mrow><mrow/><mrow><mn>7.8</mn><mn>.2</mn></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mrow><mi>N</mi><mi>u</mi><mi>m</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>c</mi><mi>L</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>l</mi></mrow><mi>:</mi><mrow><mi>i</mi><mi>n</mi><mi>t</mi></mrow><mi>o</mi><mi>r</mi><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi></mrow></mrow><mrow/><mrow><mn>7.8</mn><mn>.3</mn></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mrow><mi>S</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>L</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>l</mi></mrow><mi>:</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow></mrow><mrow/><mrow><mn>7.8</mn><mn>.4</mn></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mrow><mi>R</mi><mi>e</mi><mi>g</mi><mi>u</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>L</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>l</mi></mrow><mi>:</mi><mrow><mi>R</mi><mi>e</mi><mi>g</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi></mrow></mrow><mrow/><mrow><mn>7.8</mn><mn>.5</mn></mrow></math></p>
</div>
<div class="paragraph">
<p>Note that there are no literals specific for <code>pathSelector</code> or <code>i18nkey</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_integer_literals"><a class="anchor" href="#_integer_literals"></a>Integer Literals</h5>
<div class="paragraph">
<p>Numeric literals representing integers in the range of JavaScript’s
int32 are inferred to the built-in primitive type <code>int</code> instead of <code>number</code>. The
following rules apply:</p>
</div>
<div class="paragraph">
<p>[[req:Numeric literals]]</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Numeric literals with a fraction or using scientific notation, e.g. <code>2.0</code>
and <code>2e0</code>, respectively, are always inferred to <code>number</code>, even if they represent
integers in the range of int32.</p>
</li>
<li>
<p>Numeric literals that represent integers in the range of JavaScript’s
int32, i.e. from <math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>-2</mn><mn>31</mn></msup></math> to <math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mn>31</mn></msup><mo>-</mo><mn>1</mn></math>, are
inferred to <code>int</code>.</p>
</li>
<li>
<p>Hexadecimal and octal literals are always interpreted as positive
numbers, so all values above <code>0x7fffffff</code> and <code>017777777777</code> lie outside the range of int32 and will thus be inferred to <code>number</code>; this is an important difference to Java.
See below for further elaboration.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are differences to numeric literals in Java:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-center valign-top" colspan="2">Java</th>
<th class="tableblock halign-center valign-top" colspan="2">JavaScript &amp; N4JS</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Literal</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Value</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Type</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Value</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Type</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2147483648</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>-2147483648</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>-2147483648</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2147483647</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>2147483647</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>2147483647</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7fffffff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>2147483647</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>2147483647</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>-2147483648</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>+2147483648</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>number</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffffff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>-1</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>4294967295</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>number</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x100000000</code></p></td>
<th class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">n/a</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>4294967296</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>number</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>017777777777</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>2147483647</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>2147483647</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>020000000000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>-2147483648</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>+2147483648</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>number</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>037777777777</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>-1</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>4294967295</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>number</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>040000000000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>4294967296</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>number</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0100000000000</code></p></td>
<th class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">n/a</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>8589934592</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>number</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The literals <code>0x100000000</code> and <code>0100000000000</code> produce a syntax error in Java.</p>
</div>
<div class="paragraph">
<p>Until IDE-1881  is complete, all built-in operations always return a <code>number</code> even if all operands are of type <code>int</code>. For the time being, we therefore interpret <code>-1</code> as
a negative integer literal (inferred to <code>int</code>), but <code>-(1)</code> as the negation of a
positive integer literal (inferred to <code>number</code>).</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1881" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1881</a>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_array_literal"><a class="anchor" href="#_array_literal"></a>10.1.4. Array Literal</h4>
<div class="sect4">
<h5 id="_syntax_10"><a class="anchor" href="#_syntax_10"></a>Syntax</h5>
<div class="paragraph">
<p>cf [<a href="#ECMA11a">ECMA11a(p.S11.1.4, p.p.63)</a>]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">ArrayLiteral &lt;Yield&gt; returns ArrayLiteral:
    {ArrayLiteral} '['
        elements+=ArrayPadding* (
            elements+=ArrayElement&lt;Yield&gt;
            (',' elements+=ArrayPadding* elements+=ArrayElement&lt;Yield&gt;)*
            (trailingComma?=',' elements+=ArrayPadding*)?
        )?
    ']'
;

/**
 * This array element is used to pad the remaining elements, e.g. to get the
 * length and index right
 */
ArrayPadding returns ArrayElement: {ArrayPadding} ',';

ArrayElement &lt;Yield&gt; returns ArrayElement: {ArrayElement} spread?='...'? expression=AssignmentExpression&lt;In=true,Yield&gt;;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_type_inference_5"><a class="anchor" href="#_type_inference_5"></a>Type Inference</h5>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-244" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-244</a>
<a href="https://jira.numberfour.eu/browse/IDE-342" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-342</a>
</div>
</div>
<div class="paragraph">
<p>In general, an array literal is inferred as
<math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>A</mi><mi>r</mi><mi>r</mi><mi>a</mi><mi>y</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>T</mi><mi>g</mi><mi>t</mi><mi>;</mi></mrow></math> (similar to the type of <code>new Array()</code>).
The interesting question is the binding of the type variable <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>.</p>
</div>
<div class="paragraph">
<p>The type of an array padding <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math> is inferred as follows:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>p</mi><mi>:</mi><mrow><mi>u</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi></mrow></mrow><mrow/><mtext>
</mtext></math></p>
</div>
<div class="paragraph">
<p>The element type of an array literal is simply inferred as the
(simplified) union of the type elements of the array. Thus, the type of
an array literal <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi></math> is inferred as follows:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mfenced close=")" open="("><mi>a</mi></mfenced><mi>:</mi><mi>A</mi><mi>r</mi><mi>r</mi><mi>a</mi><mi>y</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>T</mi><mi>g</mi><mi>t</mi><mi>;</mi></mrow><mrow><mi>a</mi><mo>.</mo><mrow><mi>e</mi><mi>l</mi><mi>e</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>s</mi></mrow><mi>:</mi><msub><mi>T</mi><mi>e</mi></msub><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>T</mi><mo>=</mo><mo>⋃</mo><msub><mi>T</mi><mi>e</mi></msub></mrow></math></p>
</div>
<div class="paragraph">
<p>In other languages not supporting union types, the element type is often
inferred as the join (<a href="#AC">LCST</a>) of the element types. Using a union type here
preserves more information (as the actual types are still known). For
many use cases the behavior is similar though, as the members of a union
type are the members of the join of the elements of the union.</p>
</div>
<div class="paragraph">
<p>Note that <code>typeof [1,2,3]</code> does not return <code>Array&lt;number&gt;</code> (as ECMAScript is not aware of the generic array type), but <code>Object</code>.</p>
</div>
<div class="paragraph">
<p>The type for all variables declared in this example is inferred to<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>A</mi><mi>r</mi><mi>r</mi><mi>a</mi><mi>y</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>g</mi><mi>t</mi><mi>;</mi></mrow></math>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var names1          = ["Walter", "Werner"];
var names2          = new Array("Wim", "Wendelin");
var names3          = new Array&lt;string&gt;(3); // length is 3
var names4: Array&lt;string&gt;;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Empty array literals are inferred to <code>any</code>, by default. We are not using <code>Array&lt;?&gt;</code> here
because then a typical JavaScript pattern would no longer be supported:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var a = [];
a.push('hello'); // would fail if a and thus [] were inferred to Array&lt;?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is an important exception, however: if a type expectation exists
for the empty array literal and the expected type is , then this will be
used as the type of the array literal.</p>
</div>
<div class="paragraph">
<p>95Empty array literal An empty array literal will be inferred as
follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If there is a type expectation for the empty array literal and the
expected type is , for any type , then the type of the empty array
literal will be inferred to .</p>
</li>
<li>
<p>Otherwise, the type of the empty array literal will be inferred to .</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_object_literal"><a class="anchor" href="#_object_literal"></a>10.1.5. Object Literal</h4>
<div class="sect4">
<h5 id="object-literal-syntax"><a class="anchor" href="#object-literal-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>Cf. [<a href="#ECMA11a">ECMA11a(p.S11.1.5, p.p.65ff)</a>]
The syntax of an object literal is given by:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">ObjectLiteral &lt;Yield&gt;: {ObjectLiteral}
    '{'
        ( propertyAssignments+=PropertyAssignment&lt;Yield&gt;
          (',' propertyAssignments+=PropertyAssignment&lt;Yield&gt;)* ','?
        )?
    '}'
;

PropertyAssignment &lt;Yield&gt;:
      PropertyNameValuePair&lt;Yield&gt;
    | PropertyGetterDeclaration&lt;Yield&gt;
    | PropertySetterDeclaration&lt;Yield&gt;
    | PropertyMethodDeclaration&lt;Yield&gt;
    | PropertyNameValuePairSingleName&lt;Yield&gt;
;


PropertyMethodDeclaration &lt;Yield&gt;:
    =&gt; ({PropertyMethodDeclaration}
        annotations+=Annotation*
        TypeVariables? returnTypeRef=TypeRef?
            (
                generator?='*'  LiteralOrComputedPropertyName&lt;Yield&gt; -&gt;MethodParamsAndBody&lt;Generator=true&gt;
                | LiteralOrComputedPropertyName&lt;Yield&gt; -&gt;MethodParamsAndBody &lt;Generator=false&gt;
            )
        )
    ';'?
;

PropertyNameValuePair &lt;Yield&gt;:
    =&gt; (
        {PropertyNameValuePair}
        annotations+=Annotation*
        declaredTypeRef=TypeRef? LiteralOrComputedPropertyName&lt;Yield&gt; ':'
    )
    expression=AssignmentExpression&lt;In=true,Yield&gt;
;

/*
 * Support for single name syntax in ObjectLiteral (but disallowed in actual object literals by ASTStructureValidator
 * except in assignment destructuring patterns)
 */
PropertyNameValuePairSingleName &lt;Yield&gt;:
    declaredTypeRef=TypeRef?
    identifierRef=IdentifierRef&lt;Yield&gt;
    ('=' expression=AssignmentExpression&lt;In=true,Yield&gt;)?
;

PropertyGetterDeclaration &lt;Yield&gt;:
    =&gt;(
        {PropertyGetterDeclaration}
        annotations+=Annotation*
        GetterHeader&lt;Yield&gt;
    )
    body=Block&lt;Yield=false&gt;
;

PropertySetterDeclaration &lt;Yield&gt;:
    =&gt;(
        {PropertySetterDeclaration}
        annotations+=Annotation*
        'set'
        -&gt;LiteralOrComputedPropertyName &lt;Yield&gt;
    )
    '(' fpar=FormalParameter&lt;Yield&gt; ')' body=Block&lt;Yield=false&gt;
;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">import Address from "my/Address";
var simple = {name: "Walter", age: 72, address: new Address()};</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_properties_6"><a class="anchor" href="#_properties_6"></a>Properties</h5>
<div class="paragraph">
<p>PropertyAssignments have common properties of PropertyNameValuePair,
PropertyGetterDeclaration, and PropertySetterDeclaration:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>annotations</code> </dt>
<dd>
<p>The annotations of the property assignment.</p>
</dd>
<dt class="hdlist1"><code>name</code> </dt>
<dd>
<p>The name of the property. This may be an identifier, a string or a
numeric literal. When comparing names, we implicitly assume the name to
be converted to an identifier, even if this identifier is not a valid
ECMAScript identifier.</p>
</dd>
<dt class="hdlist1"><code>declaredType</code> </dt>
<dd>
<p>The declared type of the property which may be null. This property is a
pseudo property for PropertySetterDeclaration, in this case it is
derived from the declared type of the setter’s formal parameter.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Additionally, we introduce the following pseudo properties to simplify
constraints:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>isAccessor</code> </dt>
<dd>
<p>The read-only boolean property. This is true if the property assignment
is a setter or getter declaration. This is comparable to ECMAScript’s
spec function <code>IsAccessoprDescriptor</code>.
For a given property assignment <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math> this is
semantically equivalent to
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>μ</mi><mfenced close=")" open="("><mi>p</mi></mfenced><mo>=</mo><mrow><mi>P</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>y</mi><mi>G</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>D</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mo>∨</mo><mi>μ</mi><mfenced close=")" open="("><mi>p</mi></mfenced><mo>=</mo><mrow><mi>P</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>y</mi><mi>S</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>D</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></math>.</p>
</dd>
<dt class="hdlist1"><code>isData</code> </dt>
<dd>
<p>The read-only boolean property. This is true if the property assignment
is a name value pair. For a given property assignment <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math>
this is semantically equivalent to
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>μ</mi><mfenced close=")" open="("><mi>p</mi></mfenced><mo>=</mo><mrow><mi>P</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>y</mi><mi>N</mi><mi>a</mi><mi>m</mi><mi>e</mi><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mi>P</mi><mi>a</mi><mi>i</mi><mi>r</mi></mrow></math>. It is comparable to
ECMAScript’s spec function <code>isDataDescriptor</code>. The equation
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mi>s</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>o</mi><mi>r</mi><mo>=</mo><mo>¬</mo><mi>i</mi><mi>s</mi><mi>D</mi><mi>a</mi><mi>t</mi><mi>a</mi></math> is always true.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="properties-semantics"><a class="anchor" href="#properties-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>[[req:Object Literal]]
For a given object literal <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>o</mi><mi>l</mi></math> the
following constraints must hold (cf. [<a href="#ECMA11a">ECMA11a(p.p.66)</a>]:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Object literal may not have two PropertyNameValuePairs with the same
name in strict mode (cf. 4.a): <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>=</mo><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>c</mi><mi>t</mi></mrow><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∀</mo><mi>p</mi><mi>a</mi><mo>∈</mo><mi>o</mi><mi>l</mi><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>y</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>s</mi><mo>,</mo><mi>p</mi><mi>a</mi><mo>.</mo><mi>i</mi><mi>s</mi><mi>D</mi><mi>a</mi><mi>t</mi><mi>a</mi><mi>:</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>p</mi><msup><mi>a</mi><mi>'</mi></msup><mo>∈</mo><mi>o</mi><mi>l</mi><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>y</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>s</mi><mi>:</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>p</mi><msup><mi>a</mi><mi>'</mi></msup><mo>.</mo><mi>i</mi><mi>s</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>o</mi><mi>r</mi><mo>∧</mo><mi>p</mi><msup><mi>a</mi><mi>'</mi></msup><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>p</mi><mi>a</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></math></p>
</li>
<li>
<p>Object literal may not have PropertyNameValuePair and
PropertyGetterDeclaration/PropertySetterDeclaration with the same name
(cf. 4.b/c):<br>
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>∀</mo><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>p</mi><mi>a</mi><mo>∈</mo><mi>o</mi><mi>l</mi><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>y</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>s</mi><mo>,</mo><mi>p</mi><mi>a</mi><mo>.</mo><mi>i</mi><mi>s</mi><mi>D</mi><mi>a</mi><mi>t</mi><mi>a</mi><mi>:</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>p</mi><mi>g</mi><mi>s</mi><mi>d</mi><mo>∈</mo><mi>o</mi><mi>l</mi><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>y</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>s</mi><mi>:</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>μ</mi><mfenced close=")" open="("><mrow><mi>p</mi><mi>g</mi><mi>s</mi><mi>d</mi></mrow></mfenced><mo>≠</mo><mrow><mi>P</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>y</mi><mi>N</mi><mi>a</mi><mi>m</mi><mi>e</mi><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mi>P</mi><mi>a</mi><mi>i</mi><mi>r</mi></mrow><mo>∧</mo><mi>p</mi><mi>g</mi><mi>s</mi><mi>d</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>p</mi><mi>a</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></math></p>
</li>
<li>
<p>Object literal may not have multiple PropertyGetterDeclaration or
PropertySetterDeclaration with the same name (cf. 4.d):
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>∀</mo><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>p</mi><mi>g</mi><mo>∈</mo><mi>o</mi><mi>l</mi><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>y</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>s</mi><mo>,</mo><mi>p</mi><mi>g</mi><mo>.</mo><mi>i</mi><mi>s</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>o</mi><mi>r</mi><mi>:</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>p</mi><msup><mi>g</mi><mi>'</mi></msup><mo>∈</mo><mi>o</mi><mi>l</mi><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>y</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>s</mi><mrow><mi>p</mi><mi>g</mi></mrow><mi>:</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>μ</mi><mfenced close=")" open="("><mrow><mi>p</mi><msup><mi>g</mi><mi>'</mi></msup></mrow></mfenced><mo>=</mo><mi>μ</mi><mfenced close=")" open="("><mrow><mi>p</mi><mi>g</mi></mrow></mfenced><mo>∧</mo><mi>p</mi><msup><mi>g</mi><mi>'</mi></msup><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>p</mi><mi>g</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></math></p>
</li>
<li>
<p>It is a SyntaxError if the Identifier <code>eval</code> or the Identifier
<code>arguments</code> occurs as the Identifier in a PropertySetParameterList of
a PropertyAssignment that is contained in strict code or if its
FunctionBody is strict code.
[<a href="#ECMA11a">ECMA11a(p.p.66)</a>]</p>
</li>
<li>
<p>If two or more property assignments have the same name (and the
previous conditions hold), then the types of these assignments must
<code>conform</code>. That is to say that the inferred (but not declared) type of
all assignments must be type of probably declared types and if the types
are explicitly declared, they must be equal.</p>
</li>
<li>
<p>In N4JS mode, the name of a property must be a valid N4JSIdentifier:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>=</mo><mrow><mi>n</mi><mn>4</mn><mi>j</mi><mi>s</mi></mrow><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∀</mo><mi>p</mi><mi>a</mi><mo>∈</mo><mi>o</mi><mi>l</mi><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>y</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>s</mi><mi>:</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>μ</mi><mfenced close=")" open="("><mrow><mi>p</mi><mi>a</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow></mfenced><mo>=</mo><mrow><mi>N</mi><mn>4</mn><mi>J</mi><mi>S</mi><mi>I</mi><mi>d</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>r</mi></mrow></math></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_scoping_and_linking"><a class="anchor" href="#_scoping_and_linking"></a>Scoping and linking</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-173" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-173</a>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var p = {
    f: function() {
        console.log("p´s f");
    },
    b: function() {
        this.f();
    },
    o: {
        nested: "Hello"
    }
};
p.b();
p.o.nested;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Other properties within an object literal property can be accessed
using this. In the expression of property name value pairs, however,
<code>this</code> is not be bound to the containing object literal, but usually
to undefined or global.</p>
</li>
<li>
<p>The properties of an object literal are accessible from outside.</p>
</li>
<li>
<p>Nested properties of an object literal are also accessible from
outside.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="type-inference-3"><a class="anchor" href="#type-inference-3"></a>Type Inference</h5>
<div class="paragraph">
<p>  </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-244" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-244</a>
<a href="https://jira.numberfour.eu/browse/IDE-343" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-343</a>
<a href="https://jira.numberfour.eu/browse/IDE-691" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-691</a>
</div>
</div>
<div class="paragraph">
<p>An object literal implicitly extends <code>Object</code>, therefore, object literal types use structural typing. For details see <a href="#Structural_Typing">[Structural_Typing]</a>.
From a type systems point of view, the two variables <code>ol</code> and <code>st</code> below have the same type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var ol = {
    s: "hello",
    n: 42
}
var st: ~Object with { s: string; n: number;};</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_parenthesized_expression_and_grouping_operator"><a class="anchor" href="#_parenthesized_expression_and_grouping_operator"></a>10.1.6. Parenthesized Expression and Grouping Operator</h4>
<div class="paragraph">
<p>The grouping operator is defined here as a parenthesized expression.</p>
</div>
<div class="sect4">
<h5 id="parenthesized-expression-grouping-syntax"><a class="anchor" href="#parenthesized-expression-grouping-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>cf. [<a href="#ECMA11a">ECMA11a(p.S11.1.6, p.p.67)</a>]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">ParenExpression &lt;Yield&gt;: '(' expression=Expression&lt;In=true,Yield&gt; ')';</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grouping-Operator-type-inference"><a class="anchor" href="#Grouping-Operator-type-inference"></a>Type Inference</h5>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-244" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-244</a>
<a href="https://jira.numberfour.eu/browse/IDE-345" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-345</a>
</div>
</div>
<div class="paragraph">
<p>The type of the grouping operator simply is the type of its nested
expression. The type if a parenthesized expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mi>e</mi></math> is
inferred as follows:</p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mrow><mi>'</mi><mrow><mo>(</mo><mi>'</mi></mrow></mrow><mi>e</mi><msup><mrow><mi>'</mi><mo>)</mo></mrow><mi>'</mi></msup><mi>:</mi><mi>T</mi></mrow><mrow><mi>e</mi><mi>:</mi><mi>T</mi></mrow><mrow><mn>11.1</mn><mn>.6</mn></mrow></math></p>
</div>
<div class="paragraph">
<p>Parenthesized Expression Type Examples
[[ex:Parenthesized Expression Type Examples]]
In the following listing, the type of the plain
expressions is equivalent to the parenthesized versions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class A{} class B extends A{}
var f: boolean; var a: A a; var b: B;

/* simple       &lt;-&gt;     parenthesized */
10;                     (10);
"hello";                ("hello");
true;                   (true);
a;                      (a);
10-5;                   (10-5);
f?a:b                   (f?a:b);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_property_accessors"><a class="anchor" href="#_property_accessors"></a>10.1.7. Property Accessors</h4>
<div class="sect4">
<h5 id="property-accessor-syntax"><a class="anchor" href="#property-accessor-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>Property accessors in N4JS are based on [<a href="#ECMA11a">ECMA11a(p.S11.2.1, p.p.67ff)</a>]. They cannot only be used for
accessing properties of an object, but also for accessing members of a
class instance. In order to support parameterized calls, the syntax is
extended to optionally allow type arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">ParameterizedPropertyAccessExpression:
    target=PrimaryExpression&lt;Yield&gt; ParameterizedPropertyAccessExpressionTail&lt;Yield&gt;
;

IndexedAccessExpression:
    target=PrimaryExpression&lt;Yield&gt; IndexedAccessExpressionTail&lt;Yield&gt;
;

fragment IndexedAccessExpressionTail &lt;Yield&gt;*:
    '[' index=Expression&lt;In=true,Yield&gt; ']'
;

fragment ParameterizedPropertyAccessExpressionTail &lt;Yield&gt;*:
    '.' TypeArguments? property=[types::IdentifiableElement|IdentifierName]
;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in [<a href="#ECMA11a">ECMA11a</a>], the <code>index access</code> is called <code><em>bracket notation</em></code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="properties-1"><a class="anchor" href="#properties-1"></a>Properties</h5>
<div class="paragraph">
<p>We define the following properties:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>target</code> </dt>
<dd>
<p>The receiver of the property access.</p>
</dd>
<dt class="hdlist1"><code>index</code> </dt>
<dd>
<p>The index expression in case of an IndexedAccessExpression (returns
<math xmlns="http://www.w3.org/1998/Math/MathML"/> otherwise).</p>
</dd>
<dt class="hdlist1"><code>property</code> </dt>
<dd>
<p>The name of the property in case of non-indexed-access expressions
(returns <math xmlns="http://www.w3.org/1998/Math/MathML"/> otherwise, although the index may be
interpreted as property name).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>We define the following pseudo properties:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>isDotAccess</code> </dt>
<dd>
<p>Read-only boolean property, returns true for non-index access expression
(similar to <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>μ</mi><mfenced close=")" open="("><mi>p</mi></mfenced><mo>≠</mo><mrow><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mi>e</mi><mi>d</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></math>.</p>
</dd>
<dt class="hdlist1"><code>isIndexAccess</code> </dt>
<dd>
<p>Read-only boolean property, returns true for index access expression
(similar to <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>μ</mi><mfenced close=")" open="("><mi>p</mi></mfenced><mo>=</mo><mrow><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mi>e</mi><mi>d</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></math>.<br>
The equation <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mo>.</mo><mi>i</mi><mi>s</mi><mi>D</mi><mi>o</mi><mi>t</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mo>=</mo><mo>¬</mo><mi>p</mi><mo>.</mo><mi>i</mi><mi>s</mi><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi></math> is
always true.</p>
</dd>
<dt class="hdlist1"><code>name</code> </dt>
<dd>
<p>Returns the name of the property. This is either the
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>y</mi></math> converted to a simple name or the index converted
to a name (where possible) if it is an indexed-accessed expression.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="property-acessors-semantics"><a class="anchor" href="#property-acessors-semantics"></a>Semantics</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-12" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-12</a>
</div>
</div>
<div class="paragraph">
<p>The parameterization is part of the property access in case of generic
methods. For generic functions, a parameterized function call is
introduced (cf. ). The constraints are basically similar.</p>
</div>
<div id="req:Property_Access_And_Dot_Notation" class="olist arabic">
<ol class="arabic">
<li>
<p>If dot notation is used in N4JS mode, the referenced property must
exist unless receiver is a dynamic type: <br>
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>p</mi><mi>a</mi><mi>e</mi><mo>.</mo><mi>i</mi><mi>s</mi><mi>D</mi><mi>o</mi><mi>t</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mo>∧</mo><mo>¬</mo><mi>R</mi><mo>.</mo><mi>d</mi><mi>y</mi><mi>n</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∃</mo><mi>m</mi><mo>∈</mo><mi>p</mi><mi>a</mi><mi>e</mi><mo>.</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>i</mi><mi>e</mi><mi>s</mi><mi>:</mi><mi>m</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>p</mi><mi>a</mi><mi>e</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></math></p>
</li>
<li>
<p>If dot notation is used and the referenced property exists, then the
property must be accessible:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>p</mi><mi>a</mi><mi>e</mi><mo>.</mo><mi>i</mi><mi>s</mi><mi>D</mi><mi>o</mi><mi>t</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mo>∧</mo><mo>¬</mo><mi>R</mi><mo>.</mo><mi>d</mi><mi>y</mi><mi>n</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mfenced close=")" open="("><mrow><mo>∃</mo><mi>m</mi><mo>∈</mo><mi>p</mi><mi>a</mi><mi>e</mi><mo>.</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>i</mi><mi>e</mi><mi>s</mi><mi>:</mi><mi>m</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>p</mi><mi>a</mi><mi>e</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow></mfenced><mi>α</mi><mfenced close=")" open="("><mrow><mi>p</mi><mi>a</mi><mi>e</mi></mrow><mi>m</mi></mfenced></math></p>
</li>
<li>
<p>If dot notation is used and the referenced property exists and this
property is a member with a declared <code>@This</code> type (only possible for methods or
field accessors), then the receiver must be a subtype of the declared <code>@This</code>
type.</p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-422" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-422</a>
</div>
</div>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-656" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-656</a>
<a href="https://jira.numberfour.eu/browse/IDE-1734" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1734</a>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A limited form of computed-name indexed-access is allowed in N4JS
mode. In case the receiver is of dynamic type, the index can be any
expression . Otherwise, the indexed-access is limited in that the index
must be a string literal. Feasible targets of such accesses are the same
as for dot-access.</p>
<div class="paragraph">
<p>This notation is useful when interoperating with libraries that define
members whose names contain special characters (for example, a field
name starting with commercial-at).</p>
</div>
</li>
<li>
<p>Additionally, an indexed-access expression is allowed when targeting
one of the types</p>
<div class="paragraph">
<p>or subtypes, for (not including subtypes of and not for and ), and for
dynamic types. It is not allowed to access members of enums in
particular. That is to say, for an indexed-access expression
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mi>a</mi><mi>e</mi></math>, the following constraint must hold:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>i</mi><mi>a</mi><mo>.</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mi>T</mi><mo>,</mo><mi>T</mi><mo>∈</mo><mrow><mi>A</mi><mi>r</mi><mi>r</mi><mi>a</mi><mi>y</mi><mo>,</mo><mi>A</mi><mi>r</mi><mi>g</mi><mi>u</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>,</mo><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo>,</mo><mi>S</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo>,</mo><mi>I</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∨</mo><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>i</mi><mi>a</mi><mo>.</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>=</mo><mrow><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow></math></p>
</div>
</li>
<li>
<p>In N4JS mode, if the receiver is an array and is not dynamic, in
case of index access the index expression must be a number:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>=</mo><mrow><mi>n</mi><mn>4</mn><mi>j</mi><mi>s</mi></mrow><mo>∧</mo><mi>p</mi><mi>a</mi><mi>e</mi><mo>.</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>=</mo><mrow><mi>A</mi><mi>r</mi><mi>r</mi><mi>a</mi><mi>y</mi></mrow><mo>∧</mo><mi>p</mi><mi>a</mi><mi>e</mi><mo>.</mo><mi>i</mi><mi>s</mi><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>⇒</mo><mi>p</mi><mi>a</mi><mi>e</mi><mo>.</mo><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mrow><mo>[</mo><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi></mrow></math>
        \end{aligned}\]]</p>
</li>
<li>
<p>In N4JS mode, if the receiver is a subtype of types or and is not
dynamic, in case of index access the index expression must be a
number:  <br>
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>=</mo><mrow><mi>n</mi><mn>4</mn><mi>j</mi><mi>s</mi></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mo>∧</mo><mfenced close=")" open="("><mrow><mi>p</mi><mi>a</mi><mi>e</mi><mo>.</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow><mo>∨</mo><mi>p</mi><mi>a</mi><mi>e</mi><mo>.</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mrow><mi>S</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow></mrow></mfenced><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mo>∧</mo><mi>p</mi><mi>a</mi><mi>e</mi><mo>.</mo><mi>i</mi><mi>s</mi><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>⇒</mo><mi>p</mi><mi>a</mi><mi>e</mi><mo>.</mo><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi></mrow></math></p>
</li>
<li>
<p>In N4JS mode, if the receiver is an iterable and is not dynamic, in
case of index access the index expression must be a property access
expression to the built-in symbol :<br>
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mo>=</mo><mrow><mi>n</mi><mn>4</mn><mi>j</mi><mi>s</mi></mrow><mo>∧</mo><mi>p</mi><mi>a</mi><mi>e</mi><mo>.</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>=</mo><mrow><mi>I</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi></mrow><mo>∧</mo><mi>p</mi><mi>a</mi><mi>e</mi><mo>.</mo><mi>i</mi><mi>s</mi><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>⇒</mo><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mi>μ</mi><mfenced close=")" open="("><mrow><mi>p</mi><mi>a</mi><mi>e</mi><mo>.</mo><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi></mrow></mfenced><mo>=</mo><mrow><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mi>e</mi><mi>d</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mo>∧</mo><mi>p</mi><mi>a</mi><mi>e</mi><mo>.</mo><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mo>.</mo><mi>i</mi><mi>s</mi><mi>D</mi><mi>o</mi><mi>t</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mo>∧</mo><mi>p</mi><mi>a</mi><mi>e</mi><mo>.</mo><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mo>.</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>=</mo><mrow><mi>S</mi><mi>y</mi><mi>m</mi><mi>b</mi><mi>o</mi><mi>l</mi></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mo>∧</mo><mi>p</mi><mi>a</mi><mi>e</mi><mo>.</mo><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>y</mi><mo>=</mo><mi>"</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>"</mi><mtext>
</mtext></math></p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/238" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-238</a>
<a href="https://jira.numberfour.eu/browse/IDE-837" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-837</a>
</div>
</div>
<div class="paragraph">
<p>Although index access is very limited, it is still possible to use
immediate instances of <code>Object</code> in terms of a map (but this applies only to index access, not the dot notation):</p>
</div>
<div class="paragraph">
<p>Object as Map</p>
</div>
<div id="ex:Object_as_Map" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var map: Object = new Object();
map["Kant"] = "Imperative";
map["Hegel"] = "Dialectic";
map.spinoza = "Am I?";  // error: Couldn't resolve reference to IdentifiableElement 'spinoza'.</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a parameterized property access expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mi>a</mi><mi>e</mi></math>, the
following constraints must hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The receiver or target must be a function or method:
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mi>a</mi><mi>e</mi><mo>.</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mrow><mi>F</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></math></p>
</li>
<li>
<p>The number of type arguments must match the number of type
parameters of the generic function or method:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>|</mo><mi>p</mi><mi>a</mi><mi>e</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>A</mi><mi>r</mi><mi>g</mi><mi>s</mi><mo>|</mo><mo>=</mo><mo>|</mo><mi>p</mi><mi>a</mi><mi>e</mi><mo>.</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>V</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>|</mo></math></p>
</li>
<li>
<p>The type arguments of a parameterized property access expression
must be subtypes of the boundaries of the parameters of the called
generic method.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Also see constraints on read (<a href="#req:Read_Access_to_Identifier">[req:Read_Access_to_Identifier]</a>) and write
(<a href="#req:Write_Acccess">[req:Write_Acccess]</a>) access.</p>
</div>
</div>
<div class="sect4">
<h5 id="type-inference-5"><a class="anchor" href="#type-inference-5"></a>Type Inference</h5>
<div class="paragraph">
<p>  </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-244" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-244</a>
<a href="https://jira.numberfour.eu/browse/IDE-182" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-182</a>
<a href="https://jira.numberfour.eu/browse/IDE-183" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-183</a>
</div>
</div>
<div class="paragraph">
<p>Cf. [<a href="#ECMA11a">ECMA11a(p.S11.2.1, p.p.67ff)</a>]</p>
</div>
<div class="paragraph">
<p>We define the following type inferencing rules for property accessors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The type of an indexed-access expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math> is inferred
as follows task:IDE-342]: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>p</mi><mi>:</mi><mi>T</mi></mrow><mrow><mo>¬</mo><mi>p</mi><mo>.</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>.</mo><mi>d</mi><mi>y</mi><mi>n</mi><mo>∨</mo><mi>p</mi><mo>.</mo><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mrow><mo>[</mo><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi></mrow></mrow></math> &amp; \tee p.target: \type{Array&lt;T&gt;}} \\
    &amp; \infer{\tee p: \type{any}}{else}
    \end{aligned}\]]</p>
</li>
<li>
<p>The type of a property access expression is inferred as follows:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>P</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>y</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mi> </mi><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>:</mi><mi>T</mi></mrow><mrow><mn>174</mn><mi>;</mi><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo>.</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mi>:</mi><mi>R</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>y</mi><mi>:</mi><mi>T</mi></mrow></math></p>
</li>
<li>
<p>The type of a parameterized access expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math> is
inferred as follows: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>p</mi><mi>:</mi><mi>T</mi></mrow><mrow><mo>∃</mo><mi>m</mi><mo>∈</mo><mi>p</mi><mo>.</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mi>:</mi><mi>m</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>p</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>m</mi><mi>:</mi><mi>T</mi></mrow><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>p</mi><mi>:</mi><mrow><mi>a</mi><mi>n</mi><mi>y</mi></mrow></mrow><mrow/></math></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_new_expression"><a class="anchor" href="#_new_expression"></a>10.1.8. New Expression</h4>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-192" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-192</a>
<a href="https://jira.numberfour.eu/browse/IDE-204" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-204</a>
</div>
</div>
<div class="paragraph">
<p>cf. [<a href="#ECMA11a">ECMA11a(p.S11.2.2, p.p.68)</a>]</p>
</div>
<div class="sect4">
<h5 id="new-expression-syntax"><a class="anchor" href="#new-expression-syntax"></a>Syntax</h5>
<div class="listingblock">
<div class="content">
<pre>NewExpression: 'new' callee=MemberExpression&lt;Yield&gt; (-&gt; TypeArguments)?
        (=&gt; withArgs?='(' Arguments&lt;Yield&gt;? ')' )?</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>import Address from "my/Address";

var a = new Address();
// a.type := my/Address

class C&lt;T&gt; {
    constructor(param: T) {}
}
var c = new C&lt;string&gt;("hello");</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="new-expression-semantics"><a class="anchor" href="#new-expression-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>Let <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mi>e</mi></math> be a new expression, with
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mi>e</mi><mo>.</mo><mi>c</mi><mi>a</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>e</mi><mi>:</mi><mi>C</mi></math>. The following constraints must hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The callee must be a constructor type:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>C</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mfenced close="}" open="{"><mi>?</mi></mfenced></mrow></math> or a constructable type.</p>
</li>
<li>
<p>Let <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi></math> be the type argument of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>, that is
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi><mo>=</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>O</mi></math>. In that case,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi></math> must not be an interface or enum:
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>μ</mi><mn>169</mn><mi>;</mi><mo>∉</mo><mfenced close="}" open="{"><mrow><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi></mrow><mrow><mi>E</mi><mi>n</mi><mi>u</mi><mi>m</mi></mrow></mfenced></math></p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi></math> must not contain any wildcards.</p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi></math> must not be a type variable.</p>
</li>
</ol>
</div>
</li>
<li>
<p>If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> is not a constructor type, it must be a
constructable type, that is one of the following:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mfenced close="}" open="{"><mrow><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow><mrow><mi>F</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mrow><mi>S</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow><mrow><mi>B</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi>a</mi><mi>n</mi></mrow><mrow><mi>N</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi></mrow><mrow><mi>A</mi><mi>r</mi><mi>r</mi><mi>a</mi><mi>y</mi></mrow><mrow><mi>D</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow><mrow><mi>R</mi><mi>e</mi><mi>g</mi><mi>E</mi><mi>x</mi><mi>p</mi></mrow><mrow><mi>E</mi><mi>r</mi><mi>r</mi><mi>o</mi><mi>r</mi></mrow></mfenced></math>
In particular, it must not refer to a primitive type or a defined
functions (i.e., subtypes of ) cannot be used in new-expressions in
N4JS.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Remarks:</p>
</div>
<div class="paragraph">
<p>to 1) The type of an abstract class <code>A</code> is <math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>A</mi></mrow></math>.
Or in other words: Only instantiable classes have an inferred type of
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mfenced close="}" open="{"><mrow><mo>.</mo><mo>.</mo></mrow></mfenced></math>.</p>
</div>
<div class="paragraph">
<p>to 2) Even though it is possible to use the constructor type of an
abstract class – concrete subclasses with override compatible
constructor signature will be subclasses of this constructor.</p>
</div>
<div class="paragraph">
<p>to 3) It is not possible to refer to union or intersection at that
location. So this is not explicitly denied here since it is not possible
anyway.</p>
</div>
<div class="paragraph">
<p>Abstract classes and construction
[[ex:Abstract classes and construction]]
The following examples demonstrates the usage of abstract
classes and constructor types, to make the first two constraints more
clearer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">/* XPECT_SETUP eu.numberfour.n4js.spec.tests.N4JSSpecTest END_SETUP */

abstract class A {}
class B extends A {}

// XPECT errors --&gt; "Cannot instantiate abstract class A." at "A"
var x = new A();
// XPECT noerrors --&gt;
var y = new B();

function foo(ctor : constructor{A}) {
    // XPECT noerrors --&gt;
    return new ctor();
}

// XPECT errors --&gt; "type{A} is not a subtype of constructor{A}." at "A"
foo(A);
// XPECT noerrors --&gt;
foo(B);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="type-inference-6"><a class="anchor" href="#type-inference-6"></a>Type Inference</h5>
<div class="paragraph">
<p>The type of a new expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mi>e</mi></math> is inferred as follows:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>n</mi><mi>e</mi><mi>:</mi><mi>C</mi></mrow><mrow><mi>n</mi><mi>e</mi><mo>.</mo><mi>c</mi><mi>a</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>e</mi><mi>:</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>C</mi></mrow></mrow></math></p>
</div>
<div class="paragraph">
<p>For classes, constructors are described in <a href="#Constructor">[Constructor]</a>.</p>
</div>
<div class="paragraph">
<p>In N4JS it is not allowed to call new on a plain function. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">function foo() {}
var x = new foo();</code></pre>
</div>
</div>
<div class="paragraph">
<p>will issue an error.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_expression_2"><a class="anchor" href="#_function_expression_2"></a>10.1.9. Function Expression</h4>
<div class="paragraph">
<p>See <a href="#Functions.adoc">[Functions.adoc]</a> for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="_function_calls"><a class="anchor" href="#_function_calls"></a>10.1.10. Function Calls</h4>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-186" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-186</a>
<a href="https://jira.numberfour.eu/browse/IDE-851" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-851</a>
</div>
</div>
<div class="paragraph">
<p>In N4JS, a function call [<a href="#ECMA11a">ECMA11a(p.S11.2.3)</a>] is similar to a method call. Additionally to
the ECMAScript’s CallExpression, a ParameterizedCallExpression is
introduced to allow type arguments passed to plain functions.</p>
</div>
<div class="sect4">
<h5 id="_syntax_11"><a class="anchor" href="#_syntax_11"></a>Syntax</h5>
<div class="paragraph">
<p> <a id="function-calls-syntax"></a></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-177" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-177</a>
</div>
</div>
<div class="paragraph">
<p>Similar to [<a href="#ECMA11a">ECMA11a(p.S11.2.3, p.p.68ff)</a>], a function call is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">CallExpression &lt;Yield&gt;:
    target=IdentifierRef&lt;Yield&gt;
    ArgumentsWithParentheses&lt;Yield&gt;
;

ParameterizedCallExpression &lt;Yield&gt;:
    TypeArguments
    target=IdentifierRef&lt;Yield&gt;
    ArgumentsWithParentheses&lt;Yield&gt;
;

fragment ArgumentsWithParentheses &lt;Yield&gt;*:
    '(' Arguments&lt;Yield&gt;? ')'
;

fragment Arguments &lt;Yield&gt;*:
    arguments+=AssignmentExpression&lt;In=true,Yield&gt; (',' arguments+=AssignmentExpression&lt;In=true,Yield&gt;)* (',' spread?='...' arguments+=AssignmentExpression&lt;In=true,Yield&gt;)?
    | spread?='...' arguments+=AssignmentExpression&lt;In=true,Yield&gt;
;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="function-calls-semantics"><a class="anchor" href="#function-calls-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>101Function Call Constraints</p>
</div>
<div class="paragraph">
<p>For a given call expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi></math> bound to a method or function
declaration <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi></math>, the following constraints must hold:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If less arguments are provided than formal parameters were declared,
the missing formal parameters must have been declared optional:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>|</mo><mi>f</mi><mo>.</mo><mi>a</mi><mi>r</mi><mi>g</mi><mi>s</mi><mo>|</mo><mi>l</mi><mi>t</mi><mi>;</mi><mo>|</mo><mi>F</mi><mo>.</mo><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>|</mo><mo>∀</mo><mo>|</mo><mi>f</mi><mo>.</mo><mi>a</mi><mi>r</mi><mi>g</mi><mi>s</mi><mo>|</mo><mi>l</mi><mi>t</mi><mi>;</mi><mi>i</mi><mo>≤</mo><mo>|</mo><mi>F</mi><mo>.</mo><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>|</mo><mi>:</mi><msub><mi>F</mi><mi>p</mi></msub><mi>a</mi><mi>r</mi><msub><mi>s</mi><mi>i</mi></msub><mo>.</mo><mi>o</mi><mi>p</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>a</mi><mi>l</mi></math></p>
</li>
<li>
<p>If more arguments are provided than formal parameters were declared,
the last formal parameter must have been declared variadic:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>|</mo><mi>f</mi><mo>.</mo><mi>a</mi><mi>r</mi><mi>g</mi><mi>s</mi><mo>|</mo><mi>g</mi><mi>t</mi><mi>;</mi><mo>|</mo><mi>F</mi><mo>.</mo><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>|</mo><mi>F</mi><mo>.</mo><mi>p</mi><mi>a</mi><mi>r</mi><msub><mi>s</mi><mrow><mo>|</mo><mi>F</mi><mo>.</mo><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>|</mo><mo>-</mo><mn>1</mn></mrow></msub><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>d</mi><mi>i</mi><mi>c</mi></math></p>
</li>
<li>
<p>Types of provided arguments must be subtypes of the formal parameter
types:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><mn>0</mn><mi>l</mi><mi>t</mi><mi>;</mi><mi>i</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>m</mi><mi>i</mi><mi>n</mi><mfenced close=")" open="("><mrow><mo>|</mo><mi>f</mi><mo>.</mo><mi>a</mi><mi>r</mi><mi>g</mi><mi>s</mi><mo>|</mo></mrow><mrow><mo>|</mo><mi>F</mi><mo>.</mo><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>|</mo></mrow></mfenced><mi>:</mi><mi>f</mi><mo>.</mo><mi>a</mi><mi>r</mi><mi>g</mi><msub><mi>s</mi><mi>i</mi></msub><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>F</mi><mo>.</mo><mi>p</mi><mi>a</mi><mi>r</mi><msub><mi>s</mi><mi>i</mi></msub></math></p>
</li>
<li>
<p>If more arguments are provided than formal parameters were declared,
the type of the exceeding arguments must be a subtype of the last
(variadic) formal parameter type:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∀</mo><mo>|</mo><mi>F</mi><mo>.</mo><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>|</mo><mi>l</mi><mi>t</mi><mi>;</mi><mi>i</mi><mo>≤</mo><mo>|</mo><mi>f</mi><mo>.</mo><mi>a</mi><mi>r</mi><mi>g</mi><mi>s</mi><mo>|</mo><mi>:</mi><mi>f</mi><mo>.</mo><mi>a</mi><mi>r</mi><mi>g</mi><msub><mi>s</mi><mi>i</mi></msub><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>F</mi><mo>.</mo><mi>p</mi><mi>a</mi><mi>r</mi><msub><mi>s</mi><mrow><mo>|</mo><mi>F</mi><mo>.</mo><mi>p</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>|</mo><mo>-</mo><mn>1</mn></mrow></msub></math></p>
</li>
</ul>
</div>
<div id="req:Parameterized_Function_Call_Constraints" class="ulist">
<ul>
<li>
<p>The number of type arguments in a parameterized call expression must
be equal to the number of type parameters of the generic function /
method and the type arguments must be subtypes of the corresponding
declared upper boundaries of the type parameters of the called generic
function.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that (for a limited time), constraints
<a href="#req:Function_Call_Constraints">[req:Function_Call_Constraints]</a> and
<a href="#req:Parameterized_Function_Call_Constraints">[req:Parameterized_Function_Call_Constraints]</a> are not applied if the the
type of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi></math> is <code>Function</code>. See <a href="#Function_Object_Type">[Function_Object_Type]</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="type-inference-7"><a class="anchor" href="#type-inference-7"></a>Type Inference</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-244" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-244</a>
</div>
</div>
<div class="paragraph">
<p>A call expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi></math> is bound to a method (<a href="#_methods">Methods</a>) or function
declaration (which may be part of a function definition (<a href="#Function_Definition">[Function_Definition]</a> or specified via a function type <a href="#Fucntion_Type">[Fucntion_Type]</a>) <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi></math> (via evaluation of <code>MemberExpression</code>. The type of the call is inferred from the function declaration or type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi></math> as follows:</p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>:</mi><mi>T</mi></mrow><mrow><mi>b</mi><mi>i</mi><mi>n</mi><mi>d</mi><mfenced close=")" open="("><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo>.</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow><mi>F</mi></mfenced><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>F</mi><mo>.</mo><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>:</mi><mi>T</mi></mrow></math></p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-205" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-205</a>
</div>
</div>
<div class="paragraph">
<p>A generic method invocation may be parameterized as well. This is rarely
required as the function argument types are usually inferred from the
given arguments. In some cases, for instance with pathSelectors, this is
useful. In that case, the type variable defined in the generic method
declaration is explicitly bound to types by using type arguments. See
<a href="#Property_Accessors">[Property_Accessors]</a> for semantics and type inference.</p>
</div>
<div class="paragraph">
<p>[[ex:Generic Method Invocation]]
This examples demonstrate how to explicitly
define the type argument in a method call in case it cannot be inferred
automatically.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class C {
    static &lt;T&gt; foo(p: pathSelector&lt;T&gt;): void {..}
};
C.&lt;my.Address&gt;foo("street.number");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in many cases, the type inferencer should be able to infer the
type automatically. For example, for a method</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">function &lt;T&gt; bar(c: T, p: pathSelector&lt;T&gt;): void {..};</code></pre>
</div>
</div>
<div class="paragraph">
<p>and a function call</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">bar(context, "some.path.selector");
[source,n4js]</code></pre>
</div>
</div>
<div class="paragraph">
<p>the type variable <code>T</code> can be automatically bound to the type of variable <code>context</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_postfix_expression"><a class="anchor" href="#_postfix_expression"></a>10.1.11. Postfix Expression</h4>
<div class="sect4">
<h5 id="postfix-expression-syntax"><a class="anchor" href="#postfix-expression-syntax"></a>Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">PostfixExpression returns Expression: LeftHandSideExpression
         (=&gt;({PostfixExpression.expression=current} /* no line terminator here */ op=PostfixOperator))?
    ;
enum PostfixOperator: inc='++' | dec='--';</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="semantics-and-type-inference"><a class="anchor" href="#semantics-and-type-inference"></a>Semantics and Type Inference</h5>
<div class="paragraph">
<p>The type inference and constraints for postfix operators <code><code>` and
</code><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>-</mo><mo>-</mo></math>`</code>, cf.
[<a href="#ECMA11a">ECMA11a(p.S11.3.1, p.p.70)</a>], [<a href="#ECMA11a">ECMA11a(p.S11.3.1, p.p.70)</a>], are defined similarly to their prefix
variants (unary expressions), see <a href="#_unary_expression">Unary Expression</a>.</p>
</div>
<div class="paragraph">
<p> For a given postfix expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi></math> <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi></math> with
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi><mo>.</mo><mi>o</mi><mi>p</mi><mo>∈</mo><mfenced close="}" open="{"><mrow><mo>+</mo><mo>+</mo></mrow><mrow><mo>-</mo><mo>-</mo></mrow></mfenced></math> and <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>:</mi><mi>T</mi></math>,
the following constraints must hold:</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-345" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-345</a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>In N4JS mode, the type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> of the expression must be a
number.<br></p>
</li>
<li>
<p>If
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mi>P</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>y</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mspace width="0.278em"/><mi>p</mi><mi>a</mi><mfenced close=")" open="("><mi>p</mi></mfenced><mo>∧</mo><mi>p</mi><mi>a</mi><mo>.</mo><mi>i</mi><mi>s</mi><mi>D</mi><mi>o</mi><mi>t</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi></math>
<math xmlns="http://www.w3.org/1998/Math/MathML"/> both <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>g</mi><mi>e</mi><mi>t</mi></math> <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math> and
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mi>e</mi><mi>t</mi></math> <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math> must be defined. </p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-737" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-737</a>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_unary_expression"><a class="anchor" href="#_unary_expression"></a>10.1.12. Unary Expression</h4>
<div class="sect4">
<h5 id="unary-expression-syntax"><a class="anchor" href="#unary-expression-syntax"></a>Syntax</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">We define the following unary operators and expression, similar to [<a href="#ECMA11a">ECMA11a(p.p.70ff)</a>]</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">UnaryExpression returns Expression:
      PostfixExpression
    | ({UnaryExpression} op=UnaryOperator expression=UnaryExpression);
enum UnaryOperator: delete | void | typeof | inc='++' | dec='--' | pos='+' | neg='-' | inv='$\sim$' | not='!';</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="unary-expression-semantics"><a class="anchor" href="#unary-expression-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>For semantics of the delete operator, see also cite:[MozillaJSRef(<a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Operators/delete" class="bare">https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Operators/delete</a>)]</p>
</div>
<div class="paragraph">
<p>104delete Operator Constraints[req:DeleteOperatorConstraints] For a
given unary expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi></math> with
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi><mo>.</mo><mi>o</mi><mi>p</mi><mo>=</mo><mrow><mi>d</mi><mi>e</mi><mi>l</mi><mi>e</mi><mi>t</mi><mi>e</mi></mrow></math>, the following constraints must
hold:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In strict mode, <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></math> must be a reference to a
property of an object literal, a member of a class type, or to a
property of the global type (i.e., the reference must be bound, and the
bound target must not be a variable).</p>
</li>
<li>
<p>In N4JS mode, the referenced property or member must not be declared
in the containing type and the containing type reference must be
declared dynamic.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are no specific constraints defined for with <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi><mo>.</mo><mi>o</mi><mi>p</mi><mo>=</mo><mrow><mi>v</mi><mi>o</mi><mi>i</mi><mi>d</mi></mrow></math></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-345" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-345</a>
</div>
</div>
<div class="paragraph">
<p>There are no specific constraints defined for unary expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi></math>
with <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi><mo>.</mo><mi>o</mi><mi>p</mi><mo>=</mo><mrow><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>o</mi><mi>f</mi></mrow></math>. </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-345" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-345</a>
</div>
</div>
<div class="paragraph">
<p>107Increment/Decrement Constraints[req:IncrementOperatorConstraints] For
a given unary expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi></math> <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi></math> with
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi><mo>.</mo><mi>o</mi><mi>p</mi><mo>∈</mo><mfenced close="}" open="{"><mrow><mo>+</mo><mo>+</mo></mrow><mrow><mo>-</mo><mo>-</mo></mrow></mfenced></math> and <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>:</mi><mi>T</mi></math>,
the following constraints must hold:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If mode is N4JS,  the type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math> of the expression must be a
number <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mrow><mi>U</mi><mi>n</mi><mi>a</mi><mi>r</mi><mi>y</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mrow><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mi>:</mi><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi></mrow></mrow><mrow/></math></p>
</li>
<li>
<p>If
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mi>P</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>y</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mspace width="0.278em"/><mi>p</mi><mi>a</mi><mfenced close=")" open="("><mi>p</mi></mfenced><mo>∧</mo><mi>p</mi><mi>a</mi><mo>.</mo><mi>i</mi><mi>s</mi><mi>D</mi><mi>o</mi><mi>t</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi></math>
<math xmlns="http://www.w3.org/1998/Math/MathML"/> both <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>g</mi><mi>e</mi><mi>t</mi></math> <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math> and
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mi>e</mi><mi>t</mi></math> <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math> must be defined. </p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-345" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-345</a>
<a href="https://jira.numberfour.eu/browse/IDE-768" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-768</a>
</div>
</div>
<div class="paragraph">
<p>108Unary Plus/Minus/Bitwise Not Operator
Constraints[req:UnaryPlusOperatorConstraints] For a given unary
expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi></math> <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi></math> with
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi><mo>.</mo><mi>o</mi><mi>p</mi><mo>∈</mo><mfenced close="}" open="{"><mo>+</mo><mo>-</mo><mo>∼</mo></mfenced></math> and
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>:</mi><mi>T</mi></math>, the following constraints must hold: </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-345" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-345</a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>In N4JS mode, the type T of the expression must be a number:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mrow><mi>U</mi><mi>n</mi><mi>a</mi><mi>r</mi><mi>y</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mrow><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mi>:</mi><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi></mrow></mrow><mrow/></math></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are no specific constraints defined for with
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi><mo>.</mo><mi>o</mi><mi>p</mi><mo>=</mo><mo>!</mo></math>.</p>
</div>
</div>
<div class="sect4">
<h5 id="type-inference-8"><a class="anchor" href="#type-inference-8"></a>Type Inference</h5>
<div class="paragraph">
<p>The following operators have fixed types independent of their operand
types:
 </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-244" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-244</a>
<a href="https://jira.numberfour.eu/browse/IDE-345" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-345</a>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>math:[\[\begin{aligned}
&amp;\infer{\tee \lstnfbnf{'delete'}\ expression: \type{boolean}}{}     \tag{\S 11.4.1}\\
&amp;\infer{\tee \lstnfbnf{'void'}\ expression: \type{undefined}}{}     \tag{\S 11.4.2}\\
&amp;\infer{\tee \lstnfbnf{'typeof'}\ expression: \type{string}}{}  \tag{\S 11.4.3}\\
&amp;\infer{\tee \lstnfbnf{('++'|'$--$'|'+'|'$-$'|'~')}\ expression: \type{number}}{}   \tag{\S 11.4.4-8}\\
&amp;\infer{\tee \lstnfbnf{'!'}\ expression: \type{boolean}}{}  \tag{\S 11.4.9}\end{aligned}\]]</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_multiplicative_expression"><a class="anchor" href="#_multiplicative_expression"></a>10.1.13. Multiplicative Expression</h4>
<div class="sect4">
<h5 id="multiplicative-expression-syntax"><a class="anchor" href="#multiplicative-expression-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>Cf. [<a href="#ECMA11a">ECMA11a(p.p.73ff)</a>]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">MultiplicativeExpression returns Expression: UnaryExpression
      (=&gt;({MultiplicativeExpression.lhs=current} op=MultiplicativeOperator) rhs=UnaryExpression)*;
enum MultiplicativeOperator: times='*' | div='/' | mod='%';</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="multiplicative-expression-semantics"><a class="anchor" href="#multiplicative-expression-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>110Multiplicative Expression
Constraints[req:MultiplicativeExpressionConstraints] For a given
multiplicative expression the following constraints must hold in N4JS
mode :</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-345" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-345</a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The types of the operands must be subtypes of number:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>M</mi><mi>u</mi><mi>l</mi><mi>t</mi><mi>i</mi><mi>p</mi><mi>l</mi><mi>i</mi><mi>c</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>v</mi><mi>e</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mrow><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mi>:</mi><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi></mrow></mrow><mrow/></math></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_type_inference_6"><a class="anchor" href="#_type_inference_6"></a>Type Inference</h5>
<div class="paragraph">
<p>  <a id="type-inference-9"></a></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-244" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-244</a>
<a href="https://jira.numberfour.eu/browse/IDE-345" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-345</a>
</div>
</div>
<div class="paragraph">
<p>The inferred type of a multiplicative expression always is number:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>M</mi><mi>u</mi><mi>l</mi><mi>t</mi><mi>i</mi><mi>p</mi><mi>l</mi><mi>i</mi><mi>c</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>v</mi><mi>e</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mi>:</mi><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi></mrow></mrow><mrow/></math></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_additive_expression"><a class="anchor" href="#_additive_expression"></a>10.1.14. Additive Expression</h4>
<div class="sect4">
<h5 id="additive-expression-syntax"><a class="anchor" href="#additive-expression-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>Cf. [<a href="#ECMA11a">ECMA11a(p.p.75ff)</a>]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">AdditiveExpression returns Expression: MultiplicativeExpression
    (=&gt;({AdditiveExpression.lhs=current} op=AdditiveOperator) rhs=MultiplicativeExpression)*;
enum AdditiveOperator: add='+' | sub='-';</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="additive-expression-semantics"><a class="anchor" href="#additive-expression-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>111Additive Expression Constraints[req:AdditiveExpressionConstraints]

For a given additive expression the following constraints must hold in
N4JS mode:</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-345" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-345</a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The types of the operands must be subtypes of number if the operator
is not ’+’, otherwise, any type could be used:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>A</mi><mi>d</mi><mi>d</mi><mi>i</mi><mi>t</mi><mi>i</mi><mi>v</mi><mi>e</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mi> </mi><mi>e</mi><mrow><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mi>:</mi><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi></mrow></mrow><mrow><mi>e</mi><mo>.</mo><mi>o</mi><mi>p</mi><mo>≠</mo><mi>A</mi><mi>d</mi><mi>d</mi><mi>i</mi><mi>t</mi><mi>i</mi><mi>v</mi><mi>e</mi><mi>O</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo>.</mo><mi>A</mi><mi>D</mi><mi>D</mi></mrow></math></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="type-inference-10"><a class="anchor" href="#type-inference-10"></a>Type Inference</h5>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-244" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-244</a>
<a href="https://jira.numberfour.eu/browse/IDE-345" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-345</a>
</div>
</div>
<div class="paragraph">
<p>The type of an additive expression is usually inferred to . The result
for the addition operator may only be a number if both operands are
numbers, booleans, or one is boolean or number and the other is
undefined or null.</p>
</div>
<div class="paragraph">
<p>We first define two helper rules to simplify the addition operator
condition:</p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mo>[</mo><mi>n</mi><mi>b</mi></mrow></math>{nb(T)}{T = \type{number} \lor T = \type{boolean}}
&amp;\infer[nb]{nb(expr)}{nb\tee expr}\\
&amp;\infer[un]{un(T)}{T = \type{undefined} \lor T = \type{null}}
&amp;\infer[un]{un(expr)}{un\tee expr.lhs \lor un\tee expr.rhs}\end{aligned}\]]</p>
</div>
<div class="paragraph">
<p>The type of an additive expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi></math> is inferred as
follows: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>e</mi><mi>:</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow></mrow><mrow><mi>e</mi><mo>.</mo><mi>o</mi><mi>p</mi><msup><mo>=</mo><mi>'</mi></msup><msup><mo>+</mo><mi>'</mi></msup><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>¬</mo><mfenced close=")" open="("><mrow><mi>n</mi><mi>b</mi><mfenced close=")" open="("><mrow><mi>e</mi><mo>.</mo><mi>l</mi><mi>h</mi><mi>s</mi></mrow></mfenced><mo>∧</mo><mi>n</mi><mi>b</mi><mfenced close=")" open="("><mrow><mi>e</mi><mo>.</mo><mi>r</mi><mi>h</mi><mi>s</mi></mrow></mfenced></mrow></mfenced><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>¬</mo><mrow><mo>(</mo><mi>u</mi><mi>n</mi><mfenced close=")" open="("><mi>e</mi></mfenced><mo>∧</mo><mfenced close=")" open="("><mrow><mi>n</mi><mi>b</mi><mfenced close=")" open="("><mrow><mi>e</mi><mo>.</mo><mi>l</mi><mi>h</mi><mi>s</mi></mrow></mfenced><mo>∨</mo><mi>n</mi><mi>b</mi><mfenced close=")" open="("><mrow><mi>e</mi><mo>.</mo><mi>r</mi><mi>h</mi><mi>s</mi></mrow></mfenced></mrow></mfenced></mrow></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>e</mi><mi>:</mi><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi></mrow></mrow><mrow/><mtext>
</mtext></math></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">1+2;            // number 3
"1"+"2";        // string "12"
"1"+2;          // string "12"
1+true;         // number 2
false+1;        // number 1
"1"+true;       // string "1true"
"1"+null;       // string "1null"
1+null;         // number 1
1+undefined;    // number NaN
"1"+undefined;  // string "1undefined"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bitwise_shift_expression"><a class="anchor" href="#_bitwise_shift_expression"></a>10.1.15. Bitwise Shift Expression</h4>
<div class="sect4">
<h5 id="bitwise-shift-expression-syntax"><a class="anchor" href="#bitwise-shift-expression-syntax"></a>Syntax</h5>
<div class="paragraph">
<p> Cf. [<a href="#ECMA11a">ECMA11a(p.p.76f)</a>]</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-288" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-288</a>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">ShiftExpression returns Expression: AdditiveExpression
    (=&gt;({ShiftExpression.lhs=current} op=ShiftOperator rhs=AdditiveExpression))*
;

ShiftOperator returns ShiftOperator:
      '&gt;' '&gt;' '&gt;'? // SHR, USHR
    | '&lt;' '&lt;'  // SHL
    ;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bitwise-shift-expression-semantics"><a class="anchor" href="#bitwise-shift-expression-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>For a given bitwise shift expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi></math> the following constraints must hold in N4JS mode:  </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-345" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-345</a>
<a href="https://jira.numberfour.eu/browse/IDE-771" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-771</a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The types of the operands must be both number.
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>B</mi><mi>i</mi><mi>t</mi><mi>w</mi><mi>i</mi><mi>s</mi><mi>e</mi><mi>S</mi><mi>h</mi><mi>i</mi><mi>f</mi><mi>t</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mi> </mi><mi> </mi><mrow><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mi>:</mi><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi></mrow></mrow><mrow/></math></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="type-inference-11"><a class="anchor" href="#type-inference-11"></a>Type Inference</h5>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-244" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-244</a>
<a href="https://jira.numberfour.eu/browse/IDE-345" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-345</a>
</div>
</div>
<div class="paragraph">
<p>The type returned by a bitwise shift expression is always :</p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi> </mi><mfenced close=")" open="("><mrow><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mfenced close=")" open="("><mrow><mi>'</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>l</mi><mi>t</mi><msup><mi>;</mi><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mi>g</mi><mi>t</mi><mi>;</mi><mi>g</mi><mi>t</mi><msup><mi>;</mi><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mi>g</mi><mi>t</mi><mi>;</mi><mi>g</mi><mi>t</mi><mi>;</mi><mi>g</mi><mi>t</mi><msup><mi>;</mi><mi>'</mi></msup></mrow></mfenced><mi> </mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></mfenced><mi>:</mi><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi></mrow></mrow><mrow/><mrow><mn>11.7</mn><mn>.1</mn><mo>/</mo><mn>2</mn></mrow><mtext>
</mtext></math></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_relational_expression"><a class="anchor" href="#_relational_expression"></a>10.1.16. Relational Expression</h4>
<div class="sect4">
<h5 id="relational-expression-syntax"><a class="anchor" href="#relational-expression-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>Cf. [<a href="#ECMA11a">ECMA11a(p.p.77ff)</a>]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">RelationalExpression returns Expression: ShiftExpression
    (=&gt;({RelationalExpression.lhs=current} op=RelationalOperator) rhs=ShiftExpression)*;

RelationalExpressionNoIn returns Expression: ShiftExpression
    (=&gt;({RelationalExpression.lhs=current} op=RelationalOperatorNoIn) rhs=ShiftExpression)*;

enum RelationalOperator:
    lt='&lt;' | gt='&gt;' | lte='&lt;=' | gte='&gt;=' | instanceof | in;
RelationalOperatorNoIn returns RelationalOperator:
    '&lt;' | '&gt;' | '&lt;=' | '&gt;=' | 'instanceof';</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="relational-expression-semantics"><a class="anchor" href="#relational-expression-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>113Greater/Less (Equals) Operator

Constraints[req:GreaterOperatorConstraints] For a given relational
expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi></math> with
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mo>.</mo><mi>o</mi><mi>p</mi><mo>∈</mo><mfenced close="}" open="{"><mrow><mi>l</mi><mi>t</mi><mi>;</mi></mrow><mrow><mi>g</mi><mi>t</mi><mi>;</mi></mrow><mrow><mn>8656</mn><mi>;</mi></mrow><mrow><mi>g</mi><mi>t</mi><mi>;</mi><mo>=</mo></mrow></mfenced></math>
in N4JS mode, the following constraints must hold:</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-345" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-345</a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The operands must have the same type and the type must be either a
number, string, or boolean: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>l</mi><mi>h</mi><mi>s</mi><mi> </mi><mfenced close=")" open="("><mrow><mi>'</mi><mi>l</mi><mi>t</mi><msup><mi>;</mi><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mn>8656</mn><msup><mi>;</mi><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mi>g</mi><mi>t</mi><msup><mi>;</mi><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mi>g</mi><mi>t</mi><mi>;</mi><msup><mo>=</mo><mi>'</mi></msup></mrow></mfenced><mi> </mi><mi>r</mi><mi>h</mi><mi>s</mi><mi> </mi><mi> </mi><mi>l</mi><mi>h</mi><mi>s</mi><mi>:</mi><mi>T</mi></mrow><mrow><mi>r</mi><mi>h</mi><mi>s</mi><mi>:</mi><mi>T</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>T</mi><mo>∈</mo><mfenced close="}" open="{"><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mo>,</mo><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo>,</mo><mi>b</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi>a</mi><mi>n</mi></mrow></mfenced></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>l</mi><mi>h</mi><mi>s</mi><mi> </mi><mfenced close=")" open="("><mrow><mi>'</mi><mi>l</mi><mi>t</mi><msup><mi>;</mi><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mn>8656</mn><msup><mi>;</mi><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mi>g</mi><mi>t</mi><msup><mi>;</mi><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mi>g</mi><mi>t</mi><mi>;</mi><msup><mo>=</mo><mi>'</mi></msup></mrow></mfenced><mi> </mi><mi>r</mi><mi>h</mi><mi>s</mi><mi> </mi><mi> </mi><mi>l</mi><mi>h</mi><mi>s</mi><mi>:</mi><mi>T</mi></mrow><mrow><mi>r</mi><mi>h</mi><mi>s</mi><mi>:</mi><mi>O</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>O</mi><mo>∉</mo><mfenced close="}" open="{"><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mo>,</mo><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo>,</mo><mi>b</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi>a</mi><mi>n</mi></mrow></mfenced><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>T</mi><mo>=</mo><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mo>,</mo><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo>,</mo><mi>b</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi>a</mi><mi>n</mi></mrow></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>l</mi><mi>h</mi><mi>s</mi><mi> </mi><mfenced close=")" open="("><mrow><mi>'</mi><mi>l</mi><mi>t</mi><msup><mi>;</mi><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mn>8656</mn><msup><mi>;</mi><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mi>g</mi><mi>t</mi><msup><mi>;</mi><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mi>g</mi><mi>t</mi><mi>;</mi><msup><mo>=</mo><mi>'</mi></msup></mrow></mfenced><mi> </mi><mi>r</mi><mi>h</mi><mi>s</mi><mi> </mi><mi> </mi><mi>r</mi><mi>h</mi><mi>s</mi><mi>:</mi><mi>T</mi></mrow><mrow><mi>l</mi><mi>h</mi><mi>s</mi><mi>:</mi><mi>T</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>T</mi><mo>∈</mo><mfenced close="}" open="{"><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mo>,</mo><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo>,</mo><mi>b</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi>a</mi><mi>n</mi></mrow></mfenced></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>l</mi><mi>h</mi><mi>s</mi><mi> </mi><mfenced close=")" open="("><mrow><mi>'</mi><mi>l</mi><mi>t</mi><msup><mi>;</mi><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mn>8656</mn><msup><mi>;</mi><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mi>g</mi><mi>t</mi><msup><mi>;</mi><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mi>g</mi><mi>t</mi><mi>;</mi><msup><mo>=</mo><mi>'</mi></msup></mrow></mfenced><mi> </mi><mi>r</mi><mi>h</mi><mi>s</mi><mi> </mi><mi> </mi><mi>r</mi><mi>h</mi><mi>s</mi><mi>:</mi><mi>T</mi></mrow><mrow><mi>l</mi><mi>h</mi><mi>s</mi><mi>:</mi><mi>O</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>O</mi><mo>∉</mo><mfenced close="}" open="{"><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mo>,</mo><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo>,</mo><mi>b</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi>a</mi><mi>n</mi></mrow></mfenced><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>T</mi><mo>=</mo><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mo>,</mo><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo>,</mo><mi>b</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi>a</mi><mi>n</mi></mrow></mrow><mtext>
</mtext></math></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For a given relational expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi></math> with
 <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mo>.</mo><mi>o</mi><mi>p</mi><mo>=</mo><mrow><mi>i</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi><mi>o</mi><mi>f</mi></mrow></math>, the following constraints
must hold:</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-345" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-345</a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The right operand of the instanceof operator must be a <code>Function</code>
<sup class="footnote">[<a id="_footnoteref_45" class="footnote" href="#_footnote_45" title="View footnote.">45</a>]</sup>$].
Thus instanceof expressions are rewritten by the compiler for other types.
Note that a reference to a class returns the constructor type, which actually is a function itself.
In other words, <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>l</mi><mi>h</mi><mi>s</mi><mi> </mi><mrow><mi>'</mi><mi>i</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi><mi>o</mi><msup><mi>f</mi><mi>'</mi></msup></mrow><mi> </mi><mi>r</mi><mi>h</mi><mi>s</mi><mi> </mi><mi> </mi><mi>r</mi><mi>h</mi><mi>s</mi><mi>:</mi><mrow><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mrow><mi>C</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi></mrow></mrow></mrow><mrow/><mtext>
</mtext></math>
is contained in the the first type rule.] 
, an object type
reference
<sup class="footnote">[<a id="_footnoteref_46" class="footnote" href="#_footnote_46" title="View footnote.">46</a>]</sup>
or an enum type reference.     <br>
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>l</mi><mi>h</mi><mi>s</mi><mi> </mi><mrow><mi>'</mi><mi>i</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi><mi>o</mi><msup><mi>f</mi><mi>'</mi></msup></mrow><mi> </mi><mi>r</mi><mi>h</mi><mi>s</mi><mi> </mi><mi> </mi><mi>r</mi><mi>h</mi><mi>s</mi><mi>:</mi><mrow><mi>F</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></mrow><mrow/><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>l</mi><mi>h</mi><mi>s</mi><mi> </mi><mrow><mi>'</mi><mi>i</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi><mi>o</mi><msup><mi>f</mi><mi>'</mi></msup></mrow><mi> </mi><mi>r</mi><mi>h</mi><mi>s</mi><mi> </mi><mi> </mi><mi>r</mi><mi>h</mi><mi>s</mi><mi>:</mi><mrow><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mrow><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow></mrow></mrow><mrow/><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>l</mi><mi>h</mi><mi>s</mi><mi> </mi><mrow><mi>'</mi><mi>i</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi><mi>o</mi><msup><mi>f</mi><mi>'</mi></msup></mrow><mi> </mi><mi>r</mi><mi>h</mi><mi>s</mi><mi> </mi><mi> </mi><mi>r</mi><mi>h</mi><mi>s</mi><mi>:</mi><mrow><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mrow><mi>N</mi><mn>4</mn><mi>E</mi><mi>n</mi><mi>u</mi><mi>m</mi></mrow></mrow></mrow><mrow/></math></p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-652" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-652</a>
<a href="https://jira.numberfour.eu/browse/IDE-681" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-681</a>
<a href="https://github.com/NumberFour/N4JS/issues/631" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-631</a>
</div>
</div>
<div class="paragraph">
<p>The type of a definition site structural classifier <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> is
not of type <code>C</code>. Thus, the <code>instanceof</code> operator cannot be used for structural types.
Use-site structural typing is also not possible since `~
` would be
interpreted (by the parser) as a binary operator.</p>
</div>
<div class="paragraph">
<p><a id="req:inOperatorConstraints"></a> 
For a given relational expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi></math> with
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mo>.</mo><mi>o</mi><mi>p</mi><mo>=</mo><mrow><mi>i</mi><mi>n</mi></mrow></math>, the following constraints must hold:</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-345" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-345</a>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The right operand of the in operator must be an <code>Object</code>:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>l</mi><mi>h</mi><mi>s</mi><mi> </mi><mrow><mi>'</mi><mi>i</mi><msup><mi>n</mi><mi>'</mi></msup></mrow><mi> </mi><mi>r</mi><mi>h</mi><mi>s</mi><mi> </mi><mi> </mi><mi>r</mi><mi>h</mi><mi>s</mi><mi>:</mi><mrow><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow></mrow><mrow/></math></p>
</li>
<li>
<p>In N4JS mode,the left operand is restricted to be of type <code>string</code> or <code>number</code>:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>l</mi><mi>h</mi><mi>s</mi><mi> </mi><mrow><mi>'</mi><mi>i</mi><msup><mi>n</mi><mi>'</mi></msup></mrow><mi> </mi><mi>r</mi><mi>h</mi><mi>s</mi><mi> </mi><mi> </mi><mi>l</mi><mi>h</mi><mi>s</mi><mi>:</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo>,</mo><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi></mrow></mrow><mrow/></math></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A special feature of N4JS is support for interface type references in
combination with the <code>instance of</code> operator. The compiler rewrites the code to make this work. </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-561" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-561</a>
</div>
</div>
<div class="paragraph">
<p><code>instanceof</code> with Interface</p>
</div>
<div class="paragraph">
<p>The following example demonstrates the use of the operator with an interface. This is, of course, not working in pure ECMAScript.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">interface I {}

class A implements I {}
class B extends A {}
class C {}

function f(name: string, p: any) {
    if (p instanceof I) {
        console.log(name + " is instance of I");
    }
}

f("A", new A())
f("B", new B())
f("C", new C())</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will print out</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">A is instance of I
B is instance of I</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="type-inference-12"><a class="anchor" href="#type-inference-12"></a>Type Inference</h5>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-244" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-244</a>
<a href="https://jira.numberfour.eu/browse/IDE-345" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-345</a>
</div>
</div>
<div class="paragraph">
<p>The type of a relational expression always is ;
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>l</mi><mi>h</mi><mi>s</mi><mi> </mi><mfenced close=")" open="("><mrow><mi>'</mi><mi>l</mi><mi>t</mi><msup><mi>;</mi><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mn>8656</mn><msup><mi>;</mi><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mi>g</mi><mi>t</mi><msup><mi>;</mi><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mi>g</mi><mi>t</mi><mi>;</mi><msup><mo>=</mo><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mi>i</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi><mi>o</mi><msup><mi>f</mi><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mi>i</mi><msup><mi>n</mi><mi>'</mi></msup></mrow></mfenced><mi> </mi><mi>r</mi><mi>h</mi><mi>s</mi><mi> </mi><mi>:</mi><mrow><mi>b</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi>a</mi><mi>n</mi></mrow></mrow><mrow/><mrow><mn>11.8</mn><mn>.1</mn><mo>-</mo><mn>6</mn></mrow></math></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_equality_expression"><a class="anchor" href="#_equality_expression"></a>10.1.17. Equality Expression</h4>
<div class="sect4">
<h5 id="equality-expression-syntax"><a class="anchor" href="#equality-expression-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>Cf. [<a href="#ECMA11a">ECMA11a(p.p.80ff)</a>]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">EqualityExpression returns Expression: RelationalExpression
    (=&gt;({EqualityExpression.lhs=current} op=EqualityOperator) rhs=RelationalExpression)*;

EqualityExpressionNoIn returns Expression: RelationalExpressionNoIn
    (=&gt;({EqualityExpression.lhs=current} op=EqualityOperator) rhs=RelationalExpressionNoIn)*;


enum EqualityOperator: same='===' | nsame='!==' | eq='==' | neq='!=';</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="equality-expression-semantics"><a class="anchor" href="#equality-expression-semantics"></a>Semantics</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-345" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-345</a>
</div>
</div>
<div class="paragraph">
<p>There are no hard constraints defined for equality expressions.</p>
</div>
<div class="paragraph">
<p>In N4JSmode, a warning is created if for a given expression
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mi>h</mi><mi>s</mi><mfenced close=")" open="("><mrow><mi>'</mi><mo>=</mo><mo>=</mo><msup><mo>=</mo><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mo>!</mo><mo>=</mo><msup><mo>=</mo><mi>'</mi></msup></mrow></mfenced><mi>r</mi><mi>h</mi><mi>s</mi></math>, neither
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mi>h</mi><mi>s</mi><mo>.</mo><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>r</mi><mi>h</mi><mi>s</mi><mo>.</mo><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi></math> nor
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi><mi>h</mi><mi>s</mi><mo>.</mo><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>l</mi><mi>h</mi><mi>s</mi><mo>.</mo><mi>u</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>r</mi></math> and no interface or composed
type is involved as the result is constant in these cases.
 </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-773" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-773</a>
<a href="https://github.com/NumberFour/N4JS/issues/260" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-260</a>
</div>
</div>
<div class="paragraph">
<p>Note that a warning is only created if the upper bounds do not match the
described constraints. This is necessary for wildcards. For example in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">// with
class A{} class B extends A{}
function isFirst(ar: Array&lt;? extends A&gt;, b: B): boolean {
    return b === ar[0]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>the type of array elements is <code>? extends A</code>.<br>
Neither <math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>?</mi><mi>e</mi><mi>x</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>s</mi><mi>A</mi></mrow><mi>B</mi></math> nor
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi><mrow><mi>?</mi><mi>e</mi><mi>x</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>s</mi><mi>A</mi></mrow></math> is true. This
is why the upper bounds are to be used.</p>
</div>
</div>
<div class="sect4">
<h5 id="type-inference-13"><a class="anchor" href="#type-inference-13"></a>Type Inference</h5>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-244" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-244</a>
<a href="https://jira.numberfour.eu/browse/IDE-345" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-345</a>
</div>
</div>
<div class="paragraph">
<p>In N4JSmode, using the non-strict equality operators <code>'=='|'!='</code> is only allowed for internal developers. External developers have to use the strict equality
operators <code>'==='|'!=='</code>. The inferred type of an equality expression always is <code>boolean</code>.</p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>l</mi><mi>h</mi><mi>s</mi><mi> </mi><mfenced close=")" open="("><mrow><mi>'</mi><mo>=</mo><msup><mo>=</mo><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mo>!</mo><msup><mo>=</mo><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mo>=</mo><mo>=</mo><msup><mo>=</mo><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mo>!</mo><mo>=</mo><msup><mo>=</mo><mi>'</mi></msup></mrow></mfenced><mi> </mi><mi>r</mi><mi>h</mi><mi>s</mi><mi> </mi><mi>:</mi><mrow><mi>b</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi>a</mi><mi>n</mi></mrow></mrow><mrow/><mn>11.9</mn></math></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_binary_bitwise_expression"><a class="anchor" href="#_binary_bitwise_expression"></a>10.1.18. Binary Bitwise Expression</h4>
<div class="sect4">
<h5 id="binary-bitwise-expression-syntax"><a class="anchor" href="#binary-bitwise-expression-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>Cf. [<a href="#ECMA11a">ECMA11a(p.p.82ff)</a>]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">BitwiseANDExpression returns Expression: EqualityExpression
    (=&gt; ({BitwiseANDExpression.lhs=current} '&amp;') rhs=EqualityExpression)*;

BitwiseANDExpressionNoIn returns Expression: EqualityExpressionNoIn
    (=&gt; ({BitwiseANDExpression.lhs=current} '&amp;') rhs=EqualityExpressionNoIn)*;

BitwiseXORExpression returns Expression: BitwiseANDExpression
    (=&gt; ({BitwiseXORExpression.lhs=current} '^') rhs=BitwiseANDExpression)*;

BitwiseXORExpressionNoIn returns Expression: BitwiseANDExpressionNoIn
    (=&gt; ({BitwiseXORExpression.lhs=current} '^') rhs=BitwiseANDExpressionNoIn)*;

BitwiseORExpression returns Expression: BitwiseXORExpression
    (=&gt; ({BitwiseORExpression.lhs=current} '|') rhs=BitwiseXORExpression)*;

BitwiseORExpressionNoIn returns Expression: BitwiseXORExpressionNoIn
    (=&gt; ({BitwiseORExpression.lhs=current} '|') rhs=BitwiseXORExpressionNoIn)*;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="binary-bitwise-expression-semantics"><a class="anchor" href="#binary-bitwise-expression-semantics"></a>Semantics</h5>
<div class="paragraph">
<p> For a given bitwise bitwise expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi></math> the following constraints must hold
in N4JS mode:</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-345" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-345</a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The types of the operands must be both number.
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>B</mi><mi>i</mi><mi>t</mi><mi>w</mi><mi>i</mi><mi>s</mi><mi>e</mi><mi>B</mi><mi>i</mi><mi>t</mi><mi>w</mi><mi>i</mi><mi>s</mi><mi>e</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mi> </mi><mi> </mi><mrow><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mi>:</mi><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi></mrow></mrow><mrow/></math></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="type-inference-14"><a class="anchor" href="#type-inference-14"></a>Type Inference</h5>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-244" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-244</a>
<a href="https://jira.numberfour.eu/browse/IDE-345" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-345</a>
</div>
</div>
<div class="paragraph">
<p>The type returned by a binary bitwise expression is always :
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi> </mi><mfenced close=")" open="("><mrow><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mfenced close=")" open="("><mrow><mi>'</mi><mi>a</mi><mi>m</mi><mi>p</mi><msup><mi>;</mi><mi>'</mi></msup><mo>|</mo><msup><mi>'</mi><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup></mrow></mfenced><mi> </mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></mfenced><mi>:</mi><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi></mrow></mrow><mrow/><mn>11.10</mn></math></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_binary_logical_expression"><a class="anchor" href="#_binary_logical_expression"></a>10.1.19. Binary Logical Expression</h4>
<div class="sect4">
<h5 id="binary-logical-expression-syntax"><a class="anchor" href="#binary-logical-expression-syntax"></a>Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">LogicalANDExpression returns Expression: BitwiseORExpression
    (=&gt; ({LogicalANDExpression.lhs=current} '&amp;&amp;') rhs=BitwiseORExpression)*;
LogicalANDExpressionNoIn returns Expression: BitwiseORExpressionNoIn
    (=&gt; ({LogicalANDExpression.lhs=current} '&amp;&amp;') rhs=BitwiseORExpressionNoIn)*;

LogicalORExpression returns Expression: LogicalANDExpression
    (=&gt; ({LogicalORExpression.lhs=current} '||') rhs=LogicalANDExpression)*;
LogicalORExpressionNoIn returns Expression: LogicalANDExpressionNoIn
    (=&gt; ({LogicalORExpression.lhs=current} '||') rhs=LogicalANDExpressionNoIn)*;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="binary-logical-expression-semantics"><a class="anchor" href="#binary-logical-expression-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>117Binary Logical Expression
Constraints[req:BinaryLogicalExpressionConstraints] For a given binary
logical expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi></math> with <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mo>.</mo><mi>l</mi><mi>h</mi><mi>s</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>:</mi><mi>L</mi></math> and
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mo>.</mo><mi>r</mi><mi>h</mi><mi>s</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>:</mi><mi>R</mi></math> the following constraints must hold:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In N4JS mode <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>L</mi></math> must not be or .</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-775" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-775</a>
</div>
</div>
</div>
<div class="sect4">
<h5 id="type-inference-15"><a class="anchor" href="#type-inference-15"></a>Type Inference</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-244" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-244</a>
</div>
</div>
<div class="paragraph">
<p>The evaluation relies on ECMAScript’s abstract operation <code>ToBoolean</code> [<a href="#ECMA11a">ECMA11a(p.p.43)</a>].
A short-circuit evaluation strategy is used so that depending on the types
of the operands, different result types may be inferred. In particular,
the inferred type usually is not <code>boolean</code> ((cf. [<a href="#ECMA11a">ECMA11a(p.S11.11., p.p.83ff)</a>] ).
The type inference does not take this short-circuit evaluation strategy into account, as it will
affect the result in case one of the types is <code>null</code> either or <code>undefined</code>, which is not allowed in N4JS mode.</p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi> </mi><mi>l</mi><mi>h</mi><mi>s</mi><mi> </mi><mrow><mi>'</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>a</mi><mi>m</mi><mi>p</mi><msup><mi>;</mi><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup><mo>|</mo><msup><mo>|</mo><mi>'</mi></msup></mrow><mi> </mi><mi>r</mi><mi>h</mi><mi>s</mi><mi>:</mi><mrow/><mi>l</mi><mi>h</mi><mi>s</mi><mo>,</mo><mi>r</mi><mi>h</mi><mi>s</mi><mrow><mo>}</mo></mrow></mrow><mrow/></math></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_conditional_expression"><a class="anchor" href="#_conditional_expression"></a>10.1.20. Conditional Expression</h4>
<div class="sect4">
<h5 id="conditional-expression-syntax"><a class="anchor" href="#conditional-expression-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>Cf. [<a href="#ECMA11a">ECMA11a(p.S11.12, p.p.84)</a>]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">ConditionalExpression returns Expression: LogicalORExpression
    (=&gt; ({ConditionalExpression.expression=current} '?') trueExpression=AssignmentExpression  ':' falseExpression=AssignmentExpression)?;

ConditionalExpressionNoIn returns Expression: LogicalORExpressionNoIn
    (=&gt; ({ConditionalExpression.expression=current} '?') trueExpression=AssignmentExpression  ':' falseExpression=AssignmentExpressionNoIn)?;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="conditional-expression-semantics"><a class="anchor" href="#conditional-expression-semantics"></a>Semantics</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-776" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-776</a>
</div>
</div>
<div class="paragraph">
<p>118Conditional Expression
Constraints[req:ConditionalExpressionConstraints] For a given
conditional expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi></math> with <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>e</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>:</mi><mi>C</mi><mo>,</mo><mi>e</mi><mo>.</mo><mi>t</mi><mi>r</mi><mi>u</mi><mi>e</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>:</mi><mi>T</mi><mo>,</mo><mi>e</mi><mo>.</mo><mi>f</mi><mi>a</mi><mi>l</mi><mi>s</mi><mi>e</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>:</mi><mi>F</mi></math> the following constraints
must hold:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A warning will be issued in N4JSmode if <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></math>
evaluates to a constant value. That is to say</p>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>∈</mo><mfenced close="}" open="{"><mrow><mi>f</mi><mi>a</mi><mi>l</mi><mi>s</mi><mi>e</mi></mrow><mrow><mi>t</mi><mi>r</mi><mi>u</mi><mi>e</mi></mrow><mrow><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi></mrow><mrow><mi>u</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi></mrow></mfenced></math> or
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi><mo>∈</mo><mfenced close="}" open="{"><mrow><mi>v</mi><mi>o</mi><mi>i</mi><mi>d</mi></mrow><mrow><mi>u</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi></mrow></mfenced></math>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are no specific constraints defined for the condition. The
ECMAScript operation <code>ToBoolean</code> [<a href="#ECMA11a">ECMA11a(p.S9.2, p.p.43)</a>] is used to convert any type to boolean.</p>
</div>
</div>
<div class="sect4">
<h5 id="type-inference-16"><a class="anchor" href="#type-inference-16"></a>Type Inference</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-348" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-348</a>
</div>
</div>
<div class="paragraph">
<p>The inferred type of a conditional expression is the union of the true
and false expression (cf. [<a href="#ECMA11a">ECMA11a(p.S11.12, p.p.84)</a>]   (): <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>d</mi><mi> </mi><mrow><mi>'</mi><msup><mi>?</mi><mi>'</mi></msup></mrow><mi>e</mi><mi>t</mi><mi> </mi><mrow><mi>'</mi><msup><mi>:</mi><mi>'</mi></msup></mrow><mi>e</mi><mi>f</mi><mi>:</mi><mi>T</mi></mrow><mrow><mi>T</mi><mo>=</mo><mrow><mi>e</mi><mi>t</mi><mo>,</mo><mi>e</mi><mi>f</mi></mrow></mrow></math></p>
</div>
<div class="paragraph">
<p>[[ex:Type of Conditional Expressions]]
Given the following declarations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class A{}       class B extends A{}
class C{}       class D extends A{}
class G&lt;T&gt; { field: T; }

var ga: G&lt;A&gt;, gb: G&lt;B&gt;;
    a: A, b: B, c: C, d: D;
var boolean cond;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the type of the following conditional expression is inferred as
noted in the comments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">cond ? a : a;                           // A
cond ? a : b;                           // union{A,B}
cond ? a : c;                           // union{A,C}
cond ? b : d;                           // union{B,D}
cond ? (cond ? a : b) : (cond ? c : d); // union{A,B,C,D}
cond ? (cond ? a : b) : (cond ? b : d); // union{A,B,D}
cond ? ga : gb;                         // union{G&lt;A&gt;,G&lt;B&gt;}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_assignment_expression"><a class="anchor" href="#_assignment_expression"></a>10.1.21. Assignment Expression</h4>
<div class="sect4">
<h5 id="assignment-expression-syntax"><a class="anchor" href="#assignment-expression-syntax"></a>Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">[language=n4bnf,caption={Syntax Assignment Expression},label={lst:EBNFAssignment},escapeinside={^}{^}]
AssignmentExpression &lt;In, Yield&gt;:
    lhs=Expression op=AssignmentOperator rhs=AssignmentExpression&lt;In,Yield&gt;
;
AssignmentOperator:
      '='
    | '*=' | '/=' | '%=' | '+=' | '-='
    | '&lt;&lt;=' | '&gt;&gt;=' | '&gt;&gt;&gt;='
    | '&amp;=' | '^=' | '|='
;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="assignment-expression-semantics"><a class="anchor" href="#assignment-expression-semantics"></a>Semantics</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-349" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-349</a>
</div>
</div>
<div class="paragraph">
<p>For a given assignment <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi></math>
with <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mo>.</mo><mi>o</mi><mi>p</mi><mo>=</mo><mrow><mi>'</mi><msup><mo>=</mo><mi>'</mi></msup></mrow></math> the following constraints
must hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mo>.</mo><mi>l</mi><mi>h</mi><mi>s</mi></mrow><mrow><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mo>.</mo><mi>r</mi><mi>h</mi><mi>s</mi></mrow></math></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the following inference rule and the constraint, ’@’ is to be
replaced with the right part of one of the assignment operators listed
above, that is,<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>@</mi><mo>∈</mo><mfenced close="}" open="{"><mrow><mi>'</mi><msup><mo>*</mo><mi>'</mi></msup><msup><mo>,</mo><mi>'</mi></msup><msup><mo>/</mo><mi>'</mi></msup><msup><mo>,</mo><mi>'</mi></msup><msup><mi>%</mi><mi>'</mi></msup><msup><mo>,</mo><mi>'</mi></msup><msup><mo>+</mo><mi>'</mi></msup><msup><mo>,</mo><mi>'</mi></msup><msup><mo>-</mo><mi>'</mi></msup><msup><mo>,</mo><mi>'</mi></msup><mi>l</mi><mi>t</mi><mi>;</mi><mi>l</mi><mi>t</mi><msup><mi>;</mi><mi>'</mi></msup><msup><mo>,</mo><mi>'</mi></msup><mi>g</mi><mi>t</mi><mi>;</mi><mi>g</mi><mi>t</mi><msup><mi>;</mi><mi>'</mi></msup><msup><mo>,</mo><mi>'</mi></msup><mi>g</mi><mi>t</mi><mi>;</mi><mi>g</mi><mi>t</mi><mi>;</mi><mi>g</mi><mi>t</mi><msup><mi>;</mi><mi>'</mi></msup><msup><mo>,</mo><mi>'</mi></msup><mi>a</mi><mi>m</mi><mi>p</mi><msup><mi>;</mi><mi>'</mi></msup><mo>,</mo><msup><mi>'</mi><mi>'</mi></msup><msup><mo>,</mo><mi>'</mi></msup><msup><mo>|</mo><mi>'</mi></msup></mrow></mfenced></math></p>
</div>
<div class="paragraph">
<p>120Compound Assignment For a given assignment
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mi> </mi><mi>o</mi><mi>p</mi><mi> </mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></math>, with <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>o</mi><mi>p</mi><mo>=</mo><mrow><mi>'</mi><mi>@</mi><msup><mo>=</mo><mi>'</mi></msup></mrow></math> but
not , both, left and right must be subtypes of <code>number</code>.<br>
For operator <code>'+='</code>,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if the left-hand side is a <code>number</code>, then
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mi> </mi><mrow><mi>'</mi><msup><mo>+</mo><mi>'</mi></msup></mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></math> must return a number as well.
The right-hand side must, in fact, be a <code>number</code> (and not a <code>boolean</code>) here in order to avoid unexpected results.</p>
</li>
<li>
<p>if the left-hand side is a <code>string</code>, then
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mrow><mi>'</mi><msup><mo>+</mo><mi>'</mi></msup></mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></math> must return a string as well.
That means that the right-hand side can be of <code>any</code> type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The expected type for the left-hand side is <code>union{number,string}</code>.</p>
</div>
<div class="paragraph">
<p>The basic idea behind these constraints is that the type of the
left-hand side is not to be changed by the compound assignment.</p>
</div>
<div class="paragraph">
<p>For a given assignment expression
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi></math>, the left-hand side must be writeable or a
final data field and the assignment must be in the constructor. Let
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>v</mi></math> be the bound variable (or field) with
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>b</mi><mi>i</mi><mi>n</mi><mi>d</mi><mfenced close=")" open="("><mrow><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo>.</mo><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow><mi>v</mi></mfenced></math> <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>v</mi><mo>.</mo><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi><mo>∨</mo><mi>v</mi><mo>.</mo><mi>f</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi><mo>∧</mo><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><mi>v</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo>=</mo><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><mo>∧</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>F</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mi>v</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>r</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="2.0em"/><mo>∧</mo><mi>μ</mi><mfenced close=")" open="("><mrow><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo>.</mo><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></mfenced><mo>=</mo><mrow><mi>P</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>y</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="4.0em"/><mo>∧</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo>.</mo><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mo>.</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>=</mo><mrow><mi>"</mi><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi><mi>"</mi></mrow></math></p>
</div>
<div class="paragraph">
<p>The value of writeable is true for setters and usually for variables and
data fields. Assignability of variables and data fields can be
restricted via <code>const</code> or the <code>@Final</code> annotation. See <a href="#Assignment_Modifiers">[Assignment_Modifiers]</a>(data fields) and <a href="#_const">Const</a> (const variables) for details.</p>
</div>
<div class="paragraph">
<p>Also see <a href="#req:Read_Access_to_Identifier">[req:Read_Access_to_Identifier]</a> for read access constraint.</p>
</div>
<div class="paragraph">
<p>The left-hand side of an assignment expression may be an array or object
literal and the assignment expression is then treated as a destructuring
assignment. See <a href="#Destructuring">[Destructuring]</a> for details.</p>
</div>
</div>
<div class="sect4">
<h5 id="type-inference-17"><a class="anchor" href="#type-inference-17"></a>Type Inference</h5>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-244" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-244</a>
<a href="https://jira.numberfour.eu/browse/IDE-349" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-349</a>
</div>
</div>
<div class="paragraph">
<p>Similarly to [<a href="#ECMA11a">ECMA11a(p.S11.1, p.p.84ff)</a>], we define type inference for simple assignment (<code>=</code>) and compound assignment (<code>op=</code>) individually.</p>
</div>
<div class="paragraph">
<p>The type of the assignment is simply the type of the right-hand side:</p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mi> </mi><mrow><mi>'</mi><msup><mo>=</mo><mi>'</mi></msup></mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>:</mi><mi>T</mi></mrow><mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>:</mi><mi>T</mi></mrow><mrow><mn>11.13</mn><mn>.1</mn></mrow></math></p>
</div>
<div class="paragraph">
<p>Compound assignments are reduced to the former by splitting an operator
’@=’, in which ’@’ is a simple operator, into a simple operator
expression with operator ’@’ and a simple assignment ’=’. Since the type
of the latter is the right-hand side, we can define:</p>
</div>
<div class="paragraph">
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mi> </mi><mrow><mi>'</mi><mi>@</mi><msup><mo>=</mo><mi>'</mi></msup></mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>:</mi><mi>T</mi></mrow><mrow><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mi> </mi><mrow><mi>'</mi><msup><mi>@</mi><mi>'</mi></msup></mrow><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>:</mi><mi>T</mi></mrow><mrow><mn>11.13</mn><mn>.1</mn></mrow></math></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_comma_expression"><a class="anchor" href="#_comma_expression"></a>10.1.22. Comma Expression</h4>
<div class="sect4">
<h5 id="comma-expression-syntax"><a class="anchor" href="#comma-expression-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>Cf. [<a href="#ECMA11a">ECMA11a(p.S11.14, p.p.85)</a>]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">CommaExpression &lt;In, Yield&gt;:
    exprs+=AssignmentExpression&lt;In,Yield&gt; ',' exprs+=AssignmentExpression&lt;In,Yield&gt;
    (','    exprs+=AssignmentExpression&lt;In,Yield&gt;)*
;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="comma-expression-semantics"><a class="anchor" href="#comma-expression-semantics"></a>Semantics</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-778" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-778</a>
</div>
</div>
<div class="paragraph">
<p>All expressions will be evaluated even though only the value of the last
expression will be the result.</p>
</div>
<div class="paragraph">
<p>[Comma Expression][ex:CommaExpression] Assignment expressions preceed
comma expressions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var b: boolean;
b = (12, 34, true); // ok, b=true
b =  12, 34, true ; // error, b=12 is invalid</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="type-inference-18"><a class="anchor" href="#type-inference-18"></a>Type Inference</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-244" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-244</a>
</div>
</div>
<div class="paragraph">
<p>Cf. [<a href="#ECMA11a">ECMA11a(p.S11.14, p.p.85)</a>]</p>
</div>
<div class="paragraph">
<p>The type of a comma expression <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi></math> is inferred to the
last expression: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>c</mi><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>:</mi><mi>T</mi></mrow><mrow><mi>n</mi><mo>=</mo><mo>|</mo><mi>c</mi><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>s</mi><mo>|</mo><mo>,</mo><mi>c</mi><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><msub><mi>s</mi><mi>n</mi></msub><mi>:</mi><mi>T</mi></mrow><mn>11.14</mn></math></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ecmascript_6_expressions"><a class="anchor" href="#_ecmascript_6_expressions"></a>10.2. ECMAScript 6 Expressions</h3>
<div class="sect3">
<h4 id="_the_super_keyword"><a class="anchor" href="#_the_super_keyword"></a>10.2.1. The super Keyword</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">SuperLiteral: {SuperLiteral} 'super';</code></pre>
</div>
</div>
<div class="paragraph">
<p>Apart from the use of keyword <code>super</code> in wildcards of type expressions (cf. <a href="#Type_Expressions">[Type_Expressions]</a>), there are two use cases for keyword <code>super</code>: super member access and super
constructor calls.</p>
</div>
<div class="paragraph">
<p>Super Keyword</p>
</div>
<div class="paragraph">
<p>Two use cases for keyword super:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class B extends A {
    constructor() {
        // super call
        super();
    }
    @Override
    m();: void {
        // super member access
        super.m();
    }
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="super-keyword-semantics"><a class="anchor" href="#super-keyword-semantics"></a>Semantics</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-645" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-645</a>
</div>
</div>
<div class="paragraph">
<p><code>super</code> can be used to access the supertype’s constructor, methods, getters and
setters. The supertype is defined lexically, which is different from how <code>this</code>
works.
<sup class="footnote">[<a id="_footnoteref_47" class="footnote" href="#_footnote_47" title="View footnote.">47</a>]</sup>],
Chapter 12.3.5 "The Super Keyword"; note the use of "HomeObject" instead of "thisValue"; also see this
<a href="http://www.2ality.com/2011/11/super-references.html">blog</a>). Note that in  cite:[ECMA15a]
Chapter 12.3.5 <code>The Super Keyword</code>, <code>super</code> is defined as a keyword but the
syntax and semantics are defined in conjunction of member access.]</p>
</div>
<div class="paragraph">
<p>The type referenced with the super literal is always nominal. This is a
consequence of references to types in extend clauses to be nominal.
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>s</mi><mi>u</mi><mi>p</mi><mi>e</mi><mi>r</mi></mrow><mi>:</mi><mi>T</mi><mo>∧</mo><mi>T</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>S</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>g</mi><mi>y</mi><mo>=</mo><mrow><mi>n</mi><mi>o</mi><mi>m</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow></math></p>
</div>
<div class="paragraph">
<p>If the super literal <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math> is used to access the super constructor of a
class, all of the following constraints must hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The super constructor access must be a call expression:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>μ</mi><mfenced close=")" open="("><mrow><mi>c</mi><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi></mrow></mfenced><mo>=</mo><mrow><mi>C</mi><mi>a</mi><mi>l</mi><mi>l</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mo>∧</mo><mi>c</mi><mo>.</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>=</mo><mi>c</mi><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi></math></p>
</li>
<li>
<p>The super constructor call must be the expression of an expression
statement <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>S</mi><mi>t</mi><mi>m</mi><mi>t</mi></math>: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>S</mi><mi>t</mi><mi>m</mi><mi>t</mi><mo>=</mo><mi>c</mi><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>r</mi><mo>∧</mo><mi>μ</mi><mfenced close=")" open="("><mrow><mi>c</mi><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>r</mi></mrow></mfenced><mo>=</mo><mrow><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>S</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow></math></p>
</li>
<li>
<p>The containing statement <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mi>t</mi><mi>m</mi><mi>t</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi></math> must be directly
contained in a constructor body: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>μ</mi><mfenced close=")" open="("><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>S</mi><mi>t</mi><mi>m</mi><mi>t</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>F</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></mfenced><mo>=</mo><mrow><mi>C</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow><mo>)</mo></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∧</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>S</mi><mi>t</mi><mi>m</mi><mi>t</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>r</mi><mo>=</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>S</mi><mi>t</mi><mi>m</mi><mi>t</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>F</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>.</mo><mi>b</mi><mi>o</mi><mi>d</mi><mi>y</mi></math></p>
</li>
<li>
<p> There must be no access to and not return statement before the
containing statement <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>S</mi><mi>t</mi><mi>m</mi><mi>t</mi></math>.<br>
Let <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mi>i</mi></math> be the index of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>S</mi><mi>t</mi><mi>m</mi><mi>t</mi></math> in the
constructor body:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>S</mi><mi>t</mi><mi>m</mi><mi>t</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>r</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>m</mi><mi>t</mi><msub><mi>s</mi><mrow><mi>s</mi><mi>i</mi></mrow></msub><mo>=</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>S</mi><mi>t</mi><mi>m</mi><mi>t</mi></math>.<br>
Then, the following constraint must
hold<sup class="footnote">[<a id="_footnoteref_48" class="footnote" href="#_footnote_48" title="View footnote.">48</a>]</sup> <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∀</mo><mi>i</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>s</mi><mi>i</mi><mi>:</mi><mi>e</mi><mi>l</mi><mi>e</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><msup><mo>∈</mo><mo>*</mo></msup><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>S</mi><mi>t</mi><mi>m</mi><mi>t</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>r</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>m</mi><mi>t</mi><msub><mi>s</mi><mi>i</mi></msub><mi>:</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mi>μ</mi><mfenced close=")" open="("><mi>i</mi></mfenced><mo>∈</mo><mrow><mi>T</mi><mi>h</mi><mi>i</mi><mi>s</mi><mi>L</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>l</mi><mo>,</mo><mi>R</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>S</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow></math></p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/147" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-147</a>
</div>
</div>
<div class="paragraph">
<p>Further constraints with regard to super constructor calls are described
in <a href="#Constructor">[Constructor]</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1753" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1753</a>
</div>
</div>
<div class="paragraph">
<p>124Access Super Member with Super
Literal[req:Access_Super_Member_with_Super_Literal] If the super literal
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math> is used to access a member of the super class, all of
the following constraints must hold, with
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mo>=</mo><mi>s</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>r</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>r</mi></math></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The super literal must be the receiver of a method call (cf. remarks
below): <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>μ</mi><mfenced close=")" open="("><mi>c</mi></mfenced><mo>=</mo><mrow><mi>C</mi><mi>a</mi><mi>l</mi><mi>l</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mtext>
</mtext><mo>∧</mo><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>c</mi><mo>.</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>=</mo><mrow><mi>P</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>y</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mtext>
</mtext><mo>∧</mo><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>c</mi><mo>.</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>.</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>=</mo><mi>s</mi></math></p>
</li>
<li>
<p>The super literal is used in a method or field accessor of a class:

<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>μ</mi><mfenced close=")" open="("><mrow><mi>s</mi><mo>.</mo><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>C</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi></mrow></mfenced><mo>=</mo><mrow><mi>C</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi></mrow></math></p>
</li>
<li>
<p>The super literal must not be used in a nested function expression:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>μ</mi><mrow><mo>(</mo><mi>s</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>F</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mi>s</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>M</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi><mi>O</mi><mi>r</mi><mi>F</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mi>A</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>o</mi><mi>r</mi></mrow></math></p>
</li>
<li>
<p>If the return type of the method access via super is this, the
actually bound this type will be the type of the calling class (and not
of the class defining the method). <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>f</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mfenced close=")" open="("/><mi>:</mi><mi>T</mi></mrow><mi>s</mi><mo>.</mo><mi>m</mi></mrow><mrow><mi>s</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>C</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi><mo>=</mo><mi>T</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>μ</mi><mfenced close=")" open="("><mi>m</mi></mfenced><mo>=</mo><mrow><mi>M</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi></mrow><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>m</mi><mo>.</mo><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>=</mo><mrow><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi></mrow></mrow></math></p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/386" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-386</a>
</div>
</div>
<div class="paragraph">
<p>[[req:Super Literal Usage]]
For super literals, either <a href="#req:Access_Super_Constructor_with_Super_Literal">[req:Access_Super_Constructor_with_Super_Literal]</a> or <a href="#req:Access_Super_Member_with_Super_Literal">[req:Access_Super_Member_with_Super_Literal]</a> must hold, no other usage
is allowed.</p>
</div>
<div class="paragraph">
<p>Consequences:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Since fields cannot be overridden (except for changing the access
modifier), it is not possible nor allowed to access a field via <code>super</code>.</p>
</li>
<li>
<p>Super literals must not be used with index access (e.g., <code>super["foo"]</code>)</p>
</li>
<li>
<p>It is not possible to chain super keywords. That is, it is not
possible to call <code>super.super.m()</code>.</p>
</li>
<li>
<p>It is not allowed to use the super literal in interfaces or
non-methods/accessors.</p>
</li>
<li>
<p>Super cannot be used to call an overridden method of an implemented
method from the overriding method in the implementing class.</p>
</li>
<li>
<p>In order to be able to access a super method of a method
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> of a class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>, exactly one non-abstract
super method <math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>M</mi><mi>'</mi></msup></math> in a super class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> of
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> must exist. This is assured by the standard rules for
binding identifiers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If super is used to access a super member, the receiver type is not
changed. This is important in particular for static methods as
demonstrated in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class A {
    static foo(): void { console.log("A") }
    static bar(): void {
        this.foo();
    }
}

class B extends A {

    @Override
    static foo(): void { console.log("B") }
    @Override
    static bar(): void {
        A.bar();        // outputs "A"
        super.bar();    // outputs "B"
    }
}

B.bar();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In line 14, the receiver (which is similar to the this-binding in
ECMAScript) is changed to <code>A</code> . In line 15, using super, the receiver is
preserved, i.e. <code>B</code> coming from line 19.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ecmascript_7_expressions"><a class="anchor" href="#_ecmascript_7_expressions"></a>10.3. ECMAScript 7 Expressions</h3>
<div class="sect3">
<h4 id="_await_expression"><a class="anchor" href="#_await_expression"></a>10.3.1. Await Expression</h4>
<div class="paragraph">
<p>In N4JS, <code>await</code> is implemented as a unary operator with the same precedence as
<code>yield</code> in ECMAScript 6.</p>
</div>
<div class="paragraph">
<p>Constraints governing the use of <code>await</code> are given together with those for <code>async</code> in <a href="#Asynchronous_Functions">[Asynchronous_Functions]</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_n4js_specific_expressions"><a class="anchor" href="#_n4js_specific_expressions"></a>10.4. N4JS Specific Expressions</h3>
<div class="sect3">
<h4 id="_class_expression"><a class="anchor" href="#_class_expression"></a>10.4.1. Class Expression</h4>
<div class="paragraph">
<p>A class expression in N4JS is similar to a class expression in
ECMAScript 6 [<a href="#ECMA15a">ECMA15a(p.14.5)</a>].
.</p>
</div>
<div class="sect4">
<h5 id="class-expression-syntax"><a class="anchor" href="#class-expression-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>See <a href="#_classes">Classes</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="class-expression-semantics-type-inference"><a class="anchor" href="#class-expression-semantics-type-inference"></a>Semantics and Type Inference</h5>
<div class="paragraph">
<p>The inferred type of a class expression simply is the class type as
described in <a href="#Constructor_Type">[Constructor_Type]</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cast_as_expression"><a class="anchor" href="#_cast_as_expression"></a>10.4.2. Cast (As) Expression</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-161p" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-161p</a>
</div>
</div>
<div class="sect4">
<h5 id="cast-as-expression-syntax"><a class="anchor" href="#cast-as-expression-syntax"></a>Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">CastExpression &lt;Yield&gt; returns Expression: expression=Expression 'as' targetTypeRef=TypeRefForCast;

TypeRefForCast returns StaticBaseTypeRef:
      ParameterizedTypeRef
    | ThisTypeRef
    | ConstructorTypeRef
    | ClassifierTypeRef
    | FunctionTypeExpression
    | UnionTypeExpression
    | IntersectionTypeExpression</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cast-as-expression-semantics-type-inference"><a class="anchor" href="#cast-as-expression-semantics-type-inference"></a>10.4.3. Semantics and Type Inference</h4>
<div class="paragraph">
<p>The inferred type of the type cast expression is the target type:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi> </mi><mrow><mi>"</mi><mi>a</mi><mi>s</mi><mi>"</mi></mrow><mi> </mi><mi>T</mi><mi>:</mi><mi>T</mi></mrow><mrow/></math></p>
</div>
<div class="paragraph">
<p>The type cast returns the expression without further modifications. Type
casts are simply removed during compilation so there will be no
exceptions thrown at the cast until later when accessing properties
which may not be present in case of a failed cast.</p>
</div>
<div class="paragraph">
<p>An error is issued if the cast is either unnecessary or cannot succeed.
See further details in .</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_statements"><a class="anchor" href="#_statements"></a>11. Statements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For all statements, we define the following pseudo properties:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>containingFunction</code> </dt>
<dd>
<p>The function or method in which the statement is (indirectly) contained,
this may be null.</p>
</dd>
<dt class="hdlist1"><code>containingClass</code> </dt>
<dd>
<p>The class in which the statement is (indirectly) contained, this may be
null.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The expressions and statements are ordered, at first describing the
constructs available in the 5th edition of ECMA-262 referred to as  [<a href="#ECMA11a">ECMA11a</a>] in the following.
The grammar snippets already use newer constructs in some cases.</p>
</div>
<div class="sect2">
<h3 id="_ecmascript_5_statements"><a class="anchor" href="#_ecmascript_5_statements"></a>11.1. ECMAScript 5 Statements</h3>
<div class="paragraph">
<p>N4JS supports the same statements as
ECMAScript. Some of these statements are enhanced with annotations <a href="#_annotations">Annotations</a> and type information.</p>
</div>
<div class="paragraph">
<p>Although some statements may return a value which can be used via
certain constructs such as <code>eval</code>), no type is inferred for any statement. The
compiler will always create a warning if a statement is used instead of
an expression.</p>
</div>
<div class="paragraph">
<p>The following sections, therefore, do not define how to infer types for
statement but how types and type annotations are used in these
statements and the specific type constraints for a given statement.</p>
</div>
<div class="paragraph">
<p>All syntax definitions taken from  [<a href="#ECMA11a">ECMA11a</a>]  are repeated here for convenience
reasons and in order to define temporary variables for simplifying
constraint definitions. If non-terminals are not defined here, the
definition specified in  [<a href="#ECMA11a">ECMA11a</a>]   is to be used.</p>
</div>
<div class="sect3">
<h4 id="_function_or_field_accessor_bodies"><a class="anchor" href="#_function_or_field_accessor_bodies"></a>11.1.1. Function or Field Accessor Bodies</h4>
<div class="paragraph">
<p>126Dead Code[req:Dead_Code] For all statements in a function or field
accessor (getter/setter) body, the following constraints must hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Statements appearing directly after return, throw, break, or
continue statements (in the same block) are considered to be dead code
and a warning is issued in these cases.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_variable_statement"><a class="anchor" href="#_variable_statement"></a>11.1.2. Variable Statement</h4>
<div class="sect4">
<h5 id="variable-statement-syntax"><a class="anchor" href="#variable-statement-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>A var statement can declare the type of the variable with a type
reference. This is described with the following grammar similar to
[<a href="#ECMA11a">ECMA11a(p.S12.2, p.p.87)</a>]:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>VariableStatement &lt;In, Yield&gt;:
    =&gt;({VariableStatement}
        'var'
    )
    varDeclsOrBindings+=VariableDeclarationOrBinding&lt;In,Yield,false&gt; (',' varDeclsOrBindings+=VariableDeclarationOrBinding&lt;In,Yield,false&gt;)* Semi
;

VariableDeclarationOrBinding &lt;In, Yield, OptionalInit&gt;:
        VariableBinding&lt;In,Yield,OptionalInit&gt;
    |   VariableDeclaration&lt;In,Yield,true&gt;
;

VariableBinding &lt;In, Yield, OptionalInit&gt;:
    =&gt; pattern=BindingPattern&lt;Yield&gt; (
            &lt;OptionalInit&gt; ('=' expression=AssignmentExpression&lt;In,Yield&gt;)?
        |   &lt;!OptionalInit&gt; '=' expression=AssignmentExpression&lt;In,Yield&gt;
    )
;

VariableDeclaration &lt;In, Yield, AllowType&gt;:
    {VariableDeclaration} VariableDeclarationImpl&lt;In,Yield,AllowType&gt;;

fragment VariableDeclarationImpl &lt;In, Yield, AllowType&gt;*:
    annotations+=Annotation*
    (
        &lt;AllowType&gt; =&gt;(
            name=BindingIdentifier&lt;Yield&gt; ColonSepTypeRef?
        ) ('=' expression=AssignmentExpression&lt;In,Yield&gt;)?
    |   &lt;!AllowType&gt; =&gt;(
        name=BindingIdentifier&lt;Yield&gt;
        ) ('=' expression=AssignmentExpression&lt;In,Yield&gt;)?
    )
;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>var any: any;
// any.type := any

var anyNull = null;
// anyNull.type := any

var s: string;
// s.type := string

var init = "Hi";
// init.type := string

const MESSAGE = "Hello World";
// MESSAGE.type := string</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="variable-statement-semantics"><a class="anchor" href="#variable-statement-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>From a model and type inference point of view, variable and constant
statements and declarations are similar except that the pseudo property
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi></math> is set to false for variables and true for
constants. Also see exported variable statement (<a href="#_export_statement">Export Statement</a>) and constant statement and declaration (<a href="#_const">Const</a>).</p>
</div>
<div class="paragraph">
<p>For a given variable declaration <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi></math>, the following constraints must hold:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The type of the initializer expression must conform to the declared
type:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>≠</mo><mo>∧</mo><mi>d</mi><mo>.</mo><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi><mo>≠</mo><mtext>
</mtext><mi>d</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>d</mi><mo>.</mo><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>f</mi></math></p>
</li>
<li>
<p>The initializer expression should not contain a reference to
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi></math> except where the reference is contained in a class
expression or function expression and the class is not immediately
initialized or the function is not immediately invoked. In these cases,
the code is executed later and the self-reference is not a problem.<br>
To clarify: <code>should not</code> means that only a warning will be produced.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>// not ok (simple case)
var n = n + 1;

// ok (class expression  not in version 0.1)
// var cls1 = class { static sfield1 = "hello"; field2 = cls1.sfield1; };

// not ok, immediately instantiated (class expression  not in version 0.1)
// var cls2 = new class { field1 = "hello"; field2 = cls2.field1; };

// ok
var fun1 = function() : number { var x = fun1; return -42; };

// not ok, immediately invoked
var fun2 = function() : number { var x = fun2;  return -42; }();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The variable statement may contain array or object destructuring
patterns, see <a href="#Destructuring">[Destructuring]</a> for details.</p>
</div>
</div>
<div class="sect4">
<h5 id="variable-statement-type-inference"><a class="anchor" href="#variable-statement-type-inference"></a>Type Inference</h5>
<div class="paragraph">
<p>The type of a variable is the type of its declaration:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>v</mi><mi>:</mi><mi>d</mi></mrow><mrow/><mtext>
</mtext></math></p>
</div>
<div class="paragraph">
<p>The type of a variable declaration is either the declared type or the
inferred type of the initializer expression:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>d</mi><mi>:</mi><mi>T</mi></mrow><mrow><mi>d</mi><mo>.</mo><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>≠</mo><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>T</mi><mo>=</mo><mi>d</mi><mo>.</mo><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>d</mi><mi>:</mi><mi>T</mi></mrow><mrow><mi>d</mi><mo>.</mo><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>=</mo><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>d</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>≠</mo><mtext>
</mtext><mi>E</mi><mo>=</mo><mi>d</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>E</mi><mo>∉</mo><mfenced close="}" open="{"><mrow><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi><mo>,</mo><mi>u</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi></mrow></mfenced><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>T</mi><mo>=</mo><mi>E</mi></mrow><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>d</mi><mi>:</mi><mrow><mi>a</mi><mi>n</mi><mi>y</mi></mrow></mrow><mrow><mi>e</mi><mi>l</mi><mi>s</mi><mi>e</mi></mrow></math></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_if_statement"><a class="anchor" href="#_if_statement"></a>11.1.3. If Statement</h4>
<div class="sect4">
<h5 id="if-statement-syntax"><a class="anchor" href="#if-statement-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>Cf. [<a href="#ECMA11a">ECMA11a(p.S12.5, p.p.89)</a>]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>IfStatement &lt;Yield&gt;:
    'if' '(' expression=Expression&lt;In=true,Yield&gt; ')'
    ifStmt=Statement&lt;Yield&gt;
    (=&gt; 'else' elseStmt=Statement&lt;Yield&gt;)?;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="if-statement-semantics"><a class="anchor" href="#if-statement-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>There are no specific constraints defined for the condition, the
ECMAScript operation <code>ToBoolean</code> [<a href="#ECMA11a">ECMA11a(p.S9.2, p.p.43)</a>] is used to convert any type to boolean.</p>
</div>
<div class="paragraph">
<p>[[req:If_Statement]
In N4JS, the expression of an if statement must not evaluate to <code>void</code>. If the expressions is a function call
in particular, the called function must not be declared to return <code>void</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_iteration_statements"><a class="anchor" href="#_iteration_statements"></a>11.1.4. Iteration Statements</h4>
<div class="sect4">
<h5 id="iterations-statements-syntax"><a class="anchor" href="#iterations-statements-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>Cf. [<a href="#ECMA11a">ECMA11a(p.S12.6, p.p.90ff)</a>]</p>
</div>
<div class="paragraph">
<p>The syntax already considers the for-of style described in .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>IterationStatement &lt;Yield&gt;:
        DoStatement&lt;Yield&gt;
    |   WhileStatement&lt;Yield&gt;
    |   ForStatement&lt;Yield&gt;
;

DoStatement &lt;Yield&gt;: 'do' statement=Statement&lt;Yield&gt; 'while' '(' expression=Expression&lt;In=true,Yield&gt; ')' =&gt; Semi?;
WhileStatement &lt;Yield&gt;: 'while' '(' expression=Expression&lt;In=true,Yield&gt; ')' statement=Statement&lt;Yield&gt;;

ForStatement &lt;Yield&gt;:
    {ForStatement} 'for' '('
    (
        // this is not in the spec as far as I can tell, but there are tests that rely on this to be valid JS
            =&gt;(initExpr=LetIdentifierRef forIn?='in' expression=Expression&lt;In=true,Yield&gt; ')')
        |   (   -&gt;varStmtKeyword=VariableStatementKeyword
                (
                        =&gt;(varDeclsOrBindings+=BindingIdentifierAsVariableDeclaration&lt;In=false,Yield&gt; (forIn?='in' | forOf?='of') -&gt;expression=AssignmentExpression&lt;In=true,Yield&gt;?)
                    |   varDeclsOrBindings+=VariableDeclarationOrBinding&lt;In=false,Yield,OptionalInit=true&gt;
                        (
                                (',' varDeclsOrBindings+=VariableDeclarationOrBinding&lt;In=false,Yield,false&gt;)* ';' expression=Expression&lt;In=true,Yield&gt;? ';' updateExpr=Expression&lt;In=true,Yield&gt;?
                            |   forIn?='in' expression=Expression&lt;In=true,Yield&gt;?
                            |   forOf?='of' expression=AssignmentExpression&lt;In=true,Yield&gt;?
                        )
                )
            |   initExpr=Expression&lt;In=false,Yield&gt;
                (
                        ';' expression=Expression&lt;In=true,Yield&gt;? ';' updateExpr=Expression&lt;In=true,Yield&gt;?
                    |   forIn?='in' expression=Expression&lt;In=true,Yield&gt;?
                    |   forOf?='of' expression=AssignmentExpression&lt;In=true,Yield&gt;?
                )
            |   ';' expression=Expression&lt;In=true,Yield&gt;? ';' updateExpr=Expression&lt;In=true,Yield&gt;?
            )
        ')'
    ) statement=Statement&lt;Yield&gt;
;

ContinueStatement &lt;Yield&gt;: {ContinueStatement} 'continue' (label=[LabelledStatement|BindingIdentifier&lt;Yield&gt;])? Semi;
BreakStatement &lt;Yield&gt;: {BreakStatement} 'break' (label=[LabelledStatement|BindingIdentifier&lt;Yield&gt;])? Semi;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>v</mi><mi>a</mi><mi>r</mi><mi>D</mi><mi>e</mi><mi>c</mi><mi>l</mi><mfenced close=")" open="("><mi>s</mi></mfenced></math> are <code>VariableStatement</code>s as described in <a href="#Var_Statement">[Var_Statement]</a>, the declared variables can be type annotated.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title"></div>
</td>
<td class="content">
Using for-in is not recommended, instead `_each
` should be used.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="iterations-statements-semantics"><a class="anchor" href="#iterations-statements-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>There are no specific constraints defined for the condition, the
ECMAScript operation <code>ToBoolean</code> [<a href="#ECMA11a">ECMA11a(p.S9.2, p.p.43)</a>] is used to convert any type to boolean.</p>
</div>
<div class="paragraph">
<p>For a given <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi></math> the following conditions must hold:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The type of the expression must be conform to object:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mrow><mi>u</mi><mi>n</mi><mi>i</mi><mi>o</mi><mi>n</mi><mfenced close="}" open="{"><mrow><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow><mrow><mi>A</mi><mi>r</mi><mi>g</mi><mi>u</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi></mrow></mfenced></mrow></math></p>
</li>
<li>
<p>Either a new loop variable must be declared or an rvalue must be
provided as init expression:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi><mi>D</mi><mi>e</mi><mi>c</mi><mi>l</mi><mo>≠</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi><mo>∨</mo><mfenced close=")" open="("><mrow><mi>f</mi><mo>.</mo><mi>i</mi><mi>n</mi><mi>i</mi><mi>t</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo>≠</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi><mo>∧</mo><mi>i</mi><mi>s</mi><mi>R</mi><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mfenced close=")" open="("><mrow><mi>f</mi><mo>.</mo><mi>i</mi><mi>n</mi><mi>i</mi><mi>t</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi></mrow></mfenced></mrow></mfenced></math></p>
</li>
<li>
<p>The type of the loop variable must be a string (or a super type of
string, i.e. any): <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mfenced close=")" open="("><mrow><mi>f</mi><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi><mi>D</mi><mi>e</mi><mi>c</mi><mi>l</mi><mo>≠</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi><mo>∧</mo><mi>f</mi><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi><mi>D</mi><mi>e</mi><mi>c</mi><mi>l</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow></mrow></mfenced><mtext>
</mtext><mo>∨</mo><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mfenced close=")" open="("><mrow><mi>f</mi><mo>.</mo><mi>i</mi><mi>n</mi><mi>i</mi><mi>t</mi><mi>E</mi><mi>x</mi><mi>p</mi><mo>≠</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi><mo>∧</mo><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow><mi>f</mi><mo>.</mo><mi>i</mi><mi>n</mi><mi>i</mi><mi>t</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi></mrow></mfenced></math></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_return_statement"><a class="anchor" href="#_return_statement"></a>11.1.5. Return Statement</h4>
<div class="sect4">
<h5 id="return-statement-syntax"><a class="anchor" href="#return-statement-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>The returns statement is defined as in [<a href="#ECMA11a">ECMA11a(p.S12.9, p.p.93)</a>] with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ReturnStatement &lt;Yield&gt;:
    'return' (expression=Expression&lt;In=true,Yield&gt;)? Semi;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="return-statement-semantics"><a class="anchor" href="#return-statement-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>130Return statement[req:Return_statement]</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Expected type of expression in a return statement must be a sub type
of the return type of the enclosing function:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>S</mi><mi>t</mi><mi>m</mi><mi>t</mi><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>:</mi><mi>T</mi></mrow><mrow><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>S</mi><mi>t</mi><mi>m</mi><mi>t</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>F</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>:</mi><mi>F</mi><mi>T</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>T</mi><mo>=</mo><mi>F</mi><mi>T</mi><mo>.</mo><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi></mrow></math> Note that the expression may be evaluated to .</p>
</li>
<li>
<p>If enclosing function is declared to return , then either</p>
<div class="ulist">
<ul>
<li>
<p>no return statement must be defined</p>
</li>
<li>
<p>return statement has no expression</p>
</li>
<li>
<p>type of expression of return statement is</p>
</li>
</ul>
</div>
</li>
<li>
<p>If enclosing function is declared to to return a type different from
, then</p>
<div class="ulist">
<ul>
<li>
<p>all return statements must have a return expression</p>
</li>
<li>
<p>all control flows must either end with a return or throw statement</p>
</li>
</ul>
</div>
</li>
<li>
<p>Returns statements must be enclosed in a function. A return
statement, for example, must not be a top-level statement.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_with_statement"><a class="anchor" href="#_with_statement"></a>11.1.6. With Statement</h4>
<div class="sect4">
<h5 id="with-statement-syntax"><a class="anchor" href="#with-statement-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>The with statement is not allowed in N4JS, thus an error is issued.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>WithStatement &lt;Yield&gt;:
    'with' '(' expression=Expression&lt;In=true,Yield&gt; ')'
    statement=Statement&lt;Yield&gt;;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="with-statement-semantics"><a class="anchor" href="#with-statement-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>N4JS is based on strict mode and the with statement is not allowed in
strict mode, cf. [<a href="#ECMA11a">ECMA11a(p.S12.10.1, p.p.94)</a>].</p>
</div>
<div class="paragraph">
<p>131With Statement[req:With Statement] With statements are not allowed in
N4JS or strict mode.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_switch_statement"><a class="anchor" href="#_switch_statement"></a>11.1.7. Switch Statement</h4>
<div class="sect4">
<h5 id="switch-statement-syntax"><a class="anchor" href="#switch-statement-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>Cf. [<a href="#ECMA11a">ECMA11a(p.S12.11, p.p.94ff)</a>]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>SwitchStatement &lt;Yield&gt;:
    'switch' '(' expression=Expression&lt;In=true,Yield&gt; ')' '{'
    (cases+=CaseClause&lt;Yield&gt;)*
    ((cases+=DefaultClause&lt;Yield&gt;)
    (cases+=CaseClause&lt;Yield&gt;)*)? '}'
;

CaseClause &lt;Yield&gt;: 'case' expression=Expression&lt;In=true,Yield&gt; ':' (statements+=Statement&lt;Yield&gt;)*;
DefaultClause &lt;Yield&gt;: {DefaultClause} 'default' ':' (statements+=Statement&lt;Yield&gt;)*;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="switch-statement-semantics"><a class="anchor" href="#switch-statement-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>132Switch Constraints[req:Switch Constraints] For a given switch
statement <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math>, the following constraints must hold:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For all cases <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mo>∈</mo><mi>s</mi><mo>.</mo><mi>c</mi><mi>a</mi><mi>s</mi><mi>e</mi><mi>s</mi></math>,
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi></math>===<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mo>.</mo><mi>e</mi><mi>x</mi><mi>p</mi><mi>r</mi></math> must be valid according to
the constraints defined in .</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_throw_try_and_catch_statements"><a class="anchor" href="#_throw_try_and_catch_statements"></a>11.1.8. Throw, Try, and Catch Statements</h4>
<div class="sect4">
<h5 id="throw-try-catch-syntax"><a class="anchor" href="#throw-try-catch-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>Cf. [<a href="#ECMA11a">ECMA11a(p.S12.13/14, p.p.96ff)</a>]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ThrowStatement &lt;Yield&gt;:
    'throw' expression=Expression&lt;In=true,Yield&gt; Semi;

TryStatement &lt;Yield&gt;:
    'try' block=Block&lt;Yield&gt;
    ((catch=CatchBlock&lt;Yield&gt; finally=FinallyBlock&lt;Yield&gt;?) | finally=FinallyBlock&lt;Yield&gt;)
;

CatchBlock &lt;Yield&gt;: {CatchBlock} 'catch' '(' catchVariable=CatchVariable&lt;Yield&gt; ')' block=Block&lt;Yield&gt;;

CatchVariable &lt;Yield&gt;:
        =&gt;bindingPattern=BindingPattern&lt;Yield&gt;
    |   name=BindingIdentifier&lt;Yield&gt;
;

FinallyBlock &lt;Yield&gt;: {FinallyBlock} 'finally' block=Block&lt;Yield&gt;;</code></pre>
</div>
</div>
<div class="paragraph">
<p>There must be not type annotation for the catch variable, as this would
lead to the wrong assumption that a type can be specified.</p>
</div>
</div>
<div class="sect4">
<h5 id="throw-try-catch-type-inference"><a class="anchor" href="#throw-try-catch-type-inference"></a>Type Inference</h5>
<div class="paragraph">
<p>The type of the catch variable is always assumed to be .
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>c</mi><mi>a</mi><mi>t</mi><mi>c</mi><mi>h</mi><mi>B</mi><mi>l</mi><mi>o</mi><mi>c</mi><mi>k</mi><mo>.</mo><mi>c</mi><mi>a</mi><mi>t</mi><mi>c</mi><mi>h</mi><mi>V</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi><mi>:</mi><mrow><mi>a</mi><mi>n</mi><mi>y</mi></mrow></mrow><mrow/></math></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_debugger_statement"><a class="anchor" href="#_debugger_statement"></a>11.1.9. Debugger Statement</h4>
<div class="sect4">
<h5 id="debugger-statement-syntax"><a class="anchor" href="#debugger-statement-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>Cf. [<a href="#ECMA11a">ECMA11a(p.S12.15, p.p.97ff)</a>])</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>DebuggerStatement: {DebuggerStatement} 'debugger' Semi;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="debugger-statement--semantics"><a class="anchor" href="#debugger-statement--semantics"></a>Semantics</h5>
<div class="paragraph">
<p>na</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ecmascript_6_statements"><a class="anchor" href="#_ecmascript_6_statements"></a>11.2. ECMAScript 6 Statements</h3>
<div class="paragraph">
<p>N4JS export and import statements are similar to ES6 with some minor
differences which are elaborated on below.</p>
</div>
<div class="sect3">
<h4 id="_let"><a class="anchor" href="#_let"></a>11.2.1. Let</h4>
<div class="paragraph">
<p>Cf. [<a href="#ECMA11a">ECMA11a(p.13.2.1)</a>], also <a href="http://www.2ality.com/2015/02/es6-scoping.html">Rauschmayer,
2ality: <code>Variables and scoping in ECMAScript 6</code></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_const"><a class="anchor" href="#_const"></a>11.2.2. Const</h4>
<div class="paragraph">
<p>Cf. [<a href="#ECMA15a">ECMA15a(p.13.2.1)</a>], also <a href="http://www.2ality.com/2015/02/es6-scoping.html">Rauschmayer,
2ality: <code>Variables and scoping in ECMAScript 6</code></a></p>
</div>
<div class="paragraph">
<p>Additionally to the <code>var</code> statement, the <code>const</code> statement is supported. It allows for
declaring variables which must be assigned to a value in the declaration
and their value must not change. That is to say that constants are not
allowed to be on the left-hand side of other assignments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ConstStatement returns VariableStatement: 'const' varDecl+=ConstDeclaration ( ',' varDecl+=ConstDeclaration )* Semi;

ConstDeclaration returns VariableDeclaration: typeRef=TypeRef? name=IDENTIFIER const?='=' expression=AssignmentExpression;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="const-semantics"><a class="anchor" href="#const-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>A const variable statement is more or less a normal variable statement
(see <a href="#_variable_statement">Variable Statement</a>), except that all variables declared by that statement are not
writable (cf. <a href="#req:Write_Acccess">[req:Write_Acccess]</a>). This is similar to constant data
fields (cf. <a href="#Assignment_Modifiers">[Assignment_Modifiers]</a>).</p>
</div>
<div class="paragraph">
<p>All variable declarations of a const variable statement
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>S</mi><mi>t</mi><mi>m</mi><mi>t</mi></math> are not writeable: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>∀</mo><mi>v</mi><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mo>∈</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>S</mi><mi>t</mi><mi>m</mi><mi>t</mi><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi><mi>D</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>:</mi><mo>¬</mo><mi>v</mi><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mo>.</mo><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi></math></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_for_of_statement"><a class="anchor" href="#_for_of_statement"></a>11.2.3. for &#8230;&#8203; of statement</h4>
<div class="paragraph">
<p>ES6 introduced a new form of <code>for</code> statement: <code>for &#8230;&#8203; of</code> to iterate over the elements of an  <code>Iterable</code>, cf. <a href="#Iterable_Object_Type">[Iterable_Object_Type]</a>.</p>
</div>
<div class="sect4">
<h5 id="for-of-statement-syntax"><a class="anchor" href="#for-of-statement-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>See <a href="#_iteration_statements">Iteration Statements</a></p>
</div>
</div>
<div class="sect4">
<h5 id="for-of-statement-semantics"><a class="anchor" href="#for-of-statement-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>For a given <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi></math> the following conditions must hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The value provided after <code>of</code> in a <code>for &#8230;&#8203; of</code> statement must be a subtype of <code>Iterable&lt;?&gt;</code>.</p>
</li>
<li>
<p>Either a new loop variable must be declared or an rvalue must be
provided as init expression:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mo>.</mo><mi>v</mi><mi>a</mi><mi>r</mi><mi>D</mi><mi>e</mi><mi>c</mi><mi>l</mi><mo>≠</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi><mo>∨</mo><mfenced close=")" open="("><mrow><mi>f</mi><mo>.</mo><mi>i</mi><mi>n</mi><mi>i</mi><mi>t</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo>≠</mo><mi>n</mi><mi>u</mi><mi>l</mi><mi>l</mi><mo>∧</mo><mi>i</mi><mi>s</mi><mi>R</mi><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mfenced close=")" open="("><mrow><mi>f</mi><mo>.</mo><mi>i</mi><mi>n</mi><mi>i</mi><mi>t</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi></mrow></mfenced></mrow></mfenced></math></p>
</li>
<li>
<p>If a new variable <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>v</mi></math> is declared before <code>of</code> and it has a
declared type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>, the value provided after must be a
subtype of . If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>v</mi></math> does not have a declared type, the type
of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>v</mi></math> is inferred to the type of the first type argument of
the actual type of the value provided after .</p>
</li>
<li>
<p>If a previously-declared variable is referenced before with a
declared or inferred type of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>, the value provided after <code>of</code>
must be a subtype of <code>Iterable&lt;? extends T&gt;</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title"></div>
</td>
<td class="content">
<code>Iterable</code> is structurally typed on definition-site so non-N4JS types can
meet the above requirements by simply implementing the only method in
interface <code>Iterable</code> (with a correct return type).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title"></div>
</td>
<td class="content">
The first of the above constraints (the type required by the
’of’ part in a <code>for &#8230;&#8203; of</code> loop is <code>Iterable</code>) was changed during the definition of ECMAScript 6.
This is implemented differently in separate implementations and even
in different versions of the same implementation (for instance in
different versions of V8). Older implementations require an <code>Iterator</code> or accept
both <code>Iterator</code> an or <code>Iterable</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Requiring an <code>Iterable</code> and not accepting a plain <code>Iterator</code> seems to be the final decision (as of Dec. 2014). For reference, see abstract operations
<code>GetIterator</code> in [<a href="#ECMA15a">ECMA15a(p.S7.4.2)</a>] and "CheckIterable"
[<a href="#ECMA15a">ECMA15a(p.S7.4.1)</a>] and their application in "ForIn/OfExpressionEvaluation" [<a href="#ECMA15a">ECMA15a(p.S13.6.4.8)</a>] and <code>CheckIterable</code> and their application in
<code>ForIn/OfExpressionEvaluation</code> . See also a related blog
post
<sup class="footnote">[<a id="_footnoteref_49" class="footnote" href="#_footnote_49" title="View footnote.">49</a>]</sup> that is kept up
to date with changes to ECMAScript 6: <em>"ECMAScript 6 has a new loop,
for-of. That loop works with iterables. Before we can use it with
createArrayIterator(), we need to turn the result into an iterable"</em>.</p>
</div>
<div class="paragraph">
<p>An array or object destructuring pattern may be used left of the <code>of</code>.
This is used to destructure the elements of the <code>Iterable</code> on the right-hand side (not the <code>Iterable</code> itself). For detais, see <a href="#Destructuring">[Destructuring]</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_import_statement"><a class="anchor" href="#_import_statement"></a>11.2.4. Import Statement</h4>
<div class="paragraph">
<p>Cf. ES6 import [<a href="#ECMA15a">ECMA15a(p.15.2.2)</a>], see also <a href="https://babeljs.io/docs/usage/modules/" class="bare">https://babeljs.io/docs/usage/modules/</a></p>
</div>
<div class="sect4">
<h5 id="import-statement-syntax"><a class="anchor" href="#import-statement-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>The grammar of import declarations is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ImportDeclaration:
    {ImportDeclaration}
    ImportDeclarationImpl
;

fragment ImportDeclarationImpl*:
    'import' (
        ImportClause importFrom?='from'
    )? module=[types::TModule|ModuleSpecifier] Semi
;

fragment ImportClause*:
        importSpecifiers+=DefaultImportSpecifier (',' ImportSpecifiersExceptDefault)?
    |   ImportSpecifiersExceptDefault
;

fragment ImportSpecifiersExceptDefault*:
        importSpecifiers+=NamespaceImportSpecifier
    |   '{' (importSpecifiers+=NamedImportSpecifier (',' importSpecifiers+=NamedImportSpecifier)* ','?)? '}'
;

NamedImportSpecifier:
        importedElement=[types::TExportableElement|BindingIdentifier&lt;Yield=false&gt;]
    |   importedElement=[types::TExportableElement|IdentifierName] 'as' alias=BindingIdentifier&lt;Yield=false&gt;
;

DefaultImportSpecifier:
    importedElement=[types::TExportableElement|BindingIdentifier&lt;Yield=false&gt;]
;

NamespaceImportSpecifier: {NamespaceImportSpecifier} '*' 'as' alias=BindingIdentifier&lt;false&gt; (declaredDynamic?='+')?;

ModuleSpecifier: STRING;</code></pre>
</div>
</div>
<div class="paragraph">
<p>These are the properties of import declaration which can be specified by
the user:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>annotations</code> </dt>
<dd>
<p>Arbitrary annotations, see <a href="#_annotations">Annotations</a> and below for details.</p>
</dd>
<dt class="hdlist1"><code>importSpecifiers</code> </dt>
<dd>
<p>The elements to be imported with their names.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Also see compilation as described in <a href="#_modules">Modules</a>, for semantics see following
section.</p>
</div>
<div id="ex:Import" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>import A from "p/A"
import {C,D,E} from "p/E"
import * as F from "p/F"
import {A as G} from "p/G"
import {A as H, B as I} from "p/H"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="import-statement-semantics"><a class="anchor" href="#import-statement-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>Import statements are used to import identifiable elements from another
module. Identifiable elements are</p>
</div>
<div class="ulist">
<ul>
<li>
<p>types (via their type declaration), in particular</p>
<div class="ulist">
<ul>
<li>
<p>classifiers (classes, interfaces)</p>
</li>
<li>
<p>functions</p>
</li>
</ul>
</div>
</li>
<li>
<p>variables and constants. </p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-190" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-190</a>
</div>
</div>
<div class="paragraph">
<p>The module to import from is identified by the string literal following
keyword <code>from</code>. This string must be a valid</p>
</div>
<div class="ulist">
<ul>
<li>
<p>complete module specifier <sup class="footnote">[<a id="_footnoteref_50" class="footnote" href="#_footnote_50" title="View footnote.">50</a>]</sup>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>    import {A} from "ProjectA/a/b/c/M"</code></pre>
</div>
</div>
</li>
<li>
<p>plain module specifier:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>    import {A} from "a/b/c/M"</code></pre>
</div>
</div>
</li>
<li>
<p>or project name only, assuming the project defines a main module in
its manifest (using the <code>MainModule</code> manifest property, <a href="#Manifest_Properties">[Manifest_Properties]</a>):</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>    import {A} from "ProjectA"</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For choosing the element to import, there are the exact same options as
in ECMAScript6:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>named imports select one or more elements by name, optionally
introducing a local alias:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>    import {C} from "M"
    import {D as MyD} from "M"
    import {E, F as MyF, G, H} from "M"</code></pre>
</div>
</div>
</li>
<li>
<p>namespace imports select all elements of the remote module for import
and define a namespace name; the imported elements are then accessed via
the namespace name:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>    import * as N from "M"
    var c: N.C = new N.C();</code></pre>
</div>
</div>
</li>
<li>
<p>default imports select whatever element was exported by the remote
module as the default (there can be at most one default export per
module):</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>    import C from "M"</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following constraints are defined on a
(non-dynamic) import statement <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The imported module needs to be accessible from the current project.</p>
</li>
<li>
<p>The imported declarations need to be accessible from the current
module.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For named imports, the following constraints must hold:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No declaration must be imported multiple times, even if aliases are
used.</p>
</li>
<li>
<p>The names must be unique in the module. They must not conflict with
each other or locally declared variables, types, or functions.</p>
</li>
<li>
<p>Declarations imported via named imports are accessible only via used
name (or alias) and not via original name directly.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For wildcard imports, the following constraints must hold:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only one namespace import can be used per (target) module, even if
different namespace name is used.</p>
</li>
<li>
<p>The namespace name must be unique in the module. They must not
conflict with each other or locally declared variables, types, or
functions.</p>
</li>
<li>
<p>Declarations imported via namespace import are accessible via
namespace only and not with original name directly.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For namespace imports, the following constraints must hold:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the referenced module is a plain <code>js</code> file, a warning will be
created to use the dynamic import instead.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For default imports, the following constraints must hold: </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1744" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1744</a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The referenced module must have a default export.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Cross-cutting constraints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No declaration can be imported via named import and namespace import
at the same time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Imports cannot be duplicated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>import * as A from 'A';
import * as A from 'A';//error, duplicated import statement

import B from 'B';
import B from 'B';//error, duplicated import statement</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given element cannot be imported multiple times:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>import * as A1 from 'A';
import * as A2 from 'A';//error, elements from A already imported in A1

import B from 'B';
import B as B1 from 'B';//error, B/B is already imported as B

import C as C1 from 'C';
import C from 'C';//error, C/C is already imported as C1

import D as D1 from 'D';
import D as D2 from 'D';//error, D/D is already imported as D1

import * as NE from 'E';
import E from 'E';//error, E/E is already imported as NE.E

import F from 'F';
import * as NF from 'F';//error, F/F is already imported as F</code></pre>
</div>
</div>
<div class="paragraph">
<p>Names used in imports must not not conflict with each other or local
declarations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>import * as A from 'A1';
import * as A from 'A2';//A is already used as namespace for A1

import B from 'B1';
import B1 as B from 'B2';//B us already used as import B/B1

import C1 as C from 'C1';
import * as C from 'C2'; //C is already used as import C1/C1

import * as D from 'D1';
import D2 as D from 'D2';//D is already used as namespace for D1

import E from 'E';
var E: any; // conflict with named import E/E

import * as F from 'F';
var F: any; // conflict with namespace F</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using named imports, aliases and namespaces allows to refer to mulitple
types of the same name such as  <code>A/A</code>, <code>B/A</code> and <code>C/A</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>import A from 'A';// local name A referencess to A/A
import A as B from 'B';//local name B referencess to B/A
import * as C from 'C';//local name C.A referencess to C/A</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a declaration has been imported with an alias or namespace, it is not
accessible via its original name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>import * as B from 'A1';
import A2 as C from 'A2';

var a1_bad: A1;//error, A1/A1 is not directly accessible with original name
var a1_correct: B.A1;// A1/A1 is accessible via namespace B
var a2_bad: A2;//error, A2/A2 is not directly accessible with original name
var a2_correct: C;// A2/A2 is accessible via alias C</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_dynamic_imports"><a class="anchor" href="#_dynamic_imports"></a>Dynamic Imports</h5>
<div class="paragraph">
<p>N4JS extends the ES6 module import in order that modules without a
<code>n4jsd</code> or <code>n4js</code> file (plain <code>js</code> modules) can be imported. This is
done by adding <code>+</code> to the name of the named import.</p>
</div>
<div class="paragraph">
<p>136Dynamic Import</p>
</div>
<div class="paragraph">
<p>Let <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math> be an import
statement <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math> with a dynamic namespace specifier. The
following constraints must hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mo>.</mo><mi>m</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>l</mi><mi>e</mi></math> must not reference an <code>n4js</code> file.</p>
</li>
<li>
<p>If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mo>.</mo><mi>m</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>l</mi><mi>e</mi></math> references an <code>n4jsd</code> file, a warning is
to be created.</p>
</li>
<li>
<p>If the file referenced by <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mo>.</mo><mi>m</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>l</mi><mi>e</mi></math> is not found, an
error is created just as in the static case.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>These constraints define the error level when using dynamic import: we
receive no error for <code>js</code>, a warning for <code>n4jsd</code>, and an error for
<code>n4js</code> files. The idea behind these distinct error levels is as follows:
If only a plain <code>js</code> file is available, using the dynamic import is the
only way to access elements from the <code>js</code> module. This might be an
unsafe way, but it allows the access and simplifies the first steps. An
<code>n4jsd</code> file may then be made available either by the developer using
the <code>js</code> module or by a third-party library. In this case, we do not
want to break existing code. There is only a warning created in the case
of an available <code>n4jsd</code> file and a <code>js</code> file still must be provided by
the user. Having an <code>n4js</code> file is a completely different story; no
<code>n4jsd</code> file is required, no <code>js</code> file is needed (since the transpiler
creates one from the <code>n4js</code> file) and there is absolutely no reason to
use the module dynamically.</p>
</div>
</div>
<div class="sect4">
<h5 id="_immutabilaty_of_imports"><a class="anchor" href="#_immutabilaty_of_imports"></a>Immutabilaty of Imports</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/119" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-119</a>
</div>
</div>
<div class="paragraph">
<p>Imports create always immutable bindings, c.f.
[<a href="#ECMA15a">ECMA15a(p.8.1.1.5)</a>]
<a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-createimportbinding" class="bare">http://www.ecma-international.org/ecma-262/6.0/index.html#sec-createimportbinding</a></p>
</div>
<div class="paragraph">
<p>137Immutable Import[req:Immutable Import] Let <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math> be a
binding to an imported element. It is an error if</p>
</div>
<div class="ulist">
<ul>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math> occurs on the left-hand side as the assignment-target
of an assignment expression (this also includes any level in a
destructuring pattern on the left-hand side),</p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math> as a direct argument of a postfix operator (/),</p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math> as a direct argument of a operator,</p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math> as a direct argument of the <code>increment</code> or
<code>decrement</code> unary operator (/)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_export_statement"><a class="anchor" href="#_export_statement"></a>11.2.5. Export Statement</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1302" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1302</a>
</div>
</div>
<div class="paragraph">
<p>Cf. ES6 import [<a href="#ECMA15a">ECMA15a(p.15.2.3)</a>]</p>
</div>
<div class="sect4">
<h5 id="export-statement-syntax"><a class="anchor" href="#export-statement-syntax"></a>Syntax</h5>
<div class="paragraph">
<p>Grammar of export declarations is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ExportDeclaration:
    {ExportDeclaration}
    ExportDeclarationImpl
;

fragment ExportDeclarationImpl*:
    'export' (
        wildcardExport?='*' ExportFromClause Semi
    |   ExportClause -&gt;ExportFromClause? Semi
    |   exportedElement=ExportableElement
    |   defaultExport?='default' (-&gt;exportedElement=ExportableElement | defaultExportedExpression=AssignmentExpression&lt;In=true,Yield=false&gt; Semi)
    )
;

fragment ExportFromClause*:
    'from' reexportedFrom=[types::TModule|ModuleSpecifier]
;

fragment ExportClause*:
    '{'
        (namedExports+=ExportSpecifier (',' namedExports+=ExportSpecifier)* ','?)?
    '}'
;

ExportSpecifier:
    element=IdentifierRef&lt;Yield=false&gt; ('as' alias=IdentifierName)?
;

ExportableElement:
      N4ClassDeclaration&lt;Yield=false&gt;
    | N4InterfaceDeclaration&lt;Yield=false&gt;
    | N4EnumDeclaration&lt;Yield=false&gt;
    | ExportedFunctionDeclaration&lt;Yield=false&gt;
    | ExportedVariableStatement
;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This are the properties of export declaration, which can be specified by
the user:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>exportedElement</code> </dt>
<dd>
<p>The element to be exported, can be a declaration or a variable/const
statement.</p>
</dd>
</dl>
</div>
<div id="ex:Export" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>export public class A{}
export interface B{}
export function foo() {}
export var a;
export const c="Hello";</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="export-statement-semantics"><a class="anchor" href="#export-statement-semantics"></a>Semantics</h5>
<div class="paragraph">
<p>With regard to type inference, export statements are not handled at all.
Only the exported element is inferred and the <code>export</code> keyword is ignored.</p>
</div>
<div class="paragraph">
<p>In order to use types defined in other compilation units, these types
have to be explicitly imported with an import statement.</p>
</div>
<div class="paragraph">
<p>Imported namespaces cannot be exported.</p>
</div>
<div class="paragraph">
<p>Declared elements (types, variables, functions) are usually only visible
outside the declaring module if the elements are exported and imported
(by the using module, cf. <a href="#Import_Statement">[Import_Statement]</a>&gt;&gt;).</p>
</div>
<div class="paragraph">
<p>Some special components (runtime environment and libraries, cf. <a href="#Runtime_Environment_Libraries">[Runtime_Environment_Libraries]</a>, may export elements globally. This is done by annotating the export (or the
whole module) with <code>@Global</code>, see <a href="#Global_Definitions">[Global_Definitions]</a> for details.</p>
</div>
<div class="paragraph">
<p>By adding <code>default</code> after the keyword <code>export</code>, the identifiable element can be exported as ’the default’. This can then be imported from other modules via
default imports (see <a href="#Import_Statement">[Import_Statement]</a>).</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_annotations"><a class="anchor" href="#_annotations"></a>12. Annotations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>  </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-139" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-139</a>
<a href="https://jira.numberfour.eu/browse/IDE-260" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-260</a>
<a href="https://jira.numberfour.eu/browse/IDE-272" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-272</a>
</div>
</div>
<div class="sect2">
<h3 id="_introduction_2"><a class="anchor" href="#_introduction_2"></a>12.1. Introduction</h3>
<div class="paragraph">
<p>Annotations are used to further define meta properties of language
elements such as types, variables and functions. These annotations are
used by the compiler and validator to prohibit the developer from
introducing constructs which are either not allowed or are unnecessary
in certain contexts.</p>
</div>
<div class="paragraph">
<p>Since annotations are to be processed by the compiler and the
compilation cannot be extended by third-party users for security
reasons, annotations cannot be defined by developers. Instead, the
compiler comes with a predefined set of annotations which are summarized
here.</p>
</div>
<div class="sect3">
<h4 id="_syntax_12"><a class="anchor" href="#_syntax_12"></a>12.1.1. Syntax</h4>
<div class="paragraph">
<p>Annotations are used similarly as in Java (although new annotations
cannot be defined by the user). They are formally defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">Annotation:'@' AnnotationNoAtSign;
ScriptAnnotation returns Annotation: '@@' AnnotationNoAtSign;

AnnotationNoAtSign returns Annotation:
    name=AnnotationName (=&gt; '(' (args+=AnnotationArgument (',' args+=AnnotationArgument)*)? ')')?;

AnnotationArgument:
    LiteralAnnotationArgument | TypeRefAnnotationArgument
;

LiteralAnnotationArgument:
    literal=Literal
;

TypeRefAnnotationArgument:
    typeRef=TypeRef
;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_properties_7"><a class="anchor" href="#_properties_7"></a>12.1.2. Properties</h4>
<div class="paragraph">
<p>We use the map notation for retrieving annotation properties and values
from a list of annotations, for example
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>.</mo><mi>a</mi><mi>n</mi><mi>n</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>s</mi><mrow><mo>[</mo><mi>R</mi><mi>e</mi><mi>q</mi><mi>u</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>d</mi></mrow></math>$], or shorter
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mi>@</mi><mi>R</mi><mi>e</mi><mi>q</mi><mi>u</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>d</mi></math>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_element_specific_annotations"><a class="anchor" href="#_element_specific_annotations"></a>12.1.3. Element-Specific Annotations</h4>
<div class="paragraph">
<p>The following annotations are element-specific and are explained in the
corresponding sections:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-center valign-top">Element Types</th>
<th class="tableblock halign-left valign-top">Section</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Internal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TypeDefiningElement, Member, Function, Export</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Access_Control">[Access_Control]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Undefined</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Variable</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Undefined_Type">[Undefined_Type]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@StringBased</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Enum</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#String_Based_Enums">[String_Based_Enums]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Final</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Class, Member</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Final_Methods">[Final_Methods]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Spec</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FPar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Spec_Construtor">[Spec_Construtor]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Override</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Method</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Redefinition_of_Members">[Redefinition_of_Members]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Promisifiable</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Function</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Promisifiable_Functions">[Promisifiable_Functions]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Promisify</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CallExpression</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Promisifiable_Functions">[Promisifiable_Functions]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@This</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Function</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#This_keyword">[This_keyword]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@N4JS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Class, Export Statement</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#External_Declarations">[External_Declarations]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@IgnoreImplementation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Script, ExportDeclaration, ExportableElement</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#External_Declarations">[External_Declarations]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Global</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>External Declaration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Global_Definitions">[Global_Definitions]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@ProvidedByRuntime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>External Declaration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Runtime_Definitions">[Runtime_Definitions]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@TestAPI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TypeDefiningElement, Member</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Test_Support">[Test_Support]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Polyfill</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Class</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Polyfill_Definitions">[Polyfill_Definitions]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@StaticPolyfill</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Class</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Static_Polyfill_Definitions">[Static_Polyfill_Definitions]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@StaticPolyfillAware</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Script</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Static_Polyfill_Definitions">[Static_Polyfill_Definitions]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@StaticPolyfillModule</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Script</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Static_Polyfill_Definitions">[Static_Polyfill_Definitions]</a></p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>intended for internal use only; will be removed.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_general_annotations"><a class="anchor" href="#_general_annotations"></a>12.1.4. General Annotations</h4>
<div class="sect4">
<h5 id="_idebug"><a class="anchor" href="#_idebug"></a>IDEBUG</h5>
<div class="paragraph">
<p><code>IDEBUG</code> is an annotation similar to Java’s <code>@SuppressWarnings</code>. It changes the severity of an issue
from an error to a warning so that code can be compiled regardless of
validation errors. This is to be used for known IDE bugs only.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="idebug-syntax"><a class="anchor" href="#idebug-syntax"></a>12.1.5. Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>'@IDEBUG' '(' bugID = INT ',' errorMessage=STRING ')'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotation is defined transitively and repeatable on script, type
declaration, function and method level.</p>
</div>
<div class="sect4">
<h5 id="_semantics_10"><a class="anchor" href="#_semantics_10"></a>Semantics</h5>
<div class="paragraph">
<p>This annotation will cause errors issued in the scope of the annotation
(in the defined script, type, or method) to be transformed to warnings
if their message text is similar to the <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mi>r</mi><mi>r</mi><mi>o</mi><mi>r</mi><mi>M</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>a</mi><mi>g</mi><mi>e</mi></math> text.
If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mi>r</mi><mi>r</mi><mi>o</mi><mi>r</mi><mi>M</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>a</mi><mi>g</mi><mi>e</mi></math> ends with <code>…</code> (three dots as a single
character, created by Eclipse to abbreviate messages), then the error’s
message text must start with the specified text.</p>
</div>
<div class="paragraph">
<p>If no matching error is found, the annotation itself will issue an
error.</p>
</div>
<div class="paragraph">
<p>[IDEBUG][ex:IDEBUG] In the following code snippet, two errors are to be
transformed to warnings.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>export class TestDataBridge with IModuleTest {
    @IDEBUG(166, "{function(number):void} is not a subtype of {function(T):void}.")
    @IDEBUG(91, "Incorrect number of arguments: expected 1, got 2.")
    @Override public run(): void {
        var foo = new Foo(),
            cb = function(val: number): void {},
            db = DataBridge.&lt;number&gt;bind(foo, "bar");
        db.add(cb);
        Assert.isTrue(called);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first one would occur on line 8, since there is a bug in the IDE
type system (as of writing this example) that type arguments are not
correctly bound in case of function expressions used as callback
methods. The annotation in line 2 transforms the error</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>{function(number):void} is not a subtype of {function(T):void}.</code></pre>
</div>
</div>
<div class="paragraph">
<p>into a warning with the following text:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>IDEBUG-166: {function(number):void} is not a subtype of {function(T):void}.</code></pre>
</div>
</div>
<div class="paragraph">
<p>refers to the corresponding bug report, that is .</p>
</div>
<div class="paragraph">
<p>The annotation on line 3 was proposed as a workaround for <code>IDEBUG-91</code> which has
been fixed. <sup class="footnote">[<a id="_footnoteref_51" class="footnote" href="#_footnote_51" title="View footnote.">51</a>]</sup>. No error message is produced and an error will be issued on line 3 instead:</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/166" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-166</a>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>No matching error found, apparently bug IDEBUG-91 has been fixed or does not occur here.</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_suppress_warnings"><a class="anchor" href="#_suppress_warnings"></a>Suppress Warnings</h5>

</div>
</div>
</div>
<div class="sect2">
<h3 id="_declaration_of_annotations"><a class="anchor" href="#_declaration_of_annotations"></a>12.2. Declaration of Annotations</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_extended_fetaures"><a class="anchor" href="#_extended_fetaures"></a>13. Extended Fetaures</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_array_and_object_destructuring"><a class="anchor" href="#_array_and_object_destructuring"></a>13.1. Array and Object Destructuring</h3>
<div class="paragraph">
<p>N4JS supports array and object destructuring as provided in ES6. This is
used to conveniently assign selected elements of an array or object to a
number of newly-declared or pre-existing variables or to further
destructure them by using nested destructuring
patterns.</p>
</div>
<div class="paragraph">
<p><sup class="footnote">[<a id="_footnoteref_52" class="footnote" href="#_footnote_52" title="View footnote.">52</a>]</sup>,  Verification [<a href="#Zhu13a">Zhu13a</a>; <a href="#Hudli13a">Hudli13a</a>],  Frameworks [<a href="#Lesiecki08a">Lesiecki08a</a>; <a href="#Betts13a">Betts13a</a>; <a href="#Knol13a">Knol13a</a>; <a href="#Dagger">Dagger</a>] , Verification ,
Frameworks ]</p>
</div>
<div class="sect3">
<h4 id="_syntax_13"><a class="anchor" href="#_syntax_13"></a>13.1.1. Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">BindingPattern &lt;Yield&gt;:
    ObjectBindingPattern&lt;Yield&gt;
    | ArrayBindingPattern&lt;Yield&gt;
;

ObjectBindingPattern &lt;Yield&gt; returns BindingPattern:
    {BindingPattern}
    '{' (properties+=BindingProperty&lt;Yield,AllowType=false&gt; (',' properties+=BindingProperty&lt;Yield,AllowType=false&gt;)*)? '}'
;

ArrayBindingPattern &lt;Yield&gt; returns BindingPattern:
    {BindingPattern}
    '['
        elements+=Elision* (
            elements+=BindingRestElement&lt;Yield&gt;
            (',' elements+=Elision* elements+=BindingRestElement&lt;Yield&gt;)*
            (',' elements+=Elision*)?
        )?
    ']'
;

BindingProperty &lt;Yield, AllowType&gt;:
      =&gt;(LiteralBindingPropertyName&lt;Yield&gt; ':') value=BindingElement&lt;Yield&gt;
    | value=SingleNameBinding&lt;Yield,AllowType&gt;
;

fragment LiteralBindingPropertyName &lt;Yield&gt;*:
    declaredName=IdentifierName | declaredName=STRING | declaredName=NumericLiteralAsString
    // this is added here due to special treatment for a known set of expressions
    | '[' (declaredName=SymbolLiteralComputedName&lt;Yield&gt; | declaredName=STRING) ']'
;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_semantics_11"><a class="anchor" href="#_semantics_11"></a>13.1.2. Semantics</h4>
<div class="paragraph">
<p>The following example declares four variables <code>a</code>, <code>b</code>, <code>x</code>, and <code>prop2</code>. Variables <code>a</code> and <code>x</code> will have the value <code>hello</code>, whereas <code>b</code> and <code>prop2</code> will have value 42.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var [a,b] = ["hello", 42];

var {prop1:x, prop2} = {prop1:"hello", prop2:42};</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the case of <code>prop2</code>, we do not provide a property name and variable name
separately; this is useful in cases where the property name also makes
for a suitable variable name (called <code>single name binding</code>).</p>
</div>
<div class="paragraph">
<p>One of the most useful use cases of destructuring is in a <code>for..of</code> loop. Take
this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var arr1 = [ ["hello",1,2,3], ["goodbye",4,5,6] ];
for(var [head,...tail] of arr1) {
    console.log(head,'/',tail);
}
// will print:
//   hello / [ 1, 2, 3 ]
//   goodbye / [ 4, 5, 6 ]

var arr2 = [ {key:"hello", value:42}, {key:"goodbye", value:43} ];
for(var {key,value} of arr2) {
    console.log(key,'/',value);
}
// will print:
//   hello / 42
//   goodbye / 43</code></pre>
</div>
</div>
<div class="paragraph">
<p>Array and object destructuring pattern can appear in many different
places:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In a variable declaration (not just in variable statements but also in
other places where variable declarations are allowed, e.g. plain for
loops; called <em>destructuring binding</em>; see <a href="#Var_Statement">[Var_Statement]</a>).</p>
</li>
<li>
<p>On the left-hand side of an assignment expression (the assignment
expression is then called <em>destructuring assignment</em>; see <a href="#Assignment_Expression">[Assignment_Expression]</a>).</p>
</li>
<li>
<p>In a <code>for..in</code> or <code>for..of</code> loop on the left side of the <code>in</code>/<code>of</code> (see <a href="#for_of_statement">[for_of_statement]</a>).<br>
NOTE: It can also be used in plain statements, but then we actually have
one of the above two use cases.</p>
</li>
<li>
<p>With lists of formal parameters or function arguments (NOT SUPPORTED
YET) .</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1609" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1609</a>
</div>
</div>
<div class="paragraph">
<p>For further details on array and object destructuring please refer to
the ECMAScript 6 specification.</p>
</div>
<div class="paragraph">
<p>Type annotations can only be added when a new variable name is
introduced since the short version would be ambiguous with the long one.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var {x: someTypeOrNewVar} = ol</code></pre>
</div>
</div>
<div class="paragraph">
<p>could either mean that a new variable is declared and is assigned to it,
or that a new variable is declared with type . The longer form would
look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var {x: x: someType} = ol</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can make this more readable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var {propOfOl: newVar: typeOfNewVar} = ol</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dependency_injection"><a class="anchor" href="#_dependency_injection"></a>13.2. Dependency Injection</h3>
<div class="paragraph">
<p>This chapter describes <a href="#AC">DI</a> mechanisms for N4JS. This includes compiler,
validation and language extensions that allow to achieve <a href="#AC">DI</a> mechanisms
built in into the N4JS language and IDE.</p>
</div>
<div class="paragraph">
<p>N4JS <a href="#AC">DI</a> support specifies a means for obtaining objects in such a way as to
maximize reusability, testability and maintainability, especially
compared to traditional approaches such as constructors, factories and
service locators. While this can be achieved manually (without tooling
support) it is difficult for nontrivial applications. The solutions that <a href="#AC">DI</a>
provides should empower N4JS users to achieve the above goals without
the burden of maintaining so-called ’boilerplate’ code.</p>
</div>
<div class="paragraph">
<p>image::fig/diTerms.PNG[[fig:diTerms] key: pass the dependency instead of
letting the client create or find it]</p>
</div>
<div class="paragraph">
<p>Core terms</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Service</strong> - A set of APIs describing the functionality of the service.</p>
</li>
<li>
<p><strong>Service Implementation</strong>s - One or more implementations of given
service API.</p>
</li>
<li>
<p><strong>Client</strong> - Consumer of a given functionality, uses the given <strong>Service
Implementation</strong>.</p>
</li>
<li>
<p><strong>Injector</strong> - Object providing <strong>Service Implementation</strong> of a specific
<strong>Service</strong>, according to configuration.</p>
</li>
<li>
<p><strong>Binding</strong> - Part of configuration describing which interface
implementing a subtype will be injected, when a given interface is
requested.</p>
</li>
<li>
<p><strong>Provider</strong> - Factory used to create instances of a given <strong>Service
Implementation</strong> or its sub-components, can be a method.</p>
</li>
<li>
<p><strong>Injection Point</strong> - Part of the user’s code that will have the given
dependency injected. This is usually fields, method parameters,
constructor parameters etc.</p>
</li>
<li>
<p><strong>di configuration</strong> - This describes which elements of the user’s code
are used in mechanisms and how they are wired. It is derived from user
code elements being marked with appropriate annotations, bindings and
providers.</p>
</li>
<li>
<p><strong>di wiring</strong> - The code responsible for creating user objects. These
are injectors, type factories/providers, fields initiators etc.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_di_components_and_injectors"><a class="anchor" href="#_di_components_and_injectors"></a>13.2.1. DI Components and Injectors</h4>
<div class="paragraph">
<p>N4JS’ <a href="#AC">DI</a> systems is based on the notion of .</p>
</div>
<div class="paragraph">
<p>[DI Component][def:DI_Component] A is a N4Class annotated with<br>
.</p>
</div>
<div class="paragraph">
<p>This annotation causes an <em>injector</em> to be created for (and associated
to) the <a href="#AC">DI</a>. can be composed; meaning that when requested to inject an
instance of a type, a <a href="#AC">DIC</a>’s injector can delegate this request to the
injector of the containing <a href="#AC">DIC</a>. An injector always prioritizes its own
configuration before delegating to the container’s injector. For
validation purposes, a child <a href="#AC">DI</a> can be annotated with <code>@WithParent</code> to ensure that it is
always used with a proper parent.</p>
</div>
<div class="paragraph">
<p><em>Injector</em> is the main object of <a href="#AC">DI</a> mechanisms responsible for creating
object graphs of the application. At runtime, injectors are instances of
<code>N4Injector</code>.</p>
</div>
<div class="paragraph">
<p>The following constraints must hold for a class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> marked as <a href="#AC">DIC</a>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A subclass <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> is a <a href="#DIC">[DIC]</a> as well and it
must be marked with <code>GenerateInjector</code> .</p>
</li>
<li>
<p>If a parent <a href="#_dicomponent_relations">DIC</a> <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi></math> is specified via <code>WithParent</code>, then <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi></math> must be a \ac{DIC} as well.</p>
</li>
<li>
<p>The injector associated to a \ac{DIC} is of type <code>N4Injector</code>. It can be retrieved via <code>N4Injector.of(DIC)</code> in which <code>DIC</code> is the <code>DIC</code>.</p>
</li>
<li>
<p>Injectors associated to \ac{DIC} a are DI-singletons (cf. <a href="#_singleton_scope">Singleton Scope</a>).
Two calls to <code>N4Injector.of(DIC)</code> are different (as different \acp{DIC} are assumed).</p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1563" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1563</a>
</div>
</div>
<div class="paragraph">
<p>
We call the (transitive)
creation and setting of values by an injector <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math> caused by
the creation of an root object <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi></math> the <em>injection phase</em>.
If an instance <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> is newly created by the injector
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math> (regardless of the injection point being used), the
injection is transitively applied on <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>. The following
constraints have to hold:</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1497" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1497</a>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Root objects are created by one of the following mechanisms:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Any class or interface can be created as root objects via an
injector associated to a \ac{DIC}: <code>var x: X = N4Injector.of(DIC).create(X);</code>
in which <code>DIC</code> is a <code>ac{DIC}</code>. Of course, an appropriate binding must
exist. <sup class="footnote">[<a id="_footnoteref_53" class="footnote" href="#_footnote_53" title="View footnote.">53</a>]</sup></p>
</li>
<li>
<p>If a type has the injector being injected, e.g. via field injection
<code>@Inject injector: N4Injector;</code>, then this injector can be used anytime in the control flow to create a new root object similar as above (using <code>create</code> method).</p>
</li>
<li>
<p>If a provider has been injected (i.e., an instance of <code>N4Provider}</code>), then its
method can be used to create a root object causing a new injection phase
to take place.</p>
</li>
</ol>
</div>
</li>
<li>
<p>If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi><mo>.</mo><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></math> is marked as injection point, all its
arguments are set by the injector. This is also true for an inherited
constructor marked as an injection point. See <a href="#req:Constructor_Injection">[req:Constructor_Injection]</a> . For all arguments the injection phase constraints have to hold as well.
\item All fields of $C$, including \emph{inherited} once, marked as injection points are set by the injector. For all fields the injection phase constraints have to hold as well.
 </p>
</li>
<li>
<p>All fields of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math>, including <em>inherited</em> once, marked as
injection points are set by the injector. For all fields the injection
phase constraints have to hold as well.</p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1264" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1264</a>
<a href="https://jira.numberfour.eu/browse/IDE-1264" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1264</a>
<a href="https://github.com/NumberFour/N4JS/issues/441" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-441</a>
</div>
</div>
<div class="paragraph">
<p>The injector may use a provider method (of a binder) to create nested
instances.</p>
</div>
<div class="paragraph">
<p>The injector is configured with <em>Binders</em> and it tracks <em>Bindings</em>
between types (). An N4JS developer normally would not interact with
this object directly except when defining an entry-point to his
application. <em>Injector</em>s are configured with <em>Binder</em>s which contain
explicit <em>Binding</em>s defined by an N4JS developer. A set of these
combined with <em>implicit bindings</em> creates the <em>di configuration</em> used by
a given injector. To configure given <em>Injector</em>s with given
<em>Binder</em>(s) use <code>@UseBinder</code> annotation.</p>
</div>
<div class="sect4">
<h5 id="_dicomponent_relations"><a class="anchor" href="#_dicomponent_relations"></a>DIComponent Relations</h5>
<div class="paragraph">
<p>A Parent-Child relation can be established between two DIComponents.
Child DIComponents use the parent bindings but can also be configured
with their own bindings or <em>change</em> targets used by a parent. The final
circumstance is local to the child and is referred to as <em>rebinding</em>.
For more information about bindings see . A Child-Parent relation is
expressed by the annotation attached to a given DIComponent. When this
relation is defined between DIComponents, the user needs to take care to
preserve the proper relation between injectors. In other words, the user
must provide an instance of the parent injector (the injector of the
DIComponent passes as a parameter to <code>@WithParentInjector</code>) when creating the child injector
(injector of the DIComponent annotated with <code>@WithParentInjector</code>).</p>
</div>
<div class="paragraph">
<p>[[ex:Simple DIComponents Relation]]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">@GenerateInjector
class ParentDIComponent{}

@GenerateInjector
@WithParentInjector(ParentDIComponent)
class ChildDIComponent{}

var parentInejctor = N4Inejctor.of(ParentDiCompoennt);
var childInjector = N4Inejctor.of(ChildDIComponent, parentInjector);</code></pre>
</div>
</div>
<div class="paragraph">
<p>With complex DIComponent structures, injector instances can be created
with a directly-declared parent and also with any of its children. This
is due to the fact that any child can rebind types, add new bindings,
but not remove them. Any child is, therefore, <em>compatible</em> with its
parents.</p>
</div>
<div class="openblock definition">
<div class="content">
<div class="paragraph">
<p><strong>Definition:</strong> <a href="#compatible_dicomponent">Compatible DIComponent</a></p>
</div>
<div class="paragraph">
<p>A given DIComponent
is compatible with another DIComponent if it has bindings for all keys
in other component bindings.<br>
<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∃</mo><mi>D</mi><mi>I</mi><mi>C</mi><mn>1</mn><mo>,</mo><mi>D</mi><mi>I</mi><mi>C</mi><mn>2</mn><mi>:</mi><mi>D</mi><mi>I</mi><mi>C</mi><mn>1.</mn><mrow><mi>b</mi><mi>i</mi><mi>n</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow><mo>.</mo><mrow><mi>k</mi><mi>e</mi><mi>y</mi></mrow><mi>D</mi><mi>I</mi><mi>C</mi><mn>2.</mn><mrow><mi>b</mi><mi>i</mi><mi>n</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow><mo>.</mo><mrow><mi>k</mi><mi>e</mi><mi>y</mi></mrow><mi>D</mi><mi>I</mi><mi>C</mi><mn>2</mn><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>D</mi><mi>I</mi><mi>C</mi><mn>1</mn></math></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title"></div>
</td>
<td class="content">
Although subtype notation <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi></math> is used here it does <strong>not</strong> imply actual subtype relations. It was used in this instance for of lack of formal notations for DI concepts and because this is similar to the Liskov Substitution principle.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A complex Child-Parent relation between components is depicted in <a href="#fig:diagDICParentChild">Complex DIComponents Relations</a> and <a href="#ex:Complex_DIComponents_Relations">[ex:Complex_DIComponents_Relations]</a>.</p>
</div>
</div>
</div>
<div id="fig:diagDICParentChild" class="imageblock">
<div class="content">
<img src="fig/diagDICParentChild.png" alt="diagDICParentChild">
</div>
<div class="title">Figure 4. Complex DIComponents Relations</div>
</div>
<div class="paragraph">
<p>Complex DIComponents Relations</p>
</div>
<div id="ex:Complex_DIComponents_Relations" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">@GenerateInjector class A {}
@GenerateInjector @WithParentInjector(A) class B {}
@GenerateInjector @WithParentInjector(B) class C {}
@GenerateInjector @WithParentInjector(C) class D {}
@GenerateInjector @WithParentInjector(A) class B2 {}
@GenerateInjector @WithParentInjector(B2) class C2 {}
@GenerateInjector @WithParentInjector(C2) class D2 {}
@GenerateInjector @WithParentInjector(A) class X {}
@GenerateInjector @WithParentInjector(C) class Y {}

// creating injectors
var injectorA = N4Injector.of(A);
//following throws DIConfigurationError, expected parent is not provided
//var injectorB =  N4Injector.of(B);
//correct declarations
var injectorB =  N4Injector.of(B, injectorA);
var injectorC = N4Injector.of(C, injectorB);
var injectorD = N4Injector.of(D, injectorC);
var injectorB2 = N4Injector.of(B2, injectorA);
var injectorC2 = N4Injector.of(C2, injectorB2);
var injectorD2 = N4Injector.of(D2, injectorC2);

//Any injector of {A,B,C,D,b2,C2,D2} s valid parent for injector of X, e.g. D or D2
N4Injector.of(X, injectorD);//is ok as compatible parent is provided
N4Injector.of(X, injectorD2);//is ok as compatible parent is provided

N4Injector.of(Y, injectorC);//is ok as direct parent is provided
N4Injector.of(Y, injectorD);//is ok as compatible parent is provided

N4Injector.of(Y, injectorB2);//throws DIConfigurationError, incompatible parent is provided
N4Injector.of(Y, injectorC2);//throws DIConfigurationError, incompatible parent is provided
N4Injector.of(Y, injectorD2);//throws DIConfigurationError, incompatible parent is provided</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_binders_and_bindings"><a class="anchor" href="#_binders_and_bindings"></a>13.2.2. Binders and Bindings</h4>
<div class="paragraph">
<p><em>Binder</em> allows an N4JS developer to (explicitly) define a set of
<em>Binding</em>s that will be used by an <em>Injector</em> configured with a given
<em>Binder</em>. There are two ways for <em>Binder</em> to define <em>Binding</em>s: <code>@Bind</code> (<a href="#_n4js_di_bind">N4JS DI @Bind</a>)
annotations and a method annotated with <code>@Provides</code>.</p>
</div>
<div class="paragraph">
<p><em>Binder</em> is declared by annotating a class with the annotation.</p>
</div>
<div class="paragraph">
<p>A <em>Binding</em> is part of a configuration that defines which instance of
what type should be injected into an <em>injection point</em> (<a href="#N4JS_DI_Injection_Points">[N4JS_DI_Injection_Points]</a>) with an expected type.</p>
</div>
<div class="paragraph">
<p><em>Provider Method</em> is essentially a <em>factory method</em> that is used to
create an instance of a type. N4JS allows a developer to declare those
methods (see <a href="#N4JS_DI_@Provides">[N4JS_DI_@Provides]</a>) which gives them a hook in instance creation process.
Those methods will be used when creating instances by the <em>Injector</em>
configured with the corresponding <em>Binder</em>. A provider method is a
special kind of binding (<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi><mi>e</mi><mi>y</mi></math>) in which the return type of
the method is the <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi><mi>e</mi><mi>y</mi></math>. The <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></math> type is
unknown at compile time (although it may be inferred by examining the
return statements of the provide method).</p>
</div>
<div class="paragraph">
<p>A <em>binding</em> is a pair
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>b</mi><mi>i</mi><mi>n</mi><mi>d</mi><mfenced close=")" open="("><mrow><mi>k</mi><mi>e</mi><mi>y</mi></mrow><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></mfenced></math>. It defines that for a dependency with a
given key which usually is the expected type at the injection point. An
instance of type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></math> is injected.</p>
</div>
<div class="paragraph">
<p>A <em>binding</em> is called <em>explicit</em> if it is declared in the code, i.e. via <code>@Bind</code>
annotation or <code>@Provides</code> annotation).</p>
</div>
<div class="paragraph">
<p>A <em>binding</em> is called <em>implicit</em> if it is not declared. An implicit
binding can only be used if the <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi><mi>e</mi><mi>y</mi></math> is a class and derived
from the type at the injection point, i.e. the type of the field or
parameter to be injected. In that case, the <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></math> equals
the <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi><mi>e</mi><mi>y</mi></math>. </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/484" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-484</a>
</div>
</div>
<div class="paragraph">
<p>A provider method <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math> (in the binder) defines a binding
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>b</mi><mi>i</mi><mi>n</mi><mi>d</mi><mfenced close=")" open="("><mrow><mi>M</mi><mo>.</mo><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi></mrow><mi>X</mi></mfenced></math> (in which <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math> is an
existential type with
<math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∃</mo><mi>X</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>.</mo><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi></math>).</p>
</div>
<div class="paragraph">
<p>For simplification, we define<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi><mi>e</mi><mi>y</mi><mo>*</mo><mo>=</mo><mfenced close="" open="{"><mtable><mtr><mtd><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>.</mo><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>,</mo></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>i</mi><mi>f</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mi>i</mi><mi>s</mi><mi>p</mi><mi>r</mi><mi>o</mi><mi>v</mi><mi>i</mi><mi>d</mi><mi>e</mi><mi>r</mi><mi>m</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi></mrow></mtd></mtr><mtr><mtd><mi>k</mi><mi>e</mi><mi>y</mi><mo>,</mo></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>w</mi><mi>i</mi><mi>s</mi><mi>e</mi><mfenced close=")" open="("><mrow><mi>k</mi><mi>e</mi><mi>y</mi><mi>i</mi><mi>s</mi><mi>a</mi><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>f</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>c</mi><mi>e</mi></mrow></mfenced></mrow></mtd></mtr></mtable></mfenced></math><br>
and<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>*</mo><mo>=</mo><mfenced close="" open="{"><mtable><mtr><mtd><mi>X</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>.</mo><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mi>T</mi><mi>y</mi><mi>p</mi><mi>e</mi><mo>,</mo></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>i</mi><mi>f</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mi>i</mi><mi>s</mi><mi>p</mi><mi>r</mi><mi>o</mi><mi>v</mi><mi>i</mi><mi>d</mi><mi>e</mi><mi>r</mi><mi>m</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>o</mi><mi>d</mi></mrow></mtd></mtr><mtr><mtd><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>,</mo></mtd><mtd><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>w</mi><mi>i</mi><mi>s</mi><mi>e</mi><mfenced close=")" open="("><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mi>i</mi><mi>s</mi><mi>a</mi><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>f</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>c</mi><mi>e</mi></mrow></mfenced></mrow></mtd></mtr></mtable></mfenced></math></p>
</div>
<div class="paragraph">
<p>140Bindings[req:Bindings] For a given binding
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>b</mi><mo>=</mo><mfenced close=")" open="("><mrow><mi>k</mi><mi>e</mi><mi>y</mi></mrow><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></mfenced></math>, the following constraints must
hold:
<sup class="footnote">[<a id="_footnoteref_54" class="footnote" href="#_footnote_54" title="View footnote.">54</a>]</sup></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi><mi>e</mi><mi>y</mi></math> must be either a class or an interface.</p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></math> must either be a class or a provider method.</p>
</li>
<li>
<p>If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>b</mi></math> is implicit, then <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi><mi>e</mi><mi>y</mi></math> must be a
class. If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi><mi>e</mi><mi>y</mi></math> references a type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math>, then
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>=</mo><mi>T</mi></math> – even if <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi><mi>e</mi><mi>y</mi></math> is a use-site
structural type.</p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi><mi>e</mi><mi>y</mi></math> and <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>*</mo></math> can be nominal,
structural or field-structural types, either definition-site or
use-site.    The injector and binder needs to take the different structural
reference into account at runtime!</p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo>*</mo><mi>k</mi><mi>e</mi><mi>y</mi></math> must hold</p>
</li>
<li>
<p>If during injection phase no binding for a given key is found, an is
thrown. </p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1496" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1496</a>
<a href="https://github.com/NumberFour/N4JS/issues/418" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-418</a>
<a href="https://github.com/NumberFour/N4JS/issues/498" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-498</a>
<a href="https://github.com/NumberFour/N4JS/issues/461" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-461</a>
</div>
</div>
<div class="paragraph">
<p>141Transitive Bindings[req:Transtive_Bindings] If an injector contains
two given bindings <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>b</mi><mn>1</mn></msub><mo>=</mo><mfenced close=")" open="("><mrow><mi>k</mi><mi>e</mi><msub><mi>y</mi><mn>1</mn></msub></mrow><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><msub><mi>t</mi><mn>1</mn></msub></mrow></mfenced></math> and
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>b</mi><mn>2</mn></msub><mo>=</mo><mfenced close=")" open="("><mrow><mi>k</mi><mi>e</mi><msub><mi>y</mi><mn>2</mn></msub></mrow><mrow><mi>k</mi><mi>e</mi><msub><mi>y</mi><mn>1</mn></msub></mrow></mfenced></math>, an effective binding
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>b</mi><mo>=</mo><mfenced close=")" open="("><mrow><mi>k</mi><mi>e</mi><msub><mi>y</mi><mn>2</mn></msub></mrow><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><msub><mi>t</mi><mn>1</mn></msub></mrow></mfenced></math> is derived (replacing
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>b</mi><mn>1</mn></msub></math>).</p>
</div>
<div class="paragraph">
<p>N4JS \ac{DI} mechanisms don’t allow for injection of primitives or built-in
types. Only user-defined N4Types can be used. In cases where a user
needs to inject a primitive or a built-in type, the developer must wrap
it into its own class.<sup class="footnote">[<a id="_footnoteref_55" class="footnote" href="#_footnote_55" title="View footnote.">55</a>]</sup>. This
is to say that none of the following metatypes can be bound: primitive
types, enumerations, functions, object types, union- or intersection
types. It is possible to (implicitly) bind to built-in classes.</p>
</div>
<div class="paragraph">
<p>While direct binding overriding or rebinding is not allowed, <em>Injector</em>
can be configured in a way where one type can be separately bound to
different types with implicit binding, <em>explicit binding</em> and in
bindings of the child injectors. <em>Binding precedence</em> is a mechanism of
<em>Injector</em> selecting a binding use for a type. If operates in the
following order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Try to use explicit binding, if this is not available:</p>
</li>
<li>
<p>Try to delegate to parent injectors (order of lookup is not
guaranteed, first found is selected). If this is not available then:</p>
</li>
<li>
<p>Try to use use implicit binding, which is simply to attempt to
create the instance.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If no binding for a requested type is available an error will be thrown.</p>
</div>
</div>
<div class="sect3">
<h4 id="_injection_points"><a class="anchor" href="#_injection_points"></a>13.2.3. Injection Points</h4>
<div class="paragraph">
<p>By <em>injection point</em> we mean a place in the source code which, at
runtime, will be expected to hold a reference to a particular type
instance.</p>
</div>
<div class="sect4">
<h5 id="_field_injection"><a class="anchor" href="#_field_injection"></a>Field Injection</h5>
<div class="paragraph">
<p>In its simplest form, this is a class field annotated with <code>@Inject</code> annotation.
At runtime, an instance of the containing class will be expected to hold
reference to an instance of the field declared type. Usually that case
is called <em>Field Injection</em>.</p>
</div>
<div class="paragraph">
<p>The injector will inject the
following fields:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>All directly contained fields annotated with <code>@Inject</code>.</p>
</li>
<li>
<p>All inherited fields annotated with <code>@Inject</code>. </p>
</li>
<li>
<p>The injected fields will be created by the injector and their fields
will be injected as well.</p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/400" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-400</a>
</div>
</div>
<div class="paragraph">
<p>demonstrates simple
field injection using default bindings. Note that all inherited fields
(i.e. <code>A.xInA</code>) are injected and also fields in injected fields (i.e. )</p>
</div>
<div class="listingblock">
<div class="title">Simple Field Injection</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class X {
    @Inject y: Y;
}
class Y {}

class A {
    @Inject xInA: X;
}
class B extends A {
    @Inject xInB: X;
}

@GenerateInjector
export public class DIC {
    @Inject a: B;
}

var dic = N4Injector.of(DIC).create(DIC);
console.log(dic);              // --&gt; DIC
console.log(dic.a);            // --&gt; B
console.log(dic.a.xInA);       // --&gt; X
console.log(dic.a.xInA.y);     // --&gt; Y
console.log(dic.a.xInB);       // --&gt; X
console.log(dic.a.xInB.y);     // --&gt; Y</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_constructor_injection"><a class="anchor" href="#_constructor_injection"></a>Constructor Injection</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1262" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1262</a>
</div>
</div>
<div class="paragraph">
<p>Parameters of the constructor can also be injected, in which case this
is usually referred to as <em>Constructor Inejction</em>. This is similar to
<em>Method Injection</em> and while constructor injection is supported in N4JS,
method injection is not (see remarks below).</p>
</div>
<div class="paragraph">
<p>When a constructor is annotated with <code>@Inject</code> annotation, all user-defined,
non-generic types given as the parameters will be injected into the
instance’s constructor created by the dependency injection framework.
Currently, optional constructor parameters are always initialized and
created by the framework, therefore, they are ensured to be available at
the constructor invocation time. Unlike optional parameters, variadic
parameters cannot be injected into a type’s constructor. In case of
annotating a constructor with that has variadic parameters, a validation
error will be reported. When a class’s constructor is annotated with <code>@Inject</code>
annotation, it is highly recommended to annotate all explicitly-defined
constructors at the subclass level. If this is not done, the injection
chain can break and runtime errors might occur due to undefined
constructor parameters. In the case of a possible broken injection chain
due to missing <code>@Inject</code> annotations for any subclasses, a validation warning will
be reported.</p>
</div>
<div class="paragraph">
<p>If a class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> has a constructor marked as injection point, the
following applies:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> is subclassed by <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math>, and if
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> has no explicit constructor, then <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math>
inherits the constructor from <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> and it will be an
injection point handled by the injector during injection phase.
  </p>
</li>
<li>
<p>If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math> provides its own injector, <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi><mo>.</mo><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></math>
is no longer recognized by the injector during the injection phase.
There will be a warning generated in <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi><mo>.</mo><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></math> to mark it as
injection point as well in order to prevent inconsistent injection
behavior. Still, <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi><mo>.</mo><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></math> must be called in
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi><mo>.</mo><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></math> similarly to other overridden constructors.</p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/447" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-447</a>
<a href="https://github.com/NumberFour/N4JS/issues/458" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-458</a>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_method_injection"><a class="anchor" href="#_method_injection"></a>Method Injection</h5>
<div class="paragraph">
<p>Other kinds of injector points are method parameters where (usually) all
method parameters are injected when the method is called. In a way,
constructor injection is a special case of the method itself.</p>
</div>
<div class="sect5">
<h6 id="_provider"><a class="anchor" href="#_provider"></a>Provider</h6>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1261" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1261</a>
</div>
</div>
<div class="paragraph">
<p><em>Provider</em> is essentially a <em>factory</em> for a given type. By injecting an <code>N4Provider</code> into any injection point, one can acquire new instances of a given type
provided by the injected provider. The providers prove useful when one
has to solve re-injection issues since the depended type can be wired
and injected via the provider rather than the dependency itself and can
therefore obtain new instances from it if required. Provider can be also
used as a means of delaying the instantiation time of a given type.</p>
</div>
<div class="paragraph">
<p><code>N4Provider</code> is a public generic built-in interface that is used to support the
re-injection. The generic type represents the dependent type that has to
be obtained. The <code>N4Provider</code> interface has one single public method: <code>public T get()</code> which should be invoked from the client code when a new instance of the dependent type  is required.
Unlike any other unbound interfaces, the <code>N4Provider</code> can be injected
without any explicit binding.</p>
</div>
<div class="paragraph">
<p>The following snippet demonstrates the usage of <code>N4Provider</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class SomeService { }

@Singleton
class SomeSingletonService { }

class SomeClass {

    @Inject serviceProvider: N4Provider&lt;SomeService&gt;;
    @Inject singletonServiceProvider: N4Provider&lt;SomeSingletonService&gt;;

    void foo() {
        console.log(serviceProvider.get() ===
            serviceProvider.get()); //false

        console.log(singletonServiceProvider.get() ===
            singletonServiceProvider.get()); //true
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is important to note that the <code>N4Provider</code> interface can be extended by any
user-defined interfaces and/or can be implemented by any user-defined
classes. For those user-defined providers, consider all binding-related
rules; the extended interface, for example, must be explicitly bound via
a binder to be injected. The binding can be omitted only for the
built-in <code>N4Provider</code>s.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_n4js_di_life_cycle_and_scopes"><a class="anchor" href="#_n4js_di_life_cycle_and_scopes"></a>13.2.4. N4JS DI Life Cycle and Scopes</h4>
<div class="paragraph">
<p><a href="#AC">DI</a> Life Cycle defines when a new instance is created by the injector as its
destruction is handled by JavaScript. The creation depends on the scope
of the type. Aside from the scopes, note that it is also possible to
implement custom scopes and life cycle management via <code>N4JSProvider</code> and
Binder@Provides methods.</p>
</div>
<div class="sect4">
<h5 id="_injection_cylces"><a class="anchor" href="#_injection_cylces"></a>Injection Cylces</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1608" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1608</a>
</div>
</div>
<div class="paragraph">
<p>[Injection Cycle][def:Injection_Cycle] We define an injection graph
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mfenced close=")" open="("><mi>V</mi><mi>E</mi></mfenced></math> as a directed graph as follows: <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>V</mi></math>
(the vertices) is the set types of which instances are created during
the injection phase and which use . <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>E</mi></math> (the edges) is a set
of directed and labeled edges <math xmlns="http://www.w3.org/1998/Math/MathML"><mfenced close=")" open="("><msub><mi>v</mi><mn>1</mn></msub><msub><mi>v</mi><mn>2</mn></msub><mrow><mi>l</mi><mi>a</mi><mi>b</mi><mi>e</mi><mi>l</mi></mrow></mfenced></math>, where
label indicates the injection point:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mfenced close=")" open="("><msub><mi>T</mi><mi>o</mi></msub><msub><mi>T</mi><mi>f</mi></msub><mrow><mi>"</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi><mi>"</mi></mrow></mfenced></math>, if <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>T</mi><mi>f</mi></msub></math> is the
actualy type of an an injected field of an instance of type
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>T</mi><mi>o</mi></msub></math></p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mfenced close=")" open="("><msub><mi>T</mi><mi>c</mi></msub><msub><mi>T</mi><mi>p</mi></msub><mrow><mi>"</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>"</mi></mrow></mfenced></math>, if <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>T</mi><mi>p</mi></msub></math> is the type
of a parameter used in a constructor injection of type <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>T</mi><mi>c</mi></msub></math></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>One cycle in this graph is an injection cycle.</p>
</div>
<div class="paragraph">
<p>When injecting instances into an object, cycles have to be detected and
handled independently from the scope. If this is not done, the following
examples would result in an infinite loop causing the entire script to
freeze until the engine reports an error:</p>
</div>
<div class="paragraph">
<p>[c]0.6</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class A { @Inject b: B; }
class B { @Inject a: A; }</code></pre>
</div>
</div>
<div class="paragraph">
<p>[c]0.4</p>
</div>
<div class="imageblock">
<div class="content">
<img src="fig/injectionGraph_cycleField.png" alt="image">
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>+</pre>
</div>
</div>
<div class="paragraph">
<p>[c]0.6</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class C { @Inject constructor(d: D) {} }
class D { @Inject c: C; }</code></pre>
</div>
</div>
<div class="paragraph">
<p>[c]0.4</p>
</div>
<div class="imageblock">
<div class="content">
<img src="fig/injectionGraph_cycleCtorField.png" alt="image">
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>+</pre>
</div>
</div>
<div class="paragraph">
<p>[c]0.6</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class E { @Inject constructor(f: F) {} }
class F { @Inject constructor(e: E) {} }</code></pre>
</div>
</div>
<div class="paragraph">
<p>[c]0.4</p>
</div>
<div class="imageblock">
<div class="content">
<img src="fig/injectionGraph_cycleCtor.png" alt="image">
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>+</pre>
</div>
</div>
<div class="paragraph">
<p>The injector needs to detect these cycles and resolve them.</p>
</div>
<div class="paragraph">
<p>144Resolution of Injection Cycles[req:Resolution_of_Injection_Cycles] A
cycle <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mo>⊂</mo><mi>G</mi></math>, with <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi></math> being an injection
graph, is resolved as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi></math> contains no edge with <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mi>a</mi><mi>b</mi><mi>e</mi><mi>l</mi><mo>=</mo><mi>"</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>"</mi></math>,
the cycle is resolved using the algorithm described below.</p>
</li>
<li>
<p>If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi></math> contains at least one edge with
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mi>a</mi><mi>b</mi><mi>e</mi><mi>l</mi><mo>=</mo><mi>"</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>"</mi></math>, a runtime exception is thrown.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Cycles stemming from field injection are resolved by halting the
creation of new instances of types which have been already created by a
containing instance. The previously-created instance is then reused.
This makes injecting the instance of a (transitive) container less
complicated and without the need to pass the container instance down the
entire chain. The following pseudo code describes the algorithm to
create new instances which are injected into a newly created object:</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1608" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1608</a>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">function injectDependencies(object) {
    doInjectionWithCylceAwareness(object, {(typeof object -&gt; object)})
}

function doInjectionWithCylceAwareness(object, createdInstancesPerType) {
    forall v $\in$ injectedVars of object {
        var type = retrieveBoundType(v)
        var instance = createdInstancesPerType.get(type)
        if (not exists instance) {
            instance = createInstance(type, createdInstancesPerType)
            doInjectionWithCylceAwareness(instance,
                createdInstancesPerType $\cap$ {(type-&gt;instance)})
        }
        v.value = instance;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The actual instance is created in line 10 via . This function then takes
scopes into account. The map is passed to that function in order to
enable cycle detection for constructor injection. The following scopes
are supported by the N4JS \ac{DI}, other scopes, cf.
<a href="https://jersey.java.net/documentation/latest/ioc.html">Jersey custom
scopes</a> and <a href="https://github.com/google/guice/wiki/CustomScopes">Guice
custom scopes</a>, may be added in the future.</p>
</div>
<div class="paragraph">
<p>This algorithm is not working for constructor injection because it is
possible to already access all fields of the arguments passed to the
constructor. In the algorithm, however, the instances may not be
completely initialized.</p>
</div>
</div>
<div class="sect4">
<h5 id="_default_scope"><a class="anchor" href="#_default_scope"></a>Default Scope</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1471" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1471</a>
</div>
</div>
<div class="paragraph">
<p>The default scope always creates a new instance.</p>
</div>
</div>
<div class="sect4">
<h5 id="_singleton_scope"><a class="anchor" href="#_singleton_scope"></a>Singleton Scope</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1260" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1260</a>
</div>
</div>
<div class="paragraph">
<p>The singleton scope (per injector) creates one instance (of the type with <code>@Singleton</code> scope) per injector, which is then shared between clients.</p>
</div>
<div class="paragraph">
<p>The injector will preserve a single instance of the type of <code>S</code> and will provide it to all injection points where type of <code>S</code> is used. Assuming nested injectors without any declared binding where the second parameter is <code>S</code>, the same preserved singleton instance will be available for all nested injectors at all injection points as well.</p>
</div>
<div class="paragraph">
<p>The singleton preservation behavior changes when explicit bindings are declared for type <code>S</code> on the nested injector level. Let&#8217;s assume that the type <code>S</code> exists and the type is annotated with <code>@Singleton</code>. Furthermore, there is a declared binding where the binding&#8217;s second argument is <code>S</code>. In that case, unlike in other dependency injection frameworks, nested injectors may preserve a singleton for itself and all descendant injectors with <code>@Bind</code> annotation. In this case, the preserved singleton at the child injector level will be a different instance than the one at the parent injectors.</p>
</div>
<div class="paragraph">
<p>The tables below depict the expected runtime behavior of singletons used at different injector levels.
Assume the following are injectors: <code>C</code>, <code>D</code>, <code>E</code>, <code>F</code> and <code>G</code>. Injector <code>C</code> is the top most injector and its nesting injector <code>D</code>, hence injector <code>C</code> is the parent of the injector <code>D</code>. Injector <code>D</code> is nesting <code>E</code> and so on. The most nested injector is <code>G</code>. Let&#8217;s assume <code>J</code> is an interface, class <code>U</code> implements interface <code>J</code> and class <code>V</code> extends class <code>U</code>. Finally assume both <code>U</code> and <code>V</code> are annotated with <code>@Singleton</code> at definition-site.</p>
</div>
<div class="paragraph">
<p>The example below depicts the singleton preservation for nested injectors without any bindings. All injectors use the same instance from a type. Type <code>J</code> is not available at all since it is not bound to any concrete implementation:</p>
</div>
<table id="tab:diNoBindings" class="tableblock frame-all grid-all spread">
<caption class="title">Table 7. DI No Bindings</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Binding</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Injector nesting (<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>g</mi><mi>t</mi><mi>;</mi></math>)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">C</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">D</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">E</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">G</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">J</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi><mi>a</mi><mi>N</mi></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi><mi>a</mi><mi>N</mi></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi><mi>a</mi><mi>N</mi></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi><mi>a</mi><mi>N</mi></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi><mi>a</mi><mi>N</mi></math></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">U</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>0</mn></msub></math></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">V</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>0</mn></msub></math></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following example is configured by explicit bindings. At the root injector level, type <code>J</code> is binded to type <code>U</code>. Since the second argument of the binding is declared as a singleton at the definition-site, this explicit binding implicitly ensures that the injector and all of its descendants preserve a singleton of the bound type <code>U</code>. At injector level <code>C</code>, <code>D</code> and <code>E</code>, the same instance is used for type <code>J</code> which is type <code>U</code> at runtime. At injector level <code>E</code> there is an additional binding from type <code>U</code> to type <code>V</code> that overrules the binding declared at the root injector level. With this binding, each places where <code>J</code> is declared, type <code>U</code> is used at runtime. Furthermore, since <code>V</code> is declared as a singleton, both injector <code>F</code> and <code>G</code> are using a shared singleton instance of type <code>V</code>. Finally, for type <code>V</code>; injector <code>C</code>, <code>D</code> and <code>E</code> should use a separate instance of <code>V</code> other than injector level <code>F</code> and <code>G</code> because <code>V</code> is preserved at injector level <code>F</code> with the <code>U</code> <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>→</mo></math> <code>V</code> binding.</p>
</div>
<table id="tab:diTransitiveBindings" class="tableblock frame-all grid-all spread">
<caption class="title">Table 8. DI Transitive Bindings</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Binding</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">J &#8594; U</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">U &#8594; V</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Injector nesting (&gt;)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">C</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">D</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">E</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">G</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">J</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>0</mn></msub></math></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">U</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>0</mn></msub></math></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">V</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>1</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>1</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>1</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>0</mn></msub></math></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following table depicts the singleton behaviour but unlike the above
table, the bindings are declared for the interface <code>J</code>.</p>
</div>
<table id="tab:diReBinding" class="tableblock frame-all grid-all spread">
<caption class="title">Table 9. DI Re - Binding</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Binding</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">J &#8594; U</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">J &#8594; V</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Injector nesting (<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>g</mi><mi>t</mi><mi>;</mi></math>)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">C</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">D</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">E</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">G</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">J</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>0</mn></msub></math></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">U</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>0</mn></msub></math></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">V</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>1</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>1</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>1</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>0</mn></msub></math></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This table describes the singleton behavior when both bindings are
configured at child injector levels but not the root injector level.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 10. DI Child Binding[tab:diChildBinding]</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Binding</th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top">U <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>→</mo></math> V</th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top">J <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>→</mo></math>
U</th>
<th class="tableblock halign-center valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Injector nesting (<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>g</mi><mi>t</mi><mi>;</mi></math>)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">C</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">D</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">E</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">G</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">J</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi><mi>a</mi><mi>N</mi></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi><mi>a</mi><mi>N</mi></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi><mi>a</mi><mi>N</mi></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>0</mn></msub></math></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">U</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>1</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>U</mi><mn>0</mn></msub></math></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">V</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>1</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>0</mn></msub></math></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>0</mn></msub></math></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_per_injection_chain_singleton"><a class="anchor" href="#_per_injection_chain_singleton"></a>Per Injection Chain Singleton</h5>
<div class="paragraph">
<p>The per injection chain singleton is ’between’ the default and singleton
scope. It can be used in order to explicitly describe the situation
which happens when a simple cycle is resolved automatically. It has more
effects that lead to a more deterministic behavior.</p>
</div>
<div class="paragraph">
<p>Assume a provider declared as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">var pb: Provider&lt;B&gt;;</code></pre>
</div>
</div>
<div class="paragraph">
<p>to be available:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">@PerInjectionSingleton
class A {  }

class B { @Inject a: A; @Inject a1: A;}

b1=pb.get();
b2=pb.get();
b1.a != b2.a
b1.a == b1.a1
b2.a == b2.a1</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">@Singleton
class A {  }

class B { @Inject a: A; @Inject a1: A;}

b1=pb.get();
b2=pb.get();
b1.a == b2.a
b1.a == b1.a1
b2.a == b2.a1</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">// no annotation
class A {  }

class B { @Inject a A; @Inject a1: A;}

b1=pb.get();
b2=pb.get();
b1.a != b2.a
b1.a != b1.a1
b2.a != b2.a1</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_validation_of_callsites_targeting_n4injector_methods"><a class="anchor" href="#_validation_of_callsites_targeting_n4injector_methods"></a>13.2.5. Validation of callsites targeting N4Injector methods</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1671" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1671</a>
</div>
</div>
<div class="paragraph">
<p>Terminology for this section:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a value is <strong>injectable</strong> if it</p>
<div class="ulist">
<ul>
<li>
<p>either conforms to a user-defined class or interface (a
non-parameterized one, that is),</p>
</li>
<li>
<p>or conforms to Provider-of-T where T is injectable itself.</p>
</li>
</ul>
</div>
</li>
<li>
<p>a classifier declaring injected members is said to <strong>require injection</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To better understand the validations in effect for callsites targeting</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">N4Injector.of(ctorOfDIC: constructor{N4Object}, parentDIC: N4Injector?, ...providedBinders: N4Object)</code></pre>
</div>
</div>
<div class="paragraph">
<p>we can recap that at runtime:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first argument denotes a DIC constructor.</p>
</li>
<li>
<p>The second (optional) argument is an injector.</p>
</li>
<li>
<p>Lastly, the purpose of <code>providedBinders</code> is as follows:</p>
<div class="ulist">
<ul>
<li>
<p>The DIC above is marked with one or more <code>@UseBinder</code>.</p>
</li>
<li>
<p>Some of those binders may require injection.</p>
</li>
<li>
<p>Some of those binders may have constructor(s) taking parameters.</p>
</li>
<li>
<p>The set of binders described above should match the providedBinders.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Validations in effect for callsites:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>T</code> should be injectable (in particular, it may be an <code>N4Provider</code>).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_n4js_di_annotations"><a class="anchor" href="#_n4js_di_annotations"></a>13.2.6. N4JS DI Annotations</h4>
<div class="paragraph">
<p>Following annotations describe API used to configure N4JSDI.</p>
</div>
<div class="sect4">
<h5 id="_n4js_di_generateinjector"><a class="anchor" href="#_n4js_di_generateinjector"></a>N4JS DI @GenerateInjector</h5>
<div class="paragraph">
<p>3</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">name</dt>
<dd>
<p>@GenerateInjector</p>
</dd>
<dt class="hdlist1">targets</dt>
<dd>
<p>N4Class</p>
</dd>
<dt class="hdlist1">retention policy</dt>
<dd>
<p>RUNTIME</p>
</dd>
<dt class="hdlist1">transitive</dt>
<dd>
<p>NO</p>
</dd>
<dt class="hdlist1">repeatable</dt>
<dd>
<p>NO</p>
</dd>
<dt class="hdlist1">arguments</dt>
<dd>
<p>NO</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>@GenerateInjector</code> marks a given class as DIComponent of the graph. The generated injector
will be responsible for creating an instance of that class and all of
its dependencies.</p>
</div>
</div>
<div class="sect4">
<h5 id="_n4js_di_withparentinjector"><a class="anchor" href="#_n4js_di_withparentinjector"></a>N4JS DI @WithParentInjector</h5>
<div class="paragraph">
<p>3</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">name</dt>
<dd>
<p>@WithParentInjector</p>
</dd>
<dt class="hdlist1">targets</dt>
<dd>
<p>N4Class</p>
</dd>
<dt class="hdlist1">retention policy</dt>
<dd>
<p>RUNTIME</p>
</dd>
<dt class="hdlist1">transitive</dt>
<dd>
<p>NO</p>
</dd>
<dt class="hdlist1">repeatable</dt>
<dd>
<p>NO</p>
</dd>
<dt class="hdlist1">arguments</dt>
<dd>
<p>TypeRef</p>
</dd>
<dt class="hdlist1">arguments are optional</dt>
<dd>
<p>NO</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>@WithParentInjector</code> marks given <em>injector</em> as depended on other <em>injector</em>. The depended
<em>injector</em> may use provided <em>injector</em> to create instances of objects
required in its object graph.</p>
</div>
<div class="paragraph">
<p>Additional <em>WithParentInjector</em> constraints:</p>
</div>
<div class="paragraph">
<p>145DI WithParentInjector[req:DI_WithParentInjector]</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allowed only on annotated with <code>@GenerateInjector</code>.</p>
</li>
<li>
<p>Its parameter can only be annotated with .</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_n4js_di_usebinder"><a class="anchor" href="#_n4js_di_usebinder"></a>N4JS DI @UseBinder</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">name</dt>
<dd>
<p>@UseBinder</p>
</dd>
<dt class="hdlist1">targets</dt>
<dd>
<p>N4Class</p>
</dd>
<dt class="hdlist1">retention policy</dt>
<dd>
<p>RUNTIME</p>
</dd>
<dt class="hdlist1">transitive</dt>
<dd>
<p>NO</p>
</dd>
<dt class="hdlist1">arguments</dt>
<dd>
<p>TypeRef</p>
</dd>
<dt class="hdlist1">arguments are optional</dt>
<dd>
<p>NO</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>@UseBinder</code> describes <em>Binder</em> to be used (configure) target <em>Injector</em>.</p>
</div>
<div class="paragraph">
<p>146 DI UseInjector[req:DI_use_bindings]</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allowed only on annotated with <code>@GenerateInjector</code>.</p>
</li>
<li>
<p>Its parameter can only be annotated with <code>@Binder</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_n4js_di_binder"><a class="anchor" href="#_n4js_di_binder"></a>N4JS DI @Binder</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">name</dt>
<dd>
<p>@Binder</p>
</dd>
<dt class="hdlist1">targets</dt>
<dd>
<p>N4Class</p>
</dd>
<dt class="hdlist1">retention policy</dt>
<dd>
<p>RUNTIME</p>
</dd>
<dt class="hdlist1">transitive</dt>
<dd>
<p>NO</p>
</dd>
<dt class="hdlist1">repeatable</dt>
<dd>
<p>NO</p>
</dd>
<dt class="hdlist1">arguments</dt>
<dd>
<p>NONE</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>@UseBinder</code> defines a list of bind configurations.
That can be either annotations on itself or its factory methods annotated with <code>@Bind</code>.</p>
</div>
<div class="paragraph">
<p>147 DI binder[req:DI_Binder]</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Target <code>N4ClassDeclaration</code> must not be <em>abstract</em>.</p>
</li>
<li>
<p>Target <code>N4ClassDeclaration</code>  must not be annotated with <code>@GenerateInjector</code>.</p>
</li>
<li>
<p>Target class cannot have <em>injection points</em>.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_n4js_di_bind"><a class="anchor" href="#_n4js_di_bind"></a>N4JS DI @Bind</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">name</dt>
<dd>
<p>@Bind</p>
</dd>
<dt class="hdlist1">targets</dt>
<dd>
<p>N4ClassDeclaration</p>
</dd>
<dt class="hdlist1">retention policy</dt>
<dd>
<p>RUNTIME</p>
</dd>
<dt class="hdlist1">transitive</dt>
<dd>
<p>NO</p>
</dd>
<dt class="hdlist1">arguments</dt>
<dd>
<p><br>
TypeRef key, TypeRef target</p>
</dd>
<dt class="hdlist1">arguments are optional</dt>
<dd>
<p>NO</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Defines <em>binding</em> between type and subtype that will be used by injector
when configured with target . See also for description of injectable
types.</p>
</div>
<div class="paragraph">
<p>148 DI Bind[req:DI_bind]</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allowed only on <code>N4ClassDeclarations</code> that are annotated with <code>@Binder</code>(<a href="#_n4js_di_binder">N4JS DI @Binder</a>).</p>
</li>
<li>
<p>Parameters are instances of one of the values described in <a href="#N4JS_DI_Validation_N4Injector_Callsites">[N4JS_DI_Validation_N4Injector_Callsites]</a>.</p>
</li>
<li>
<p>The second parameter must be a subtype of the first one.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_n4js_di_provides"><a class="anchor" href="#_n4js_di_provides"></a>N4JS DI @Provides</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">name</dt>
<dd>
<p>@Provides</p>
</dd>
<dt class="hdlist1">targets</dt>
<dd>
<p>N4MethodDeclaration</p>
</dd>
<dt class="hdlist1">retention policy</dt>
<dd>
<p>RUNTIME</p>
</dd>
<dt class="hdlist1">transitive</dt>
<dd>
<p>NO</p>
</dd>
<dt class="hdlist1">repeatable</dt>
<dd>
<p>NO</p>
</dd>
<dt class="hdlist1">arguments</dt>
<dd>
<p>NONE</p>
</dd>
<dt class="hdlist1">arguments are optional</dt>
<dd>
<p>NO</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>@Provides</code> marks <em>factory method</em> to be used as part \ac{DI}. This is treated as <em>explicit binding</em> between declared return type and actual return type. This
method is expected to be part of the <code>@Binder</code>. Can be used to implement custom
scopes.</p>
</div>
<div class="paragraph">
<p>149 DI Provides[req:DI_provides]</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allowed only on <code>N4MethodDeclarations</code> that are part of a classifier annotated with <code>@Binder</code>.</p>
</li>
<li>
<p>Annotated method declared type returns instance of one of the types
described in <em>injectable values</em>  <a href="#N4JS_DI_Validation_N4Injector_Callsites">[N4JS_DI_Validation_N4Injector_Callsites]</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_n4js_di_inject"><a class="anchor" href="#_n4js_di_inject"></a>N4JS DI @Inject</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">name</dt>
<dd>
<p>@Inject</p>
</dd>
<dt class="hdlist1">targets</dt>
<dd>
<p>N4Field, N4Method, constructor</p>
</dd>
<dt class="hdlist1">retention policy</dt>
<dd>
<p>RUNTIME</p>
</dd>
<dt class="hdlist1">transitive</dt>
<dd>
<p>NO</p>
</dd>
<dt class="hdlist1">repeatable</dt>
<dd>
<p>NO</p>
</dd>
<dt class="hdlist1">arguments</dt>
<dd>
<p>NO</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>@Inject</code> defines the injection point into which an instance object will be injected. The specific instance depends on the injector configuration (bindings)
used. Class fields, methods and constructors can be annotated. See <a href="#N4JS_DI_Injection_Points">[N4JS_DI_Injection_Points]</a> for more information.</p>
</div>
<div class="paragraph">
<p>150 DI Inject[req:DI_provides]</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Injection point bindings need to be resolvable.</p>
</li>
<li>
<p>Binding for given type must not be duplicated.</p>
</li>
<li>
<p>Annotated types must be instances of one of the types described in <a href="#N4JS_DI_Validation_N4Injector_Callsites">[N4JS_DI_Validation_N4Injector_Callsites]</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_n4js_di_singleton"><a class="anchor" href="#_n4js_di_singleton"></a>N4JS DI @Singleton</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">name</dt>
<dd>
<p>@Singleton</p>
</dd>
<dt class="hdlist1">targets</dt>
<dd>
<p>N4Class</p>
</dd>
<dt class="hdlist1">retention policy</dt>
<dd>
<p>RUNTIME</p>
</dd>
<dt class="hdlist1">transitive</dt>
<dd>
<p>NO</p>
</dd>
<dt class="hdlist1">repeatable</dt>
<dd>
<p>NO</p>
</dd>
<dt class="hdlist1">arguments</dt>
<dd>
<p>NO</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In the case of annotating a class <code>S</code> with <code>@Singleton</code> on the definition-site, the
singleton scope will be used as described in <a href="#_singleton_scope">Singleton Scope</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_test_support"><a class="anchor" href="#_test_support"></a>13.3. Test Support</h3>
<div class="paragraph">
<p>N4JS provides some annotations for testing. Most of these annotations
are similar to annotations found in JUnit 4. For details see our
Mangelhaft test framework (stdlib specification) and the N4JS-IDE
specification.</p>
</div>
<div class="paragraph">
<p>In order to enable tests for private methods, test projects may define
which project they are testing.</p>
</div>
<div class="paragraph">
<p>151Test API methods and types[req:Test_API_methods_and_types]

In some cases, types or methods are only provided for testing purposes. In order
to improve usability, e.g. content assist, these types and methods can
be annotated with <code>@TestAPI</code>. There are no constraints defined for that annotation
at the moment.</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1468" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1468</a>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_polyfill_definitions"><a class="anchor" href="#_polyfill_definitions"></a>13.4. Polyfill Definitions</h3>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1142" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1142</a>
</div>
</div>
<div class="paragraph">
<p>In plain JavaScript, so called <em>polyfill</em> (or sometimes called <em>shim</em>)
libraries are provided in order to modify existing classes which are
only prototypes in plain JavaScript. In N4JS, this can be defined for
declarations via the annotation <code>@Polyfill</code> or <code>@StaticPolyfill</code>.
One of these annotations can be added to class declarations which do not look that much different from
normal classes. In the case of polyfill classes, the extended class is
modified (or filled) instead of being subclassed.</p>
</div>
<div class="paragraph">
<p>We distinguish two flavours of polyfill classes: runtime and static.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Runtime polyfilling covers type enrichment for runtime libraries. For
type modifications the annotation <code>@Polyfill</code> is used.</p>
</li>
<li>
<p>Static polyfilling covers code modifications for adapting generated
code. The annotation <code>@StaticPolyfill</code> denotes a polyfill in ordinary code, which usually provides executable implementations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <em>polyfill class</em> (or simply <em>polyfill</em>) is
a class modifying an existing one. The polyfill is not a new class (or
type) on its own. Instead, new members defined in the polyfill are added
to the modified class and existing members can be modified similarly to
overriding. We call the modified class the <em>filled</em> class and the
modification <em>filling</em>.</p>
</div>
<div class="paragraph">
<p>We add a new pseudo property <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mi>o</mi><mi>l</mi><mi>y</mi><mi>f</mi><mi>i</mi><mi>l</mi><mi>l</mi></math> to classes in order
to distinguish between normal (sub-) classes and polyfill classes.</p>
</div>
<div class="paragraph">
<p>152Polyfill Class[req:Polyfill_Class] For a polyfill class
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi></math> annotated with <code>@Polyfill</code> or  <code>@StaticPolyfill</code>, that is
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi><mo>.</mo><mi>p</mi><mi>o</mi><mi>l</mi><mi>y</mi><mi>f</mi><mi>i</mi><mi>l</mi><mi>l</mi><mo>=</mo></math>, all the following constraints must hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi></math> must extend a class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi></math>, <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi></math>
is called the filled class: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>P</mi><mo>.</mo><mi>s</mi><mi>u</mi><mi>p</mi><mi>e</mi><mi>r</mi><mo>=</mo><mi>F</mi></math></p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi></math>’s name equals the name of the filled class and is
contained in a module with same qualified name (specifier or global):
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>P</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>F</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∧</mo><mi>P</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>l</mi><mi>e</mi><mo>.</mo><mi>g</mi><mi>l</mi><mi>o</mi><mi>b</mi><mi>a</mi><mi>l</mi><mo>=</mo><mi>F</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>l</mi><mi>e</mi><mo>.</mo><mi>g</mi><mi>l</mi><mi>o</mi><mi>b</mi><mi>a</mi><mi>l</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∧</mo><mfenced close=")" open="("><mrow><mi>P</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>l</mi><mi>e</mi><mo>.</mo><mi>g</mi><mi>l</mi><mi>o</mi><mi>b</mi><mi>a</mi><mi>l</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mo>∨</mo><mi>P</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>l</mi><mi>e</mi><mo>.</mo><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>r</mi><mo>=</mo><mi>F</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>l</mi><mi>e</mi><mo>.</mo><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>r</mi></mrow></mfenced><mtext>
</mtext></math></p>
</li>
<li>
<p>Both the polyfill and filled class must be top-level declarations
(i.e., no class expression): <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>P</mi><mo>.</mo><mi>t</mi><mi>o</mi><mi>p</mi><mi>L</mi><mi>e</mi><mi>v</mi><mi>e</mi><mi>l</mi><mo>=</mo><mo>∧</mo><mi>F</mi><mo>.</mo><mi>t</mi><mi>o</mi><mi>p</mi><mi>L</mi><mi>e</mi><mi>v</mi><mi>e</mi><mi>l</mi><mo>=</mo></math></p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi></math> must not implement any interfaces:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>P</mi><mo>.</mo><mi>i</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>e</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>d</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi><mi>s</mi><mo>=</mo><mi>∅</mi></math></p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi></math> must have the same access modifier (access,
abstract, final) as the filled class: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>P</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>M</mi><mi>o</mi><mi>d</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>r</mi><mo>=</mo><mi>F</mi><mo>.</mo><mi>a</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>M</mi><mi>o</mi><mi>d</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>r</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>P</mi><mo>.</mo><mi>a</mi><mi>b</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mo>=</mo><mi>F</mi><mo>.</mo><mi>a</mi><mi>b</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>P</mi><mo>.</mo><mi>f</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi><mo>=</mo><mi>F</mi><mo>.</mo><mi>f</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi></math></p>
</li>
<li>
<p>If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi></math> declares a constructor, it must be override
compatible with the constructor of the filled class:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>∃</mo><mi>P</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>C</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>:</mi><mi>P</mi><mo>.</mo><mi>o</mi><mi>w</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>C</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>F</mi><mo>.</mo><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></math></p>
</li>
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi></math> must define the same type variables as the filled
class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi></math> and the arguments must be in the same order as the
parameters (with no further modifications): <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∀</mo><mi>i</mi><mo>,</mo><mn>0</mn><mo>≤</mo><mi>i</mi><mi>l</mi><mi>t</mi><mi>;</mi><mo>|</mo><mi>P</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>P</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>|</mo><mi>:</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mi>P</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>P</mi><mi>a</mi><mi>r</mi><msub><mi>s</mi><mi>i</mi></msub><mo>=</mo><mi>F</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>P</mi><mi>a</mi><mi>r</mi><msub><mi>s</mi><mi>i</mi></msub><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mspace width="3.0em"/><mo>∧</mo><mi>P</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>P</mi><mi>a</mi><mi>r</mi><msub><mi>s</mi><mi>i</mi></msub><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>P</mi><mo>.</mo><mi>s</mi><mi>u</mi><mi>p</mi><mi>e</mi><mi>r</mi><mo>.</mo><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>A</mi><mi>r</mi><mi>g</mi><msub><mi>s</mi><mi>i</mi></msub><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mtext>
</mtext></math></p>
</li>
<li>
<p>All constraints related to member redefinition (cf. <a href="#Redefinition_of_Members">[Redefinition_of_Members]</a>) have to hold.
In the case of polyfills, this is true for constructors (cf.
<a href="#req:Overriding_Members">[req:Overriding_Members]</a>) and private members.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_runtime_polyfill_definitions"><a class="anchor" href="#_runtime_polyfill_definitions"></a>13.4.1. Runtime Polyfill Definitions</h4>
<div class="paragraph">
<p>(Runtime) Libraries often do not provide completely new types but modify
existing types. The ECMA-402 Internationalization Standard [<a href="#ECMA12a">ECMA12a</a>], for example, changes methods of the built-in class \lstnfjs{Date} to be timezone aware. Other scenarios include new functionality provided by browsers which are not part of an official standard yet. Even ECMAScript 6 [<a href="#ECMA15a">ECMA15a</a>] extends the predecessor [<a href="#ECMA11a">ECMA11a</a>]  in terms of new methods (or new method parameters) added to
existing types (it also adds completely new classes and features, of
course).</p>
</div>
<div class="paragraph">
<p>Runtime polyfills are only applicable to runtime libraries or
environments and thus are limited to n4jsd files.</p>
</div>
<div class="paragraph">
<p>153Runtime Polyfill Class[req:Runtime_Polyfill_Class] For a
runtime-polyfill class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi></math> annotated with <code>@Polyfill</code>, that is
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mi>p</mi><mi>o</mi><mi>l</mi><mi>y</mi><mi>f</mi><mi>i</mi><mi>l</mi><mi>l</mi><mo>=</mo></math>, all the following constraints
must hold in addition to :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Both the polyfill and filled class are provided by the runtime
(annotated with <code>@ProvidedByRuntime</code>+
):
<sup class="footnote">[<a id="_footnoteref_56" class="footnote" href="#_footnote_56" title="View footnote.">56</a>]</sup>
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>P</mi><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>v</mi><mi>i</mi><mi>d</mi><mi>e</mi><mi>d</mi><mi>B</mi><mi>y</mi><mi>R</mi><mi>u</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mo>=</mo><mo>∧</mo><mi>F</mi><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>v</mi><mi>i</mi><mi>d</mi><mi>e</mi><mi>d</mi><mi>B</mi><mi>y</mi><mi>R</mi><mi>u</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mo>=</mo></math></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>154Applying Polyfills[req:Applying_Polyfills]

A polyfill is
automatically applied if a runtime library or environment required by
the current project provides it. In this case, the following constraints
must hold:</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1207" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1207</a>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>No member must be filled by more than one polyfill.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_static_polyfill_definitions"><a class="anchor" href="#_static_polyfill_definitions"></a>13.4.2. Static Polyfill Definitions</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1735" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1735</a>
</div>
</div>
<div class="paragraph">
<p>Static polyfilling is a compile time feature to enrich the definition
and usually also the implementation of generated code in N4JS. It is
related to runtime polyfilling described in () in a sense that both
fillings enrich the types they address. Despite this, static polyfilling
and runtime polyfilling differ in the way they are handled.</p>
</div>
<div class="paragraph">
<p>Static polyfills usually provide executable implementations and are thus
usually found in n4js files. However, they are allowed in n4jsd files,
as well, for example to enrich generated code in an API project.</p>
</div>
<div class="paragraph">
<p>The motivation for static polyfills is to support automatic code
generation. In many cases, automatically generated code is missing some
information to make it sufficiently usable in the desired environment.
Manual enhancements usually need to be applied. If we think of a
toolchain, the question may arise how to preserve the manual work when a
regeneration is triggered. Static polyfilling allows the separation of
generated code and manual adjustments in separate files. The transpiler
merges the two files into a single transpiled file. To enable this
behaviour, the statically fillable types must be contained in a module
annotated with <code>@StaticPolyfillAware</code>. The filling types must also be annotated with <code>@StaticPolyfill</code> and be contained in a different module with same specifier but annotated with <code>@StaticPolyfillModule</code>.
Static polyfilling is restricted to a project, thus the module to be
filled as well as the filling module must be contained in the same
project.</p>
</div>
<div class="paragraph">
<p>We add a new pseudo property <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mi>P</mi><mi>o</mi><mi>l</mi><mi>y</mi><mi>f</mi><mi>i</mi><mi>l</mi><mi>l</mi></math> to classes in
order to distinguish between normal (sub-) classes and static polyfill
classes. We add two new pseudo properties to modules in order to modify
the transpilation process. The mutually-exclusive properties
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mi>P</mi><mi>o</mi><mi>l</mi><mi>y</mi><mi>f</mi><mi>i</mi><mi>l</mi><mi>l</mi><mi>A</mi><mi>w</mi><mi>a</mi><mi>r</mi><mi>e</mi></math> and <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mi>P</mi><mi>o</mi><mi>l</mi><mi>y</mi><mi>f</mi><mi>i</mi><mi>l</mi><mi>l</mi></math>
signal the way these files are processed.</p>
</div>
<div class="paragraph">
<p>In order to support efficient transpilation, the following constraint
must hold in addition to constraints :</p>
</div>
<div class="paragraph">
<p>155static poly fill layout[req:static_poly_fill_layout] For a static
polyfill class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi></math> annotated with <code>@StaticPolyfill</code>, that is
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mi>p</mi><mi>o</mi><mi>l</mi><mi>y</mi><mi>f</mi><mi>i</mi><mi>l</mi><mi>l</mi><mo>=</mo></math>, all the following constraints must
hold in addition to [req:Polyfill_Class]:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi></math>’s name equals the name of the filled class and is
contained in a module with the same qualified name:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>P</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>F</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mtext>
</mtext><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mo>∧</mo><mi>P</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>l</mi><mi>e</mi><mo>.</mo><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>r</mi><mo>=</mo><mi>F</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>l</mi><mi>e</mi><mo>.</mo><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>r</mi><mtext>
</mtext></math></p>
</li>
<li>
<p>Both the static polyfill and the filled class are part of the same
project: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>P</mi><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo>=</mo><mi>F</mi><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></math></p>
</li>
<li>
<p>The filled class must be contained in a module annotated with <code>@StaticPolyfillAware</code>:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>F</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>l</mi><mi>e</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mi>P</mi><mi>o</mi><mi>l</mi><mi>y</mi><mi>f</mi><mi>i</mi><mi>l</mi><mi>l</mi><mi>A</mi><mi>w</mi><mi>a</mi><mi>r</mi><mi>e</mi><mo>=</mo></math></p>
</li>
<li>
<p>The static polyfill and the filled type must both be declared in an
n4js file or both in an n4jsd file.</p>
</li>
<li>
<p>The filling class must be contained in a module annotated with :
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mi>P</mi><mo>.</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>l</mi><mi>e</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mi>P</mi><mi>o</mi><mi>l</mi><mi>y</mi><mi>f</mi><mi>i</mi><mi>l</mi><mi>l</mi><mi>M</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>l</mi><mi>e</mi><mo>=</mo></math></p>
</li>
<li>
<p>For a statically-filled class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi></math> there is at most one
static polyfill: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mfenced close=")" open="("><mrow><msub><mi>P</mi><mn>1</mn></msub><mrow><mi>i</mi><mi>s</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mi>p</mi><mi>o</mi><mi>l</mi><mi>y</mi><mi>f</mi><mi>i</mi><mi>l</mi><mi>l</mi><mi>o</mi><mi>f</mi></mrow><mi>F</mi><mo>∧</mo><msub><mi>P</mi><mn>2</mn></msub><mrow><mi>i</mi><mi>s</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mi>p</mi><mi>o</mi><mi>l</mi><mi>y</mi><mi>f</mi><mi>i</mi><mi>l</mi><mi>l</mi><mi>o</mi><mi>f</mi></mrow><mi>F</mi></mrow></mfenced><mo>→</mo><msub><mi>P</mi><mn>1</mn></msub><mo>=</mo><msub><mi>P</mi><mn>2</mn></msub></math></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>156Restrictions on static
polyfilling[req:Restrictions_on_static_polyfilling] For a static
polyfilling module <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>M</mi><mi>P</mi></msub></math> the following must hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>All top-level elements are static polyfills:
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><mrow><mi>T</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mi>P</mi><mi>o</mi><mi>l</mi><mi>y</mi><mi>f</mi><mi>i</mi><mi>l</mi><mi>l</mi><mo>=</mo></mrow><mrow><mo>∀</mo><mi>T</mi><mo>∈</mo><msub><mi>M</mi><mi>P</mi></msub><mo>∧</mo><mi>T</mi><mo>.</mo><mi>t</mi><mi>o</mi><mi>p</mi><mi>L</mi><mi>e</mi><mi>v</mi><mi>e</mi><mi>l</mi><mo>=</mo></mrow></math></p>
</li>
<li>
<p>It exists exactly one filled module <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>M</mi><mi>F</mi></msub></math> annotated with
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mi>P</mi><mi>o</mi><mi>l</mi><mi>y</mi><mi>f</mi><mi>i</mi><mi>l</mi><mi>l</mi><mi>A</mi><mi>w</mi><mi>a</mi><mi>r</mi><mi>e</mi></math> in the same project.</p>
</li>
<li>
<p>It is an error if two static polyfill modules for the same filled
module exist in the same project: <math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><msub><mi>M</mi><mn>1</mn></msub><mo>=</mo><msub><mi>M</mi><mn>2</mn></msub></mrow><mrow><msub><mi>M</mi><mn>1.</mn></msub><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>r</mi><mo>=</mo><msub><mi>M</mi><mn>2.</mn></msub><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>r</mi><mo>∧</mo><msub><mi>M</mi><mn>1.</mn></msub><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo>=</mo><msub><mi>M</mi><mn>2.</mn></msub><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mtext>
</mtext><mo>∧</mo><msub><mi>M</mi><mn>1.</mn></msub><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mi>P</mi><mi>o</mi><mi>l</mi><mi>y</mi><mi>f</mi><mi>i</mi><mi>l</mi><mi>l</mi><mi>M</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>l</mi><mo>=</mo><msub><mi>M</mi><mn>2.</mn></msub><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mi>P</mi><mi>o</mi><mi>l</mi><mi>y</mi><mi>f</mi><mi>i</mi><mi>l</mi><mi>l</mi><mi>M</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>l</mi><mo>=</mo></mrow></math></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>[[ex:Static polyfill]]</p>
</div>
<div class="paragraph">
<p><a href="#lst:StaticPolyfill_genMod">[lst:StaticPolyfill_genMod]</a> shows an example of generated code. <a href="#lst:StaticPolyfill_polyfillMod">[lst:StaticPolyfill_polyfillMod]</a> demonstrates the static polyfill.
Note that the containing project has two source folders configured:
<code>Project/src/n4js</code> and <code>Project/src/n4js-gen</code>
.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">@@StaticPolyfillAware
export public class A {
    constructor() {...}
    m1(): void{...}
}
export public class B {
    constructor() {...}
    m2(): void{...}
}</code></pre>
</div>
</div>
<div id="lst:StaticPolyfill_genMod" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">@@StaticPolyfillModule
@StaticPolyfill
export public class B extends B {
    @Override
    constructor(){ ... } // replaces generated ctor of B
    @Override
    m1(): void {...} // adds overridden method m1 to B
    @Override
    m2(): void {...} // replaces method m2 in B
    m3(): void {...} // adds new method m3 to B
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_transpiling_static_polyfilled_classes"><a class="anchor" href="#_transpiling_static_polyfilled_classes"></a>13.4.3. Transpiling static polyfilled classes</h4>
<div class="paragraph">
<p>Transpiling static polyfilled classes encounters the special case that
two different <code>n4js</code> source files with the same qualified name are part of the
project. Since the current transpiler is file-based, both files would be
transpiled to the same output destination and would therefore overwrite
each other. The following pre-transpilation steps handle this situation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Current file to transpile is <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math></p>
</li>
<li>
<p>If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mi>P</mi><mi>o</mi><mi>l</mi><mi>y</mi><mi>f</mi><mi>i</mi><mi>l</mi><mi>l</mi><mi>A</mi><mi>w</mi><mi>a</mi><mi>r</mi><mi>e</mi><mo>=</mo></math>, then</p>
<div class="ulist">
<ul>
<li>
<p>search for a second file <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi></math> with same qualified name:<br>
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo>.</mo><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>r</mi><mo>=</mo><mi>M</mi><mo>.</mo><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>r</mi><mo>∧</mo><mi>G</mi><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo>=</mo><mi>M</mi><mo>.</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></math></p>
</li>
<li>
<p>If <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∃</mo><mi>G</mi></math>, then</p>
<div class="ulist">
<ul>
<li>
<p>merge <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi></math> into current file
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi><mo>→</mo><msup><mi>M</mi><mi>'</mi></msup></math></p>
</li>
<li>
<p>conventionally transpile <math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>M</mi><mi>'</mi></msup></math></p>
</li>
</ul>
</div>
</li>
<li>
<p>else conventionally transpile <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math></p>
</li>
</ul>
</div>
</li>
<li>
<p>else, if <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi><mo>.</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>c</mi><mi>P</mi><mi>o</mi><mi>l</mi><mi>y</mi><mi>f</mi><mi>i</mi><mi>l</mi><mi>l</mi><mi>M</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>l</mi><mi>e</mi><mo>=</mo></math>,</p>
<div class="ulist">
<ul>
<li>
<p>then <em>do nothing</em>. (Transpilation will be triggered for filled type
separately.)</p>
</li>
</ul>
</div>
</li>
<li>
<p>else, conventionally transpile <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_components"><a class="anchor" href="#_components"></a>14. Components</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_n4js_platform_architecture"><a class="anchor" href="#_n4js_platform_architecture"></a>14.1. N4JS Platform Architecture</h3>
<div class="sect3">
<h4 id="_overview_2"><a class="anchor" href="#_overview_2"></a>14.1.1. Overview</h4>
<div class="paragraph">
<p>shows the N4JS components described in detail in this
chapter.
<sup class="footnote">[<a id="_footnoteref_57" class="footnote" href="#_footnote_57" title="View footnote.">57</a>]</sup></p>
</div>
<div class="imageblock">
<div class="content">
<img src="fig/cmpd_components_in_n4js.png" alt="cmpd components in n4js">
</div>
<div class="title">Figure 5. N4JS Component Overview</div>
</div>
<div class="paragraph">
<p>The N4JS platform distinguishes several types of components. The
following components can only be created by internal developers:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Runtime Environment</dt>
<dd>
<p>Definition of a runtime environment such as ECMAScript 5. A Runtime
Environment describes the base types provided by the runtime directly
which are usually globally available. Other components do not directly
rely on runtime environments, but on runtime libraries.</p>
</dd>
<dt class="hdlist1">Runtime Library</dt>
<dd>
<p>Collections of types provided by the runtime. These types may be
extensions to certain language specifications. E.g., the ECMAScript 6
collection classes are already provided by some environments otherwise
only supporting ECMAScript 5. The collections are defined in terms of
a runtime library which can then be provided by these environments.
Runtime libraries may also contain polyfills to alter types predefined
in the environment.</p>
</dd>
<dt class="hdlist1">Test Environment</dt>
<dd>
<p>Not yet clear. Environments defined for tests</p>
</dd>
<dt class="hdlist1">Test Library</dt>
<dd>
<p>Not yet clear. Libraries defined for tests supported by the to enable
running tests and viewing test reports directly within the , such as
<em>Mangelhaft</em>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following components can be created by external developers:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Apps</dt>
<dd>
<p>User-written N4JS applications running in a web browser (the reference
browser is Chrome).</p>
</dd>
<dt class="hdlist1">Processors</dt>
<dd>
<p>User-written N4JS processors running on Node.js.</p>
</dd>
<dt class="hdlist1">Libraries</dt>
<dd>
<p>User-written libraries used by apps, processors or other libraries.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>These components are described in detail later.</p>
</div>
<div class="paragraph">
<p>A component is similar to a single project in the N4JS IDE. It is
shipped as NFAR archive and contains:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Manifest</dt>
<dd>
<p>The manifest describing the components, dependencies and metadata.</p>
</dd>
<dt class="hdlist1">Resources</dt>
<dd>
<p>Resources such as images, N4ML files etc.</p>
</dd>
<dt class="hdlist1">Sources</dt>
<dd>
<p>Source files of modules - actual N4JS files used in a project.</p>
</dd>
<dt class="hdlist1">Compilation</dt>
<dd>
<p>Compiled, minified and concatenated versions of the N4JS files and
other JS files.</p>
</dd>
<dt class="hdlist1">Tests</dt>
<dd>
<p>Optional test sources and compiled tests.</p>
</dd>
<dt class="hdlist1">Source Maps</dt>
<dd>
<p>Optional source maps.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Components contain modules. describes what can be contained in a
component.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="fig/cmpd_component_content.png" alt="cmpd component content">
</div>
<div class="title">Figure 6. Content of a Component</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_component_types"><a class="anchor" href="#_component_types"></a>14.2. Component Types</h3>
<div class="paragraph">
<p>Different N4JS component types are described in this section. At compile
time and runtime, dependent components have to be available. This is the
responsibility of the user interface ( or ) and described in the
specification.</p>
</div>
<div class="sect3">
<h4 id="_apps"><a class="anchor" href="#_apps"></a>14.2.1. Apps</h4>
<div class="paragraph">
<p>Applications allow developers to bundle a project as an application and
deploy it to an N4 environment. An application is visible to users of
the N4 platform in the app store. Users can subscribe and use an
application that is available in the app store.</p>
</div>
</div>
<div class="sect3">
<h4 id="_processors"><a class="anchor" href="#_processors"></a>14.2.2. Processors</h4>
<div class="paragraph">
<p>Processors allow developers to bundle a project as a processor which can
run asynchronously on an N4 environment. Users can deploy a processor to
an N4 environment so that other developers can use its services.</p>
</div>
</div>
<div class="sect3">
<h4 id="_libraries"><a class="anchor" href="#_libraries"></a>14.2.3. Libraries</h4>
<div class="paragraph">
<p>A library is a user project providing modules with declaration.</p>
</div>
</div>
<div class="sect3">
<h4 id="_runtime_environment_and_runtime_libraries"><a class="anchor" href="#_runtime_environment_and_runtime_libraries"></a>14.2.4. Runtime Environment and Runtime Libraries</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1036" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1036</a>
</div>
</div>
<div class="paragraph">
<p>Runtime environments and libraries define globally available elements
(types, variables, functions) provided by the JavaScript engine. Both
must contain <em>only</em> definition files (n4jsd) of which all elements are
marked as (<code>@ProvidedByRuntime</code>) and (<code>@Global</code>)</p>
</div>
<div class="paragraph">
<p>Other projects may refer to a <em>single</em> runtime environment in their
manifest via <code>RequiredRuntimeEnvironment</code>  and to <em>multiple</em> runtime libraries via <code>RequiredRuntimeLibraries</code></p>
</div>
<div class="paragraph">
<p>Both types of components are referenced, similarly to libraries, by
their project Id. It is possible, however, to state that a specific
component may be used instead of another one via the <code>CompatibleWith</code> field defined by an environment or library.</p>
</div>
<div class="paragraph">
<p>The concrete runtime environment and library are selected by the
JavaScript engine. Deployment and execution scripts must ensure that a
component can run on the given engine; the required environments and
libraries must all be compatible with the provided environment. If no
runtime environment is specified, a default an ECMAScript 5 runtime is
assumed to be present.</p>
</div>
<div class="paragraph">
<p>Typical runtime environments are ES5 or ES6, typical runtime libraries
are DOM or HTML.</p>
</div>
<div class="paragraph">
<p>In JavaScript, browsers and other execution environments provide
built-in objects. In browsers, for example, the whole DOM is made
available via built-in object types. In this case, even the global
object also becomes a different type (in N4JS terms). Besides execution
environments such as browsers or Node.js, libraries also provide
functionality by exposing globally available functions. This is often
used to bridge execution environment inconsistencies. When browser API
differences are adapted by a library, this is called a <em>polyfil</em>.
Other adaptations, such as enabling ECMSScript 6 object types in
ECMAScript 5 environments, are known as <em>shim</em>. Instead of directly
supporting these kind of <code>hacks</code>, other components specify which
runtime environment and libraries they depend on by specifying unique
runtime ids. Possible shims (in case of environments) or polyfils (in
case of libraries) are transparently provided by the execution
environment and the bootstrap code.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tests"><a class="anchor" href="#_tests"></a>14.2.5. Tests</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1400" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1400</a>
</div>
</div>
<div class="paragraph">
<p>Tests are special projects which contain tests for other projects.</p>
</div>
<div class="paragraph">
<p>157Test Project[req:Test_Project]</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Tests have full access to the tested project including elements with
visibility.</p>
</li>
<li>
<p>Only other test projects can depend on tests project. In other
words, other components must not depend on test components.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In a test project, the tested projects can be specified via <code>testee</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_component_content"><a class="anchor" href="#_component_content"></a>14.3. Component Content</h3>
<div class="paragraph">
<p>A component is similar to a project in the N4JS IDE. It consists of
sources, test sources, resources (such as images) and libraries (nears).
These items are contained in separate folders alongside output folders
and settings specified in the manifest file. The manifest file is stored
at the root of the project (and explained in ).</p>
</div>
<div class="paragraph">
<p>For build and production purposes, other files such as <code>pom.xml</code> or
<code>.project</code> files are automatically derived from the . These files are
not to be added manually.</p>
</div>
</div>
<div class="sect2">
<h3 id="_component_manifest"><a class="anchor" href="#_component_manifest"></a>14.4. Component Manifest</h3>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-18" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-18</a>
</div>
</div>
<div class="sect3">
<h4 id="_syntax_14"><a class="anchor" href="#_syntax_14"></a>14.4.1. Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ProjectDescription:
        ('ProjectId'        ':' projectId=N4mfIdentifier)
    &amp;   ('ProjectType'      ':' projectType=ProjectType)
    &amp;   ('ProjectVersion'   ':' projectVersion=DeclaredVersion)
    &amp;   ('VendorId'         ':' declaredVendorId=N4mfIdentifier)
    &amp;   ('VendorName'       ':' vendorName=STRING)?

    &amp;   ('MainModule'       ':' mainModule=STRING)?

    // only available for runtime environments
    &amp;   (extendedRuntimeEnvironment=ExtendedRuntimeEnvironment)?

    // only in case of runtime libraries or runtime environment:
    &amp;   (providedRuntimeLibraries=ProvidedRuntimeLibraries)?

    // not available in runtime environments:
    &amp;   (requiredRuntimeLibraries=RequiredRuntimeLibraries)?

    // only available in N4JS components (Apps, Libs, Processor)
    &amp;   (projectDependencies=ProjectDependencies)?

    // only available in N4JS components (Apps, Libs, Processor)
    &amp;   ('ImplementationId' ':' implementationId=N4mfIdentifier)?

    // only available in N4JS components (Apps, Libs, Processor)
    &amp;   (implementedProjects=ImplementedProjects)?

    //only RuntimeLibrary and RuntimeEnvironemnt
    &amp;   (initModules=InitModules)?
    &amp;   (execModule=ExecModule)?


    &amp;   ('Output'           ':' outputPath=STRING)?
    &amp;   ('Libraries'        '{' libraryPaths+=STRING (',' libraryPaths+=STRING)* '}')?
    &amp;   ('Resources'        '{' resourcePaths+=STRING (',' resourcePaths+=STRING)* '}')?
    &amp;   ('Sources'          '{' sourceFragment+=SourceFragment+ '}')?

    &amp;   ('ModuleFilters'    '{' moduleFilters+=ModuleFilter+ '}')?

    &amp;   (testedProjects=TestedProjects)?

    &amp;   ('ModuleLoader' ':' moduleLoader=ModuleLoader)?
;

enum ProjectType :
    APPLICATION = 'application' |
    APPLICATION = 'app' | //XXX deprecated. Will be removed soon. Use application instead.
    LIBRARY = 'library' |
    LIBRARY = 'lib' | //XXX deprecated. Will be removed soon. Use library instead.
    API = 'API' |
    RUNTIME_ENVIRONMENT = "runtimeEnvironment" |
    RUNTIME_LIBRARY = "runtimeLibrary" |
    TEST = "test"
;

ExecModule returns ExecModule:
    {ExecModule}
    'ExecModule' ':' execModule=BootstrapModule
;


TestedProjects returns TestedProjects:
    {TestedProjects}
    'TestedProjects' '{'
        (testedProjects+=TestedProject (',' testedProjects+=TestedProject)*)?
    '}'
;


InitModules returns InitModules:
    {InitModules}
    'InitModules' '{'
        (initModules+=BootstrapModule (',' initModules+=BootstrapModule)*)?
    '}'
;

ImplementedProjects returns ImplementedProjects:
    {ImplementedProjects}
    'ImplementedProjects' '{'
        (implementedProjects+=ProjectReference (',' implementedProjects+=ProjectReference)*)?
    '}'
;

ProjectDependencies returns ProjectDependencies:
    {ProjectDependencies}
    'ProjectDependencies' '{'
        (projectDependencies+=ProjectDependency (',' projectDependencies+=ProjectDependency)*)?
    '}'
;

ProvidedRuntimeLibraries returns ProvidedRuntimeLibraries:
    {ProvidedRuntimeLibraries}
    'ProvidedRuntimeLibraries' '{'
        (providedRuntimeLibraries+=ProvidedRuntimeLibraryDependency (',' providedRuntimeLibraries+=ProvidedRuntimeLibraryDependency)*)?
    '}'
;

RequiredRuntimeLibraries returns RequiredRuntimeLibraries:
    {RequiredRuntimeLibraries}
    'RequiredRuntimeLibraries' '{'
        (requiredRuntimeLibraries+=RequiredRuntimeLibraryDependency (',' requiredRuntimeLibraries+=RequiredRuntimeLibraryDependency)*)?
    '}'
;

ExtendedRuntimeEnvironment returns ExtendedRuntimeEnvironment:
    {ExtendedRuntimeEnvironment}
    'ExtendedRuntimeEnvironment' ':' extendedRuntimeEnvironment=ProjectReference
;

DeclaredVersion :
    major=INT ('.' minor=INT ('.' micro=INT)?)? ('-' qualifier=N4mfIdentifier)?
;

SourceFragment:
    sourceFragmentType=SourceFragmentType '{' paths+=STRING (',' paths+=STRING)* '}'
;

enum SourceFragmentType :
    SOURCE = 'source' | EXTERNAL = 'external' | TEST = 'test'
;

ModuleFilter:
    moduleFilterType=ModuleFilterType '{'
        moduleSpecifiers+=ModuleFilterSpecifier (',' moduleSpecifiers+=ModuleFilterSpecifier)* '}'
;

BootstrapModule:
    moduleSpecifierWithWildcard=STRING ('in' sourcePath=STRING)?
;


ModuleFilterSpecifier:
    moduleSpecifierWithWildcard=STRING ('in' sourcePath=STRING)?
;

enum ModuleFilterType:
    NO_VALIDATE = 'noValidate' | NO_MODULE_WRAPPING = 'noModuleWrap'
;

ProvidedRuntimeLibraryDependency:
    project=SimpleProjectDescription
;

RequiredRuntimeLibraryDependency:
    project=SimpleProjectDescription
;

TestedProject:
    project=SimpleProjectDescription
;

/*
 * scope is optional, default scope is compile
 */
ProjectReference :
    project=SimpleProjectDescription
;

/*
 * scope is optional, default scope is compile
 */
ProjectDependency :
    project=SimpleProjectDescription
    (versionConstraint=VersionConstraint)?
    (declaredScope=ProjectDependencyScope)?
;

/*
 * vendorN4mfIdentifier is optional, if it is not specified, vendor id of current project is used.
 */
SimpleProjectDescription :
    (declaredVendorId=N4mfIdentifier ':')? projectId=N4mfIdentifier
;

/*
 * If no version range is specified, lower version is inclusive.
 */
VersionConstraint:
    (
        (exclLowerBound?='(' | '[')  lowerVersion=DeclaredVersion
            ((',' upperVersion=DeclaredVersion (exclUpperBound?=')' | ']') )? | ')')
    ) | lowerVersion=DeclaredVersion
;


enum ProjectDependencyScope :
    COMPILE = 'compile' | TEST = 'test'
;

enum ModuleLoader:
    N4JS = 'n4js'
|   COMMONJS = 'commonjs'
|   NODE_BUILTIN = 'node_builtin'
;

// N4mfIdentifier: left off for simplicity, allows everything that starts with a letter, also allows keywords
// Path: project relative path
// ModuleSpecifierWithWildcard</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_properties_8"><a class="anchor" href="#_properties_8"></a>14.4.2. Properties</h4>
<div class="paragraph">
<p>The manifest, called <code>manifest.n4mf</code>, specifies the following information:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ProjectId </dt>
<dd>
<p>Compare to Maven pom / manifest symbolic name.</p>
</dd>
<dt class="hdlist1">VendorId </dt>
<dd>
<p>This is similar to the group id in Maven.</p>
</dd>
<dt class="hdlist1">VendorName </dt>
<dd>
<p>The <em>vendor</em> of the project as a string. This is optional and if not
specified, vendor id is used as vendor name.</p>
</dd>
<dt class="hdlist1">ProjectType </dt>
<dd>
<p>The <em>type</em> of the project. The following types of projects exists:</p>
</dd>
<dt class="hdlist1">app</dt>
<dd>
<p>Application</p>
</dd>
<dt class="hdlist1">lib</dt>
<dd>
<p>Library</p>
</dd>
<dt class="hdlist1">test</dt>
<dt class="hdlist1">api</dt>
<dt class="hdlist1">runtimeEnvironment</dt>
<dd>
<p>Runtime Environment</p>
</dd>
<dt class="hdlist1">runtimeLibrary</dt>
<dd>
<p>Runtime Library</p>
</dd>
<dt class="hdlist1">DeclaredVersion </dt>
<dd>
<p>The <em>version</em> of the project. The version consists of a major, minor and
micro version. The syntax of the version is given by:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>    DeclaredVersion :
        major=INT ('.' minor=INT ('.' micro=INT)?)? ('-' qualifier=ID)?
    ;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We use <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>q</mi><mi>u</mi><mi>a</mi><mi>l</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>r</mi><mo>=</mo><mi>S</mi><mi>N</mi><mi>A</mi><mi>P</mi><mi>S</mi><mi>H</mi><mi>O</mi><mi>T</mi></math> in our Maven builds so that each
build uses the latest available version of a project. The qualifier is
only supported for this tooling and is removed during deployment. The
lengths of the major, minor and micro numbers is additionally limited to
four digits.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">MainModule </dt>
<dd>
<p>(optional) A plain module specifier defining the project’s <code>main
module</code>. If this property is defined, other projects can import from
this project using imports where the string following keyword <code>from</code> states the
project name and not the complete module specifier (see <a href="#Imprt_Statement_Semantics">[Imprt_Statement_Semantics]</a>).</p>
</dd>
<dt class="hdlist1">CompatibleWith </dt>
<dd>
<p>In the case of a runtime environment or library, this specifies to which
other component this one is compatible to.</p>
</dd>
<dt class="hdlist1">RequiredRuntimeEnvironment </dt>
<dd>
<p>Environment this project depends on. This is a simple project ID,
runtime environments are not versioned. This is usually omitted and
concrete environments are computed from the required N4JS libraries and
runtime libraries.</p>
</dd>
<dt class="hdlist1">RequiredRuntimeLibraries </dt>
<dd>
<p>Comma-separated list of runtime libraries this project depends on. These
are a simple project IDs, runtime libraries are not versioned.</p>
</dd>
<dt class="hdlist1">ProjectDependencies </dt>
<dd>
<p>The <em>dependencies</em> section describes which projects this project
requires. A <em>dependency</em> has the following properties:</p>
<div class="ulist">
<ul>
<li>
<p>The <em>vendorId</em>. This is optional. If no vendor id is given, the
vendor id of the current project is also used as vendor id for this
project dependency.</p>
</li>
<li>
<p>The <em>projectId</em></p>
</li>
<li>
<p>Either the minimum excluded or included version and the maximum
excluded or included version. If no version (range) is given [0.0.0,
infinity) is assumed. If only one version (e.g. 1.0) is given this is
interpreted as [1.0, infinity]. Writing (1.0) means (1.0, infinity).</p>
</li>
<li>
<p>The <em>scope</em> of the dependency. The scopes are inspired by Maven [<a href="#MavenDependencies">MavenDependencies</a>] and
the following scopes are supported:</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">compile</dt>
<dd>
<p>This dependency is needed for compilation of the project <em>and</em> it
needs to exist on the environment when deploying it.</p>
</dd>
<dt class="hdlist1">test</dt>
<dd>
<p>This dependency is only needed for compiling and running tests. <em>Types
imported from a test dependency are only accessible from a test source
fragment.</em></p>
<div class="paragraph">
<p>The deployment descriptor of a project only contains dependencies with
scope compile. If there is no scope explicitly set, the scope is set to
[compile].</p>
</div>
</dd>
<dt class="hdlist1">Output </dt>
<dd>
<p>Path to output folder, compilers may use subfolders inside this folder.</p>
</dd>
<dt class="hdlist1">Libraries </dt>
<dd>
<p>List of paths to libraries, that is, folders in which nfars are found.</p>
</dd>
<dt class="hdlist1">Resources </dt>
<dd>
<p>List of paths to resources, that is, folders in which images, css etc.
is found.</p>
</dd>
<dt class="hdlist1">Sources </dt>
<dd>
<p>List of source fragments. A source fragment is a path to sources (n4js
or js), which are typically compiled to the output path, with a given
type. There exist three different source fragment types:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Source</strong>: files, will be available in scope for projects that defines
this project as compile time dependency. A module contained in a
source fragment of kind <em>source</em> can only access modules from other
source fragments with kind source and from dependencies with scope
compile. Files in sources will be validated and compiled to the output
folder.</p>
</li>
<li>
<p><strong>test</strong>: files, will be available in scope for projects that defines this
project as test time dependency. A module contained in a source
fragment of kind <em>test</em> can access any module from other source
fragments and from dependencies with any scope. Files in sources will
be validated and compiled to the output folder (maybe a subfolder).</p>
</li>
<li>
<p><strong>external</strong>: Implementation of modules defined in definition files (n4jsd). These
implementations are never validated nor fully compiled. Instead, they
are only wrapped into module definitions and copied to the output
folder. See <a href="#External_Declarations">[External_Declarations]</a> and <a href="#Implementation_of_External_Declarations">[Implementation_of_External_Declarations]</a> for details.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Filters for fine-tuning the validator and compiler. A filter is applied
to modules matching the given module specifier which may contain
wildcards, optionally restricted to modules defined in a specific source
path. The following filters are supported:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">noValidate</dt>
<dd>
<p>Modules matching this filter are not semantically validated. That is,
they are still syntactically validated. If they are contained in
source or test source fragments, it must be possible to bind
references to declarations inside these modules. Note that switching
off validation for n4js files is disallowed.</p>
</dd>
<dt class="hdlist1">noModuleWrap</dt>
<dd>
<p>Files matching this filter are not wrapped into modules and they are
not semantically validated. Since they are assumed to be wrapped into
modules, declarations inside these modules cannot be referenced by
n4js code.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Optional property that defines what module loader are supported by the
modules in this component. Possible values are</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">n4js</dt>
<dd>
<p>(default) The modules in this component can be loaded with SystemJS or
with CommonJS.</p>
</dd>
<dt class="hdlist1">commonjs</dt>
<dd>
<p>Modules in this component must be loaded with CommonJS. When these
modules are referenced in generated code (i.e. when importing from
these modules), the module specifier will be prefixed with <code>@@cjs/</code>.</p>
</dd>
<dt class="hdlist1">node_builtin</dt>
<dd>
<p>Modules in this component represent node built-in modules such as <code>fs</code>
or <code>https</code>. When these modules are referenced in generated code
(i.e. when importing from these modules), the module specifier will be
prefixed with <code>@node/</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Validation or module-wrapping can be turned off for certain files or
folders via the manifest properties <code>no-validate</code> and
<code>no-module-wrapping</code>. While this is mostly intended for external
implementation modules below the source-external folder, it is also
allowed for <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>.</mo><mi>j</mi><mi>s</mi></math> and <math xmlns="http://www.w3.org/1998/Math/MathML"><mo>.</mo><mi>n</mi><mn>4</mn><mi>j</mi><mi>s</mi></math> files in the
source folder.</p>
</div>
<div class="paragraph">
<p>158GeneralConstraints</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The projectId used in the manifest file have to match the project
name in file system as well as project name in the Eclipse workspace.</p>
</li>
<li>
<p>There must be an output directory specified so the compiler(s) can
run.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>159Paths Paths are constrained in the following way:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A path cannot appear more than one time within a source fragment
type (same applies to paths in the resources section).</p>
</li>
<li>
<p>A path cannot be used in different source fragment types at same
times.</p>
</li>
<li>
<p>A path can only be declared exclusively in one of the sections
Output, Libraries, Resources or Sources.</p>
</li>
<li>
<p>A path must not contain wild cards.</p>
</li>
<li>
<p>A path has to be relative to the project path.</p>
</li>
<li>
<p>A path has to point to folder.</p>
</li>
<li>
<p>The folder a defined path points to must exist in the project (but
in case of non-existent folders of source fragments, only a warning is
shown). </p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/339" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-339</a>
</div>
</div>
<div class="paragraph">
<p>160ModuleSpecifiers Module specifiers are constrained in the following
way:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Within a module filter type no duplicate specifiers are allowed.</p>
</li>
<li>
<p>A module specifier is by default applied relatively to all defined
source containers, i.e. if there src and src2 defined as source
containers in both folders files are looked up that matches the given
module specifier</p>
</li>
<li>
<p>A module specifier can be constrained to be applied only to a
certain source container.</p>
</li>
<li>
<p>A module specifier is allowed to contain wildcards but it must
resolve to some existing files in the project</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>161ModuleSpecifierWildcardConstraints</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>All path patterns are case sensitive.</p>
</li>
<li>
<p>all module specifiers will be matched.</p>
</li>
<li>
<p>all module specifiers will be matched.</p>
</li>
<li>
<p>matches all module specifiers whose qualified name consists of two
segments where the first part matches test and the second part starts
with an <code>A</code> and then two more characters.</p>
</li>
<li>
<p>- matches all module specifiers whose qualified name contains a
segment that matches test and the last segment ends with an ’XYZ’.</p>
</li>
<li>
<p>A module specifier wild card isn’t allowed to contain <code>*\*\*</code>.</p>
</li>
<li>
<p>A module specifier wild card isn’t allowed to contain relative
navigation.</p>
</li>
<li>
<p>A module specifier wild card shouldn’t contain the file extension
(only state the file name (pattern) without extension, valid file
extensions will then be used to match the file).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Examples of using external source fragments and filters are given in ().</p>
</div>
<div class="paragraph">
<p>[[ex:No validation and module wrapping example]]
The following manifest shows the use of filters to disable validation
and module wrapping.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ProjectId: Test
ProjectType: lib
ProjectVersion: 0.0.1-SNAPSHOT
VendorId: eu.numberfour
VendorName: "NumberFour AG"
Output: "src-gen"
Sources {
    source {
        "src1",
        "src2"
    }
    external {
        "external"
    }
}
Libraries {
    "lib"
}
Resources {
    "resources"
}
ModuleFilters {
    noValidate {
        "p/UglyHack",
        "**/*" in "src2"
    }
    noModuleWrap {
        "p/myAlreadyAsModuleHack"
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_component_dependencies"><a class="anchor" href="#_component_dependencies"></a>14.5. Component Dependencies</h3>
<div class="paragraph">
<p>There are several dependencies between components. We can distinguish
between <code>require</code> dependencies and <code>provide</code> dependencies.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">require</dt>
<dd>
<p><em>N4JS Components</em> require:
+</p>
<div class="ulist">
<ul>
<li>
<p><em>APIs</em></p>
</li>
<li>
<p><em>RuntimeLiberaries</em> and</p>
</li>
<li>
<p><em>Libraries</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">provide</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>Runtime Environments</em> provide <em>Runtime Libraries</em> and maybe extend
other <em>Runtime Environments</em> (which means they provide the same
runtime libraries as the extended environments and the same base
types).</p>
</li>
<li>
<p><em>SysLibs</em> implement (<code>provide implementations</code> of) <em>APIs</em></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_runtime_environment_resolution"><a class="anchor" href="#_runtime_environment_resolution"></a>14.5.1. Runtime Environment Resolution</h4>
<div class="paragraph">
<p>In order to execute (run, debug, or test) an <em>N4JS Component</em>, an
actual <em>runner</em> has to be determined. Since runners support runtime
environments, this basically means calculating runtime environments
which provide all necessary runtime libraries needed by the component.
This is done by computing the transitive closure of required runtime
libraries and by comparing that with the transitive closure of runtime
libraries provided by an environment.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_modules"><a class="anchor" href="#_modules"></a>14.6. Modules</h3>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-8" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-8</a>
</div>
</div>
<div class="paragraph">
<p>All N4JS files are modules, sometimes also called compilation unit (CU).
This is the overall structure of a module, based on [<a href="#ECMA15a">ECMA15a(p.S14)</a>].</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Script: {Script}
    annotations+=ScriptAnnotation*
    scriptElements+=ScriptElement*;

/*
 * The top level elements in a script are type declarations, exports, imports or statements
 */
ScriptElement:
      AnnotatedScriptElement
    | N4ClassDeclaration&lt;Yield=false&gt;
    | N4InterfaceDeclaration&lt;Yield=false&gt;
    | N4EnumDeclaration&lt;Yield=false&gt;
    | ImportDeclaration
    | ExportDeclaration
    | RootStatement&lt;Yield=false&gt;
;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Grammar and semantics of import statement is described in ; of of export
statement is described in .</p>
</div>
<div class="paragraph">
<p>
An import statement imports a variable declaration, function
declaration, or N4 type declaration defined and exported by another
module into the current module under the given alias (which is similar
to the original name if no alias is defined). The name of the module is
its project’s source folder’s relative path without any extension, see
for details.</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-179" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-179</a>
</div>
</div>
<div class="paragraph">
<p>This are the properties of script, which can be specified by the user:</p>
</div>
<div class="paragraph">
<p>Arbitrary annotations, see and below for details.</p>
</div>
<div class="paragraph">
<p>The content of the script.</p>
</div>
<div class="paragraph">
<p>And we additionally define the following pseudo properties:</p>
</div>
<div class="paragraph">
<p>File system path (path delimiter is always <code>’/’</code>) relative to the source
fragment of the file without the extension. E.g.: given a source folder
<code>src</code>, <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mi>a</mi><mi>t</mi><mi>h</mi></math> of a module located at:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>src/n4/lang/List.js</code> is <code>n4/lang/List</code></p>
</li>
<li>
<p><code>src/n4/lang/Objects.prototypes</code> is <code>n4/lang/Objects</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Pseudo property consists of the project name and project version of the
module followed by the path, the concrete syntax is:<br>
<code>&lt;project.name&gt;-&lt;project.version&gt;/&lt;module.path&gt;</code>,<br>
where project version includes all version parts except the qualifier.<br>
E.g. given a module with path <code>n4/lang/List</code> in a project <code>lib</code> with
version <code>1.0.0</code>, the <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mi>x</mi><mi>p</mi><mi>a</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>d</mi><mi>P</mi><mi>a</mi><mi>t</mi><mi>h</mi></math> is
<code>lib-1.0.0/n4/lang/List</code>.</p>
</div>
<div class="paragraph">
<p>Pseudo property contains all load time dependencies of this module.</p>
</div>
<div class="paragraph">
<p>Pseudo property contains all runtime dependencies of this module.</p>
</div>
<div class="paragraph">
<p>Pseudo property contains all dependencies of this module. This is the
union of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mi>o</mi><mi>a</mi><mi>d</mi><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>D</mi><mi>e</mi><mi>p</mi><mi>s</mi></math> and <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi><mi>u</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>D</mi><mi>e</mi><mi>p</mi><mi>s</mi></math> which
maintains the ordering of both lists, with the
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mi>o</mi><mi>a</mi><mi>d</mi><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>D</mi><mi>e</mi><mi>p</mi><mi>s</mi></math> at the front.</p>
</div>
<div class="paragraph">
<p>Pseudo properties to be set via annotations are explained in .</p>
</div>
</div>
<div class="sect2">
<h3 id="_numberfour_archives_nfar"><a class="anchor" href="#_numberfour_archives_nfar"></a>14.7. NumberFour Archives (NFAR)</h3>
<div class="paragraph">
<p>  </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-19" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-19</a>
<a href="https://jira.numberfour.eu/browse/IDE-37" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-37</a>
<a href="https://jira.numberfour.eu/browse/IDE-46" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-46</a>
</div>
</div>
<div class="paragraph">
<p>Compiled projects are packaged in a N4 bundle archive and use <code>nfar</code> as a file extension. A nfar file is a zip archive that contains all source files,
compiled files and metadata of a project. It’s used to deploy projects
to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>N4 environments via the N4 deployment web service</p>
</li>
<li>
<p>Maven artifact repositories via the standard Maven deploy</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A nfar archive has the following structure:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">/resources/</dt>
<dd>
<p>contains all resources such as images and css files</p>
</dd>
<dt class="hdlist1">/src/</dt>
<dd>
<p>contains all JavaScript and N4ML source files, but doesn’t contain
test source files.</p>
</dd>
<dt class="hdlist1">/output/</dt>
<dd>
<p>contains the compiled JavaScript.</p>
</dd>
<dt class="hdlist1">/model/</dt>
<dd>
<p>contains the compiled type model.</p>
</dd>
<dt class="hdlist1">manifest.pmi</dt>
<dd>
<p>the manifest file</p>
</dd>
<dt class="hdlist1">bundle.json</dt>
<dd>
<p>This is used to track the format/version of the contained data, so
that we are able to see if two bundles are compatible with each other</p>
</dd>
<dt class="hdlist1">package.json</dt>
<dd>
<p>This contains the <em>N4 deployment descriptor</em> required by the N4
deployment webservice. This file is only added to the nfar file when
deploying it to a N4 environment! That means that it’s not available
in nfar files deployed to a Maven artifact repository.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_n4_deployment_descriptor"><a class="anchor" href="#_n4_deployment_descriptor"></a>14.7.1. N4 Deployment Descriptor</h4>
<div class="paragraph">
<p>The N4 deployment descriptor of a project <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math> is a NFON
formatted file with the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>{
  "@type":"n4.deployment.PackageDescription",
  "kind":~$p.deploymentKind$~, // LIBRARY, APPLICATION or PROCESSOR
  "name":~$p.name$~,
  "singleton":~$p.type="LIBRARY"$~,
  "version":~$p.version$~,
  "displayName":"",
  "buildComment":"",
  "allJavaScriptFile":~$p.allJavaScriptFile$~,
  "allMinJavaScriptFile":~$p.allMinJavaScriptFile$~,
  "dependentPackages": [
    // for (d in ~$p.dependencies$~)
    {
        "@type":"n4.deployment.DependencyInfo",
        "name": ~$d.name$~,
        "version": ~$d.version$~
    }
  ],
  "properties": {
    "@type":"n4.coreservices.graph.deployment.AppProperties",
    "objectHandlers": [
        // for (o in ~$p.objectHandlers$~)
        {
                "@type":"n4.coreservices.graph.deployment.ObjectHandler",
                "type":~$o.type$~,
                "viewId":~$o.viewId$~,
                "viewType":~$o.viewType$~,
                "perspectiveId":~$o.perspectiveId$~,
                "onlyCreatedByApp":~$o.onlyCreatedByApp$~,
                "actions":~$o.actions$~, // array of strings
                "docFileProvider":~$o.docFileProvider$~,
                "docMimeContentTypeMatch":~$o.docMimeContentTypeMatch$~
        }
    ]
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_properties_files"><a class="anchor" href="#_properties_files"></a>14.8. Properties Files</h3>
<div class="paragraph">
<p>Properties files have the file extension <code>properties</code> and describe how
to localize text in a project. They basically define keys
<a href="#Primitive_Pathselector__I18nKey">[Primitive_Pathselector__I18nKey]</a> with their
values. The key is used during runtime to retrieve text localized to the
user’s locale.</p>
</div>
<div class="sect3">
<h4 id="_syntax_n4_deployment_descriptor_syntax"><a class="anchor" href="#_syntax_n4_deployment_descriptor_syntax"></a>14.8.1. Syntax [[N4 Deployment Descriptor Syntax]]</h4>
<div class="paragraph">
<p>The syntax of a resource file is defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ResourceFile:   Comment* | $entry+=$ Entry*;
Comment:        '#' .* EOL;
Entry:          $key$ = KeyIdentifier '=' $value$ = .* EOL;
KeyIdentifier:  LETTER (DIGIT | LETTER | '.')*;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_constraints"><a class="anchor" href="#_constraints"></a>14.8.2. Constraints</h4>
<div class="paragraph">
<p>Properties files have to be stored in source fragment of type source.
The <em>base folder</em> for storing the properties files of a project
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math> is <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mo>.</mo><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mrow><mo>/</mo><mi>n</mi><mi>l</mi><mi>s</mi></mrow></math>. The
language-specific resource files are stored in subfolders of the base
folder. The base language (normally english) has to be located in a
subfolder of the base folder. The resource files for other languages
have to be located in a subfolder with the name given by syntax
<strong>&lt;ISO Language Code&gt;_&lt;ISO Country Code&gt;</strong>, where ISO Language Code is
given by the ISO-639 standard and ISO Country Code is given by the
ISO-3166 standard.</p>
</div>
<div class="paragraph">
<p>All resource files stored in a language folder are compiled to a
JavaScript file which exports all resource keys as an object literal.</p>
</div>
<div class="paragraph">
<p>The resource files of a project are automatically loaded. To access a
resource key <code>key</code> stored in a resource file <code>my.properties</code>, you have
to use the file name as a prefix (e.g. you have to use the key <code>my.key</code>).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_api_and_implementation_components"><a class="anchor" href="#_api_and_implementation_components"></a>14.9. API and Implementation Components</h3>
<div class="paragraph">
<p>Instead of providing an implementation, N4JS components may only define
an API by way of one or more n4jsd files which is then implemented by
separate implementation projects. For one such API project, several
implementation projects may be provided. Client code using the API will
always be bound to the API project only, i.e. only the API project will
appear in the client project’s manifest under project dependencies. When
launching the client code, the launcher will choose an appropriate
implementation for each API project in the client code’s direct or
indirect dependencies and transparently replace the API project by the
implementation project. In other words, instead of the API project’s
output folder, the implementation project’s output folder will be put on
the class path. Static compile time validations ensure that the
implementation projects comply to their corresponding API project.</p>
</div>
<div class="paragraph">
<p>Note how this concept can be seen as an alternative way of providing the
implementation for an n4jsd file: usually n4jsd files are used to define
types that are implemented in plain JavaScript code or provided by the
runtime; this concept allows for providing the implementation of an
n4jsd file in form of ordinary N4JS code.</p>
</div>
<div class="paragraph">
<p>At this time, the concept of API and implementation components is in a
prototype phase and the tool support is limited. The goal is to gain
experience from using the early prototype support and then refine the
concept over time.</p>
</div>
<div class="paragraph">
<p>Here is a summary of the most important details of this concept (they
are all subject to discussion and change):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Support for this concept, esp. validations, should not be built into
the core language but rather implemented as a separate
validation/analysis tool. Validation is currently provided in the form
of a separate view: the API / Implementation compare view.</p>
</li>
<li>
<p>A project that defines one or more other projects in its manifest
under <code>ImplementedProjects</code> is called <em>implementation project</em>. A project that has another
project pointing to itself via <code>ImplementedProjects</code> is called <em>API project</em>.
Note that, at the moment, there is no explicit definition making a project an API project.</p>
</li>
<li>
<p>An implementation project must define an implementation ID in its
manifest using the <code>ImplementationID</code> property.</p>
</li>
<li>
<p>For each public or public@Internal classifier or enum in an API
project, there must be a corresponding type with the same
fully-qualified name of the same or higher visibility in the
implementation project. For each member of such a type in the API, there
must exist a corresponding, owned <em>or</em> inherited type-compatible member
in the implementation type.</p>
</li>
<li>
<p>Beyond type compatibility, formal parameters should have the same name
on API and implementation side; however, different names are legal but
should be highlighted by API / Implementation tool support as a (legal)
change.</p>
</li>
<li>
<p>Comments regarding the state of the API or implementation may be added
to the JSDoc in the source code using the special tag @apiNote. API /
Implementation tool support should extract and present this information
to the user in an appropriate form.</p>
</li>
<li>
<p>If an API class <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> implements an interface
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math>, it has to explicitly (re-) declare all members of
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math> similar to the implementation. This is necessary for
abstract classes anyway in order to distinguish the implemented methods
from the non-implemented ones. For concrete classes, we want all members
in <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> in order to be complete and avoid problems when the
interface is changed or <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> is made abstract.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_execution_of_api_and_implementation_components"><a class="anchor" href="#_execution_of_api_and_implementation_components"></a>14.9.1. Execution of API and Implementation Components</h4>
<div class="paragraph">
<p>When launching an N4JS component <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> under runtime
environment <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi><mi>E</mi></math>, the user may(!) provide an implementation
ID <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi><mspace width="-0.167em"/><mi>I</mi><mspace width="-0.167em"/><mi>D</mi></math> to run. Then, for each API project
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi></math> in the direct or indirect dependencies of
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> an implementation project is chosen as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Collect all implementation projects for <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi></math>
(i.e. projects that specify <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi></math> in their manifest under <code>ImplementedProjects</code>).</p>
</li>
<li>
<p>Remove implementation projects that cannot be run under runtime
environment <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi><mi>E</mi></math>, using the same logic as for running
ordinary N4JS components (this step is not implemented yet!).</p>
</li>
<li>
<p>If there are no implementation projects left, show an error.</p>
</li>
<li>
<p>If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi><mspace width="-0.167em"/><mi>I</mi><mspace width="-0.167em"/><mi>D</mi></math> is defined (i.e. user specified an
implementation ID to run), then:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If there is an implementation project left with implementation ID
<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi><mspace width="-0.167em"/><mi>I</mi><mspace width="-0.167em"/><mi>D</mi></math>, use that.</p>
</li>
<li>
<p>Otherwise, show an error.</p>
</li>
</ol>
</div>
</li>
<li>
<p>If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi><mspace width="-0.167em"/><mi>I</mi><mspace width="-0.167em"/><mi>D</mi></math> is undefined, then</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If there is exactly 1 implementation project left, use it.</p>
</li>
<li>
<p>Otherwise, in UI mode prompt the user for a choice, in headless mode
show an error.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Having found an implementation project <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>I</mi><mi>n</mi></msub></math> for each API
project <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>A</mi><mi>n</mi></msub></math>, launch as usual except that whenever
<math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>A</mi><mi>n</mi></msub></math>’s output folder would be used, use <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>I</mi><mi>n</mi></msub></math>’s
output folder (esp. when constructing a <code>class path</code>) and when loading
or importing a type from <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>A</mi><mi>n</mi></msub></math> return the corresponding type
with the same fully-qualified name from <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>I</mi><mi>n</mi></msub></math>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_api_and_implementation_with_di"><a class="anchor" href="#_api_and_implementation_with_di"></a>14.10. API and Implementation With DI</h3>
<div class="paragraph">
<p>API projects may use N4JS DI (<a href="#Dependency_Injection">[Dependency_Injection]</a>) language features which require
Implementation projects to provide DI-compatible behaviour in order to
allow a Client (implemented against an API project) to be executed with
a given Implementation project. This is essential for normal execution
and for test execution. Figure <a href="#diag_APITestsDI_Overview">Overview of API tests with DI</a> shows some of those considerations from test client point of view.</p>
</div>
<div id="diag_APITestsDI_Overview" class="imageblock">
<div class="content">
<img src="fig/diag_ApiTestsDI_Overview.png" alt="diag ApiTestsDI Overview">
</div>
<div class="title">Figure 7. Overview of API tests with DI</div>
</div>
<div class="paragraph">
<p>Static DI mechanisms in N4JS allow an API project to enforce
Implementation projects to provide all necessary information. This
allows clients to work seamlessly with various implementations without
specific knowledge about them or without relying on extra tools for
proper project wiring. Figure <a href="#diag_ApiTestsDI_StaticDI">API tests with static DI</a> shows how API project defines project wiring and enforces certain level of testability.</p>
</div>
<div id="diag_ApiTestsDI_StaticDI" class="imageblock">
<div class="content">
<img src="fig/diag_ApiTestsDI_StaticDI.png" alt="diag ApiTestsDI StaticDI">
</div>
<div class="title">Figure 8. API tests with static DI</div>
</div>
<div class="paragraph">
<p>During Client execution, weather it is test execution or not, N4JS
mechanisms will replace the API project with a proper Implementation
project. During runtime DI mechanisms will take care of providing proper
instances of implantation types.
Figure <a href="#diag_ApiTestsDI_Views">Types view and Instances view</a> shows Types View perspective of the client, and Instances View perspective of the client.</p>
</div>
<div id="diag_ApiTestsDI_Views" class="imageblock">
<div class="content">
<img src="fig/diag_ApiTestsDI_Views.png" alt="diag ApiTestsDI Views">
</div>
<div class="title">Figure 9. Types view and Instances view</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_plainjs"><a class="anchor" href="#_plainjs"></a>15. PlainJS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since N4JS is a super set of JavaScript, is it both possible to use
plain JavaScript in N4JS and vice versa. There may be some obstacles due
to concepts introduced by N4JS to make code more maintainable and
robust:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>N4JS’ static type system may complain about some older JavaScript
hacks. Declared types, in particular, are assumed to be implicitly
frozen.</p>
</li>
<li>
<p>In N4JS, modules are used as namespaces with explicit export and
import statements. The notion of globals is not directly supported by
N4JS as this leads to unexpected side effects (several components
providing and thus overriding global definitions, for example).</p>
</li>
<li>
<p>N4JS defines a (ECMAScript 6 compatible) concept of object-oriented
programming which may conflict with other plain JavaScript solutions.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To overcome these problems, N4JS provides a couple of techniques
summarized in this chapter.</p>
</div>
<div class="sect2">
<h3 id="_type_inference_and_validation_for_plain_js"><a class="anchor" href="#_type_inference_and_validation_for_plain_js"></a>15.1. Type Inference and Validation for Plain JS</h3>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/45" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-45</a>
</div>
</div>
<div class="paragraph">
<p>In plain JavaScript mode:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>All declared variables are inferred to <code>any+</code>.</p>
</li>
<li>
<p>All declared functions return and accept a variadic number of
arguments of type <code>any+</code>.</p>
</li>
<li>
<p>It is allowed to use the <code>return</code> statement with or without an expression.</p>
</li>
<li>
<p>New expressions with a receiver of <code>any+</code> is allowed.</p>
</li>
<li>
<p>No type arguments are required for generic built-in types.</p>
</li>
<li>
<p>Assigning a value to a read-only variable is not checked.</p>
</li>
<li>
<p>Undeclared variables are treated as <code>any+</code> as well.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that this essentially disables all validation particularly since
methods such as the ’import’-like function <code>require</code> are unknown.</p>
</div>
</div>
<div class="sect2">
<h3 id="_external_declarations"><a class="anchor" href="#_external_declarations"></a>15.2. External Declarations</h3>
<div class="paragraph">
<p> </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-572" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-572</a>
<a href="https://jira.numberfour.eu/browse/IDE-1236" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1236</a>
</div>
</div>
<div class="paragraph">
<p>N4JS supports declaring external classes as
a means to declare classes whose implementation is not N4JS so they can
be used from N4JS. Together with structural typing , this allows N4JS to
seamlessly integrate frameworks and libraries which have not been
implemented in N4JS but in plain ECMAScript or another language.</p>
</div>
<div class="paragraph">
<p>[[External allowed occurrences]]</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Declarations with external flags are only allowed in files with the
extension \($n4jsd$\) (so called N4JS definition files).</p>
</li>
<li>
<p>Only external classes, external interfaces marked with <code>@N4JS</code>, external
enums, external function declarations and structurally typed interfaces
are allowed in a \($n4jsd$\) file.</p>
</li>
<li>
<p>Declarations with external flags are allowed to subclass built-in type
<code>Error</code> type and all of its descendants such as <code>EvalError</code>, <code>RangeError</code>, <code>ReferenceError</code>, <code>SyntaxError</code>, <code>TypeError</code> and <code>URIError</code>, although any of the error types are annotated with <code>@N4JS</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following explanations apply to all external declarations except
where stated otherwise.</p>
</div>
<div class="paragraph">
<p>In general, an external declaration uses the same syntax as the
declaration of a normal N4JS declaration with the addition of the
modifier <code>external</code>.</p>
</div>
<div class="paragraph">
<p>External classifiers are always ’entirely external’ in that it is not
possible to combine defined methods and external methods within a single
class or interface.</p>
</div>
<div class="paragraph">
<p>[[External classes inheritance]]</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>An external class <em>without</em> the <code>@N4JS</code> annotation can only inherit from
another external class or from one of the built-in ECMAScript types
(e.g. Object). That is, by default external classes are derived from <code>Object</code>.</p>
</li>
<li>
<p>An external class <em>with</em> the annotation <code>@N4JS</code> can only inherit from
another external class annotated with <code>@N4JS</code> or from non-external N4JS classes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>[[Structurally typed interface implementation]]</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>An external class <em>without</em> the annotation <code>@N4JS</code> can only be implemented
by structurally typed interfaces.</p>
</li>
<li>
<p>An external class <em>with</em> the annotation <code>@N4JS</code> can only be implemented by
structurally typed interfaces annotated with <code>@N4JS</code>.</p>
</li>
<li>
<p>An external interface <em>without</em> the annotation <code>@N4JS</code> must be defined
structurally.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>[[External interface inheritance]]</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>An interface in a n4jsd file <em>without</em> the annotation <code>@N4JS</code> can only
inherit from another interface within a n4jsd file.</p>
</li>
<li>
<p>An interface <em>with</em> the <code>@N4JS</code> annotation can only inherit from another
interface annotated with <code>@N4JS</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>[[External class interface members]]</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The static and instance methods, getters and setters of an external
class must not have a method body.</p>
</li>
<li>
<p>The static and instance fields of an external class must not have an
initializer.</p>
</li>
<li>
<p>The constructor of an external class without the annotation <code>@N4JS</code> must not be declared private. </p>
</li>
<li>
<p>Methods in interfaces with default implementation which cannot be
expressed in the definition file must be annotated with <code>@ProvidesDefaultImplementation</code>.
This is only allowed in interfaces annotated with <code>@N4JS</code>. </p>
</li>
<li>
<p>Fields in interfaces or classes with initializers which cannot be
expressed in the definition file, must be annotated with <code>@ProvidesInitializer</code>.
This is only allowed in classes or interfaces annotated with <code>@N4JS</code>.</p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/431" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-431</a>
<a href="https://jira.numberfour.eu/browse/IDE-1403" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1403</a>
<a href="https://jira.numberfour.eu/browse/IDE-1509" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1509</a>
</div>
</div>
<div class="paragraph">
<p>This means that in external classes, all members except constructors may
be declared private even if the class is not annotated with <code>@N4JS</code>. In
interfaces, however, private members are disallowed anyway,
cf. <a id="req:Interfaces"></a>.</p>
</div>
<div class="paragraph">
<p>[[Other external declarations]]
Other external declarations</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The literals of an external enum must not have a value.</p>
</li>
<li>
<p>An external function declaration must not have a body.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_declaring_externals"><a class="anchor" href="#_declaring_externals"></a>15.2.1. Declaring externals</h4>
<div class="paragraph">
<p>By default, the implicit supertype of an external class is Object. If
the <code>@N4JS</code> annotation is provided it is N4Object. If a superclass is explicitly
given, the constraints from the previous section apply.</p>
</div>
</div>
<div class="sect3">
<h4 id="_instantiating_external_classes"><a class="anchor" href="#_instantiating_external_classes"></a>15.2.2. Instantiating external classes</h4>
<div class="paragraph">
<p>In most cases, it is desirable to instantiate external classes from
external projects. Publicly exporting the class definition and providing
a public constructor is good practice.</p>
</div>
<div class="paragraph">
<p>In some cases, the instantiation from an outer scope is not wanted. A
possible approach is to use a structurally typed interface instead of a
class to link to the implementation.</p>
</div>
<div class="paragraph">
<p>In case of API-definitions (see <a href="#API_and_Implementation_Components">[API_and_Implementation_Components]</a>), it might be useful to limit the visibility of classes to narrower scopes such as package or private.</p>
</div>
<div class="paragraph">
<p>External declarations can be instantiated if the following three
requirements are fulfilled (not a constraint!):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>External declarations have to be exported and be marked as public so
they are accessible from outside.</p>
</li>
<li>
<p>The contained or inherited constructor of an external class must be
public.</p>
</li>
<li>
<p>The external class must be linked to an implementation module (see
below <a href="#_implementation_of_external_declarations">Implementation of External Declarations</a>).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_of_external_declarations"><a class="anchor" href="#_implementation_of_external_declarations"></a>15.2.3. Implementation of External Declarations</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/242" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-242</a>
</div>
</div>
<div class="paragraph">
<p>All external declarations must be associated with an external
implementation module in one way or another. Any time the external
declaration is imported, the compiler generates code that imports the
corresponding implementation module at runtime.</p>
</div>
<div class="paragraph">
<p>There are two possible ways of linking an external declaration to its
corresponding implementation:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>By naming convention defined in the manifest.</p>
</li>
<li>
<p>By declaring that the implementation is provided by the JavaScript
runtime, see <a href="#Runtime_Definitions">[Runtime_Definitions]</a> for details.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The naming convention is based on the <code>external</code> source fragments
defined in the manifest (<a href="#Manifest">[Manifest]</a>). If the implementation is provided by the
runtime directly, then this can be also specified in the manifest by a
module filter.</p>
</div>
<div class="paragraph">
<p>The implicit link via the naming convention is used to link an external
class declaration to its non-N4JS implementation module. It does not
effect validation, but only compilation and runtime. Essentially, this
makes the compiler generate code so that at runtime, the linked
implementation module is imported instead of the declaration module.</p>
</div>
<div class="paragraph">
<p>In most use cases of external declarations you also want to disable
validation and module wrapping by specifying appropriate filters in the
manifest.</p>
</div>
<div class="paragraph">
<p>Occasionally it is not possible for the validation to correctly detect a
corresponding implementation element. For that reason, it is possible to
disable validation of implementations completely via <code>@@IgnoreImplementation</code>.</p>
</div>
<div class="paragraph">
<p>[[req:169Implementation of External Declarations]]

For a given external declaration \($D$\) but not for
API-definitions <sup class="footnote">[<a id="_footnoteref_58" class="footnote" href="#_footnote_58" title="View footnote.">58</a>]</sup>, the
following constraints must hold:</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1099" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1099</a>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the declaration is neither provided by runtime nor validation of
implementation is disabled, a corresponding implementation must be found
by the naming convention. If no such implementation is found, a warning
is generated.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>[[ex:External Definitions and Their Implementations]]
If, in addition to standard <code>source</code>, the <code>source-external</code> fragment is
provided in <code>Sources</code>, \($n4jsd$\) files in the folder tree
below source folders will be related to modules of the same name in the
external folders. This is shown in <a href="#externalClassImplementation_naming">[externalClassImplementation_naming]</a>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="fig/externalClassImplementation_naming.png" alt="externalClassImplementation naming" title="External Class Implementation, Naming Convention"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="ex:External_Classes_Example"><a class="anchor" href="#ex:External_Classes_Example"></a>15.2.4. Example</h4>
<div class="paragraph">
<p>Assume the following non-N4JS module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>module.exports = {
    "Point": function Point(x, y) {
        this.x = x;
        this.y = y;
    },

    "Circle": function Circle(center, radius) {
        this.center = center;
        this.radius = radius;
        this.scaleX = function(x){ this.x = x; }
    this.scaleY= function(y){ this.y = y; }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming</p>
</div>
<div class="ulist">
<ul>
<li>
<p>shapes.js is placed in project folder /external/a/b/shapes.js</p>
</li>
<li>
<p>shapes.n4jsd is placed in project folder /src/a/b/shapes.n4jsd</p>
</li>
<li>
<p>manifest.n4mf defines src as source folder and external as external
source folder</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>the following N4JS external class declarations in shapes.n4jsd are
sufficient:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>export external public class Point {
    x: number; y: number;
    constructor(x: number, y: number);
}

export external public class Circle {
    center: Point; radius: number;
    constructor(center: Point, radius: number);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the class and interface names in n4jsd files must match those
in the js files, respectively.</p>
</div>
<div class="paragraph">
<p>[[ex:Structural typed external interfaces]]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>export external public interface ~Scalable {
    scaleX(factor: number);
    scaleY(factor: number);
}

export external public class Circle implements Scalable {
    center: Point;
    radius: number; x: number; y: number;

    @Override public scaleX(factor: number);
    @Override public scaleY(factor: number);

    constructor(center: Point, radius: number);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_global_definitions"><a class="anchor" href="#_global_definitions"></a>15.3. Global Definitions</h3>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1036" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1036</a>
</div>
</div>
<div class="paragraph">
<p>Existing JavaScript libraries and built-in objects provided by certain
JavaScript environments often globally define variables. Although it is
not recommended to use global definitions, this cannot always be
avoided.</p>
</div>
<div class="paragraph">
<p>N4JS supports global definitions via the annotation <code>Global</code>. This annotation
can only be defined on modules (via <code>@@Global</code>) – this means that all declarations in the module are globally defined.
<sup class="footnote">[<a id="_footnoteref_59" class="footnote" href="#_footnote_59" title="View footnote.">59</a>]</sup></p>
</div>
<div class="paragraph">
<p>We introduce a new pseudo property \($global$\) on all declared
elements accordingly:</p>
</div>
<div class="paragraph">
<p>Boolean flag set to true if annotation <code>@Global</code> is set in containing module. Flag indicates that the exported element is globally available and must not
be imported. </p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1036" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1036</a>
</div>
</div>
<div class="paragraph">
<p>Since definition of global elements is not supported by N4JS directly,
this can be only used in external definitions. A declaration with
\($global$\) can be used without explicit import statement. It
is not possible to import these declarations.</p>
</div>
<div class="paragraph">
<p>Global Definitions</p>
</div>
<div class="paragraph">
<p>For a declaration \($D$\) with \($D.global=\TRUE$\), not a polyfill
(\($D.polyfill=\FALSE)$\), the following constraints must hold:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The name of the definition must not be equal to any primitive type
(<code>string</code>, <code>number</code> etc.), <code>any</code>, or an built-in N4 type (<code>N4Object</code> etc.).</p>
</li>
<li>
<p>If the name of the definition equals a basic runtime time Object
Type then the project must be a runtime environment:
\(\[\begin{aligned}
&amp;D.name \in \{ \\
&amp;\hspace{3em} 'Object', 'Function', 'Array', 'String', 'Boolean'\\
&amp;\hspace{3em} 'Number', 'Math', 'Date', 'RegExp', 'Error', 'JSON' \\
&amp;\}\\
&amp;\Rightarrow D.containingProject.type=\lenum{runtimeEnvironment}\end{aligned}]\)</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_runtime_definitions"><a class="anchor" href="#_runtime_definitions"></a>15.4. Runtime Definitions</h3>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1036" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1036</a>
</div>
</div>
<div class="paragraph">
<p>Some elements are predefined by the JavaScript runtime such as DOM
elements by the browser or built-in ECMAScript or non-standard objects.
These elements can be defined by means of external definitions; however,
no actual implementation can be provided as these elements are actually
provided by the runtime itself.</p>
</div>
<div class="paragraph">
<p>Since these cases are rather rare and in order to enable additional
checks such as verification that a given runtime actually provides the
elements, this kind of element can only be defined in components of type
runtime environment or runtime library (cf <a href="#Runtime_Environment_Libraries">[Runtime_Environment_Libraries]</a>).</p>
</div>
<div class="paragraph">
<p>N4JS supports runtime definitions via the annotation <code>@ProvidedByRuntime</code>. This annotation can be defined</p>
</div>
<div class="ulist">
<ul>
<li>
<p>on modules (via <code>@@ProvidedByRuntime</code>)– this means that all declarations in the module are provided by the runtime</p>
</li>
<li>
<p>on export statements or declarations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We introduce a new pseudo property \($providedByRuntime$\)
accordingly:</p>
</div>
<div class="paragraph">
<p>Boolean flag set to true if the annotation <code>@ProvidedByRuntime</code> is set. Flag indicates that
the element is only declared in the module but its implementation is
provided by the runtime.</p>
</div>
<div class="paragraph">
<p>Since built-in types are usually defined globally, the annotation <code>@ProvidedByRuntime</code> is usually used in combination with <code>@Global</code>.</p>
</div>
<div class="paragraph">
<p>Provided By Runtime</p>
</div>
<div class="paragraph">
<p>
For a declaration
\($D$\) with \($D.providedByRuntime=\TRUE$\), the
following constraints must hold:</p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1036" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1036</a>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The declaration must either be an export declaration itself or an
exportable declaration.</p>
</li>
<li>
<p>The declaration must be contained in a definition module.</p>
</li>
<li>
<p>The declaration must be (indirectly) contained in a component of
type \($\lenum{runtimeEnvironment}$\) or
\($\lenum{runtimeLibrary}$\).</p>
</li>
<li>
<p>There must be no implementation file with the same name as the
definition module if annotation is defined for a whole module. </p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1084" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1084</a>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_applying_polyfills"><a class="anchor" href="#_applying_polyfills"></a>15.5. Applying Polyfills</h3>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1142" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1142</a>
</div>
</div>
<div class="paragraph">
<p>(Runtime) Libraries often do not provide completely new types but modify
existing types.
The ECMA-402 Internationalization Standard [<a href="#ECMA12a">ECMA12a</a>], for example, changes methods of the built-in class <code>Date</code> to be timezone-aware.
Other scenarios include new functionality provided by browsers which are not part of an official standard yet.
Even ECMAScript 6 [<a href="#ECMA15a">ECMA15a</a>] extends the predecessor [<a href="#ECMA11a">ECMA11a</a>] in terms of new methods or new method parameters added to
existing types.
It also adds completely new classes and features, of course.</p>
</div>
<div class="paragraph">
<p>The syntax of runtime polyfills is described in section <a href="#Polyfill_Definitions">[Polyfill_Definitions]</a>.
Here, an example of applying a runtime polyfill is detailed.</p>
</div>
<div class="paragraph">
<p>[[ex:Object.observe with Polyfill]]
The following snippet demonstrates how to define a polyfill of the built-in
class to add the new ECMAScript 7 observer functionality.
This snippet has to be defined in a runtime library or environment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">@@ProvidedByRuntime
@@Global

@Polyfill
export external public class Object extends Object {
    public static Object observe(Object object, Function callback, Array&lt;string&gt;? accept);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A client referring to this runtime library (or environment) can now
access the observer methods as if it were defined directly in the
original declaration of <code>Object</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jsdoc_2"><a class="anchor" href="#_jsdoc_2"></a>16. JSDoc</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In N4JS, comments starting with two asterisks (in <code>/** .. */
</code>) are interpreted as
documentation comments. The format is similar to JavaDoc or Google
Closure annotations.</p>
</div>
<div class="sect2">
<h3 id="_general_n4jsdoc_features"><a class="anchor" href="#_general_n4jsdoc_features"></a>16.1. General N4JSDoc Features</h3>
<div class="paragraph">
<p>We distinguish between line and inline tags.
The format of the content of a tag is specific to the tag.
Most line tags, however, contain a description which is simply multiline text with nested inline tags.
Every comment may start with a description.</p>
</div>
<div class="sect3">
<h4 id="_provided_inline_tags"><a class="anchor" href="#_provided_inline_tags"></a>16.1.1. Provided Inline Tags</h4>
<div class="sect4">
<h5 id="jsdoc_tag__code"><a class="anchor" href="#jsdoc_tag__code"></a>@code</h5>
<div class="paragraph">
<p>Small code snippet, not validated yet.</p>
</div>
</div>
<div class="sect4">
<h5 id="jsdoc_tag__link"><a class="anchor" href="#jsdoc_tag__link"></a>@link</h5>
<div class="paragraph">
<p>Link to a type of element, not validated or supported in navigation yet.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_n4jsdoc_for_user_projects"><a class="anchor" href="#_n4jsdoc_for_user_projects"></a>16.2. N4JSdoc for User Projects</h3>
<div class="sect3">
<h4 id="_standard_tags"><a class="anchor" href="#_standard_tags"></a>16.2.1. Standard Tags</h4>
<div class="sect4">
<h5 id="__author"><a class="anchor" href="#__author"></a>@author</h5>
<div class="paragraph">
<p>Name of author, repeat for multiple authors. Name of author is not
validated.</p>
</div>
</div>
<div class="sect4">
<h5 id="jsdoc_tag_param"><a class="anchor" href="#jsdoc_tag_param"></a>@param</h5>
<div class="paragraph">
<p>Parameter description, not validated at the moment.</p>
</div>
</div>
<div class="sect4">
<h5 id="jsdoc_tag_return"><a class="anchor" href="#jsdoc_tag_return"></a>@return</h5>
<div class="paragraph">
<p>Return description, not validated at the moment.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_test_related_tags"><a class="anchor" href="#_test_related_tags"></a>16.2.2. Test Related Tags</h4>
<div class="paragraph">
<p>The following tags are supposed to be used only in tests.</p>
</div>
<div class="sect4">
<h5 id="jsdoc_tag__testee"><a class="anchor" href="#jsdoc_tag__testee"></a>@testee</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1469" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1469</a>
</div>
</div>
<div class="paragraph">
<p>Link to type (maybe a function) or member tested by the test.</p>
</div>
<div id="req:_testee_Semantics" class="olist arabic">
<ol class="arabic">
<li>
<p>Tag can be only used on either</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>methods annotated with <code>@Test</code></p>
</li>
<li>
<p>classes in test projects or folders, cf. <a href="#jsdoc_tag__testeeFromType">@testeeFromType</a>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Tag requires a single argument, which is a fully qualified name to a
type, including the module specifier. Format is like this:
`moduleSpecifier '.' typeName ( ('.'|'#') memberName)?</p>
</li>
<li>
<p>Tag is <em>not</em> repeatable, that is a single test method (or class) can
refer to only one testee. </p>
</li>
<li>
<p>Tag precedes the <code>reqid</code> tag, i.e., if a <code>@testee</code> is specified, the <code>reqid</code> will be ignored.</p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://github.com/NumberFour/N4JS/issues/635" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-635</a>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>[[ex:@testee Example]]
The target element is to be fully qualified including the module specifier. The module specifier is simply
the source folder relative path name with forward slashes. Type and
element are added to that using dot as a separator. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>/**
 * @testee some/package/Module.Type.member
 */</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jsdoc_tag__testeeFromType"><a class="anchor" href="#jsdoc_tag__testeeFromType"></a>@testeeFromType</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/SL-41" title="STDLIB Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-41</a>
</div>
</div>
<div class="paragraph">
<p>Instead of directly linking a test method to a testee, the testee is to
be derived from the linked testee of the test class. This is useful if a
base test class is defined with generic tests, e.g., for testing methods
defined in an interface and implemented by some classes. This base test
class is then extended by concrete test classes, correctly setting up
the test fixture, e.g., creating instances of some classes implementing
the interfaces tested in the base class.</p>
</div>
<div class="paragraph">
<p>[[ex:Usage of testeeFromType]]
In the following example, the is used. This tag will lead to a test documentation for <code>B.foo</code> and <code>C.foo</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">abstract class Base {
    /**
     * @testeeFromType
     */
    @Test testFoo() {..}
}

/**
 * @testee B.foo
 */
class TestB extends Base {}

/**
 * @testee C.foo
 */
class TestC extends Base {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the resulting spec has to be double-checked for consistency
since it is easily possible that too many constraints are generated.</p>
</div>
</div>
<div class="sect4">
<h5 id="_testeeType_and__testeeMember"><a class="anchor" href="#_testeeType_and__testeeMember"></a>@testeeType and @testeeMember</h5>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/SL-41" title="STDLIB Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-41</a>
</div>
</div>
<div class="paragraph">
<p>Specifying the testee at the test method directly should be sufficient
for most cases. The <code>@testeeFromType</code> tag already provides support for some cases in which a base test class is reused by subtypes. This case usually only works if
the base test class tests a single method only. If the base test class
tests several methods and if a sub test class only provides a different
fixture, this mechanism is not sufficient. For that purpose, the two
tags <code>@testeeFromType</code> and <code>@@testeeMember</code> are to be used.
They enable the separation of a test related to a specific member and the concrete receiver type of the tested member.</p>
</div>
<div class="paragraph">
<p>The <code>@testeeType</code> is to defined in the test class JSDoc (actually, it is not
recognized when defined in a member JSDoc). The <code>@testeeMember</code> is specified in the test method JSDoc. The "real" testee is then computed from the testee type and the testee method.</p>
</div>
<div class="paragraph">
<p>This only works for instance members, so far! Note: There is no
validation for invalid combinations!</p>
</div>
<div class="paragraph">
<p>[[ex:testeeType and testeeMethod]]
Assume the following testees:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">class A {
    foo(): void {..}
    bar(): void { .. this.foo(); ..}
}
class B extends A {
    @Override foo() { .. }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assume that the tests have to ensure the same semantics for <code>bar</code>, which is
maybe changed by a wrong implementation of <code>foo</code>. That is, <code>bar</code> is to be tested in
case of the receiver type <code>A</code> and <code>B</code>. This can be achieved by the following
tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">/**
 * @testeeType A.A
 */
class ATest {
    fixture(): A { return new A(); }

    /**
     * @testeeMember bar
     */
    @Test testBar(): void { assertBehavior( fixture().bar() ); }
}
/**
 * @testeeType B.B
 */
class BTest extends ATest {
    @Override fixture(): B { return new B(); }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This actually defines two tests, which is also recognized by the spec
exporter:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>testBar</code> for a receiver of type <code>A</code>:</p>
<div class="paragraph">
<p><code>ATest</code>'s JSDoc <code>@testeeType</code> + <code>ATest.testBar</code>'s JSDoc <code>@testeeMember</code> = testee <code>A.A.bar</code></p>
</div>
</li>
<li>
<p><code>testBar</code> for a receiver of type <code>B</code>:</p>
<div class="paragraph">
<p><code>BTest</code>'s JSDoc <code>@testeeType</code> + <code>ATest.testBar</code>'s JSDoc <code>@testeeMember</code> = testee <code>B.B.bar</code></p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that in all cases when <code>@testeeFromType</code> or <code>@testeeType</code>/<code>@testeeMember</code> is used, the resulting spec has to be
double-checked for consistency. Consider if the multiplication of spec
constraints is truly required, in particular if the original semantics
of a method is not changed. Remember: It is possible to write API tests
and omit the spec constraint generation simply by not adding the testee
links.</p>
</div>
<div class="paragraph">
<p>[[ex:testeeType and testeeMethod with omitted constraints]]</p>
</div>
<div class="paragraph">
<p>Assume testees similar as in <a href="#ex:testeeType_and_testeeMethod">[ex:testeeType_and_testeeMethod]</a>. Since the semantics of <code>bar</code> is not changed in <code>B</code>, it is probably not necessary to generate the same constraint in the documentation for <code>bar</code> twice (one in the section for class <code>A</code> and another one in the section of class <code>B</code>).
Still, we want the test to be executed for both receivers. This is how it is achieved:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">abstract class BaseTest {
    abstract fixture(): A;

    /**
     * @testeeMember bar
     */
    @Test testBar(): void { assertBehavior( fixture().bar() ); }
}

/**
 * @testeeType A.A
 */
class ATest extends BaseTest {
    fixture(): A { return new A(); }
}

class BTest extends BaseTest {
    @Override fixture(): B { return new B(); }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This actually defines two tests as in the previous example. Only one
constraint is created in the spec by the spec exporter:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>testBar</code> for a receiver of type <code>A</code>:<br>
<code>ATest</code>'s JSDoc <code>@testeeType</code> + <code>BaseTest.testBar</code>'s JSDoc <code>@testeeMember</code> = testee <code>A.A.bar</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Although a test for receiver of type <code>B</code> is run, no additional constraint is
created since there is no <code>@testeeType</code> available neither in <code>BTest</code> nor in <code>BaseTest</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="jsdoc_tag_reqid_in_Tests"><a class="anchor" href="#jsdoc_tag_reqid_in_Tests"></a>@reqid in Tests</h5>
<div class="paragraph">
<p>ID of feature used in LaTeX-code for the requirements section. If no
testee (via one of the tags above) is given, then the test is linked to
the requirement with given id.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_n4jsdoc_for_api_and_implementation_projects"><a class="anchor" href="#_n4jsdoc_for_api_and_implementation_projects"></a>16.3. N4JSDoc for API and Implementation Projects</h3>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1509" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1509</a>
</div>
</div>
<div class="paragraph">
<p>The following tags are supposed to be used in API and implementation
projects.</p>
</div>
<div class="sect3">
<h4 id="jsdoc_tag__apiNote"><a class="anchor" href="#jsdoc_tag__apiNote"></a>16.3.1. @apiNote</h4>
<div class="paragraph">
<p>Simple note that is shown in the API compare view.</p>
</div>
</div>
<div class="sect3">
<h4 id="API_Project_Tags"><a class="anchor" href="#API_Project_Tags"></a>16.3.2. API Project Tags</h4>
<div class="paragraph">
<p>The following tags are supposed to be used in API projects only.</p>
</div>
<div class="sect4">
<h5 id="jsdoc_tag_apiState"><a class="anchor" href="#jsdoc_tag_apiState"></a>@apiState</h5>
<div class="paragraph">
<p>State of type or member definition, e.g., stable or draft. This can be
used to define a history. In this case, the tag has to be repeated. For
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>/**
 * @apiState stable (WK)
 * @apiState reviewed (JvP)
 */</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_grammars"><a class="anchor" href="#_grammars"></a>17. Grammars</h2>
<div class="sectionbody">
<div class="paragraph">
<p>N4JS extends the ECMAScript 2015 language grammar and combines it with
type expression.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title"></div>
</td>
<td class="content">
These grammars are slightly simplified versions of the "real"
Xtext grammars used in the implementation.
These grammars are post-processed and combined with additional validators so not all constructs are necessarily available in N4JS.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_type_expressions_grammar"><a class="anchor" href="#_type_expressions_grammar"></a>17.1. Type Expressions Grammar</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>TypeRef:
    TypeRefWithoutModifiers =&gt;undefModifier=UndefModifierToken?
    | undefModifier=UndefModifierToken;

TypeRefWithoutModifiers:
      ((ParameterizedTypeRef | ThisTypeRef) =&gt; dynamic?='+'?)
    | ConstructorTypeRef
    | ClassifierTypeRef
    | FunctionTypeExpression
    | UnionTypeExpression
    | IntersectionTypeExpression;

TypeRefFunctionTypeExpression:
      ParameterizedTypeRef
    | ConstructorTypeRef
    | ClassifierTypeRef
    | UnionTypeExpression
    | IntersectionTypeExpression
    ;

TypeRefForCast:
      ParameterizedTypeRef
    | ThisTypeRef
    | ConstructorTypeRef
    | ClassifierTypeRef
    | FunctionTypeExpression;

TypeRefInClassifierType:
      ParameterizedTypeRefNominal
    | ThisTypeRefNominal;


ThisTypeRef:
    ThisTypeRefNominal | ThisTypeRefStructural;

ThisTypeRefNominal:
    'this';

ThisTypeRefStructural:
    definedTypingStrategy=TypingStrategyUseSiteOperator
    'this'
    ('with' TStructMemberList)?;

FunctionTypeExpression:
    '{'
    ('@' 'This' '(' declaredThisType=TypeRefFunctionTypeExpression ')')?
    'function'
    ('&lt;' ownedTypeVars+=TypeVariable (',' ownedTypeVars+=TypeVariable)* '&gt;')?
    '(' TAnonymousFormalParameterList ')'
    (':' returnTypeRef=TypeRef)?
    '}';

fragment TAnonymousFormalParameterList*:
    (fpars+=TAnonymousFormalParameter (',' fpars+=TAnonymousFormalParameter)*)?
;

TAnonymousFormalParameter:
    variadic?='...'? (=&gt; name=TIdentifier ':')? typeRef=TypeRef
;

UnionTypeExpression:
    'union' '{' typeRefs+=TypeRefWithoutModifiers (',' typeRefs+=TypeRefWithoutModifiers)* '}';

IntersectionTypeExpression:
    'intersection' '{' typeRefs+=TypeRefWithoutModifiers (',' typeRefs+=TypeRefWithoutModifiers)* '}';

ParameterizedTypeRef:
    ParameterizedTypeRefNominal | ParameterizedTypeRefStructural;

ParameterizedTypeRefStructural:
    definedTypingStrategy=TypingStrategyUseSiteOperator
    declaredType=[Type|TypeReferenceName]
    (=&gt;'&lt;' typeArgs+=TypeArgument (',' typeArgs+=TypeArgument)* '&gt;')?
    ('with' TStructMemberList)?;

fragment TStructMemberList*:  '{' (astStructuralMembers+=TStructMember (';'|',')?)*  '}';

TStructMember:
      TStructGetter
    | TStructSetter
    | TStructMethod
    | TStructField;

TStructMethod:
    =&gt;
    (('&lt;' typeVars+=TypeVariable (',' typeVars+=TypeVariable)* '&gt;')?
        name=TypesIdentifier '('
    ) TAnonymousFormalParameterList ')'
    (':' returnTypeRef=TypeRef)?
;

TStructField:
    name=TypesIdentifier (':' typeRef=TypeRef)?
;

TStructGetter:
    =&gt; ('get'
    name=TypesIdentifier)
    '(' ')' (':' declaredTypeRef=TypeRef)?
;

TStructSetter:
    =&gt; ('set'
    name=TypesIdentifier)
    '(' fpar=TAnonymousFormalParameter ')'
;

ParameterizedTypeRefNominal:
    declaredType=[Type|TypeReferenceName]
    (=&gt; '&lt;' typeArgs+=TypeArgument (',' typeArgs+=TypeArgument)* '&gt;')?;

TypingStrategyUseSiteOperator:
    '~' ('~' | STRUCTMODSUFFIX)?;

TypingStrategyDefSiteOperator:
    '~';

terminal STRUCTMODSUFFIX:
    ('r' | 'i' | 'w') '~'
;

ConstructorTypeRef:
    'constructor' '{' staticTypeRef=TypeRefInClassifierType '}';

ClassifierTypeRef:
    'type' '{' staticTypeRef=TypeRefInClassifierType '}';

TypeReferenceName:
    IDENTIFIER ('.' IDENTIFIER)*;

TypeArgument:
    Wildcard | TypeRef;

Wildcard:
    =&gt; ('?') (('extends' declaredUpperBound=TypeRef) | ('super'
    declaredLowerBound=TypeRef))?;

UndefModifierToken:
    '?';

TypeVariable:
    name=IDENTIFIER ('extends' declaredUpperBounds+=ParameterizedTypeRef ('&amp;'
    declaredUpperBounds+=ParameterizedTypeRef)*)?;

TypesIdentifier:
    IDENTIFIER
    | 'get' | 'set' | 'abstract' | 'project'
    | 'union' | 'intersection'
    | 'as' | 'from' | 'type' | 'void' | 'null';

TIdentifier:
    TypesIdentifier
    | 'implements' | 'interface'
    | 'private' | 'protected' | 'public'
    | 'static'
;

terminal IDENTIFIER:
    IDENTIFIER_START IDENTIFIER_PART*;

terminal INT:
    DECIMAL_INTEGER_LITERAL_FRAGMENT;

terminal ML_COMMENT:
    ML_COMMENT_FRAGMENT;

terminal SL_COMMENT:
    '//' (!LINE_TERMINATOR_FRAGMENT)*;

terminal EOL:
    LINE_TERMINATOR_SEQUENCE_FRAGMENT;

terminal WS:
    WHITESPACE_FRAGMENT+;

terminal fragment UNICODE_ESCAPE_FRAGMENT:
    '\\' ('u' (
        HEX_DIGIT (HEX_DIGIT (HEX_DIGIT HEX_DIGIT?)?)?
      | '{' HEX_DIGIT* '}'?
    )?)?;

terminal fragment IDENTIFIER_START:
      UNICODE_LETTER_FRAGMENT
    | '$'
    | '_'
    | UNICODE_ESCAPE_FRAGMENT;

terminal fragment IDENTIFIER_PART:
      UNICODE_LETTER_FRAGMENT
    | UNICODE_ESCAPE_FRAGMENT
    | '$'
    | UNICODE_COMBINING_MARK_FRAGMENT
    | UNICODE_DIGIT_FRAGMENT
    | UNICODE_CONNECTOR_PUNCTUATION_FRAGMENT
    | ZWNJ
    | ZWJ;

terminal DOT_DOT:
    '..'
;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_n4js_language_grammar"><a class="anchor" href="#_n4js_language_grammar"></a>17.2. N4JS Language Grammar</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Script: annotations+=ScriptAnnotation*
    scriptElements+=ScriptElement*;

ScriptElement:
      AnnotatedScriptElement
    | N4ClassDeclaration&lt;Yield=false&gt;
    | N4InterfaceDeclaration&lt;Yield=false&gt;
    | N4EnumDeclaration&lt;Yield=false&gt;
    | ImportDeclaration
    | ExportDeclaration
    | RootStatement&lt;Yield=false&gt;
;

AnnotatedScriptElement:
    AnnotationList (
        {ExportDeclaration.annotationList=current} ExportDeclarationImpl
    |   {ImportDeclaration.annotationList=current} ImportDeclarationImpl
    |   {FunctionDeclaration.annotationList=current}
        =&gt;((declaredModifiers+=N4Modifier)* AsyncNoTrailingLineBreak
            -&gt;FunctionImpl&lt;Yield=false,YieldIfGenerator=false,Expression=false&gt;)
    |   (
            (
                {N4ClassDeclaration.annotationList=current}
                (declaredModifiers+=N4Modifier)*
                'class' typingStrategy=TypingStrategyDefSiteOperator?
                name=BindingIdentifier&lt;Yield=false&gt;
                TypeVariables?
                ClassExtendsClause&lt;Yield=false&gt;?
            |   {N4InterfaceDeclaration.annotationList=current}
                (declaredModifiers+=N4Modifier)*
                'interface' typingStrategy=TypingStrategyDefSiteOperator? name=BindingIdentifier&lt;Yield=false&gt;
                TypeVariables?
                InterfaceImplementsList?
            )
            Members&lt;Yield=false&gt;
        )
    |   {N4EnumDeclaration.annotationList=current}
        (declaredModifiers+=N4Modifier)*
        'enum' name=BindingIdentifier&lt;Yield=false&gt;
        '{'
            literals+=N4EnumLiteral (',' literals+= N4EnumLiteral)*
        '}'
    )
;

fragment TypeVariables*:
    '&lt;' typeVars+=TypeVariable (',' typeVars+=TypeVariable)* '&gt;'
;

ExportDeclaration:
    ExportDeclarationImpl
;

fragment ExportDeclarationImpl*:
    'export' (
        wildcardExport?='*' ExportFromClause Semi
    |   ExportClause -&gt;ExportFromClause? Semi
    |   exportedElement=ExportableElement
    |   defaultExport?='default' (-&gt;exportedElement=ExportableElement | defaultExportedExpression=AssignmentExpression&lt;In=true,Yield=false&gt; Semi)
    )
;

fragment ExportFromClause*:
    'from' reexportedFrom=[types::TModule|ModuleSpecifier]
;

fragment ExportClause*:
    '{'
        (namedExports+=ExportSpecifier (',' namedExports+=ExportSpecifier)* ','?)?
    '}'
;

ExportSpecifier:
    element=IdentifierRef&lt;Yield=false&gt; ('as' alias=IdentifierName)?
;

ExportableElement:
      AnnotatedExportableElement&lt;Yield=false&gt;
    | N4ClassDeclaration&lt;Yield=false&gt;
    | N4InterfaceDeclaration&lt;Yield=false&gt;
    | N4EnumDeclaration&lt;Yield=false&gt;
    | ExportedFunctionDeclaration&lt;Yield=false&gt;
    | ExportedVariableStatement
;

AnnotatedExportableElement &lt;Yield&gt;:
    AnnotationList (
        {FunctionDeclaration.annotationList=current}
        (declaredModifiers+=N4Modifier)* AsyncNoTrailingLineBreak
        FunctionImpl&lt;Yield, Yield, Expression=false&gt;
    |   {ExportedVariableStatement.annotationList=current}
        (declaredModifiers+=N4Modifier)*
        varStmtKeyword=VariableStatementKeyword
        varDeclsOrBindings+=ExportedVariableDeclarationOrBinding&lt;Yield&gt; ( ',' varDeclsOrBindings+=ExportedVariableDeclarationOrBinding&lt;Yield&gt; )* Semi
    |   (
            (
                {N4ClassDeclaration.annotationList=current}
                (declaredModifiers+=N4Modifier)*
                'class' typingStrategy=TypingStrategyDefSiteOperator?
                name=BindingIdentifier&lt;Yield&gt;
                TypeVariables?
                ClassExtendsClause&lt;Yield&gt;?
            |   {N4InterfaceDeclaration.annotationList=current}
                (declaredModifiers+=N4Modifier)*
                ('interface') typingStrategy=TypingStrategyDefSiteOperator? name=BindingIdentifier&lt;Yield&gt;
                TypeVariables?
                InterfaceImplementsList?
            )
            Members&lt;Yield&gt;
        )
    |   {N4EnumDeclaration.annotationList=current}
        (declaredModifiers+=N4Modifier)*
        'enum' name=BindingIdentifier&lt;Yield&gt;
        '{'
            literals+=N4EnumLiteral (',' literals+= N4EnumLiteral)*
        '}'
    )
;

ImportDeclaration:
    ImportDeclarationImpl
;

fragment ImportDeclarationImpl*:
    'import' (
        ImportClause importFrom?='from'
    )? module=[types::TModule|ModuleSpecifier] Semi
;

fragment ImportClause*:
        importSpecifiers+=DefaultImportSpecifier (',' ImportSpecifiersExceptDefault)?
    |   ImportSpecifiersExceptDefault
;

fragment ImportSpecifiersExceptDefault*:
        importSpecifiers+=NamespaceImportSpecifier
    |   '{' (importSpecifiers+=NamedImportSpecifier (',' importSpecifiers+=NamedImportSpecifier)* ','?)? '}'
;

NamedImportSpecifier:
        importedElement=[types::TExportableElement|BindingIdentifier&lt;Yield=false&gt;]
    |   importedElement=[types::TExportableElement|IdentifierName] 'as' alias=BindingIdentifier&lt;Yield=false&gt;
;

DefaultImportSpecifier:
    importedElement=[types::TExportableElement|BindingIdentifier&lt;Yield=false&gt;]
;

NamespaceImportSpecifier: '*' 'as' alias=BindingIdentifier&lt;false&gt; (declaredDynamic?='+')?;

ModuleSpecifier: STRING;

FunctionDeclaration &lt;Yield&gt;:
    =&gt; ((declaredModifiers+=N4Modifier)* AsyncNoTrailingLineBreak
        -&gt; FunctionImpl &lt;Yield,Yield,Expression=false&gt;
    ) =&gt; Semi?
;

fragment AsyncNoTrailingLineBreak *: (declaredAsync?='async' NoLineTerminator)?;

fragment FunctionImpl&lt;Yield, YieldIfGenerator, Expression&gt;*:
    'function'
    (
        generator?='*' FunctionHeader&lt;YieldIfGenerator,Generator=true&gt; FunctionBody&lt;Yield=true,Expression&gt;
    |   FunctionHeader&lt;Yield,Generator=false&gt; FunctionBody&lt;Yield=false,Expression&gt;
    )
;

fragment FunctionHeader&lt;Yield, Generator&gt;*:
    TypeVariables?
    name=BindingIdentifier&lt;Yield&gt;?
    StrictFormalParameters&lt;Yield=Generator&gt;
    (-&gt; ':' returnTypeRef=TypeRef)?
;

fragment FunctionBody &lt;Yield, Expression&gt;*:
        &lt;Expression&gt; body=Block&lt;Yield&gt;
    |   &lt;!Expression&gt; body=Block&lt;Yield&gt;?
;

ExportedFunctionDeclaration&lt;Yield&gt;:
    FunctionDeclaration&lt;Yield&gt;
;

FunctionTypeExpression:
    {types::FunctionTypeExpression}
    '{'
    ('@' 'This' '(' declaredThisType=TypeRefFunctionTypeExpression ')')?
    'function'
    ('&lt;' ownedTypeVars+=TypeVariable (',' ownedTypeVars+=TypeVariable)* '&gt;')?
    '('
    (fpars+=TAnonymousFormalParameter (',' fpars+=TAnonymousFormalParameter)*)?
    ')'
    (':' returnTypeRef=TypeRef)?
    '}';

AnnotatedFunctionDeclaration &lt;Yield, Default&gt;:
    annotationList=AnnotationList
    (declaredModifiers+=N4Modifier)* AsyncNoTrailingLineBreak
    FunctionImpl&lt;Yield,Yield,Expression=false&gt;
;


FunctionExpression:
         (FunctionImpl&lt;Yield=false,YieldIfGenerator=true,Expression=true&gt;
         )
;

AsyncFunctionExpression:
     =&gt;(declaredAsync?='async' NoLineTerminator 'function')
        FunctionHeader&lt;Yield=false,Generator=false&gt; FunctionBody&lt;Yield=false,Expression=true&gt;
;

ArrowExpression &lt;In, Yield&gt;:
    =&gt; (
            (
                    '(' (fpars+=FormalParameter&lt;Yield&gt;
                        (',' fpars+=FormalParameter&lt;Yield&gt;)*)?
                    ')' (':' returnTypeRef=TypeRef)?
                |   =&gt;(declaredAsync?='async' NoLineTerminator '(')
                    (fpars+=FormalParameter&lt;Yield&gt; (',' fpars+=FormalParameter&lt;Yield&gt;)*)?
                    ')' (':' returnTypeRef=TypeRef)?
                |   fpars+=BindingIdentifierAsFormalParameter&lt;Yield&gt;
            )
            '=&gt;'
        )
        (-&gt; hasBracesAroundBody?='{' body=BlockMinusBraces&lt;Yield&gt; '}'
            | body=ExpressionDisguisedAsBlock&lt;In&gt;)
;

fragment StrictFormalParameters &lt;Yield&gt;*:
    '(' (fpars+=FormalParameter&lt;Yield&gt; (',' fpars+=FormalParameter&lt;Yield&gt;)*)? ')'
;

BindingIdentifierAsFormalParameter &lt;Yield&gt;: name=BindingIdentifier&lt;Yield&gt;;

BlockMinusBraces &lt;Yield&gt;:   statements+=Statement&lt;Yield&gt;*;

ExpressionDisguisedAsBlock &lt;In&gt;:
    statements+=AssignmentExpressionStatement&lt;In&gt;
;

AssignmentExpressionStatement &lt;In&gt;: expression=AssignmentExpression&lt;In,Yield=false&gt;;

AnnotatedExpression &lt;Yield&gt;:
    ExpressionAnnotationList (
        {N4ClassExpression.annotationList=current}
        'class' name=BindingIdentifier&lt;Yield&gt;?
        ClassExtendsClause&lt;Yield&gt;?
        Members&lt;Yield&gt;
    |   {FunctionExpression.annotationList=current} AsyncNoTrailingLineBreak
        FunctionImpl&lt;Yield=false,YieldIfGenerator=true,Expression=true&gt;
    )
;

TypeVariable:
    name=IdentifierOrThis
    (   'extends' declaredUpperBounds+=ParameterizedTypeRefNominal
        ('&amp;' declaredUpperBounds+=ParameterizedTypeRefNominal)*
    )?
;

FormalParameter &lt;Yield&gt;:
    BindingElementFragment&lt;Yield&gt;
;

fragment BindingElementFragment &lt;Yield&gt;*:
    (=&gt; bindingPattern=BindingPattern&lt;Yield&gt;
    | annotations+=Annotation*
        (
            variadic?='...'? name=BindingIdentifier&lt;Yield&gt; ColonSepTypeRef?
        )
    )
    ('=' initializer=AssignmentExpression&lt;In=true, Yield&gt;)?
;

fragment ColonSepTypeRef*:
    ':' declaredTypeRef=TypeRef
;

Block &lt;Yield&gt;: =&gt; ('{') statements+=Statement&lt;Yield&gt;* '}';
RootStatement &lt;Yield&gt;:
    Block&lt;Yield&gt;
    | FunctionDeclaration&lt;Yield&gt;
    | VariableStatement&lt;In=true,Yield&gt;
    | EmptyStatement
    | LabelledStatement&lt;Yield&gt;
    | ExpressionStatement&lt;Yield&gt;
    | IfStatement&lt;Yield&gt;
    | IterationStatement&lt;Yield&gt;
    | ContinueStatement&lt;Yield&gt;
    | BreakStatement&lt;Yield&gt;
    | ReturnStatement&lt;Yield&gt;
    | WithStatement&lt;Yield&gt;
    | SwitchStatement&lt;Yield&gt;
    | ThrowStatement&lt;Yield&gt;
    | TryStatement&lt;Yield&gt;
    | DebuggerStatement
;

Statement &lt;Yield&gt;:
    AnnotatedFunctionDeclaration&lt;Yield,Default=false&gt;
    | RootStatement&lt;Yield&gt;
;

enum VariableStatementKeyword:
    var='var' | const='const' | let='let'
;

VariableStatement &lt;In, Yield&gt;:
    =&gt;(varStmtKeyword=VariableStatementKeyword
    )
    varDeclsOrBindings+=VariableDeclarationOrBinding&lt;In,Yield,false&gt;
    (',' varDeclsOrBindings+=VariableDeclarationOrBinding&lt;In,Yield,false&gt;)* Semi
;

ExportedVariableStatement:
    (declaredModifiers+=N4Modifier)*
    varStmtKeyword=VariableStatementKeyword
    varDeclsOrBindings+=ExportedVariableDeclarationOrBinding&lt;Yield=false&gt;
    (',' varDeclsOrBindings+=ExportedVariableDeclarationOrBinding&lt;Yield=false&gt;)* Semi
;

VariableDeclarationOrBinding &lt;In, Yield, OptionalInit&gt;:
        VariableBinding&lt;In,Yield,OptionalInit&gt;
    |   VariableDeclaration&lt;In,Yield,true&gt;
;

VariableBinding &lt;In, Yield, OptionalInit&gt;:
    =&gt; pattern=BindingPattern&lt;Yield&gt; (
            &lt;OptionalInit&gt; ('=' expression=AssignmentExpression&lt;In,Yield&gt;)?
        |   &lt;!OptionalInit&gt; '=' expression=AssignmentExpression&lt;In,Yield&gt;
    )
;

VariableDeclaration &lt;In, Yield, AllowType&gt;:
    VariableDeclarationImpl&lt;In,Yield,AllowType&gt;;

fragment VariableDeclarationImpl &lt;In, Yield, AllowType&gt;*:
    annotations+=Annotation*
    (
        &lt;AllowType&gt; =&gt;(
            name=BindingIdentifier&lt;Yield&gt; ColonSepTypeRef?
        ) ('=' expression=AssignmentExpression&lt;In,Yield&gt;)?
    |   &lt;!AllowType&gt; =&gt;(
        name=BindingIdentifier&lt;Yield&gt;
        ) ('=' expression=AssignmentExpression&lt;In,Yield&gt;)?
    )
;

ExportedVariableDeclarationOrBinding &lt;Yield&gt;:
        ExportedVariableBinding&lt;Yield&gt;
    |   ExportedVariableDeclaration&lt;Yield&gt;
;

ExportedVariableBinding &lt;Yield&gt;:
    =&gt; pattern=BindingPattern&lt;Yield&gt; '=' expression=AssignmentExpression&lt;In=true,Yield&gt;
;

ExportedVariableDeclaration &lt;Yield&gt;:
    VariableDeclarationImpl&lt;In=true,Yield,AllowType=true&gt;
;
EmptyStatement: ';';
ExpressionStatement &lt;Yield&gt;: expression=Expression&lt;In=true,Yield&gt; Semi;

IfStatement &lt;Yield&gt;: 'if' '(' expression=Expression&lt;In=true,Yield&gt; ')'
    ifStmt=Statement&lt;Yield&gt; (=&gt; 'else' elseStmt=Statement&lt;Yield&gt;)?;

IterationStatement &lt;Yield&gt;:
        DoStatement&lt;Yield&gt;
    |   WhileStatement&lt;Yield&gt;
    |   ForStatement&lt;Yield&gt;
;

DoStatement &lt;Yield&gt;: 'do' statement=Statement&lt;Yield&gt; 'while'
    '(' expression=Expression&lt;In=true,Yield&gt; ')' =&gt; Semi?;
WhileStatement &lt;Yield&gt;: 'while' '(' expression=Expression&lt;In=true,Yield&gt; ')'
    statement=Statement&lt;Yield&gt;;

ForStatement &lt;Yield&gt;:
    'for' '('
    (
            =&gt;(initExpr=LetIdentifierRef forIn?='in' expression=Expression&lt;In=true,Yield&gt; ')')
        |   (   -&gt;varStmtKeyword=VariableStatementKeyword
                (
                        =&gt;(varDeclsOrBindings+=BindingIdentifierAsVariableDeclaration&lt;In=false,Yield&gt;
                        (forIn?='in' | forOf?='of') -&gt;expression=AssignmentExpression&lt;In=true,Yield&gt;?)
                    |   varDeclsOrBindings+=VariableDeclarationOrBinding&lt;In=false,Yield,OptionalInit=true&gt;
                        (
                                (',' varDeclsOrBindings+=VariableDeclarationOrBinding&lt;In=false,Yield,false&gt;)* ';'
                                expression=Expression&lt;In=true,Yield&gt;? ';' updateExpr=Expression&lt;In=true,Yield&gt;?
                            |   forIn?='in' expression=Expression&lt;In=true,Yield&gt;?
                            |   forOf?='of' expression=AssignmentExpression&lt;In=true,Yield&gt;?
                        )
                )
            |   initExpr=Expression&lt;In=false,Yield&gt;
                (
                        ';' expression=Expression&lt;In=true,Yield&gt;? ';' updateExpr=Expression&lt;In=true,Yield&gt;?
                    |   forIn?='in' expression=Expression&lt;In=true,Yield&gt;?
                    |   forOf?='of' expression=AssignmentExpression&lt;In=true,Yield&gt;?
                )
            |   ';' expression=Expression&lt;In=true,Yield&gt;? ';' updateExpr=Expression&lt;In=true,Yield&gt;?
            )
        ')'
    ) statement=Statement&lt;Yield&gt;
;

LetIdentifierRef:
    id=[types::IdentifiableElement|LetAsIdentifier]
;

LetAsIdentifier: 'let';

BindingIdentifierAsVariableDeclaration &lt;In, Yield&gt;:
    name=BindingIdentifier&lt;Yield&gt;
;

ContinueStatement &lt;Yield&gt;: 'continue' (label=[LabelledStatement|BindingIdentifier&lt;Yield&gt;])? Semi;

BreakStatement &lt;Yield&gt;: 'break' (label=[LabelledStatement|BindingIdentifier&lt;Yield&gt;])? Semi;

ReturnStatement &lt;Yield&gt;: 'return' (expression=Expression&lt;In=true,Yield&gt;)? Semi;

WithStatement &lt;Yield&gt;: 'with' '(' expression=Expression&lt;In=true,Yield&gt; ')' statement=Statement&lt;Yield&gt;;

SwitchStatement &lt;Yield&gt;:
    'switch' '(' expression=Expression&lt;In=true,Yield&gt; ')' '{'
    (cases+=CaseClause&lt;Yield&gt;)*
    ((cases+=DefaultClause&lt;Yield&gt;)
    (cases+=CaseClause&lt;Yield&gt;)*)? '}'
;

CaseClause &lt;Yield&gt;: 'case' expression=Expression&lt;In=true,Yield&gt; ':' (statements+=Statement&lt;Yield&gt;)*;

DefaultClause &lt;Yield&gt;: 'default' ':' (statements+=Statement&lt;Yield&gt;)*;

LabelledStatement &lt;Yield&gt;: =&gt; (name=BindingIdentifier&lt;Yield&gt; ':') statement=Statement&lt;Yield&gt;;

ThrowStatement &lt;Yield&gt;:
    'throw' expression=Expression&lt;In=true,Yield&gt; Semi;

TryStatement &lt;Yield&gt;:
    'try' block=Block&lt;Yield&gt;
    ((catch=CatchBlock&lt;Yield&gt; finally=FinallyBlock&lt;Yield&gt;?) | finally=FinallyBlock&lt;Yield&gt;)
;

CatchBlock &lt;Yield&gt;: 'catch' '(' catchVariable=CatchVariable&lt;Yield&gt; ')' block=Block&lt;Yield&gt;;

CatchVariable &lt;Yield&gt;:
        =&gt;bindingPattern=BindingPattern&lt;Yield&gt;
    |   =&gt;(name=BindingIdentifier&lt;Yield&gt; -&gt; ColonSepTypeRef)
    |   name=BindingIdentifier&lt;Yield&gt;
;

FinallyBlock &lt;Yield&gt;: 'finally' block=Block&lt;Yield&gt;;

DebuggerStatement:
    'debugger' Semi;

PrimaryExpression &lt;Yield&gt;:
      ThisLiteral
    | SuperLiteral
    | IdentifierRef&lt;Yield&gt;
    | ParameterizedCallExpression&lt;Yield&gt;
    | Literal
    | ArrayLiteral&lt;Yield&gt;
    | ObjectLiteral&lt;Yield&gt;
    | ParenExpression&lt;Yield&gt;
    | AnnotatedExpression&lt;Yield&gt;
    | FunctionExpression
    | AsyncFunctionExpression
    | N4ClassExpression&lt;Yield&gt;
    | TemplateLiteral&lt;Yield&gt;
;

ParenExpression &lt;Yield&gt;: '(' expression=Expression&lt;In=true,Yield&gt; ')';

IdentifierRef &lt;Yield&gt;:
    id=[types::IdentifiableElement|BindingIdentifier&lt;Yield&gt;]
;

SuperLiteral: 'super';

ThisLiteral: 'this';

ArrayLiteral &lt;Yield&gt;:
    '['
        elements+=ArrayPadding* (
            elements+=ArrayElement&lt;Yield&gt;
            (',' elements+=ArrayPadding* elements+=ArrayElement&lt;Yield&gt;)*
            (trailingComma?=',' elements+=ArrayPadding*)?
        )?
    ']'
;

ArrayPadding: ',';

ArrayElement &lt;Yield&gt;: spread?='...'? expression=AssignmentExpression&lt;In=true,Yield&gt;;

ObjectLiteral &lt;Yield&gt;: '{'
        ( propertyAssignments+=PropertyAssignment&lt;Yield&gt;
          (',' propertyAssignments+=PropertyAssignment&lt;Yield&gt;)* ','?
        )?
    '}'
;

PropertyAssignment &lt;Yield&gt;:
      AnnotatedPropertyAssignment&lt;Yield&gt;
    | PropertyNameValuePair&lt;Yield&gt;
    | PropertyGetterDeclaration&lt;Yield&gt;
    | PropertySetterDeclaration&lt;Yield&gt;
    | PropertyMethodDeclaration&lt;Yield&gt;
    | PropertyNameValuePairSingleName&lt;Yield&gt;
;

AnnotatedPropertyAssignment &lt;Yield&gt;:
    PropertyAssignmentAnnotationList (
    =&gt;( {PropertyNameValuePair.annotationList=current} declaredTypeRef=TypeRef?
            LiteralOrComputedPropertyName&lt;Yield&gt; ':'
        ) expression=AssignmentExpression&lt;In=true,Yield&gt;
    | =&gt;({PropertyGetterDeclaration.annotationList=current}
            GetterHeader&lt;Yield&gt;
        ) body=Block&lt;Yield=false&gt;
    | =&gt;({PropertySetterDeclaration.annotationList=current}
            'set' -&gt;LiteralOrComputedPropertyName &lt;Yield&gt;
        ) '(' fpar=FormalParameter&lt;Yield&gt; ')' body=Block&lt;Yield=false&gt;
    | =&gt;({PropertyMethodDeclaration.annotationList=current}
            TypeVariables? returnTypeRef=TypeRef?
            (generator?='*' LiteralOrComputedPropertyName&lt;Yield&gt; -&gt;MethodParamsAndBody &lt;Generator=true&gt;
                | LiteralOrComputedPropertyName&lt;Yield&gt; -&gt; MethodParamsAndBody &lt;Generator=false&gt;
            )
        ) ';'?
    | {PropertyNameValuePairSingleName.annotationList=current}
        declaredTypeRef=TypeRef? identifierRef=IdentifierRef&lt;Yield&gt;
        ( '=' expression=AssignmentExpression&lt;In=true,Yield&gt;)?)
;

PropertyMethodDeclaration &lt;Yield&gt;:
    =&gt; (TypeVariables? returnTypeRef=TypeRef?
            (
                generator?='*'  LiteralOrComputedPropertyName&lt;Yield&gt;
                    -&gt;MethodParamsAndBody&lt;Generator=true&gt;
                | LiteralOrComputedPropertyName&lt;Yield&gt; -&gt;MethodParamsAndBody &lt;Generator=false&gt;
            )
        )
    ';'?
;

PropertyNameValuePair &lt;Yield&gt;:
    =&gt; (
        declaredTypeRef=TypeRef? LiteralOrComputedPropertyName&lt;Yield&gt; ':'
    )
    expression=AssignmentExpression&lt;In=true,Yield&gt;
;

PropertyNameValuePairSingleName &lt;Yield&gt;:
    declaredTypeRef=TypeRef?
    identifierRef=IdentifierRef&lt;Yield&gt;
    ('=' expression=AssignmentExpression&lt;In=true,Yield&gt;)?
;

PropertyGetterDeclaration &lt;Yield&gt;:
    =&gt;(
        GetterHeader&lt;Yield&gt;
    )
    body=Block&lt;Yield=false&gt;
;

PropertySetterDeclaration &lt;Yield&gt;:
    =&gt;(
        'set'
        -&gt;LiteralOrComputedPropertyName &lt;Yield&gt;
    )
    '(' fpar=FormalParameter&lt;Yield&gt; ')' body=Block&lt;Yield=false&gt;
;

ParameterizedCallExpression &lt;Yield&gt;:
    TypeArguments
    target=IdentifierRef&lt;Yield&gt;
    ArgumentsWithParentheses&lt;Yield&gt;
;

LeftHandSideExpression &lt;Yield&gt;:
    MemberExpression&lt;Yield&gt; (
        {ParameterizedCallExpression.target=current} ArgumentsWithParentheses&lt;Yield&gt;
        (
              {ParameterizedCallExpression.target=current} ArgumentsWithParentheses&lt;Yield&gt;
            | {IndexedAccessExpression.target=current} IndexedAccessExpressionTail&lt;Yield&gt;
            | {ParameterizedPropertyAccessExpression.target=current}
                ParameterizedPropertyAccessExpressionTail&lt;Yield&gt;
            | -&gt;({TaggedTemplateString.target=current} template=TemplateLiteral&lt;Yield&gt;)
        )*
    )?
;

fragment Arguments &lt;Yield&gt;*:
      arguments+=AssignmentExpression&lt;In=true,Yield&gt;
      (',' arguments+=AssignmentExpression&lt;In=true,Yield&gt;)*
      (',' spread?='...' arguments+=AssignmentExpression&lt;In=true,Yield&gt;)?
    | spread?='...' arguments+=AssignmentExpression&lt;In=true,Yield&gt;
;

fragment TypeArguments*:
    '&lt;' typeArgs+=TypeRef (',' typeArgs+=TypeRef)* '&gt;'
;

fragment ArgumentsWithParentheses &lt;Yield&gt;*:
    '(' Arguments&lt;Yield&gt;? ')'
;

MemberExpression &lt;Yield&gt;:
    =&gt;('new' '.') 'target'
    | =&gt; ('new') callee=MemberExpression&lt;Yield&gt; (-&gt; TypeArguments)?
        (=&gt; withArgs?='(' Arguments&lt;Yield&gt;? ')'
            (
                  {IndexedAccessExpression.target=current} IndexedAccessExpressionTail&lt;Yield&gt;
                | {ParameterizedPropertyAccessExpression.target=current}
                    ParameterizedPropertyAccessExpressionTail&lt;Yield&gt;
                | {TaggedTemplateString.target=current} template=TemplateLiteral&lt;Yield&gt;
            )*
        )?
    | PrimaryExpression&lt;Yield&gt; (
          {IndexedAccessExpression.target=current} IndexedAccessExpressionTail&lt;Yield&gt;
        | {ParameterizedPropertyAccessExpression.target=current}
            ParameterizedPropertyAccessExpressionTail&lt;Yield&gt;
        | {TaggedTemplateString.target=current} template=TemplateLiteral&lt;Yield&gt;
        )*
;

fragment IndexedAccessExpressionTail &lt;Yield&gt;*:
    '[' index=Expression&lt;In=true,Yield&gt; ']'
;

fragment ParameterizedPropertyAccessExpressionTail &lt;Yield&gt;*:
    '.' TypeArguments? property=[types::IdentifiableElement|IdentifierName]
;

PostfixExpression &lt;Yield&gt;:
    LeftHandSideExpression&lt;Yield&gt; (
        =&gt;({PostfixExpression.expression=current} op=PostfixOperator
        )
    )?
;

enum PostfixOperator: inc='++' | dec='--';

CastExpression &lt;Yield&gt;: PostfixExpression&lt;Yield&gt;
    (=&gt;({CastExpression.expression=current} 'as') targetTypeRef=TypeRefForCast)?;

UnaryExpression &lt;Yield&gt;:
      CastExpression&lt;Yield&gt;
    | (op=UnaryOperator expression=UnaryExpression&lt;Yield&gt;);

enum UnaryOperator: delete | void | typeof | inc='++' | dec='--' | pos='+' | neg='-' | inv='~' | not='!';

MultiplicativeExpression &lt;Yield&gt;: UnaryExpression&lt;Yield&gt;
    (=&gt;({MultiplicativeExpression.lhs=current} op=MultiplicativeOperator)
        rhs=UnaryExpression&lt;Yield&gt;)*;

enum MultiplicativeOperator: times='*' | div='/' | mod='%';

AdditiveExpression &lt;Yield&gt;: MultiplicativeExpression&lt;Yield&gt;
    (=&gt;({AdditiveExpression.lhs=current} op=AdditiveOperator)
        rhs=MultiplicativeExpression&lt;Yield&gt;)*;

enum AdditiveOperator: add='+' | sub='-';

ShiftExpression &lt;Yield&gt;: AdditiveExpression&lt;Yield&gt;
    (=&gt;({ShiftExpression.lhs=current} op=ShiftOperator rhs=AdditiveExpression&lt;Yield&gt;))*
;

ShiftOperator:
      '&gt;' '&gt;' '&gt;'?
    | '&lt;&lt;'
;

RelationalExpression &lt;In, Yield&gt;: ShiftExpression&lt;Yield&gt;
    =&gt;({RelationalExpression.lhs=current} op=RelationalOperator&lt;In&gt;
        -&gt;rhs=ShiftExpression&lt;Yield&gt;)*;

RelationalOperator &lt;In&gt;:
    '&lt;' | '&gt;' | '&lt;=' | '&gt;=' | 'instanceof' | &lt;In&gt; 'in';

EqualityExpression &lt;In, Yield&gt;: RelationalExpression&lt;In,Yield&gt;
    (=&gt;({EqualityExpression.lhs=current} op=EqualityOperator) rhs=RelationalExpression&lt;In,Yield&gt;)*;

enum EqualityOperator: same='===' | nsame='!==' | eq='==' | neq='!=';

BitwiseANDExpression &lt;In, Yield&gt;: EqualityExpression&lt;In,Yield&gt;
    (=&gt;({BinaryBitwiseExpression.lhs=current} op=BitwiseANDOperator) rhs=EqualityExpression&lt;In,Yield&gt;)*;

BitwiseANDOperator: '&amp;';

BitwiseXORExpression &lt;In, Yield&gt;: BitwiseANDExpression&lt;In,Yield&gt;
    (=&gt;({BinaryBitwiseExpression.lhs=current} op=BitwiseXOROperator) rhs=BitwiseANDExpression&lt;In,Yield&gt;)*;

BitwiseXOROperator: '^';

BitwiseORExpression &lt;In, Yield&gt;: BitwiseXORExpression&lt;In,Yield&gt;
    (=&gt;({BinaryBitwiseExpression.lhs=current} op=BitwiseOROperator) rhs=BitwiseXORExpression&lt;In,Yield&gt;)*;

BitwiseOROperator: '|';

LogicalANDExpression &lt;In, Yield&gt;: BitwiseORExpression&lt;In,Yield&gt;
    (=&gt; ({BinaryLogicalExpression.lhs=current} op=LogicalANDOperator) rhs=BitwiseORExpression&lt;In,Yield&gt;)*;

LogicalANDOperator: '&amp;&amp;';

LogicalORExpression &lt;In, Yield&gt;: LogicalANDExpression&lt;In,Yield&gt;
    (=&gt;({BinaryLogicalExpression.lhs=current} op=LogicalOROperator) rhs=LogicalANDExpression&lt;In,Yield&gt;)*;

LogicalOROperator: '||';

ConditionalExpression &lt;In, Yield&gt;: LogicalORExpression&lt;In,Yield&gt;
    (=&gt; ({ConditionalExpression.expression=current} '?') trueExpression=AssignmentExpression&lt;In=true,Yield&gt;
        ':' falseExpression=AssignmentExpression&lt;In,Yield&gt;)?;

AssignmentExpression &lt;In, Yield&gt;:
      AwaitExpression&lt;In,Yield&gt;
    | PromisifyExpression&lt;In,Yield&gt;
    | ArrowExpression&lt;In,Yield&gt;
    | &lt;Yield&gt; YieldExpression&lt;In&gt;
    | ConditionalExpression&lt;In,Yield&gt;
        (=&gt; ({AssignmentExpression.lhs=current} op=AssignmentOperator)
            rhs=AssignmentExpression&lt;In,Yield&gt;)?
;

YieldExpression &lt;In&gt;:
    'yield' =&gt; many?='*'? -&gt; expression=AssignmentExpression&lt;In,Yield=true&gt;?
;

AssignmentOperator:
      '=' | '*=' | '/=' | '%=' | '+=' | '-='
    | '&lt;&lt;='
    | '&gt;' '&gt;'? '&gt;='
    | '&amp;=' | '^=' | '|='
;

AwaitExpression &lt;In, Yield&gt;:
    =&gt;('await') expression=AssignmentExpression&lt;In,Yield&gt;;

PromisifyExpression &lt;In, Yield&gt;:
    =&gt; ('@' 'Promisify') expression=AssignmentExpression&lt;In,Yield&gt;;

Expression &lt;In, Yield&gt;:
    AssignmentExpression&lt;In,Yield&gt; ({CommaExpression.exprs+=current}
    ',' exprs+=AssignmentExpression&lt;In,Yield&gt;
    (','    exprs+=AssignmentExpression&lt;In,Yield&gt;)*)?
;

TemplateLiteral &lt;Yield&gt;:
    (
          segments+=NoSubstitutionTemplate
        | segments+=TemplateHead segments+=Expression&lt;In=true,Yield&gt;? TemplateExpressionEnd
            (
                segments+=TemplateMiddle segments+=Expression&lt;In=true,Yield&gt;?
                TemplateExpressionEnd
            )*
            segments+=TemplateTail
    )
;

TemplateExpressionEnd:
    '}'
;

NoSubstitutionTemplate:
    rawValue=NO_SUBSTITUTION_TEMPLATE_LITERAL
;

TemplateHead:
    rawValue=TEMPLATE_HEAD
;

TemplateTail:
    rawValue=TemplateTailLiteral;

TemplateMiddle:
    rawValue=TemplateMiddleLiteral;

Literal:
      NumericLiteral | BooleanLiteral | StringLiteral
    | NullLiteral | RegularExpressionLiteral;
NullLiteral: 'null';
BooleanLiteral: (true?='true' | 'false');
StringLiteral: value=STRING;
NumericLiteral:
      DoubleLiteral | IntLiteral | BinaryIntLiteral | OctalIntLiteral
    | LegacyOctalIntLiteral | HexIntLiteral | ScientificIntLiteral;
DoubleLiteral: value=DOUBLE;
IntLiteral: value=INT;
OctalIntLiteral: value=OCTAL_INT;
LegacyOctalIntLiteral: value=LEGACY_OCTAL_INT;
HexIntLiteral: value=HEX_INT;
BinaryIntLiteral: value=BINARY_INT;
ScientificIntLiteral: value=SCIENTIFIC_INT;
RegularExpressionLiteral: value=REGEX_LITERAL;

NumericLiteralAsString:
    DOUBLE | INT | OCTAL_INT | HEX_INT | SCIENTIFIC_INT
;

IdentifierOrThis:
    IDENTIFIER
    | 'This'
    | 'Promisify'
    | 'target';

AnnotationName:
    IDENTIFIER
    | 'This'
    | 'target';

BindingIdentifier &lt;Yield&gt;:
    IDENTIFIER
    | &lt;!Yield&gt; 'yield'
    | N4Keyword
;

IdentifierName:
    IDENTIFIER | ReservedWord | N4Keyword
;

ReservedWord:
    'break' | 'case' | 'catch' | 'class' | 'const' | 'continue' | 'debugger' | 'default' | 'delete'
    | 'do' | 'else' | 'export' | 'extends' | 'finally' | 'for' | 'function' | 'if' | 'import'
    | 'in' | 'instanceof' | 'new' | 'return' | 'super' | 'switch' | 'this' | 'throw' | 'try'
    | 'typeof' | 'var' | 'void' | 'while' | 'with' | 'yield'
    | 'null'
    | 'true' | 'false'
    | 'enum';

N4Keyword:
    'get' | 'set'
    | 'let'
    | 'project'
    | 'external' | 'abstract' | 'static'
    | 'as' | 'from' | 'constructor' | 'of' | 'target'
    | 'type' | 'union' | 'intersection'
    | 'This' | 'Await' | 'Promisify'
    | 'await'
    | 'async'
    | 'implements' | 'interface'
    | 'private' | 'protected' | 'public'
;

SymbolLiteralComputedName &lt;Yield&gt;:
    BindingIdentifier&lt;Yield&gt; ('.' IdentifierName)?
;

terminal DOUBLE:
    '.' DECIMAL_DIGIT_FRAGMENT+ EXPONENT_PART?
    | DECIMAL_INTEGER_LITERAL_FRAGMENT '.' DECIMAL_DIGIT_FRAGMENT* EXPONENT_PART?
;

terminal HEX_INT: '0' ('x' | 'X') INT_SUFFIX;

terminal BINARY_INT: '0' ('b' | 'B') INT_SUFFIX;

terminal OCTAL_INT: '0' ('o' | 'O') INT_SUFFIX;

terminal LEGACY_OCTAL_INT: '0' DECIMAL_DIGIT_FRAGMENT INT_SUFFIX;

terminal fragment INT_SUFFIX: IDENTIFIER_PART*;

terminal SCIENTIFIC_INT:
    DECIMAL_INTEGER_LITERAL_FRAGMENT EXPONENT_PART
;

terminal fragment EXPONENT_PART:
      ('e' | 'E') SIGNED_INT
    | IDENTIFIER
;

terminal fragment SIGNED_INT:
    ('+' | '-') DECIMAL_DIGIT_FRAGMENT+ IDENTIFIER?
;

terminal STRING:
      '"' DOUBLE_STRING_CHAR* '"'?
    | "'" SINGLE_STRING_CHAR* "'"?
;

terminal fragment DOUBLE_STRING_CHAR:
      !(LINE_TERMINATOR_FRAGMENT | '"' | '\\')
    | '\\' (LINE_TERMINATOR_SEQUENCE_FRAGMENT | !LINE_TERMINATOR_FRAGMENT)?
;

terminal fragment SINGLE_STRING_CHAR:
      !(LINE_TERMINATOR_FRAGMENT | "'" | '\\')
    | '\\' (LINE_TERMINATOR_SEQUENCE_FRAGMENT | !LINE_TERMINATOR_FRAGMENT)?
;

terminal fragment BACKSLASH_SEQUENCE:
    '\\' !(LINE_TERMINATOR_FRAGMENT)?
;

terminal fragment REGEX_CHAR:
      !(LINE_TERMINATOR_FRAGMENT | '\\' | '/' | '[')
    | BACKSLASH_SEQUENCE
    | '[' REGEX_CHAR_OR_BRACKET* ']'?
;

terminal fragment REGEX_CHAR_OR_BRACKET:
      !(LINE_TERMINATOR_FRAGMENT | '\\' | ']')
    | BACKSLASH_SEQUENCE
;

REGEX_LITERAL:
    ('/' | '/=') REGEX_TAIL?
;

terminal fragment ACTUAL_REGEX_TAIL:
      REGEX_CHAR+ ('/' IDENTIFIER_PART*)?
    | '/' IDENTIFIER_PART*
;

terminal fragment REGEX_START:
    ('/' | '/=')
;

terminal REGEX_TAIL: // post processed
    '//1'
;
terminal TEMPLATE_HEAD:
    "`" TEMPLATE_LITERAL_CHAR* '$'+ '{'
;

terminal NO_SUBSTITUTION_TEMPLATE_LITERAL:
    '`' TEMPLATE_LITERAL_CHAR* '$'* "`"?
;

terminal fragment ACTUAL_TEMPLATE_END:
    TEMPLATE_LITERAL_CHAR* ('$'+ ('{' | '`'?) | '`'?)
;

terminal fragment TEMPLATE_LITERAL_CHAR:
      !(LINE_TERMINATOR_FRAGMENT | '`' | '\\' | '$')
    | '$'+ !('{' | '`' | '$')
    | LINE_TERMINATOR_SEQUENCE_FRAGMENT
    | '\\' (LINE_TERMINATOR_SEQUENCE_FRAGMENT | !LINE_TERMINATOR_FRAGMENT)?
;

TemplateTailLiteral:
    TEMPLATE_END?
;

TemplateMiddleLiteral:
    TEMPLATE_MIDDLE
;

terminal TEMPLATE_MIDDLE:
    '//2' // will never be lexed
;

terminal TEMPLATE_END:
    '//3' // will never be lexed
;

terminal fragment TEMPLATE_CONTINUATION:
    '//4' // actually '}'
;

Semi: ';'; // automatic semicolon instertion, post-processed

fragment NoLineTerminator*: NO_LINE_TERMINATOR?;

terminal NO_LINE_TERMINATOR:
    '//5' // post-processed, will never be lexed
;
Annotation:'@' AnnotationNoAtSign;
ScriptAnnotation: '@@' AnnotationNoAtSign;

AnnotationNoAtSign:
    name=AnnotationName (=&gt; '(' (args+=AnnotationArgument (',' args+=AnnotationArgument)*)? ')')?;

AnnotationArgument:
    LiteralAnnotationArgument | TypeRefAnnotationArgument
;

LiteralAnnotationArgument:
    literal=Literal
;

TypeRefAnnotationArgument:
    typeRef=TypeRef
;

AnnotationList:
    =&gt;('@' -&gt; annotations+=AnnotationNoAtSign) annotations+=Annotation*
;

ExpressionAnnotationList:
    annotations+=Annotation+
;

PropertyAssignmentAnnotationList:
    annotations+=Annotation+
;

N4MemberAnnotationList:
    {N4MemberAnnotationList} annotations+=Annotation+
;

TypeReferenceName:
    'void' | 'This' | 'await' | 'Promisify' | 'target' | QualifiedTypeReferenceName
;

QualifiedTypeReferenceName:
    IDENTIFIER ('.' IDENTIFIER)?
;
N4ClassDeclaration &lt;Yield&gt;:
    =&gt;(
        {N4ClassDeclaration}
        (declaredModifiers+=N4Modifier)*
        'class' typingStrategy=TypingStrategyDefSiteOperator? name=BindingIdentifier&lt;Yield&gt;?
    )
    TypeVariables?
    ClassExtendsClause&lt;Yield&gt;?
    Members&lt;Yield&gt;
;

fragment Members &lt;Yield&gt;*:
    '{'
    ownedMembersRaw+=N4MemberDeclaration&lt;Yield&gt;*
    '}'
;

fragment ClassExtendsClause &lt;Yield&gt;*:
    'extends' (
          =&gt;superClassRef=ParameterizedTypeRefNominal ('implements' ClassImplementsList)?
        | superClassExpression=LeftHandSideExpression&lt;Yield&gt;
    )
    | 'implements' ClassImplementsList
;

fragment ClassImplementsList*:
    implementedInterfaceRefs+=ParameterizedTypeRefNominal
    (',' implementedInterfaceRefs+=ParameterizedTypeRefNominal)*
;

N4ClassExpression &lt;Yield&gt;:
    {N4ClassExpression}
    'class' name=BindingIdentifier&lt;Yield&gt;?
    ClassExtendsClause&lt;Yield&gt;?
    Members&lt;Yield&gt;;
N4InterfaceDeclaration &lt;Yield&gt;:
    =&gt; (
        {N4InterfaceDeclaration}
        (declaredModifiers+=N4Modifier)*
        'interface' typingStrategy=TypingStrategyDefSiteOperator? name=BindingIdentifier&lt;Yield&gt;?
    )
    TypeVariables?
    InterfaceImplementsList?
    Members&lt;Yield&gt;
;

fragment InterfaceImplementsList*:
     'extends' superInterfaceRefs+=ParameterizedTypeRefNominal
        (',' superInterfaceRefs+=ParameterizedTypeRefNominal)*
;
N4EnumDeclaration &lt;Yield&gt;:
    =&gt;(
        {N4EnumDeclaration}
        (declaredModifiers+=N4Modifier)*
        'enum' name=BindingIdentifier&lt;Yield&gt;?
    )
    '{'
        (literals+=N4EnumLiteral (',' literals+=N4EnumLiteral)*)?
    '}'
;
N4EnumLiteral: name=IdentifierOrThis (':' value=STRING)?;

enum N4Modifier: // validator applies further checks
      private | project | protected | public
    | external | abstract | static | const;

N4MemberDeclaration &lt;Yield&gt;:
    AnnotatedN4MemberDeclaration&lt;Yield&gt;
    | N4GetterDeclaration&lt;Yield&gt;
    | N4SetterDeclaration&lt;Yield&gt;
    | N4MethodDeclaration&lt;Yield&gt;
    | N4FieldDeclaration&lt;Yield&gt;
    | N4CallableConstructorDeclaration&lt;Yield&gt;
;

AnnotatedN4MemberDeclaration &lt;Yield&gt; returns N4MemberDeclaration:
    N4MemberAnnotationList (
            =&gt; ({N4GetterDeclaration.annotationList=current}
                (declaredModifiers+=N4Modifier)* GetterHeader&lt;Yield&gt;) (body=Block&lt;Yield&gt;)? ';'?
        |   =&gt; ({N4SetterDeclaration.annotationList=current}
                (declaredModifiers+=N4Modifier)* 'set' -&gt; LiteralOrComputedPropertyName &lt;Yield&gt;)
                '(' fpar=FormalParameter&lt;Yield&gt; ')' (body=Block&lt;Yield&gt;)? ';'?
        |   =&gt; (
                {N4MethodDeclaration.annotationList=current} (declaredModifiers+=N4Modifier)* TypeVariables?
                (
                        generator?='*' LiteralOrComputedPropertyName&lt;Yield&gt;
                        -&gt;MethodParamsReturnAndBody &lt;Generator=true&gt;
                    |   AsyncNoTrailingLineBreak LiteralOrComputedPropertyName&lt;Yield&gt;
                        -&gt;MethodParamsReturnAndBody &lt;Generator=false&gt;
                )
                )';'?
        |   {N4FieldDeclaration.annotationList=current} FieldDeclarationImpl&lt;Yield&gt;
    )
;

fragment LiteralOrComputedPropertyName &lt;Yield&gt;*:
    name=IdentifierName | name=STRING | name=NumericLiteralAsString
    | '[' (=&gt;((name=SymbolLiteralComputedName&lt;Yield&gt; | name=StringLiteralAsName) ']')
        |   computeNameFrom=AssignmentExpression&lt;In=true,Yield&gt; ']')
;

fragment LiteralPropertyName &lt;Yield&gt;*:
    name=IdentifierName | name=STRING | name=NumericLiteralAsString
    | '[' (name=SymbolLiteralComputedName&lt;Yield&gt; | name=StringLiteralAsName) ']'
;

StringLiteralAsName:
    STRING
;

fragment FieldDeclarationImpl &lt;Yield&gt;*:
    (declaredModifiers+=N4Modifier)*
    LiteralPropertyName&lt;Yield&gt; ColonSepTypeRef? ('=' expression=Expression&lt;In=true,Yield&gt;)? ';'
;

N4FieldDeclaration &lt;Yield&gt;:
    {N4FieldDeclaration}
    FieldDeclarationImpl&lt;Yield&gt;
;

N4MethodDeclaration &lt;Yield&gt;:
    =&gt; ({N4MethodDeclaration} (declaredModifiers+=N4Modifier)* TypeVariables?
        (
                generator?='*' LiteralOrComputedPropertyName&lt;Yield&gt;
                -&gt;MethodParamsReturnAndBody &lt;Generator=true&gt;
            |   AsyncNoTrailingLineBreak LiteralOrComputedPropertyName&lt;Yield&gt;
                -&gt;MethodParamsReturnAndBody &lt;Generator=false&gt;
        )
    ) ';'?
;

N4CallableConstructorDeclaration &lt;Yield&gt; returns N4MethodDeclaration:
    MethodParamsReturnAndBody &lt;Generator=false&gt; ';'?
;

fragment MethodParamsAndBody &lt;Generator&gt;*:
    StrictFormalParameters&lt;Yield=Generator&gt;
    (body=Block&lt;Yield=Generator&gt;)?
;

fragment MethodParamsReturnAndBody &lt;Generator&gt;*:
    StrictFormalParameters&lt;Yield=Generator&gt;
    (':' returnTypeRef=TypeRef)?
    (body=Block&lt;Yield=Generator&gt;)?
;

N4GetterDeclaration &lt;Yield&gt;:
    =&gt; ({N4GetterDeclaration}
    (declaredModifiers+=N4Modifier)*
    GetterHeader&lt;Yield&gt;)
    (body=Block&lt;Yield&gt;)? ';'?
;

fragment GetterHeader &lt;Yield&gt;*:
    ('get' -&gt; LiteralOrComputedPropertyName &lt;Yield&gt; '(' ')' ColonSepTypeRef?)
;

N4SetterDeclaration &lt;Yield&gt;:
    =&gt;({N4SetterDeclaration}
        (declaredModifiers+=N4Modifier)*
        'set'
        -&gt;LiteralOrComputedPropertyName &lt;Yield&gt;
    )
    '(' fpar=FormalParameter&lt;Yield&gt; ')' (body=Block&lt;Yield&gt;)? ';'?
;

BindingPattern &lt;Yield&gt;:
    ObjectBindingPattern&lt;Yield&gt;
    | ArrayBindingPattern&lt;Yield&gt;
;

ObjectBindingPattern &lt;Yield&gt;:
    '{' (properties+=BindingProperty&lt;Yield,AllowType=false&gt;
        (',' properties+=BindingProperty&lt;Yield,AllowType=false&gt;)*)? '}'
;

ArrayBindingPattern &lt;Yield&gt;:
    '['
        elements+=Elision* (
            elements+=BindingRestElement&lt;Yield&gt;
            (',' elements+=Elision* elements+=BindingRestElement&lt;Yield&gt;)*
            (',' elements+=Elision*)?
        )?
    ']'
;

BindingProperty &lt;Yield, AllowType&gt;:
      =&gt;(LiteralBindingPropertyName&lt;Yield&gt; ':') value=BindingElement&lt;Yield&gt;
    | value=SingleNameBinding&lt;Yield,AllowType&gt;
;

fragment LiteralBindingPropertyName &lt;Yield&gt;*:
    declaredName=IdentifierName | declaredName=STRING | declaredName=NumericLiteralAsString
    | '[' (declaredName=SymbolLiteralComputedName&lt;Yield&gt; | declaredName=STRING) ']'
;

SingleNameBinding &lt;Yield, AllowType&gt;:
    varDecl=VariableDeclaration&lt;In=true,Yield,AllowType&gt;
;

BindingElement &lt;Yield&gt;:
      =&gt;(nestedPattern=BindingPattern&lt;Yield&gt;) ('=' expression=AssignmentExpression&lt;In=true,Yield&gt;)?
    | varDecl=VariableDeclaration&lt;In=true,Yield,AllowType=true&gt;
;

BindingRestElement &lt;Yield&gt;:
    rest?='...'?
    (
          =&gt;(nestedPattern=BindingPattern&lt;Yield&gt;)
            ('=' expression=AssignmentExpression&lt;In=true,Yield&gt;)?
        | varDecl=VariableDeclaration&lt;In=true,Yield,AllowType=true&gt;
    )
;

Elision:
    ','
;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jsobjects"><a class="anchor" href="#_jsobjects"></a>18. JSObjects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The built-in ECMAScript Objects
[<a href="#ECMA11a">ECMA11a(p.S15, p.pp.102)</a>] are supported and their properties are annotated with types as described in this chapter. The semantics of these properties do not change. The short description is copied from [<a href="#ECMA11a">ECMA11a</a>] repeated here for convenience.</p>
</div>
<div class="sect2">
<h3 id="_object"><a class="anchor" href="#_object"></a>18.1. Object</h3>
<div class="paragraph">
<p><code>Object</code> is the super type of all declared types and <code>N4Object</code>. It is almost similar to the JavaScript type <code>Object</code> except that no properties may be dynamically added to it. In order to declare a variable to which properties can be dynamically added, the <code>Object+</code> type has to be declared (cf.
<a href="#Type_Modifiers_Dynamic">[Type_Modifiers_Dynamic]</a>).</p>
</div>
<div class="sect3">
<h4 id="_attributes_2"><a class="anchor" href="#_attributes_2"></a>18.1.1. Attributes</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>constructor:Object</code>: </dt>
<dd>
<p>Returns a reference to the Object function that created the instance’s
prototype.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_methods_2"><a class="anchor" href="#_methods_2"></a>18.1.2. Methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>toString():Object</code>: </dt>
<dd>
<p>Returns a string representing the specified object.</p>
</dd>
<dt class="hdlist1"><code>toLocaleString():Object</code>: </dt>
<dd>
<p>Returns a string representing the object. This method is meant to be
overridden by derived objects for locale-specific purposes.</p>
</dd>
<dt class="hdlist1"><code>valueOf():Object</code>: </dt>
<dd>
<p>Returns the primitive value of the specified object.</p>
</dd>
<dt class="hdlist1"><code>hasOwnProperty(prop:String):Boolean</code>: </dt>
<dd>
<p>Returns a boolean indicating whether an object contains the specified
property as a direct property of that object and not inherited through
the prototype chain.</p>
</dd>
<dt class="hdlist1"><code>isPrototypeOf(object:Object):Boolean</code>: </dt>
<dd>
<p>Returns a boolean indication whether the specified object is in the
prototype chain of the object this method is called upon.</p>
</dd>
<dt class="hdlist1"><code>propertyIsEnumerable(prop:String):Boolean</code>: </dt>
<dd>
<p>Returns a boolean indicating if the internal ECMAScript DontEnum
attribute is set.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_static_methods"><a class="anchor" href="#_static_methods"></a>18.1.3. Static Methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>getPrototypeOf(object:Object):Object</code>: </dt>
<dd>
<p>Returns the prototype of the specified object.</p>
</dd>
<dt class="hdlist1"><code>create(object:Object,properties:Object=):Object</code>: </dt>
<dd>
<p>Creates a new object with the specified prototype object and properties.</p>
</dd>
<dt class="hdlist1"><code>defineProperty(object:Object,prop:Object,descriptor:Object):Object</code>: </dt>
<dd>
<p>Defines a new property directly on an object or modifies an existing
property on an object and returns the object.</p>
</dd>
<dt class="hdlist1"><code>defineProperties(object:Object,properties:Object):Object</code>: </dt>
<dd>
<p>Defines new or modifies existing properties directly on an object,
returning the object.</p>
</dd>
<dt class="hdlist1"><code>seal(object:Object,properties:Object)</code>: </dt>
<dd>
<p>Seals an object, preventing new properties from being added to it and
marking all existing properties as non-configurable. Values of present
properties can still be changed as long as they are writable.</p>
</dd>
<dt class="hdlist1"><code>freeze(object:Object):Object</code>: </dt>
<dd>
<p>Freezes an object: that is, prevents new properties from being added to it, prevents existing properties from being removed, prevents existing properties or their enumerability, configurability, or writability from being changed.
In essence, the object is made effectively immutable.
The method returns the object being frozen.</p>
</dd>
<dt class="hdlist1"><code>preventExtensions(object:Object):Object</code>: </dt>
<dd>
<p>Prevents new properties from ever being added to an object (i.e.
prevents future extensions to the object).</p>
</dd>
<dt class="hdlist1"><code>isSealed(object:Object):Boolean static</code>: </dt>
<dd>
<p>Determine if an object is sealed.</p>
</dd>
<dt class="hdlist1"><code>isFrozen(object:Object):Boolean</code>: </dt>
<dd>
<p>Determine if an object is frozen.</p>
</dd>
<dt class="hdlist1"><code>isExtensible(object:Object):Boolean</code>: </dt>
<dd>
<p>Determines if an object is extensible (whether it can have new
properties added to it).</p>
</dd>
<dt class="hdlist1"><code>keys(object:Object):Array&lt;String&gt;</code>: </dt>
<dd>
<p>Returns an array of all own enumerable properties found upon a given
object in the same order as that provided by a for-in loop (the
difference being that a for-in loop enumerates properties in the
prototype chain as well).</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_string"><a class="anchor" href="#_string"></a>18.2. String</h3>
<div class="paragraph">
<p>String is a global object that may be used to construct String
instances and is a sub class of Object.</p>
</div>
<div class="sect3">
<h4 id="string-attributes"><a class="anchor" href="#string-attributes"></a>18.2.1. Attributes</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>number: length</code> </dt>
<dd>
<p>The length of a string.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="methods-1"><a class="anchor" href="#methods-1"></a>18.2.2. Methods</h4>
<div class="paragraph">
<p><code>String(thing:Object=)</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>anchor(anchorname:String):String</code>: </dt>
<dd>
<p>Creates an HTML anchor.</p>
</dd>
<dt class="hdlist1"><code>big():String</code>: </dt>
<dd>
<p>Returns a string in a big font.</p>
</dd>
<dt class="hdlist1"><code>blink():String</code>: </dt>
<dd>
<p>Returns a string in a blinking string.</p>
</dd>
<dt class="hdlist1"><code>bold():String</code>: </dt>
<dd>
<p>Returns a string in a bold font.</p>
</dd>
<dt class="hdlist1"><code>charAt(index:Number):String</code>: </dt>
<dd>
<p>Returns the character at a specified position.</p>
</dd>
<dt class="hdlist1"><code>charCodeAt(index:Number):Number</code>: </dt>
<dd>
<p>Returns the Unicode of the character at a specified position.</p>
</dd>
<dt class="hdlist1"><code>concat(strings:String&#8230;&#8203;):String</code>: </dt>
<dd>
<p>Joins two or more strings.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>equals(object:Object):Boolean</code></p>
</div>
<div class="paragraph">
<p><code>equalsIgnoreCase(object:Object):Boolean</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>fromCharCode(num:Any&#8230;&#8203;):String</code>: </dt>
<dd>
<p>Returns a string created by using the specified sequence of Unicode values.</p>
</dd>
<dt class="hdlist1"><code>fixed():String</code>: </dt>
<dd>
<p>Returns a string as teletype text.</p>
</dd>
<dt class="hdlist1"><code>fontcolor(color):String</code>: </dt>
<dd>
<p>Returns a string in a specified color.</p>
</dd>
<dt class="hdlist1"><code>fontsize(size):String</code>: </dt>
<dd>
<p>Returns a string in a specified size.</p>
</dd>
<dt class="hdlist1"><code>indexOf(searchValue, fromIndex:Number=):Number</code>: </dt>
<dd>
<p>Returns the position of the first occurrence of a specified string value in a string.</p>
</dd>
<dt class="hdlist1"><code>italics():String</code>: </dt>
<dd>
<p>Returns a string in italic.</p>
</dd>
<dt class="hdlist1"><code>lastIndexOf(searchValue, fromIndex:Number=):Number</code>: </dt>
<dd>
<p>Returns the position of the last occurrence of a specified string value, searching backwards from the specified position in a string.</p>
</dd>
<dt class="hdlist1"><code>link(url):String</code>: </dt>
<dd>
<p>Returns a string as a hyperlink.</p>
</dd>
<dt class="hdlist1"><code>localeCompare(otherString):Number</code>: </dt>
<dd>
<p>This method returns a number indicating whether a reference string comes before or after or is the same as the given string in sort order.</p>
</dd>
<dt class="hdlist1"><code>match(search value):String</code>: </dt>
<dd>
<p>Searches for a specified value in a string.</p>
</dd>
<dt class="hdlist1"><code>replace(findString,newString):String</code>: </dt>
<dd>
<p>Replaces some characters with some other characters in a string.</p>
</dd>
<dt class="hdlist1"><code>search(search string):Number</code>: </dt>
<dd>
<p>Searches a string for a specified value.</p>
</dd>
<dt class="hdlist1"><code>slice(beginSlice:Number, endSclice:Number=):String</code>: </dt>
<dd>
<p>Extracts a part of a string and returns the extracted part in a new string.</p>
</dd>
<dt class="hdlist1"><code>small():String</code>: </dt>
<dd>
<p>Returns a string in a small font.</p>
</dd>
<dt class="hdlist1"><code>split(separator, howmany:Number=):Array&lt;String&gt;</code>: </dt>
<dd>
<p>Splits a string into an array of strings.</p>
</dd>
<dt class="hdlist1"><code>strike():String</code>: </dt>
<dd>
<p>Returns a string with a strikethrough.</p>
</dd>
<dt class="hdlist1"><code>sub():String</code>: </dt>
<dd>
<p>Returns a string as subscript.</p>
</dd>
<dt class="hdlist1"><code>substr(start:Number,length:Number=):String</code>: </dt>
<dd>
<p>Extracts a specified number of characters in a string, from a start index.</p>
</dd>
<dt class="hdlist1"><code>substring(beginIndex:number,endIndex:Number=):String</code>: </dt>
<dd>
<p>Extracts the characters in a string between two specified indices.</p>
</dd>
<dt class="hdlist1"><code>sup():String</code>: </dt>
<dd>
<p>Returns a string as superscript.</p>
</dd>
<dt class="hdlist1"><code>toLocaleUpperCase():String</code>: </dt>
<dd>
<p>Returns a string in lowercase letters.</p>
</dd>
<dt class="hdlist1"><code>toString():String</code>: </dt>
<dd>
<p>Returns a String value for this object.</p>
</dd>
<dt class="hdlist1"><code>toUpperCase():String</code>: </dt>
<dd>
<p>Returns a string in uppercase letters.</p>
</dd>
<dt class="hdlist1"><code>valueOf():String</code>: </dt>
<dd>
<p>Returns the primitive value of a String object.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="static-methods-1"><a class="anchor" href="#static-methods-1"></a>18.2.3. Static Methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>String(value:Object=)</code>: </dt>
<dd>
<p>Static constructor.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_boolean"><a class="anchor" href="#_boolean"></a>18.3. Boolean</h3>
<div class="paragraph">
<p><code>Boolean</code> does not have a super class.</p>
</div>
<div class="sect3">
<h4 id="static-methods-2"><a class="anchor" href="#static-methods-2"></a>18.3.1. Static Methods</h4>
<div class="paragraph">
<p><code>Boolean(value:Object=):Boolean</code></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_number"><a class="anchor" href="#_number"></a>18.4. Number</h3>
<div class="paragraph">
<p><code>Number</code> does not have a super class.</p>
</div>
<div class="sect3">
<h4 id="_static_attributes"><a class="anchor" href="#_static_attributes"></a>18.4.1. Static Attributes</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>MAX\_VALUE:Number</code>: </dt>
<dd>
<p>The largest representable number.</p>
</dd>
<dt class="hdlist1"><code>MIN\_VALUE:Number</code>: </dt>
<dd>
<p>The smallest representable number.</p>
</dd>
<dt class="hdlist1"><code>NaN:Number</code>: </dt>
<dd>
<p>Special 'not a number' value.</p>
</dd>
<dt class="hdlist1"><code>NEGATIVE\_INFINITY:Number</code>: </dt>
<dd>
<p>Special value representing negative infinity, returned on overflow.</p>
</dd>
<dt class="hdlist1"><code>POSITIVE\_INFINITY:Number</code>: </dt>
<dd>
<p>Special value representing infinity, returned on overflow.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="methods-2"><a class="anchor" href="#methods-2"></a>18.4.2. Methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>toExponential(numberOfDecimals:Number=):String</code>: </dt>
<dd>
<p>Converts the value of the object into an exponential notation.</p>
</dd>
<dt class="hdlist1"><code>toFixed(numberOfDecimals:Number=):String</code>: </dt>
<dd>
<p>Formats a number to the specified number of decimals.</p>
</dd>
<dt class="hdlist1"><code>toPrecision(numberOfDecimals:Number=):String</code>: </dt>
<dd>
<p>Converts a number into an exponential notation if it has more digits than specified.</p>
</dd>
<dt class="hdlist1"><code>valueOf():Number</code>: </dt>
<dd>
<p>Returns the primitive value of a Number object.</p>
</dd>
<dt class="hdlist1"><code>toString(radix:Number=):String</code>: </dt>
<dd>
<p>Returns a String value for this object. The toString method parses its first argument and attempts to return a string representation in the specified radix (base).</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="static-methods-3"><a class="anchor" href="#static-methods-3"></a>18.4.3. Static Methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Number(value:Object=):Number</code>: </dt>
<dd>
<p>Static constructor.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="function"><a class="anchor" href="#function"></a>18.5. Function</h3>
<div class="paragraph">
<p><code>Function</code> does not have a super class.</p>
</div>
<div class="sect3">
<h4 id="attributes-2"><a class="anchor" href="#attributes-2"></a>18.5.1. Attributes</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>prototype:Object</code>: </dt>
<dd>
<p>Allows the addition of properties to the instance of the object created by the constructor function.</p>
</dd>
<dt class="hdlist1"><code>length:Number</code>: </dt>
<dd>
<p>Specifies the number of arguments expected by the functio</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="methods-3"><a class="anchor" href="#methods-3"></a>18.5.2. Methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>apply(thisArg,argsArray:Array=):Object</code>: </dt>
<dd>
<p>Applies the method of another object in the context of a different object (the calling object); arguments can be passed as an Array object.</p>
</dd>
<dt class="hdlist1"><code>call(thisArg,arg&#8230;&#8203;):Object</code>: </dt>
<dd>
<p>Calls (executes) a method of another object in the context of a different object (the calling object); arguments can be passed as they are.</p>
</dd>
<dt class="hdlist1"><code>bind(thisArg:Object,arg&#8230;&#8203;):Function</code>: </dt>
<dd>
<p>Creates a new function that, when called, itself calls this function in the context of the provided this value with a given sequence of arguments preceding any provided when the new function was called.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_error"><a class="anchor" href="#_error"></a>18.6. Error</h3>
<div class="paragraph">
<p>Error does not have a super class.</p>
</div>
<div class="sect3">
<h4 id="attributes-3"><a class="anchor" href="#attributes-3"></a>18.6.1. Attributes</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>name:String</code>: </dt>
<dd>
<p>Error name.</p>
</dd>
<dt class="hdlist1"><code>message:String</code>: </dt>
<dd>
<p>Error message.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="static-methods-4"><a class="anchor" href="#static-methods-4"></a>18.6.2. Static Methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Error(message:Object=):Error</code>: </dt>
<dd>
<p>Static Constructor.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_array"><a class="anchor" href="#_array"></a>18.7. Array</h3>
<div class="paragraph">
<p><code>Array</code> is a generic type with the type parameter <code>E</code> and  does not have a super class.</p>
</div>
<div class="sect3">
<h4 id="methods-4"><a class="anchor" href="#methods-4"></a>18.7.1. Methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>concat(array&#8230;&#8203;):Array&lt;E&gt;)</code>: </dt>
<dd>
<p>Joins two or more arrays and returns the result.</p>
</dd>
<dt class="hdlist1"><code>every(callback:Function):Boolean</code>: </dt>
<dd>
<p>Tests whether all elements in the array pass the test implemented by the provided function. The callback will be called with 3 arguments (elementValue,elementIndex,traversedArray).</p>
</dd>
<dt class="hdlist1"><code>filter(callback:Function):Array&lt;E&gt;</code>: </dt>
<dd>
<p>Creates a new array with all elements that pass the test implemented by the provided function. The callback will be called with 3 arguments (elementValue,elementIndex,traversedArray).</p>
</dd>
<dt class="hdlist1"><code>forEach(callback:Function,thisArg=)</code>: </dt>
<dd>
<p>Calls a function for each element in the array. The callback will be called with 3 arguments (elementValue,elementIndex,traversedArray). Optionally with a thisObject argument to use as this when executing callback.</p>
</dd>
<dt class="hdlist1"><code>indexOf(searchElement,fromIndex=):Number</code>: </dt>
<dd>
<p>Returns the first index at which a given element can be found in the array, or -1 if it is not present.</p>
</dd>
<dt class="hdlist1"><code>join(separator=):String</code>: </dt>
<dd>
<p>Puts all the elements of an array into a string. The elements are separated by a specified delimiter.</p>
</dd>
<dt class="hdlist1"><code>lastIndexOf(searchElement,fromIndex=):Number</code>: </dt>
<dd>
<p>Returns the last (greatest) index of an element within the array equal to the specified value. Will return -1 if none are found.</p>
</dd>
<dt class="hdlist1"><code>length():Number</code>: </dt>
<dd>
<p>The length returns an integer representing the length of an array.</p>
</dd>
<dt class="hdlist1"><code>map(callback:Function,thisArg=):Array</code>: </dt>
<dd>
<p>Creates a new array with the results of calling a provided function on every element in this array. The callback will be called with 3 arguments (elementValue,elementIndex,traversedArray). Optionally, with a thisObject argument to use as this when executing callback.</p>
</dd>
<dt class="hdlist1"><code>pop():E</code>: </dt>
<dd>
<p>Removes and returns the last element of an array.</p>
</dd>
<dt class="hdlist1"><code>push(element&#8230;&#8203;):E</code>: </dt>
<dd>
<p>Adds one or more elements to the end of an array and returns the new length.</p>
</dd>
<dt class="hdlist1"><code>reverse():Array&lt;E&gt;</code>: </dt>
<dd>
<p>Reverses the order of the elements in an array.</p>
</dd>
<dt class="hdlist1"><code>shift()</code>: </dt>
<dd>
<p>Removes and returns the first element of an array.</p>
</dd>
<dt class="hdlist1"><code>slice(start:Number,end:Number=):Array&lt;E&gt;</code>: </dt>
<dd>
<p>Returns selected elements from an existing array.</p>
</dd>
<dt class="hdlist1"><code>some(callback:Function,thisArg=):Boolean</code>: </dt>
<dd>
<p>Tests whether some element in the array passes the test implemented by the provided function. The callback will be called with 3 arguments (elementValue,elementIndex,traversedArray). Optionally, with a thisObject argument to use as this when executing callback.</p>
</dd>
<dt class="hdlist1"><code>sort(sortByFunction:Function=):Array&lt;E&gt;</code>: </dt>
<dd>
<p>Sorts the elements of an array. The function will be called with 2 arguments (a,b).</p>
</dd>
<dt class="hdlist1"><code>splice(index:Number,how many:Number,element&#8230;&#8203;):Array&lt;E&gt;</code>: </dt>
<dd>
<p>Removes and adds new elements to an array. Returns the removed elements as an Array.</p>
</dd>
<dt class="hdlist1"><code>toLocaleString():String</code>: </dt>
<dt class="hdlist1"><code>toString():String</code>: </dt>
<dd>
<p>Returns a String value for Array.</p>
</dd>
<dt class="hdlist1"><code>unshift(element&#8230;&#8203;):E</code>: </dt>
<dd>
<p>Adds one or more elements to the beginning of an array and returns the new length.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="static-methods-5"><a class="anchor" href="#static-methods-5"></a>18.7.2. Static Methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Array(item:Object&#8230;&#8203;)</code>: </dt>
<dd>
<p>Static constructor.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_date"><a class="anchor" href="#_date"></a>18.8. Date</h3>
<div class="paragraph">
<p><code>Date</code> does not have a super class.</p>
</div>
<div class="sect3">
<h4 id="static-methods-6"><a class="anchor" href="#static-methods-6"></a>18.8.1. Static Methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Date():Date</code>: </dt>
<dd>
<p>Static constructor.</p>
</dd>
<dt class="hdlist1"><code>Date(milliseconds:Number):Date</code>: </dt>
<dd>
<p>Constructor.</p>
</dd>
<dt class="hdlist1"><code>Date(date:Date):Date</code>: </dt>
<dd>
<p>Constructor.</p>
</dd>
<dt class="hdlist1"><code>Date(dateString:String):Date</code>: </dt>
<dd>
<p>Constructor.</p>
</dd>
<dt class="hdlist1"><code>Date(year:Number,month:Number,day=Number=,hour:Number=,minute:Number=,second:Number=,millisecond:Number=):Date</code>: </dt>
<dd>
<p>Constructor.</p>
</dd>
<dt class="hdlist1"><code>parse(dateString:String):Date</code>: </dt>
<dd>
<p>Parses a string representation of a date, and returns the number of milliseconds since midnight Jan 1, 1970.</p>
</dd>
<dt class="hdlist1"><code>now():Number</code>: </dt>
<dd>
<p>Returns the numeric value corresponding to the current time.</p>
</dd>
<dt class="hdlist1"><code>UTC(year:Number,month:Number,date:Number=,hrs:Number=,min:Number=,sec:Number=,ms:Number=):Number</code>: </dt>
<dd>
<p>UTC takes comma-delimited date parameters and returns the number of milliseconds between January 1, 1970, 00:00:00, Universal Time and the time you specified.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="methods-5"><a class="anchor" href="#methods-5"></a>18.8.2. Methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>getDate():Number</code>: </dt>
<dd>
<p>Returns the day of the month from a Date object (from 1-31).</p>
</dd>
<dt class="hdlist1"><code>getDay():Number</code>: </dt>
<dd>
<p>Returns the day of the week from a Date object (from 0-6).</p>
</dd>
<dt class="hdlist1"><code>getFullYear():Number</code>: </dt>
<dd>
<p>Returns the year, as a four-digit number.</p>
</dd>
<dt class="hdlist1"><code>getHours():Number</code>: </dt>
<dd>
<p>Returns the hour of a day (from 0-23).</p>
</dd>
<dt class="hdlist1"><code>getMilliseconds():Number</code>: </dt>
<dd>
<p>Returns the milliseconds of a Date object (from 0-999).</p>
</dd>
<dt class="hdlist1"><code>getMinutes():Number</code>: </dt>
<dd>
<p>Returns the minutes of a date (from 0-59).</p>
</dd>
<dt class="hdlist1"><code>getMonth():Number</code>: </dt>
<dd>
<p>Returns the month from a date (from 0-11).</p>
</dd>
<dt class="hdlist1"><code>getSeconds():Number</code>: </dt>
<dd>
<p>Returns the seconds of a date (from 0-59).</p>
</dd>
<dt class="hdlist1"><code>getTime():Number</code>: </dt>
<dd>
<p>Returns the number of milliseconds since midnight Jan 1, 1970.</p>
</dd>
<dt class="hdlist1"><code>valueOf():Number</code>: </dt>
<dd>
<p>Returns the primitive value of a Date object as a number data type, the number of milliseconds since midnight 01 January, 1970 UTC. This method is functionally equivalent to the getTime method.</p>
</dd>
<dt class="hdlist1"><code>getTimezoneOffset():Number</code>: </dt>
<dd>
<p>Returns the difference in minutes between local time and Greenwich Mean Time (GMT).</p>
</dd>
<dt class="hdlist1"><code>getUTCDate():Number</code>: </dt>
<dd>
<p>Returns the day of the month from a date according to Universal Time (from 1-31).</p>
</dd>
<dt class="hdlist1"><code>getUTCDay():Number</code>: </dt>
<dd>
<p>Returns the day of the week from a date according to Universal Time (from 0-6).</p>
</dd>
<dt class="hdlist1"><code>getUTCFullYear():Number</code>: </dt>
<dd>
<p>Returns the four-digit year from a date according to Universal Time.</p>
</dd>
<dt class="hdlist1"><code>getUTCHours():Number</code>: </dt>
<dd>
<p>Returns the hour of a date according to Universal Time (from 0-23).</p>
</dd>
<dt class="hdlist1"><code>getUTCMilliseconds():Number</code>: </dt>
<dd>
<p>Returns the milliseconds of a date according to Universal Time (from 0-999).</p>
</dd>
<dt class="hdlist1"><code>getUTCMinutes():Number</code>: </dt>
<dd>
<p>Returns the minutes of a date according to Universal Time (from 0-59).</p>
</dd>
<dt class="hdlist1"><code>getUTCMonth():Number</code>: </dt>
<dd>
<p>Returns the month from a Date object according to Universal Time (from 0-11).</p>
</dd>
<dt class="hdlist1"><code>getUTCSeconds():Number</code>: </dt>
<dd>
<p>Returns the seconds of a date according to Universal Time (from 0-59).</p>
</dd>
<dt class="hdlist1"><code>getYear():Number deprecated</code>: </dt>
<dd>
<p>Returns the year as a two-digit or a three/four-digit number, depending on the browser. Use getFullYear() instead!</p>
</dd>
<dt class="hdlist1"><code>setDate(day):Number</code>: </dt>
<dd>
<p>Sets the day of the month from a Date object (from 1-31).</p>
</dd>
<dt class="hdlist1"><code>setFullYear(full year, month=, day=):Number</code>: </dt>
<dd>
<p>Sets the year as a four-digit number.</p>
</dd>
<dt class="hdlist1"><code>setHours(hours,minutes=,seconds=,milis=):Number</code>: </dt>
<dd>
<p>Sets the hour of a day (from 0-23).</p>
</dd>
<dt class="hdlist1"><code>setMilliseconds(mills):Number</code>: </dt>
<dd>
<p>Sets the milliseconds of a Date object (from 0-999).</p>
</dd>
<dt class="hdlist1"><code>setMinutes(minutes,=seconds,=millis):Number</code>: </dt>
<dd>
<p>Sets the minutes of a date (from 0-59).</p>
</dd>
<dt class="hdlist1"><code>setMonth" directType="Number(month,day=):Number</code>: </dt>
<dd>
<p>Sets the month from a date (from 0-11).</p>
</dd>
<dt class="hdlist1"><code>setSeconds(seconds,millis=):number</code>: </dt>
<dd>
<p>Sets the seconds of a date (from 0-59).</p>
</dd>
<dt class="hdlist1"><code>setTime(mills):Number</code>: </dt>
<dd>
<p>Sets the number of milliseconds since midnight Jan 1, 1970.</p>
</dd>
<dt class="hdlist1"><code>setUTCDate(day):Number</code>: </dt>
<dd>
<p>Sets the day of the month from a date according to Universal Time (from 0-6).</p>
</dd>
<dt class="hdlist1"><code>setUTCFullYear(fullyear,month=,day=):Number</code>: </dt>
<dd>
<p>Sets the four-digit year from a date according to Universal Time.</p>
</dd>
<dt class="hdlist1"><code>setUTCHours(hours,minutes=,seconds=,millis=):Number</code>: </dt>
<dd>
<p>Sets the hour of a date according to Universal Time (from 0-23).</p>
</dd>
<dt class="hdlist1"><code>setUTCMilliseconds(mills):Number</code>: </dt>
<dd>
<p>Sets the milliseconds of a date according to Universal Time (from 0-999).</p>
</dd>
<dt class="hdlist1"><code>setUTCMinutes(minutes,seconds=,millis=):Number</code>: </dt>
<dd>
<p>Sets the minutes of a date according to Universal Time time (from 0-59).</p>
</dd>
<dt class="hdlist1"><code>setUTCMonth(month,day=):Number</code>: </dt>
<dd>
<p>Sets the month from a Date object according to Universal Time (from 0-11).</p>
</dd>
<dt class="hdlist1"><code>setUTCSeconds(seconds,millis=):Number</code>: </dt>
<dd>
<p>Sets the seconds of a date according to Universal Time (from 0-59).</p>
</dd>
<dt class="hdlist1"><code>setYear(year):Number deprecated</code>: </dt>
<dd>
<p>Sets the year, as a two-digit or a three/four-digit number, depending on the browser. Use setFullYear() instead!!</p>
</dd>
<dt class="hdlist1"><code>toDateString():String</code>: </dt>
<dd>
<p>Returns the date portion of a Date object in readable form.</p>
</dd>
<dt class="hdlist1"><code>toLocaleDateString():String</code>: </dt>
<dd>
<p>Converts a Date object, according to local time, to a string and returns the date portion.</p>
</dd>
<dt class="hdlist1"><code>toLocaleString():String</code>: </dt>
<dd>
<p>Converts a Date object, according to local time, to a string.</p>
</dd>
<dt class="hdlist1"><code>toLocaleTimeString():String</code>: </dt>
<dd>
<p>Converts a Date object, according to local time, to a string and returns the time portion.</p>
</dd>
<dt class="hdlist1"><code>toString():String</code>: </dt>
<dd>
<p>Returns a String value for this object.</p>
</dd>
<dt class="hdlist1"><code>toTimeString():String</code>: </dt>
<dd>
<p>Returns the time portion of a Date object in readable form.</p>
</dd>
<dt class="hdlist1"><code>toUTCString():String</code>: </dt>
<dd>
<p>Converts a Date object, according to Universal Time, to a string.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_math"><a class="anchor" href="#_math"></a>18.9. Math</h3>
<div class="paragraph">
<p><code>Math</code> is not instantiable and only provides static properties and methods.</p>
</div>
<div class="sect3">
<h4 id="static-attributes-1"><a class="anchor" href="#static-attributes-1"></a>18.9.1. Static Attributes</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>E:Number</code>: </dt>
<dd>
<p>Euler&#8217;s constant and the base of natural logarithms, approximately 2.718.</p>
</dd>
<dt class="hdlist1"><code>LN2:Number</code>: </dt>
<dd>
<p>Natural logarithm of 2, approximately 0.693.</p>
</dd>
<dt class="hdlist1"><code>LN10:Number</code>: </dt>
<dd>
<p>Natural logarithm of 10, approximately 2.302.</p>
</dd>
<dt class="hdlist1"><code>LOG2E:Number</code>: </dt>
<dd>
<p>Base 2 logarithm of E, approximately 1.442.</p>
</dd>
<dt class="hdlist1"><code>LOG10E:Number</code>: </dt>
<dd>
<p>Base 10 logarithm of E, approximately 0.434.</p>
</dd>
<dt class="hdlist1"><code>PI:Number</code>: </dt>
<dd>
<p>Ratio of the circumference of a circle to its diameter, approximately 3.14159.</p>
</dd>
<dt class="hdlist1"><code>SQRT1\_2:Number</code>: </dt>
<dd>
<p>Square root of 1/2; equivalently, 1 over the square root of 2, approximately 0.707.</p>
</dd>
<dt class="hdlist1"><code>SQRT2:Number</code>: </dt>
<dd>
<p>Square root of 2, approximately 1.414.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="static-methods-7"><a class="anchor" href="#static-methods-7"></a>18.9.2. Static Methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>abs(x):Number</code>: </dt>
<dd>
<p>Returns the absolute value of a number.</p>
</dd>
<dt class="hdlist1"><code>acos(x:Number):Number</code>: </dt>
<dd>
<p>Returns the arccosine of a number.</p>
</dd>
<dt class="hdlist1"><code>asinx:Number):Number</code>: </dt>
<dd>
<p>Returns the arcsine of a number.</p>
</dd>
<dt class="hdlist1"><code>atan(x:Number):Number</code>: </dt>
<dd>
<p>Returns the arctangent of a number.</p>
</dd>
<dt class="hdlist1"><code>atan2(y:Number,x:Number):Number</code>: </dt>
<dd>
<p>Returns the arctangent of the quotient of its arguments.</p>
</dd>
<dt class="hdlist1"><code>ceil(x):Number</code>: </dt>
<dd>
<p>Returns the smallest integer greater than or equal to a number.</p>
</dd>
<dt class="hdlist1"><code>cos(x):Number</code>: </dt>
<dd>
<p>Returns the arctangent of the quotient of its arguments.</p>
</dd>
<dt class="hdlist1"><code>exp(x):Number</code>: </dt>
<dd>
<p>Returns Enumber, where number is the argument, and E is Euler&#8217;s constant (2.718&#8230;&#8203;), the base of the natural logarithm.</p>
</dd>
<dt class="hdlist1"><code>floor(x):Number</code>: </dt>
<dd>
<p>Returns the largest integer less than or equal to a number.</p>
</dd>
<dt class="hdlist1"><code>log(x):Number</code>: </dt>
<dd>
<p>Returns the natural logarithm (loge, also ln) of a number.</p>
</dd>
<dt class="hdlist1"><code>max(value&#8230;&#8203;):Number</code>: </dt>
<dd>
<p>Returns the largest of zero or more numbers.</p>
</dd>
<dt class="hdlist1"><code>min(value&#8230;&#8203;):Number</code>: </dt>
<dd>
<p>Returns the smallest of zero or more numbers.</p>
</dd>
<dt class="hdlist1"><code>pow(base:Number,exponent:Number):Number</code>: </dt>
<dd>
<p>Returns base to the exponent power, that is, baseexponent.</p>
</dd>
<dt class="hdlist1"><code>random():Number</code>: </dt>
<dd>
<p>Returns a pseudorandom number between 0 and 1.</p>
</dd>
<dt class="hdlist1"><code>round(x:Number):Number</code>: </dt>
<dd>
<p>Returns the value of a number rounded to the nearest integer.</p>
</dd>
<dt class="hdlist1"><code>sin(x:Number):Number</code>: </dt>
<dd>
<p>Returns the sine of a number.</p>
</dd>
<dt class="hdlist1"><code>sqrt(x:Number):Number</code>: </dt>
<dd>
<p>Returns the positive square root of a number.</p>
</dd>
<dt class="hdlist1"><code>tan(x:Number):Number</code>: </dt>
<dd>
<p>Returns the tangent of a number.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_regexp"><a class="anchor" href="#_regexp"></a>18.10. RegExp</h3>
<div class="paragraph">
<p><code>RegExp</code> does not have a super class.</p>
</div>
<div class="sect3">
<h4 id="attributes-4"><a class="anchor" href="#attributes-4"></a>18.10.1. Attributes</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>global:Boolean</code>: </dt>
<dd>
<p>Whether to test the regular expression against all possible matches in a string, or only against the first.</p>
</dd>
<dt class="hdlist1"><code>ignoreCase:Boolean</code>: </dt>
<dd>
<p>Whether to ignore case while attempting a match in a string.</p>
</dd>
<dt class="hdlist1"><code>lastIndex:Number</code>: </dt>
<dd>
<p>The index at which to start the next match.</p>
</dd>
<dt class="hdlist1"><code>multiline:Boolean</code>: </dt>
<dd>
<p>Whether or not to search in strings across multiple lines.</p>
</dd>
<dt class="hdlist1"><code>source:String</code>: </dt>
<dd>
<p>The text of the pattern.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="methods-6"><a class="anchor" href="#methods-6"></a>18.10.2. Methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>exec(str:String):Array</code>: </dt>
<dd>
<p>Executes a search for a match in its string parameter.</p>
</dd>
<dt class="hdlist1"><code>test(str:String):Boolean</code>: </dt>
<dd>
<p>Tests for a match in its string parameter.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_json"><a class="anchor" href="#_json"></a>18.11. JSON</h3>
<div class="paragraph">
<p><code>JSON</code> is a global object and a subclass of <code>Object</code>. Its functionality is provided by two static methods.
It is not possible to create new instances of type JSON.</p>
</div>
<div class="sect3">
<h4 id="attributes-5"><a class="anchor" href="#attributes-5"></a>18.11.1. Attributes</h4>
<div class="paragraph">
<p>The JSON object does not define own properties.</p>
</div>
</div>
<div class="sect3">
<h4 id="methods-7"><a class="anchor" href="#methods-7"></a>18.11.2. Methods</h4>
<div class="paragraph">
<p>The JSON object does not define own methods.</p>
</div>
</div>
<div class="sect3">
<h4 id="static-methods-8"><a class="anchor" href="#static-methods-8"></a>18.11.3. Static Methods</h4>
<div class="paragraph">
<p>The parse function parses a JSON text (a JSON-formatted String) and
produces an ECMAScript value. The JSON format is a restricted form of
ECMAScript literal. JSON objects are realized as ECMAScript objects.
JSON arrays are realized as ECMAScript arrays. JSON strings, numbers,
booleans, and null are realized as ECMAScript Strings, Numbers,
Booleans, and null. For detailed information see [<a href="#ECMA11a">ECMA11a(p.S15.12.2)</a>]</p>
</div>
<div class="paragraph">
<p>The optional reviver parameter is a function that takes two parameters
(key and value). It can filter and transform the results. It is called
with each of the key/value pairs produced by the parse and its return
value is used instead of the original value. If it returns what it
received, the structure is not modified. If it returns then the property
is deleted from the result.</p>
</div>
<div class="paragraph">
<p>The stringify function returns a String in JSON format representing an
ECMAScript value. It can take three parameters. The first parameter is
required. The value parameter is an ECMAScript value which is usually an
object or array, although it can also be a String, Boolean, Number or
null.</p>
</div>
<div class="paragraph">
<p>The optional replacer parameter is either a function that alters the way
objects and arrays are stringified or an array of Strings and Numbers
that act as a white list for selecting the object properties that will
be stringified.</p>
</div>
<div class="paragraph">
<p>The optional space parameter is a String or Number that allows the
result to have whitespace injected into it to improve human readability.</p>
</div>
<div class="paragraph">
<p>For detailed information see [<a href="#ECMA11a">ECMA11a(p.S15.12.3)</a>].</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_n4js_objects"><a class="anchor" href="#_n4js_objects"></a>19. N4JS Objects</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_reflection_model"><a class="anchor" href="#_reflection_model"></a>19.1. Reflection Model</h3>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1236" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1236</a>
<a href="https://github.com/NumberFour/N4JS/issues/344" title="IDE Bugs"><span class="image"><img src="resources/images/github.png" alt=""></span>GH-344</a>
</div>
</div>
<div class="paragraph">
<p>N4JS provided metadata for reflection (and introspection). This
information is available via instances of some reflection model classes
(described below) attached to types and (in some cases) functions.</p>
</div>
<div class="paragraph">
<p>The following class diagrams shows the defined classes. Note that for
performance reasons, the actual structure may vary from the model.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="fig/cd_reflectionModel.svg" alt="cd reflectionModel">
</div>
<div class="title">Figure 10. N4JS Reflection Classes</div>
</div>
<div class="paragraph">
<p>Remark: This section is work in progress. The final goal is to provide a
metamodel similar to Ecore, but we will only add new features if needed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">/**
 * Base class for all N4 reflective elements.
 */
export public abstract class N4Element extends Object {
    /**
     * Annotations attached to this element.
     */
    public Array&lt;N4Annotation&gt; annotations = [];

    /**
     * The origin string formed as &lt;ID-VERSION&gt;, where ID is containing project artefact id, and VERSION is its version
     */
    public String origin;

    /**
     * Returns true if an annotation with the given name is attached to the element.
     */
    public boolean hasAnnotation(string name) {
        return !!this.anyAnnotation(name)
    }

    /**
     * Returns any annotation with the given name attached to the element, or null if no such annotation is found.
     */
    public N4Annotation anyAnnotation(string name) {
        for (var i=this.annotations.length-1; i&gt;=0; i--) {
            var a = this.annotations[i];
            if (a) {
                return a;
            }
        }
        return null;
    }
    /**
     * Returns all annotations with the given name attached to the element, or an empty array if no such annotations are found.
     */
    public Array&lt;N4Annotation&gt; allAnnotations(string name) {
        return this.annotations.filter(function(a){return a.name==name});
    }
}

/**
 * Base class for all reflective classes with a name.
 */
export public abstract class N4NamedElement extends N4Element {
    /**
     * The simple name of a named element.
     */
    public string name;
}

/**
 * Base class for all reflective classes describing a type (declaration).
 */
export public abstract class N4Type extends N4NamedElement {
    /**
     * The FQN of the type.
     */
    public string fqn;

    /**
     * Returns true if this N4Class describes an N4-class declaration.
     */
    public boolean get isClass() { return false; }

    /**
     * Returns true if this N4Class describes an N4-interface declaration.
     */
    public boolean get isInterface() { return false; }

    /**
     * Returns true if this N4Class describes an N4-enumeration declaration.
     */
    public boolean get isEnum() { return false; }
}

/**
 * Base class for meta types of classes or interfaces.
 */
export public abstract class N4Classifier extends N4Type {

    /**
     * The N4Class of the super type, may be null if super type is a not an N4Class.
     */
    public N4Class n4superType;

    /**
     * Array of the FQN of all (transitively) implemented interfaces, i.e. interfaces directly implemented by this class, its super
     * class or interfaces extended by directly implemented interfaces.
     */
    public Array&lt;string&gt; allImplementedInterfaces;

    /**
     * Array of all owned members, that is members defined in the class directly.
     * This field is private as it is an internal detail, members are accessed via methods defined in this class.
     */
    private Array&lt;N4Member&gt; ownedMembers;

    /**
     * Array of all consumed members, that is members mixed into the classifier via interface implementation and default methods.
     * This field is private as it is an internal detail, members are accessed via methods defined in this class.
     */
    private Array&lt;N4Member&gt; consumedMembers;

    /**
     * Only used internally, must not be called by client.
     */
    protected constructor(@Spec ~~this spec) {}

    /**
     * Returns all members defined by this class directly, consumed, and inherited. The boolean flags control which members are returned.
     *
     * @param consumed if set, consumed members are returned as well (false by default)
     * @param inherited if set, inherited members are returned as well (false by default)
     * @param _static if set, static members are returned, otherwise instance members (false by default).
     * @return array of members, may be empty but never null
     */
    public Array&lt;? extends N4Member&gt; members(boolean? consumed, boolean? inherited, boolean? _static) {
        return null; // TODO
    }

    /**
     * Returns all members defined in this classifier (or inherited) with an annotation
     * of given name attached to it. The boolean flags control which methods are returned.
     *
     * @param name name of annotation to be used as filter
     * @param consumed if set, consumed members are returned as well (false by default)
     * @param inherited if set, inherited members are returned as well (false by default)
     * @param _static if set, static members are returned, otherwise instance members (false by default).
     * @return array of members, may be empty but never null
     */
    public Array&lt;? extends N4Member&gt; membersWithAnnotation(string name, boolean? consumed, boolean? inherited, boolean? _static) {
        return null; // TODO
    }

    /**
     * Returns all data fields defined by this class directly, consumed, and inherited. The boolean flags control which data fields are returned.
     *
     * @param consumed if set, consumed data fields are returned as well (false by default)
     * @param inherited if set, inherited data fields are returned as well (false by default)
     * @param _static if set, static data fields are returned, otherwise instance members (false by default).
     * @return array of data fields, may be empty but never null
     */
    public Array&lt;? extends N4DataField&gt; dataFields(boolean? consumed, boolean? inherited, boolean? _static) {
        return null; // TODO
    }

    /**
     * Returns all data fields defined in this classifier (or inherited) with an annotation
     * of given name attached to it. The boolean flags control which data fields are returned.
     *
     * @param name name of annotation to be used as filter
     * @param consumed if set, consumed data fields are returned as well (false by default)
     * @param inherited if set, inherited data fields are returned as well (false by default)
     * @param _static if set, static data fields are returned, otherwise instance members (false by default).
     * @return array of data fields, may be empty but never null
     */
    public Array&lt;? extends N4DataField&gt; dataFieldsWithAnnotation(string name, boolean? consumed, boolean? inherited, boolean? _static) {
        return null; // TODO
    }

    /**
     * Returns all methods defined by this class directly, consumed, and inherited. The boolean flags control which methods are returned.
     *
     * @param consumed if set, consumed methods are returned as well (false by default)
     * @param inherited if set, inherited methods are returned as well (false by default)
     * @param _static if set, static methods are returned, otherwise instance members (false by default).
     * @return array of methods, may be empty but never null
     */
    public Array&lt;? extends N4Method&gt; methods(boolean? consumed, boolean? inherited, boolean? _static) {
        return null; // TODO
    }

    /**
     * Returns all methods defined in this classifier (or inherited) with an annotation
     * of given name attached to it. The boolean flags control which methods are returned.
     *
     * @param name name of annotation to be used as filter
     * @param consumed if set, consumed methods are returned as well (false by default)
     * @param inherited if set, inherited methods are returned as well (false by default)
     * @param _static if set, static methods are returned, otherwise instance members (false by default).
     * @return array of methods, may be empty but never null
     */
    public Array&lt;? extends N4Method&gt; methodsWithAnnotation(string name, boolean? consumed, boolean? inherited, boolean? _static) {
        return null; // TODO
    }


}

/**
 * Meta information of an n4 class.
 */
export @Final public class N4Class extends N4Classifier {

    /**
     * Returns the N4Class instance for a given n4object. This is similar to
     * {@code n4object.constructor.n4type}, however it can also be used in interfaces
     * to get reflective information of the implementor.
     */
    public static N4Class of(N4Object n4object) {
        return n4object.constructor.n4type
    }

    /**
     * Returns true if this N4Class describes an N4-class declaration.
     */
    @Override
    public boolean get isClass() { return true; }
}


/**
 * Meta information of an n4 interface.
 */
export @Final public class N4Interface extends N4Classifier {
    /**
     * Returns true if this N4Class describes an N4-interface declaration.
     */
    @Override
    public boolean get isInterface() { return true; }
}

/**
 * Description of a member, that is a method or field.
 */
export public abstract class N4Member extends N4Element {
    public string name;
}

/**
 * Description of a method.
 */
export @Final public class N4Method extends N4Member {
    public Function jsFunction;
}

/**
 * Description of a field, that is either a data field or an accessor.
 */
export public abstract class N4Field extends N4Member {
}

/**
 * Description of a simple data field.
 */
export @Final public class N4DataField extends N4Member {
}

/**
 * Description of an accessor, that is a getter or setter.
 */
export @Final public class N4Accessor extends N4Member {
    /**
     * Flag indicating whether accessor is a getter or setter, internal detail.
     */
    private boolean getter;
    /**
     * Returns true if accessor is a getter.
     */
    public boolean isGetter() { return this.getter; }
    /**
     * Returns true if accessor is a setter.
     */
    public boolean isSetter() { return ! this.getter; }
}

/**
 * Description of an N4Enum
 */
export @Final public class N4EnumType extends N4Type {
    /**
     * Returns true if this N4Clasifier describes an N4-enumeration declaration.
     */
    @Override public boolean get isEnum() { return true; }
    /**
     * Returns the N4EnumType instance for a given enum literal. This is similar to
     * {@code n4enum.constructor.n4type}.
     */
    public static N4EnumType of(N4Enum n4enum) {
        return n4enum.constructor.n4type
    }
}

/**
 * Base class for all enumeration, literals are assumed to be static constant fields of concrete subclasses.
 */
export public abstract class N4Enum  extends Object {

    /**
     * Returns the name of a concrete literal
     */
    public abstract string get name();

    /**
     * Returns the value of a concrete literal. If no value is
     * explicitly set, it is similar to the name.
     */
    public abstract string get value()

    /**
     * Returns a string representation of a concrete literal, it returns
     * the same result as value()
     */
    @Override public string toString() { return this.value }

    /**
     * Returns the enum class object of this enum literal for reflection.
     * The very same meta class object can be retrieved from the enumeration type directly.
     */
    public abstract N4Enum get n4Enum()

    /**
     * Natively overridden by concrete enums.
     */
    public static Array&lt;? extends N4Enum&gt; get values() { return null; }

    /**
     * Natively overridden by concrete enums.
     */
    public static N4Enum valueByName(string name) { return null; }

    /**
     * Returns the meta class object of this class for reflection.
     * The very same meta class object can be retrieved from an instance by calling
     * &lt;code&gt;instance.constructor.n4type&lt;/code&gt;
     */
    public static N4EnumType get n4type() { return null; }
}

/**
 * Annotation with value.
 */
export @Final public class N4Annotation extends Object {
    public string name;
    public union{string,number} value;
}

/**
 * The base class for all instances of n4 classes.
 */
export public class N4Object {
    /**
     * Returns the meta class object of this class for reflection.
     * The very same meta class object can be retrieved from an instance by calling
     * &lt;code&gt;instance.constructor.n4type&lt;/code&gt;
     */
    // defined in types model, added by $makeClass:
    // public static N4Class get n4type() { return null; }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_error_types"><a class="anchor" href="#_error_types"></a>19.2. Error Types</h3>
<div class="paragraph">
<p>N4JS provides additional Error types as subtypes of <code>Error</code>.</p>
</div>
<div class="sect3">
<h4 id="_n4apinotimplemented"><a class="anchor" href="#_n4apinotimplemented"></a>19.2.1. N4ApiNotImplemented</h4>
<div class="paragraph">
<p></p>
</div>
<div class="sidebarblock">
<div class="content">
<a href="https://jira.numberfour.eu/browse/IDE-1510" title="IDE Backlog"><span class="image"><img src="resources/images/jira.png" alt=""></span>IDE-1510</a>
</div>
</div>
<div class="paragraph">
<p>Considering API definitions and concrete implementations of those APIs
the error <code>N4-Api\-Not\-Im\-ple\-men\-ted\-Error</code> is introduced to specifically report missing implementations.
Instances of this error type are inserted internally during the
transpilation of API-implementing projects. Whenever a difference to the
API in form of a missing implementation is encountered, the transpiler
will insert stub-code throwing an instance of <code>N4-Api\-Not\-Im\-ple\-men\-ted\-Error</code>.</p>
</div>
<div class="paragraph">
<p>API-testing projects can catch those errors and act accordingly. This
enables tracking of completeness of implementations by counting the
occasions an <code>N4-Api\-Not\-Im\-ple\-men\-ted\-Error</code> was encountered.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n4js" data-lang="n4js">/**
 * Error type reporting a not implemented situation.
 */
public class N4ApiNotImplementedError extends Error {  }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bibliography"><a class="anchor" href="#_bibliography"></a>20. Bibliography</h2>
<div class="sectionbody">

</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. A brief introduction can be found at <a href="http://www.cs.cornell.edu/~ross/publications/mixedsite/tutorial.html" class="bare">http://www.cs.cornell.edu/~ross/publications/mixedsite/tutorial.html</a>. In general, we refer the reader to cite:[Pierce02a
</div>
<div class="footnote" id="_footnote_2">
<a href="#_footnoteref_2">2</a>. One can interpret this similar to delegate methods, that is, instead of writing <code>r.binding().getType()</code>, a method <code>r.getType()\{return binding().getType();</code> is defined.
</div>
<div class="footnote" id="_footnote_3">
<a href="#_footnoteref_3">3</a>. <a href="http://javascript.crockford.com/code.html" class="bare">http://javascript.crockford.com/code.html</a>
</div>
<div class="footnote" id="_footnote_4">
<a href="#_footnoteref_4">4</a>. See for definitions of metatype properties.
</div>
<div class="footnote" id="_footnote_5">
<a href="#_footnoteref_5">5</a>. That is, for application developers not providing a library or a public API available to other vendors, member access modifiers behave almost similar to modifiers known from Java.
</div>
<div class="footnote" id="_footnote_6">
<a href="#_footnoteref_6">6</a>. See <a href="#N4_Specific_Classifiers">[N4_Specific_Classifiers]</a> for definitions of metatype properties. Note that <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi><mo>.</mo><mi>r</mi><mi>e</mi><mi>c</mi><mi>e</mi><mi>i</mi><mi>v</mi><mi>e</mi><mi>r</mi></math> always refers to a type declaration in the context of an expression as the receiver type of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi></math>. The declaring type of the member declaration is considered to be the receiver type of the member reference rather than the type that originally declares the member declaration.
</div>
<div class="footnote" id="_footnote_7">
<a href="#_footnoteref_7">7</a>. Note, the Java-like access restriction for members of visibility <code>protected</code> or <code>protected@Internal</code> to code that is responsible for the implementation of that object. [<a href="#Gosling14a">Gosling14a(p.S6.6.2, p.p.166)</a>
</div>
<div class="footnote" id="_footnote_8">
<a href="#_footnoteref_8">8</a>. <code>string, boolean, number, any, null</code>
</div>
<div class="footnote" id="_footnote_9">
<a href="#_footnoteref_9">9</a>. This conflicts with the implicit parameter arguments introduced by the transpiler when wrapping the script/module into a definition function.
</div>
<div class="footnote" id="_footnote_10">
<a href="#_footnoteref_10">10</a>. In the N4JS IDE, type annotations are highlighted differently than ordinary code.
</div>
<div class="footnote" id="_footnote_11">
<a href="#_footnoteref_11">11</a>. Although raw type usage is prohibited, the N4JS validator interprets raw types according to the first case, which may lead to consequential errors.
</div>
<div class="footnote" id="_footnote_12">
<a href="#_footnoteref_12">12</a>. The general concept for checking type conformance and inferring types for generic and parameterized types is described in [<a href="#Igarashi01a">Igarashi01a</a>
</div>
<div class="footnote" id="_footnote_13">
<a href="#_footnoteref_13">13</a>. in the Java 8 spec and compiler, they are called type variables, which are types as well
</div>
<div class="footnote" id="_footnote_14">
<a href="#_footnoteref_14">14</a>. The rationale for having this limited implementation of type is that API designers already want to start providing hints where later only 32-bit integers will be used. For the time being, <strong>this is checked neither statically nor at runtime</strong>!
</div>
<div class="footnote" id="_footnote_15">
<a href="#_footnoteref_15">15</a>. This is a consequence of the syntax definition.
</div>
<div class="footnote" id="_footnote_16">
<a href="#_footnoteref_16">16</a>. For type theory about union types, [<a href="#Pierce02">Pierce02(p.a15.7)</a>
</div>
<div class="footnote" id="_footnote_17">
<a href="#_footnoteref_17">17</a>. This rule is a generalization of the sub typing rules given in [<a href="#Igarashi07a">Igarashi07a(p.p.40)</a>
</div>
<div class="footnote" id="_footnote_18">
<a href="#_footnoteref_18">18</a>. This is different from Ceylon ( [<a href="#King13a">King13a(p.3.2.3)</a>
</div>
<div class="footnote" id="_footnote_19">
<a href="#_footnoteref_19">19</a>. See Example <a href="#Type Examples">Class Hierarchy</a> for class definitions.
</div>
<div class="footnote" id="_footnote_20">
<a href="#_footnoteref_20">20</a>. For type theory about intersection types, see and , other languages supporting explicit notion of intersection type include Ceylon [<a href="#Pierce02a">Pierce02a(p.15.7)</a>
</div>
<div class="footnote" id="_footnote_21">
<a href="#_footnoteref_21">21</a>. This rule is a generalization of the subtyping rules given in [<a href="#Laurent12a">Laurent12a</a>
</div>
<div class="footnote" id="_footnote_22">
<a href="#_footnoteref_22">22</a>. In Ceylon, for a given union type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi><mo>=</mo><msub><mi>T</mi><mn>1</mn></msub><mo>|</mo><msub><mi>T</mi><mn>2</mn></msub></math> and intersection type <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi><mo>=</mo><msub><mi>T</mi><mn>1</mn></msub><mi>&amp;</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>;</mi><msub><mi>T</mi><mn>2</mn></msub></math> (with ’|’ is union and ’&amp;’ is intersection), <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>T</mi><mn>1</mn></msub><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>U</mi></math> and <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>T</mi><mn>2</mn></msub><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>U</mi></math> is true, and <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>T</mi><mn>1</mn></msub><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>I</mi></math> and <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>T</mi><mn>2</mn></msub><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mi>I</mi></math> is true. We should define that as well (if it is not already defined). Cf [<a href="#King13a">King13a(p.3.2.4/5)</a>
</div>
<div class="footnote" id="_footnote_23">
<a href="#_footnoteref_23">23</a>. See Example <a href="#Type Examples">Class Hierarchy</a> for class definitions.
</div>
<div class="footnote" id="_footnote_24">
<a href="#_footnoteref_24">24</a>. see "Covariance and contravariance with unions and intersections" at <a href="http://ceylon-lang.org/documentation/1.1/tour/generics/" class="bare">http://ceylon-lang.org/documentation/1.1/tour/generics/</a>
</div>
<div class="footnote" id="_footnote_25">
<a href="#_footnoteref_25">25</a>. The classifier type is, in fact, the <code>type type</code> or <code>metatype</code> of a type. We use the term classifier type in the specification to avoid the bogus <code>type type</code> terminology.
</div>
<div class="footnote" id="_footnote_26">
<a href="#_footnoteref_26">26</a>. The phenomenon is described in IDEBUG-263
</div>
<div class="footnote" id="_footnote_27">
<a href="#_footnoteref_27">27</a>. This is pseudo N4JS code as it is not possible to infer from <code>any</code> or define abstract static methods.
</div>
<div class="footnote" id="_footnote_28">
<a href="#_footnoteref_28">28</a>. E.g., for given <code>class A{ foo(A):A{}} class B{ foo(B):B{}}</code>, a class C could be defined as <code>class C{ foo(union{A,B}):intersection{A,B}{}}</code>. In this case it would then be a syntactical problem (and even worse - a conceptual problem) of how to call the super methods defined in A and Bfrom C.
</div>
<div class="footnote" id="_footnote_29">
<a href="#_footnoteref_29">29</a>. <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>o</mi><mi>r</mi><mi>P</mi><mi>a</mi><mi>i</mi><mi>r</mi><mfenced close=")" open="("><msub><mi>m</mi><mn>1</mn></msub><msub><mi>m</mi><mn>2</mn></msub></mfenced></math> is defined as follows: <math xmlns="http://www.w3.org/1998/Math/MathML"><mfenced close=")" open="("><mrow><mi>μ</mi><mfenced close=")" open="("><msub><mi>m</mi><mn>1</mn></msub></mfenced><mo>=</mo><mrow><mi>g</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow><mo>∧</mo><mi>μ</mi><mfenced close=")" open="("><msub><mi>m</mi><mn>2</mn></msub></mfenced><mo>=</mo><mrow><mi>s</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow></mrow></mfenced><mo>∨</mo><mfenced close=")" open="("><mrow><mi>μ</mi><mfenced close=")" open="("><msub><mi>m</mi><mn>1</mn></msub></mfenced><mo>=</mo><mrow><mi>s</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow><mo>∧</mo><mi>μ</mi><mfenced close=")" open="("><msub><mi>m</mi><mn>2</mn></msub></mfenced><mo>=</mo><mrow><mi>g</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow></mrow></mfenced></math>
</div>
<div class="footnote" id="_footnote_30">
<a href="#_footnoteref_30">30</a>. In order to emulate method overloading, union types are to be used.
</div>
<div class="footnote" id="_footnote_31">
<a href="#_footnoteref_31">31</a>. cite[ECMA15a(p214)
</div>
<div class="footnote" id="_footnote_32">
<a href="#_footnoteref_32">32</a>. This is required, because in Javascript a getter shadows a corresponding setter defined further up in the prototype chain; likewise a setter shadows a corresponding getter.
</div>
<div class="footnote" id="_footnote_33">
<a href="#_footnoteref_33">33</a>. Thus, the type of one accessor is not used to infer the type of the other one. E.g., from <code>set x(string s)</code>, we cannot infer <code>get x()</code> to return <code>string</code> — instead, the getter is inferred to return <code>any</code>.
</div>
<div class="footnote" id="_footnote_34">
<a href="#_footnoteref_34">34</a>. The technical reason for this rule is the way properties are stored in JavaScript. Take for an example subclass-write access : <code>class C { static f="a";}</code> with <code>class D extends C { }</code>. Now the data field <code>f</code> on <code>C</code> can also be queried using <code>D</code> (<code>var q=D.f;</code>) but writing (<code>D.f="b";</code>) would introduce a newly created property <code>f</code> on class <code>D</code>, which differs from the one defined on <code>C</code>. It would do this without explicitly overriding the inherited property. Subsequent reads to <code>D.f</code> would route to this ’accidentally’ introduced property. Such a behavior would not be expected and therefore has been disallowed. Note that this write restriction applies to data-fields and to field setters.
</div>
<div class="footnote" id="_footnote_35">
<a href="#_footnoteref_35">35</a>. <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math> could either be a class or an interface.
</div>
<div class="footnote" id="_footnote_36">
<a href="#_footnoteref_36">36</a>. As defined in <a href="#Function_Type">[Function_Type]</a> for function types.
</div>
<div class="footnote" id="_footnote_37">
<a href="#_footnoteref_37">37</a>. This kind of typing is used by TypeScript only. By defining a structural typed classifier or reference, it basically behaves as it would behave – without that modifier – in TypeScript.
</div>
<div class="footnote" id="_footnote_38">
<a href="#_footnoteref_38">38</a>. We enforce programmers of N4JS to use nominal typing, therefore, it is not possible to bypass that principle by declaring a type as structural for normally defined classes (except those explicitly derived from <code>N4Object</code>).
</div>
<div class="footnote" id="_footnote_39">
<a href="#_footnoteref_39">39</a>. Note that due to this relaxed definition (compared with definition-site structural types) it is possible to pass an <code>N4Object</code> instance to a function of method with a declared structural type parameter.
</div>
<div class="footnote" id="_footnote_40">
<a href="#_footnoteref_40">40</a>. This is already constrained by the grammar.
</div>
<div class="footnote" id="_footnote_41">
<a href="#_footnoteref_41">41</a>. see <a href="http://tc39.github.io/ecmascript-asyncawait/" class="bare">http://tc39.github.io/ecmascript-asyncawait/</a>
</div>
<div class="footnote" id="_footnote_42">
<a href="#_footnoteref_42">42</a>. Even in this case, the function will actually be called with the callback method which is then created by the transpiler. However, the callback is not given in the N4JS code).
</div>
<div class="footnote" id="_footnote_43">
<a href="#_footnoteref_43">43</a>. <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math> iterates over all boundaries
</div>
<div class="footnote" id="_footnote_44">
<a href="#_footnoteref_44">44</a>. <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math> iterates over all type args
</div>
<div class="footnote" id="_footnote_45">
<a href="#_footnoteref_45">45</a>. Only <code>Function</code> implements the ECMAScript specification property <math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mo>[</mo><mrow><mo>[</mo><mi>h</mi><mi>a</mi><mi>s</mi><mi>I</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi></mrow></mrow></math>
</div>
<div class="footnote" id="_footnote_46">
<a href="#_footnoteref_46">46</a>. Includes interfaces, since an interface type reference is a subtype of object type reference: <math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mrow><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>f</mi><mi>a</mi><mi>c</mi><mi>e</mi></mrow></mrow><mi>l</mi><mi>t</mi><mi>;</mi><mi>:</mi><mrow><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mrow><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow></mrow></math>
</div>
<div class="footnote" id="_footnote_47">
<a href="#_footnoteref_47">47</a>. See [<a href="#ECMA15a">ECMA15a</a>
</div>
<div class="footnote" id="_footnote_48">
<a href="#_footnoteref_48">48</a>. <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><msup><mo>∈</mo><mo>*</mo></msup><mi>c</mi></math> is the transitive version of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi><mo>∈</mo><mi>c</mi></math>, that is, it <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi></math> directly or indirectly contained in <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi></math>.
</div>
<div class="footnote" id="_footnote_49">
<a href="#_footnoteref_49">49</a>. available at: <a href="http://www.2ality.com/2013/06/iterators-generators.html" class="bare">http://www.2ality.com/2013/06/iterators-generators.html</a>
</div>
<div class="footnote" id="_footnote_50">
<a href="#_footnoteref_50">50</a>. For more details on module specifiers, see <a href="#Qualified_Names">[Qualified_Names]</a>.
</div>
<div class="footnote" id="_footnote_51">
<a href="#_footnoteref_51">51</a>. Hopefully IDEBUG-166  is fixed at time of publication.
</div>
<div class="footnote" id="_footnote_52">
<a href="#_footnoteref_52">52</a>. Further reading on <a href="#AC">DI</a>: : Basics [<a href="#Fowler04b">Fowler04b</a>; <a href="#Prasanna09a">Prasanna09a</a>
</div>
<div class="footnote" id="_footnote_53">
<a href="#_footnoteref_53">53</a>. Usually, only the itself is created like that, e.g., <code>ar dic = N4Injector.of(DIC).create(DIC);}</code>
</div>
<div class="footnote" id="_footnote_54">
<a href="#_footnoteref_54">54</a>. Note that other frameworks may define other constraints, e.g., arbitrary keys.
</div>
<div class="footnote" id="_footnote_55">
<a href="#_footnoteref_55">55</a>. Also cf. blog posting about <a href="http://www.markhneedham.com/blog/2009/03/10/oo-micro-types/">micro types</a>, <a href="http://darrenhobbs.com/2007/04/11/tiny-types/">tiny types</a>
</div>
<div class="footnote" id="_footnote_56">
<a href="#_footnoteref_56">56</a>. This restriction has two reasons: Firstly, user-defined types with implementations would require to ’bootstrap’ the polyfill, which is impossible to do automatically without serious constraints on bootstrap code in general. Secondly, instead of filling user-defined types, they can be subclasses. Mechanisms such as dependency injection could then solve almost all remaining problems.
</div>
<div class="footnote" id="_footnote_57">
<a href="#_footnoteref_57">57</a>. Note that this diagram does not necessarily reflect the actual internal implementation but only the external view.
</div>
<div class="footnote" id="_footnote_58">
<a href="#_footnoteref_58">58</a>. <a href="#API_and_Implementation_Components">[API_and_Implementation_Components]</a>
</div>
<div class="footnote" id="_footnote_59">
<a href="#_footnoteref_59">59</a>. Global basically means that the module defines no namespace on its own. Thus the annotation is a script/module related annotation.
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2016-11-09 14:59:32 CET
</div>
</div>
<div class="social">
<ul class="fa-ul">
<li><a href="https://github.numberfour.eu/NumberFour/n4js-n4"><i class="fa-li fa fa-github"></i>N4IDL Repository</a></li>
</ul>
</div>
<script>
// Toggle the table of contents
$( "button#tocbutton" ).click(function() {
  if ($("#tocbutton").css('right') == '25px') {
    $( "#tocbutton" ).animate({right: '215px'},"slow");
    $( "#toc.toc2" ).animate({right: '0'},"slow");
}
  else {
    $( "#tocbutton" ).animate({right: '25px'},"slow");
    $( "#toc.toc2" ).animate({right: '-13rem'},"slow");
}
});
</script>
<script>
// Initialise mobile menu
  $(function(){
    $('#menu').slicknav();
  });
</script>
<script type="text/javascript">
// Create a back to top button
$('body').prepend('<a href="#" class="back-to-top">Back to Top</a>');
var amountScrolled = 300;
$(window).scroll(function() {
if ( $(window).scrollTop() > amountScrolled ) {
	$('a.back-to-top').fadeIn('slow');
} else {
	$('a.back-to-top').fadeOut('slow');
}
});
$('a.back-to-top, a.simple-back-to-top').click(function() {
$('html, body').animate({
	scrollTop: 0
}, 700);
return false;
});
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.0/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
<link rel="stylesheet" href="resources/scripts/styles/n4jshighlighter.min.css">
<script src="resources/scripts/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>